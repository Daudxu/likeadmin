import{a8 as rt,a9 as ue,d as ve,P as Ze,k as le,ct as sr,cu as xt,ay as or,cv as Mt,cw as Nt,ab as lr,D as Lt,o as H,c as q,T as J,h as B,e as j,q as Ee,U as pe,t as ie,i as Q,f as fe,w as $,W as ur,p as xe,X as ot,$ as Bt,ac as Tt,au as dr,am as pt,aA as ye,cx as cr,r as oe,bQ as Oe,v as Be,a as K,cy as hr,az as Ue,cz as fr,cA as gr,V as ke,ca as pr,H as vr,y as Ut,aq as et,cB as mr,cC as yr,L as Ge,M as Er,O as Tr,ap as Sr,ad as br,Y as Ar,av as Lr,bo as kt,ax as ct,_ as lt,s as ut,cD as kr,cE as _r,aO as vt,g as ee,E as Gt,cF as Dr,cG as Rr,cH as Cr,cI as Ir,l as tt,cJ as wr,cK as Or,cL as Fr,cM as Pr,Q as Te,aw as Se,m as St,b as jt,ak as mt,an as xr,bN as je,bM as Ve,ck as bt,K as At,N as Mr,cN as Nr,S as Br,Z as Ur,cO as Gr,cP as jr,cQ as Vr,cR as Kr,cS as Hr,cT as Wr,cU as $r}from"./index.4ed0f585.js";import{P as Vt}from"./index.6e09a7fb.js";import{E as qr,a as Yr}from"./el-table-column.dd73078f.js";import{E as zr}from"./el-checkbox.7ab27357.js";import"./el-tag.bb98b154.js";import{E as Kt}from"./el-input.cb3a28b0.js";import{E as Xr,a as Qr}from"./el-select.8818cd12.js";import{P as Ht}from"./index.fa4479f1.js";import{E as Wt}from"./el-overlay.801b9a15.js";import{E as Zr}from"./el-tree.487a0a08.js";import{E as Jr}from"./el-popover.8b5c8e10.js";import{u as ei}from"./pages.83b1647b.js";import{E as ti,a as ri}from"./el-image-viewer.a8d15a14.js";const $t=Symbol("uploadContextKey"),ii=rt({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:F=>F>=0&&F<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:ue(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:ue([String,Array,Function]),default:""},format:{type:ue(Function),default:F=>`${F}%`}}),ni=["aria-valuenow"],ai={viewBox:"0 0 100 100"},si=["d","stroke","stroke-width"],oi=["d","stroke","opacity","stroke-linecap","stroke-width"],li={key:0},ui={name:"ElProgress"},di=ve({...ui,props:ii,setup(F){const R=F,h={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},_=Ze("progress"),T=le(()=>({width:`${R.percentage}%`,animationDuration:`${R.duration}s`,backgroundColor:t(R.percentage)})),A=le(()=>(R.strokeWidth/R.width*100).toFixed(1)),k=le(()=>["circle","dashboard"].includes(R.type)?Number.parseInt(`${50-Number.parseFloat(A.value)/2}`,10):0),I=le(()=>{const n=k.value,u=R.type==="dashboard";return`
          M 50 50
          m 0 ${u?"":"-"}${n}
          a ${n} ${n} 0 1 1 0 ${u?"-":""}${n*2}
          a ${n} ${n} 0 1 1 0 ${u?"":"-"}${n*2}
          `}),D=le(()=>2*Math.PI*k.value),o=le(()=>R.type==="dashboard"?.75:1),b=le(()=>`${-1*D.value*(1-o.value)/2}px`),y=le(()=>({strokeDasharray:`${D.value*o.value}px, ${D.value}px`,strokeDashoffset:b.value})),d=le(()=>({strokeDasharray:`${D.value*o.value*(R.percentage/100)}px, ${D.value}px`,strokeDashoffset:b.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),p=le(()=>{let n;return R.color?n=t(R.percentage):n=h[R.status]||h.default,n}),m=le(()=>R.status==="warning"?sr:R.type==="line"?R.status==="success"?xt:or:R.status==="success"?Mt:Nt),l=le(()=>R.type==="line"?12+R.strokeWidth*.4:R.width*.111111+2),e=le(()=>R.format(R.percentage));function i(n){const u=100/n.length;return n.map((c,E)=>Lt(c)?{color:c,percentage:(E+1)*u}:c).sort((c,E)=>c.percentage-E.percentage)}const t=n=>{var u;const{color:a}=R;if(lr(a))return a(n);if(Lt(a))return a;{const c=i(a);for(const E of c)if(E.percentage>n)return E.color;return(u=c[c.length-1])==null?void 0:u.color}};return(n,u)=>(H(),q("div",{class:J([B(_).b(),B(_).m(n.type),B(_).is(n.status),{[B(_).m("without-text")]:!n.showText,[B(_).m("text-inside")]:n.textInside}]),role:"progressbar","aria-valuenow":n.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[n.type==="line"?(H(),q("div",{key:0,class:J(B(_).b("bar"))},[j("div",{class:J(B(_).be("bar","outer")),style:Ee({height:`${n.strokeWidth}px`})},[j("div",{class:J([B(_).be("bar","inner"),{[B(_).bem("bar","inner","indeterminate")]:n.indeterminate}]),style:Ee(B(T))},[(n.showText||n.$slots.default)&&n.textInside?(H(),q("div",{key:0,class:J(B(_).be("bar","innerText"))},[pe(n.$slots,"default",{percentage:n.percentage},()=>[j("span",null,ie(B(e)),1)])],2)):Q("v-if",!0)],6)],6)],2)):(H(),q("div",{key:1,class:J(B(_).b("circle")),style:Ee({height:`${n.width}px`,width:`${n.width}px`})},[(H(),q("svg",ai,[j("path",{class:J(B(_).be("circle","track")),d:B(I),stroke:`var(${B(_).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":B(A),fill:"none",style:Ee(B(y))},null,14,si),j("path",{class:J(B(_).be("circle","path")),d:B(I),stroke:B(p),fill:"none",opacity:n.percentage?1:0,"stroke-linecap":n.strokeLinecap,"stroke-width":B(A),style:Ee(B(d))},null,14,oi)]))],6)),(n.showText||n.$slots.default)&&!n.textInside?(H(),q("div",{key:2,class:J(B(_).e("text")),style:Ee({fontSize:`${B(l)}px`})},[pe(n.$slots,"default",{percentage:n.percentage},()=>[n.status?(H(),fe(B(xe),{key:1},{default:$(()=>[(H(),fe(ur(B(m))))]),_:1})):(H(),q("span",li,ie(B(e)),1))])],6)):Q("v-if",!0)],10,ni))}});var ci=ot(di,[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]);const qt=Bt(ci),hi="ElUpload";class fi extends Error{constructor(R,h,_,T){super(R),this.name="UploadAjaxError",this.status=h,this.method=_,this.url=T}}function _t(F,R,h){let _;return h.response?_=`${h.response.error||h.response}`:h.responseText?_=`${h.responseText}`:_=`fail to ${R.method} ${F} ${h.status}`,new fi(_,h.status,R.method,F)}function gi(F){const R=F.responseText||F.response;if(!R)return R;try{return JSON.parse(R)}catch{return R}}const pi=F=>{typeof XMLHttpRequest=="undefined"&&Tt(hi,"XMLHttpRequest is undefined");const R=new XMLHttpRequest,h=F.action;R.upload&&R.upload.addEventListener("progress",A=>{const k=A;k.percent=A.total>0?A.loaded/A.total*100:0,F.onProgress(k)});const _=new FormData;if(F.data)for(const[A,k]of Object.entries(F.data))Array.isArray(k)?_.append(A,...k):_.append(A,k);_.append(F.filename,F.file,F.file.name),R.addEventListener("error",()=>{F.onError(_t(h,F,R))}),R.addEventListener("load",()=>{if(R.status<200||R.status>=300)return F.onError(_t(h,F,R));F.onSuccess(gi(R))}),R.open(F.method,h,!0),F.withCredentials&&"withCredentials"in R&&(R.withCredentials=!0);const T=F.headers||{};if(T instanceof Headers)T.forEach((A,k)=>R.setRequestHeader(k,A));else for(const[A,k]of Object.entries(T))dr(k)||R.setRequestHeader(A,String(k));return R.send(_),R},Yt=["text","picture","picture-card"];let vi=1;const zt=()=>Date.now()+vi++,Xt=rt({action:{type:String,default:"#"},headers:{type:ue(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>pt({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:ue(Array),default:()=>pt([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:Yt,default:"text"},httpRequest:{type:ue(Function),default:pi},disabled:Boolean,limit:Number}),mi=rt({...Xt,beforeUpload:{type:ue(Function),default:ye},beforeRemove:{type:ue(Function)},onRemove:{type:ue(Function),default:ye},onChange:{type:ue(Function),default:ye},onPreview:{type:ue(Function),default:ye},onSuccess:{type:ue(Function),default:ye},onProgress:{type:ue(Function),default:ye},onError:{type:ue(Function),default:ye},onExceed:{type:ue(Function),default:ye}}),yi=rt({files:{type:ue(Array),default:()=>pt([])},disabled:{type:Boolean,default:!1},handlePreview:{type:ue(Function),default:ye},listType:{type:String,values:Yt,default:"text"}}),Ei={remove:F=>!!F},Ti=["onKeydown"],Si=["src"],bi=["onClick"],Ai=["onClick"],Li=["onClick"],ki={name:"ElUploadList"},_i=ve({...ki,props:yi,emits:Ei,setup(F,{emit:R}){const h=F,{t:_}=cr(),T=Ze("upload"),A=Ze("icon"),k=Ze("list"),I=oe(!1),D=b=>{h.handlePreview(b)},o=b=>{R("remove",b)};return(b,y)=>(H(),fe(pr,{tag:"ul",class:J([B(T).b("list"),B(T).bm("list",b.listType),B(T).is("disabled",b.disabled)]),name:B(k).b()},{default:$(()=>[(H(!0),q(ke,null,Oe(b.files,d=>(H(),q("li",{key:d.uid||d.name,class:J([B(T).be("list","item"),B(T).is(d.status),{focusing:I.value}]),tabindex:"0",onKeydown:Be(p=>!b.disabled&&o(d),["delete"]),onFocus:y[0]||(y[0]=p=>I.value=!0),onBlur:y[1]||(y[1]=p=>I.value=!1),onClick:y[2]||(y[2]=p=>I.value=!1)},[pe(b.$slots,"default",{file:d},()=>[b.listType==="picture"||d.status!=="uploading"&&b.listType==="picture-card"?(H(),q("img",{key:0,class:J(B(T).be("list","item-thumbnail")),src:d.url,alt:""},null,10,Si)):Q("v-if",!0),b.listType!=="picture"&&(d.status==="uploading"||b.listType!=="picture-card")?(H(),q("div",{key:1,class:J(B(T).be("list","item-info"))},[j("a",{class:J(B(T).be("list","item-name")),onClick:Ue(p=>D(d),["prevent"])},[K(B(xe),{class:J(B(A).m("document"))},{default:$(()=>[K(B(hr))]),_:1},8,["class"]),j("span",{class:J(B(T).be("list","item-file-name"))},ie(d.name),3)],10,bi),d.status==="uploading"?(H(),fe(B(qt),{key:0,type:b.listType==="picture-card"?"circle":"line","stroke-width":b.listType==="picture-card"?6:2,percentage:Number(d.percentage),style:Ee(b.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):Q("v-if",!0)],2)):Q("v-if",!0),j("label",{class:J(B(T).be("list","item-status-label"))},[b.listType==="text"?(H(),fe(B(xe),{key:0,class:J([B(A).m("upload-success"),B(A).m("circle-check")])},{default:$(()=>[K(B(xt))]),_:1},8,["class"])):["picture-card","picture"].includes(b.listType)?(H(),fe(B(xe),{key:1,class:J([B(A).m("upload-success"),B(A).m("check")])},{default:$(()=>[K(B(Mt))]),_:1},8,["class"])):Q("v-if",!0)],2),b.disabled?Q("v-if",!0):(H(),fe(B(xe),{key:2,class:J(B(A).m("close")),onClick:p=>o(d)},{default:$(()=>[K(B(Nt))]),_:2},1032,["class","onClick"])),Q(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),Q(" This is a bug which needs to be fixed "),Q(" TODO: Fix the incorrect navigation interaction "),b.disabled?Q("v-if",!0):(H(),q("i",{key:3,class:J(B(A).m("close-tip"))},ie(B(_)("el.upload.deleteTip")),3)),b.listType==="picture-card"?(H(),q("span",{key:4,class:J(B(T).be("list","item-actions"))},[j("span",{class:J(B(T).be("list","item-preview")),onClick:p=>b.handlePreview(d)},[K(B(xe),{class:J(B(A).m("zoom-in"))},{default:$(()=>[K(B(fr))]),_:1},8,["class"])],10,Ai),b.disabled?Q("v-if",!0):(H(),q("span",{key:0,class:J(B(T).be("list","item-delete")),onClick:p=>o(d)},[K(B(xe),{class:J(B(A).m("delete"))},{default:$(()=>[K(B(gr))]),_:1},8,["class"])],10,Li))],2)):Q("v-if",!0)])],42,Ti))),128)),pe(b.$slots,"append")]),_:3},8,["class","name"]))}});var Dt=ot(_i,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const Di=rt({disabled:{type:Boolean,default:!1}}),Ri={file:F=>vr(F)},Ci=["onDrop","onDragover"],Ii={name:"ElUploadDrag"},wi=ve({...Ii,props:Di,emits:Ri,setup(F,{emit:R}){const h=F,_="ElUploadDrag",T=Ut($t);T||Tt(_,"usage: <el-upload><el-upload-dragger /></el-upload>");const A=Ze("upload"),k=oe(!1),I=o=>{if(h.disabled)return;k.value=!1;const b=Array.from(o.dataTransfer.files),y=T.accept.value;if(!y){R("file",b);return}const d=b.filter(p=>{const{type:m,name:l}=p,e=l.includes(".")?`.${l.split(".").pop()}`:"",i=m.replace(/\/.*$/,"");return y.split(",").map(t=>t.trim()).filter(t=>t).some(t=>t.startsWith(".")?e===t:/\/\*$/.test(t)?i===t.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(t)?m===t:!1)});R("file",d)},D=()=>{h.disabled||(k.value=!0)};return(o,b)=>(H(),q("div",{class:J([B(A).b("dragger"),B(A).is("dragover",k.value)]),onDrop:Ue(I,["prevent"]),onDragover:Ue(D,["prevent"]),onDragleave:b[0]||(b[0]=Ue(y=>k.value=!1,["prevent"]))},[pe(o.$slots,"default")],42,Ci))}});var Oi=ot(wi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const Fi=rt({...Xt,beforeUpload:{type:ue(Function),default:ye},onRemove:{type:ue(Function),default:ye},onStart:{type:ue(Function),default:ye},onSuccess:{type:ue(Function),default:ye},onProgress:{type:ue(Function),default:ye},onError:{type:ue(Function),default:ye},onExceed:{type:ue(Function),default:ye}}),Pi=["onKeydown"],xi=["name","multiple","accept"],Mi={name:"ElUploadContent",inheritAttrs:!1},Ni=ve({...Mi,props:Fi,setup(F,{expose:R}){const h=F,_=Ze("upload"),T=et({}),A=et(),k=p=>{if(p.length===0)return;const{autoUpload:m,limit:l,fileList:e,multiple:i,onStart:t,onExceed:n}=h;if(l&&e.length+p.length>l){n(p,e);return}i||(p=p.slice(0,1));for(const u of p){const a=u;a.uid=zt(),t(a),m&&I(a)}},I=async p=>{if(A.value.value="",!h.beforeUpload)return D(p);let m;try{m=await h.beforeUpload(p)}catch{m=!1}if(m===!1){h.onRemove(p);return}let l=p;m instanceof Blob&&(m instanceof File?l=m:l=new File([m],p.name,{type:p.type})),D(Object.assign(l,{uid:p.uid}))},D=p=>{const{headers:m,data:l,method:e,withCredentials:i,name:t,action:n,onProgress:u,onSuccess:a,onError:c,httpRequest:E}=h,{uid:g}=p,v={headers:m||{},withCredentials:i,file:p,data:l,method:e,filename:t,action:n,onProgress:s=>{u(s,p)},onSuccess:s=>{a(s,p),delete T.value[g]},onError:s=>{c(s,p),delete T.value[g]}},r=E(v);T.value[g]=r,r instanceof Promise&&r.then(v.onSuccess,v.onError)},o=p=>{const m=p.target.files;!m||k(Array.from(m))},b=()=>{h.disabled||(A.value.value="",A.value.click())},y=()=>{b()};return R({abort:p=>{mr(T.value).filter(p?([l])=>String(p.uid)===l:()=>!0).forEach(([l,e])=>{e instanceof XMLHttpRequest&&e.abort(),delete T.value[l]})},upload:I}),(p,m)=>(H(),q("div",{class:J([B(_).b(),B(_).m(p.listType),B(_).is("drag",p.drag)]),tabindex:"0",onClick:b,onKeydown:Be(Ue(y,["self"]),["enter","space"])},[p.drag?(H(),fe(Oi,{key:0,disabled:p.disabled,onFile:k},{default:$(()=>[pe(p.$slots,"default")]),_:3},8,["disabled"])):pe(p.$slots,"default",{key:1}),j("input",{ref_key:"inputRef",ref:A,class:J(B(_).e("input")),name:p.name,multiple:p.multiple,accept:p.accept,type:"file",onChange:o,onClick:m[0]||(m[0]=Ue(()=>{},["stop"]))},null,42,xi)],42,Pi))}});var Rt=ot(Ni,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const Ct="ElUpload",Bi=F=>{var R;(R=F.url)!=null&&R.startsWith("blob:")&&URL.revokeObjectURL(F.url)},Ui=(F,R)=>{const h=yr(F,"fileList",void 0,{passive:!0}),_=d=>h.value.find(p=>p.uid===d.uid);function T(d){var p;(p=R.value)==null||p.abort(d)}function A(d=["ready","uploading","success","fail"]){h.value=h.value.filter(p=>!d.includes(p.status))}const k=(d,p)=>{const m=_(p);!m||(console.error(d),m.status="fail",h.value.splice(h.value.indexOf(m),1),F.onError(d,m,h.value),F.onChange(m,h.value))},I=(d,p)=>{const m=_(p);!m||(F.onProgress(d,m,h.value),m.status="uploading",m.percentage=Math.round(d.percent))},D=(d,p)=>{const m=_(p);!m||(m.status="success",m.response=d,F.onSuccess(d,m,h.value),F.onChange(m,h.value))},o=d=>{const p={name:d.name,percentage:0,status:"ready",size:d.size,raw:d,uid:d.uid};if(F.listType==="picture-card"||F.listType==="picture")try{p.url=URL.createObjectURL(d)}catch(m){Er(Ct,m.message),F.onError(m,p,h.value)}h.value.push(p),F.onChange(p,h.value)},b=async d=>{const p=d instanceof File?_(d):d;p||Tt(Ct,"file to be removed not found");const m=l=>{T(l);const e=h.value;e.splice(e.indexOf(l),1),F.onRemove(l,e),Bi(l)};F.beforeRemove?await F.beforeRemove(p,h.value)!==!1&&m(p):m(p)};function y(){h.value.filter(({status:d})=>d==="ready").forEach(({raw:d})=>{var p;return d&&((p=R.value)==null?void 0:p.upload(d))})}return Ge(()=>F.listType,d=>{d!=="picture-card"&&d!=="picture"||(h.value=h.value.map(p=>{const{raw:m,url:l}=p;if(!l&&m)try{p.url=URL.createObjectURL(m)}catch(e){F.onError(e,p,h.value)}return p}))}),Ge(h,d=>{for(const p of d)p.uid||(p.uid=zt()),p.status||(p.status="success")},{immediate:!0,deep:!0}),{uploadFiles:h,abort:T,clearFiles:A,handleError:k,handleProgress:I,handleStart:o,handleSuccess:D,handleRemove:b,submit:y}},Gi={name:"ElUpload"},ji=ve({...Gi,props:mi,setup(F,{expose:R}){const h=F,_=Tr(),T=Sr(),A=et(),{abort:k,submit:I,clearFiles:D,uploadFiles:o,handleStart:b,handleError:y,handleRemove:d,handleSuccess:p,handleProgress:m}=Ui(h,A),l=le(()=>h.listType==="picture-card"),e=le(()=>({...h,onStart:b,onProgress:m,onSuccess:p,onError:y,onRemove:d}));return br(()=>{o.value.forEach(({url:i})=>{i!=null&&i.startsWith("blob:")&&URL.revokeObjectURL(i)})}),Ar($t,{accept:Lr(h,"accept")}),R({abort:k,submit:I,clearFiles:D,handleStart:b,handleRemove:d}),(i,t)=>(H(),q("div",null,[B(l)&&i.showFileList?(H(),fe(Dt,{key:0,disabled:B(T),"list-type":i.listType,files:B(o),"handle-preview":i.onPreview,onRemove:B(d)},kt({append:$(()=>[i.listType==="picture-card"?(H(),fe(Rt,ct({key:0,ref_key:"uploadRef",ref:A},B(e)),{default:$(()=>[B(_).trigger?pe(i.$slots,"trigger",{key:0}):Q("v-if",!0),!B(_).trigger&&B(_).default?pe(i.$slots,"default",{key:1}):Q("v-if",!0)]),_:3},16)):Q("v-if",!0)]),_:2},[i.$slots.file?{name:"default",fn:$(({file:n})=>[pe(i.$slots,"file",{file:n})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):Q("v-if",!0),i.listType!=="picture-card"?(H(),fe(Rt,ct({key:1,ref_key:"uploadRef",ref:A},B(e)),{default:$(()=>[B(_).trigger?pe(i.$slots,"trigger",{key:0}):Q("v-if",!0),!B(_).trigger&&B(_).default?pe(i.$slots,"default",{key:1}):Q("v-if",!0)]),_:3},16)):Q("v-if",!0),i.$slots.trigger?pe(i.$slots,"default",{key:2}):Q("v-if",!0),pe(i.$slots,"tip"),!B(l)&&i.showFileList?(H(),fe(Dt,{key:3,disabled:B(T),"list-type":i.listType,files:B(o),"handle-preview":i.onPreview,onRemove:B(d)},kt({_:2},[i.$slots.file?{name:"default",fn:$(({file:n})=>[pe(i.$slots,"file",{file:n})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):Q("v-if",!0)]))}});var Vi=ot(ji,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Ki=Bt(Vi);const Hi=ve({components:{},props:{showClose:{type:Boolean,default:!0}},emits:["close"],setup(F,{emit:R}){return{handleClose:()=>{R("close")}}}}),Wi={class:"del-wrap"};function $i(F,R,h,_,T,A){const k=ut("close-bold"),I=xe;return H(),q("div",Wi,[pe(F.$slots,"default",{},void 0,!0),F.showClose?(H(),q("div",{key:0,class:"icon-close",onClick:R[0]||(R[0]=Ue((...D)=>F.handleClose&&F.handleClose(...D),["stop"]))},[K(I,{size:12},{default:$(()=>[K(k)]),_:1})])):Q("",!0)])}var Qt=lt(Hi,[["render",$i],["__scopeId","data-v-77bc45f0"]]);const qi=ve({components:{DelWrap:Qt},props:{uri:{type:String},fileSize:{type:String,default:"100px"},type:{type:String,default:"image"}},emits:["close"]}),Yi=["src"];function zi(F,R,h,_,T,A){const k=ti;return H(),q("div",null,[j("div",{class:"file-item",style:Ee({height:F.fileSize,width:F.fileSize})},[F.type=="image"?(H(),fe(k,{key:0,class:"image",fit:"contain",src:F.uri},null,8,["src"])):F.type=="video"?(H(),q("video",{key:1,class:"video",src:F.uri},null,8,Yi)):Q("",!0),pe(F.$slots,"default",{},void 0,!0)],4)])}var Xi=lt(qi,[["render",zi],["__scopeId","data-v-c29ff784"]]);const Qi=ve({components:{},props:{type:{type:String,default:"image"},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},showProgress:{type:Boolean,default:!1}},emits:["change","error"],setup(F,{emit:R}){const h=kr(),_=oe(null),T=oe(`/adminapi/upload/${F.type}`),A=le(()=>({token:h.getters.token,version:_r})),k=oe(!1),I=oe([]);return{uploadRefs:_,action:T,headers:A,visible:k,fileList:I,handleProgress:(p,m,l)=>{k.value=!0,I.value=l},handleSuccess:(p,m,l)=>{var i;l.every(t=>t.status=="success")&&((i=_.value)==null||i.clearFiles(),k.value=!1,R("change"))},handleError:(p,m,l)=>{var e;vt.error(`${m.name}\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25`),(e=_.value)==null||e.abort(),k.value=!1,R("change"),R("error")},handleExceed:()=>{vt.error("\u8D85\u51FA\u4E0A\u4F20\u4E0A\u9650\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20")},handleClose:()=>{var p,m;(p=_.value)==null||p.abort(),(m=_.value)==null||m.clearFiles(),k.value=!1}}}}),Zi={class:"upload"},Ji={class:"file-list"},en={class:"flex-1"};function tn(F,R,h,_,T,A){const k=Ki,I=qt,D=Wt;return H(),q("div",Zi,[K(k,{ref:"uploadRefs",action:F.action,multiple:F.multiple,limit:F.limit,"show-file-list":!1,headers:F.headers,data:F.data,"on-progress":F.handleProgress,"on-success":F.handleSuccess,"on-exceed":F.handleExceed,"on-error":F.handleError},{default:$(()=>[pe(F.$slots,"default")]),_:3},8,["action","multiple","limit","headers","data","on-progress","on-success","on-exceed","on-error"]),F.showProgress&&F.fileList.length?(H(),fe(D,{key:0,modelValue:F.visible,"onUpdate:modelValue":R[0]||(R[0]=o=>F.visible=o),title:"\u4E0A\u4F20\u8FDB\u5EA6","close-on-click-modal":!1,width:"500px",modal:!1,"before-close":F.handleClose},{default:$(()=>[j("div",Ji,[(H(!0),q(ke,null,Oe(F.fileList,(o,b)=>(H(),q("div",{key:b,class:"m-b-20"},[j("div",null,ie(o.name),1),j("div",en,[K(I,{percentage:parseInt(o.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue","before-close"])):Q("",!0)])}var Zt=lt(Qi,[["render",tn]]);const rn=ve({props:{type:{type:String,default:"number"},width:{type:Number,default:250},value:{type:String},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["confirm"],setup(F,{emit:R}){const h=oe(!1),_=oe(F.value),T=()=>{F.disabled||(h.value=!0)},A=()=>{h.value=!1};return{visible:h,inputValue:_,open:T,close:A,handleConfirm:()=>{_.value&&(R("confirm",_.value),_.value=""),A()}}}}),nn={class:"popover-input"},an={class:"flex"},sn={class:"popover-input__input m-r-10 flex-1"},on={class:"popover-input__btns flex-none"},ln=ee("\u53D6\u6D88"),un=ee("\u786E\u5B9A");function dn(F,R,h,_,T,A){const k=Kt,I=Gt,D=Jr;return H(),q("div",nn,[K(D,{visible:F.visible,"onUpdate:visible":R[2]||(R[2]=o=>F.visible=o),placement:"top",width:F.width},{reference:$(()=>[j("div",{class:"inline",type:"text",onClick:R[1]||(R[1]=(...o)=>F.open&&F.open(...o))},[pe(F.$slots,"default")])]),default:$(()=>[j("div",an,[j("div",sn,[K(k,{modelValue:F.inputValue,"onUpdate:modelValue":R[0]||(R[0]=o=>F.inputValue=o),modelModifiers:{trim:!0},type:F.type,placeholder:F.placeholder},null,8,["modelValue","type","placeholder"])]),j("div",on,[K(I,{type:"text",onClick:F.close},{default:$(()=>[ln]),_:1},8,["onClick"]),K(I,{type:"primary",onClick:F.handleConfirm},{default:$(()=>[un]),_:1},8,["onClick"])])])]),_:3},8,["visible","width"])])}var Jt=lt(rn,[["render",dn]]);function cn(F){const R=oe([]),h=oe(""),_=I=>{Dr({type:F.value,pid:0,name:I}).then(()=>{k()})},T=(I,D)=>{Rr({id:D,name:I}).then(()=>{k()})},A=I=>{Cr({id:I}).then(()=>{k()})},k=()=>new Promise((I,D)=>{Ir({type:F.value,page_type:0}).then(o=>{const b=[{name:"\u5168\u90E8",id:""},{name:"\u672A\u5206\u7EC4",id:0}];R.value=o==null?void 0:o.lists,R.value.unshift(...b),I(R)})});return{cateId:h,cateLists:R,handleAddCate:_,handleEditCate:T,handleDeleteCate:A,getCateLists:k}}function hn(F,R,h,_){const T=et(),A=oe("normal"),k=oe(0),I=oe([]),D=oe(!1),o=oe(!1),b=tt({name:"",type:R,cid:F}),{pager:y,requestApi:d,resetPage:p}=ei({callback:Pr,params:b,firstLoading:!1,size:_}),m=le(()=>g=>I.value.find(v=>v.id==g)),l=()=>{d()},e=()=>{p()},i=g=>{let v=g||I.value.map(r=>r.id);wr({ids:v}).then(r=>{l(),u()})},t=()=>{let g=I.value.map(v=>v.id);Or({ids:g,cid:k.value}).then(v=>{k.value=0,l(),u()})},n=g=>{let v=I.value.findIndex(r=>r.id==g.id);if(v!=-1){I.value.splice(v,1);return}if(I.value.length==h.value){if(h.value==1){I.value=[],I.value.push(g);return}vt.warning("\u5DF2\u8FBE\u5230\u9009\u62E9\u4E0A\u9650");return}I.value.push(g)},u=()=>{I.value=[]};return{listShowType:A,tableRef:T,moveId:k,pager:y,fileParams:b,select:I,isCheckAll:D,isIndeterminate:o,getFileList:l,refresh:e,batchFileDelete:i,batchFileMove:t,selectFile:n,selectStatus:m,clearSelect:u,cancelSelete:g=>{I.value=I.value.filter(v=>v.id!=g)},selectAll:g=>{var v;if(o.value=!1,(v=T.value)==null||v.toggleAllSelection(),g){I.value=[...y.lists];return}u()},fileRename:(g,v)=>{Fr({id:v,name:g}).then(()=>{l()})}}}var fn=Object.defineProperty,gn=Object.defineProperties,pn=Object.getOwnPropertyDescriptors,It=Object.getOwnPropertySymbols,vn=Object.prototype.hasOwnProperty,mn=Object.prototype.propertyIsEnumerable,wt=(F,R,h)=>R in F?fn(F,R,{enumerable:!0,configurable:!0,writable:!0,value:h}):F[R]=h,yt=(F,R)=>{for(var h in R||(R={}))vn.call(R,h)&&wt(F,h,R[h]);if(It)for(var h of It(R))mn.call(R,h)&&wt(F,h,R[h]);return F},Et=(F,R)=>gn(F,pn(R));function Ot(F,R,h,_){var T,A=!1,k=0;function I(){T&&clearTimeout(T)}function D(){for(var o=arguments.length,b=new Array(o),y=0;y<o;y++)b[y]=arguments[y];var d=this,p=Date.now()-k;function m(){k=Date.now(),h.apply(d,b)}function l(){T=void 0}A||(_&&!T&&m(),I(),_===void 0&&p>F?m():R!==!0&&(T=setTimeout(_?l:m,_===void 0?F-p:F)))}return typeof R!="boolean"&&(_=h,h=R,R=void 0),D.cancel=function(){I(),A=!0},D}function Ft(F,R,h){return h===void 0?Ot(F,R,!1):Ot(F,h,R!==!1)}function yn(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}var er={exports:{}};typeof window!="undefined"&&(er.exports=function(F){var R={};function h(_){if(R[_])return R[_].exports;var T=R[_]={i:_,l:!1,exports:{}};return F[_].call(T.exports,T,T.exports,h),T.l=!0,T.exports}return h.m=F,h.c=R,h.d=function(_,T,A){h.o(_,T)||Object.defineProperty(_,T,{enumerable:!0,get:A})},h.r=function(_){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},h.t=function(_,T){if(1&T&&(_=h(_)),8&T||4&T&&typeof _=="object"&&_&&_.__esModule)return _;var A=Object.create(null);if(h.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:_}),2&T&&typeof _!="string")for(var k in _)h.d(A,k,function(I){return _[I]}.bind(null,k));return A},h.n=function(_){var T=_&&_.__esModule?function(){return _.default}:function(){return _};return h.d(T,"a",T),T},h.o=function(_,T){return Object.prototype.hasOwnProperty.call(_,T)},h.p="/dist/",h(h.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(F,R,h){var _=Object.prototype.hasOwnProperty,T="~";function A(){}function k(b,y,d){this.fn=b,this.context=y,this.once=d||!1}function I(b,y,d,p,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var l=new k(d,p||b,m),e=T?T+y:y;return b._events[e]?b._events[e].fn?b._events[e]=[b._events[e],l]:b._events[e].push(l):(b._events[e]=l,b._eventsCount++),b}function D(b,y){--b._eventsCount==0?b._events=new A:delete b._events[y]}function o(){this._events=new A,this._eventsCount=0}Object.create&&(A.prototype=Object.create(null),new A().__proto__||(T=!1)),o.prototype.eventNames=function(){var b,y,d=[];if(this._eventsCount===0)return d;for(y in b=this._events)_.call(b,y)&&d.push(T?y.slice(1):y);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(b)):d},o.prototype.listeners=function(b){var y=T?T+b:b,d=this._events[y];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,m=d.length,l=new Array(m);p<m;p++)l[p]=d[p].fn;return l},o.prototype.listenerCount=function(b){var y=T?T+b:b,d=this._events[y];return d?d.fn?1:d.length:0},o.prototype.emit=function(b,y,d,p,m,l){var e=T?T+b:b;if(!this._events[e])return!1;var i,t,n=this._events[e],u=arguments.length;if(n.fn){switch(n.once&&this.removeListener(b,n.fn,void 0,!0),u){case 1:return n.fn.call(n.context),!0;case 2:return n.fn.call(n.context,y),!0;case 3:return n.fn.call(n.context,y,d),!0;case 4:return n.fn.call(n.context,y,d,p),!0;case 5:return n.fn.call(n.context,y,d,p,m),!0;case 6:return n.fn.call(n.context,y,d,p,m,l),!0}for(t=1,i=new Array(u-1);t<u;t++)i[t-1]=arguments[t];n.fn.apply(n.context,i)}else{var a,c=n.length;for(t=0;t<c;t++)switch(n[t].once&&this.removeListener(b,n[t].fn,void 0,!0),u){case 1:n[t].fn.call(n[t].context);break;case 2:n[t].fn.call(n[t].context,y);break;case 3:n[t].fn.call(n[t].context,y,d);break;case 4:n[t].fn.call(n[t].context,y,d,p);break;default:if(!i)for(a=1,i=new Array(u-1);a<u;a++)i[a-1]=arguments[a];n[t].fn.apply(n[t].context,i)}}return!0},o.prototype.on=function(b,y,d){return I(this,b,y,d,!1)},o.prototype.once=function(b,y,d){return I(this,b,y,d,!0)},o.prototype.removeListener=function(b,y,d,p){var m=T?T+b:b;if(!this._events[m])return this;if(!y)return D(this,m),this;var l=this._events[m];if(l.fn)l.fn!==y||p&&!l.once||d&&l.context!==d||D(this,m);else{for(var e=0,i=[],t=l.length;e<t;e++)(l[e].fn!==y||p&&!l[e].once||d&&l[e].context!==d)&&i.push(l[e]);i.length?this._events[m]=i.length===1?i[0]:i:D(this,m)}return this},o.prototype.removeAllListeners=function(b){var y;return b?(y=T?T+b:b,this._events[y]&&D(this,y)):(this._events=new A,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=T,o.EventEmitter=o,F.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(F,R,h){var _,T,A,k,I;_=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,T=/^([^\/?#]*)([^]*)$/,A=/(?:\/|^)\.(?=\/)/g,k=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(D,o,b){if(b=b||{},D=D.trim(),!(o=o.trim())){if(!b.alwaysNormalize)return D;var y=I.parseURL(D);if(!y)throw new Error("Error trying to parse base URL.");return y.path=I.normalizePath(y.path),I.buildURLFromParts(y)}var d=I.parseURL(o);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return b.alwaysNormalize?(d.path=I.normalizePath(d.path),I.buildURLFromParts(d)):o;var p=I.parseURL(D);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var m=T.exec(p.path);p.netLoc=m[1],p.path=m[2]}p.netLoc&&!p.path&&(p.path="/");var l={scheme:p.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(l.netLoc=p.netLoc,d.path[0]!=="/"))if(d.path){var e=p.path,i=e.substring(0,e.lastIndexOf("/")+1)+d.path;l.path=I.normalizePath(i)}else l.path=p.path,d.params||(l.params=p.params,d.query||(l.query=p.query));return l.path===null&&(l.path=b.alwaysNormalize?I.normalizePath(d.path):d.path),I.buildURLFromParts(l)},parseURL:function(D){var o=_.exec(D);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(D){for(D=D.split("").reverse().join("").replace(A,"");D.length!==(D=D.replace(k,"")).length;);return D.split("").reverse().join("")},buildURLFromParts:function(D){return D.scheme+D.netLoc+D.path+D.params+D.query+D.fragment}},F.exports=I},"./node_modules/webworkify-webpack/index.js":function(F,R,h){function _(o){var b={};function y(p){if(b[p])return b[p].exports;var m=b[p]={i:p,l:!1,exports:{}};return o[p].call(m.exports,m,m.exports,y),m.l=!0,m.exports}y.m=o,y.c=b,y.i=function(p){return p},y.d=function(p,m,l){y.o(p,m)||Object.defineProperty(p,m,{configurable:!1,enumerable:!0,get:l})},y.r=function(p){Object.defineProperty(p,"__esModule",{value:!0})},y.n=function(p){var m=p&&p.__esModule?function(){return p.default}:function(){return p};return y.d(m,"a",m),m},y.o=function(p,m){return Object.prototype.hasOwnProperty.call(p,m)},y.p="/",y.oe=function(p){throw console.error(p),p};var d=y(y.s=ENTRY_MODULE);return d.default||d}var T="[\\.|\\-|\\+|\\w|/|@]+",A="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function k(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function I(o,b,y){var d={};d[y]=[];var p=b.toString(),m=p.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!m)return d;for(var l,e=m[1],i=new RegExp("(\\\\n|\\W)"+k(e)+A,"g");l=i.exec(p);)l[3]!=="dll-reference"&&d[y].push(l[3]);for(i=new RegExp("\\("+k(e)+'\\("(dll-reference\\s('+T+'))"\\)\\)'+A,"g");l=i.exec(p);)o[l[2]]||(d[y].push(l[1]),o[l[2]]=h(l[1]).m),d[l[2]]=d[l[2]]||[],d[l[2]].push(l[4]);for(var t,n=Object.keys(d),u=0;u<n.length;u++)for(var a=0;a<d[n[u]].length;a++)t=d[n[u]][a],isNaN(1*t)||(d[n[u]][a]=1*d[n[u]][a]);return d}function D(o){return Object.keys(o).reduce(function(b,y){return b||o[y].length>0},!1)}F.exports=function(o,b){b=b||{};var y={main:h.m},d=b.all?{main:Object.keys(y.main)}:function(i,t){for(var n={main:[t]},u={main:[]},a={main:{}};D(n);)for(var c=Object.keys(n),E=0;E<c.length;E++){var g=c[E],v=n[g].pop();if(a[g]=a[g]||{},!a[g][v]&&i[g][v]){a[g][v]=!0,u[g]=u[g]||[],u[g].push(v);for(var r=I(i,i[g][v],g),s=Object.keys(r),f=0;f<s.length;f++)n[s[f]]=n[s[f]]||[],n[s[f]]=n[s[f]].concat(r[s[f]])}}return u}(y,o),p="";Object.keys(d).filter(function(i){return i!=="main"}).forEach(function(i){for(var t=0;d[i][t];)t++;d[i].push(t),y[i][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",p=p+"var "+i+" = ("+_.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+d[i].map(function(n){return JSON.stringify(n)+": "+y[i][n].toString()}).join(",")+`});
`}),p=p+"new (("+_.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+d.main.map(function(i){return JSON.stringify(i)+": "+y.main[i].toString()}).join(",")+"}))(self);";var m=new window.Blob([p],{type:"text/javascript"});if(b.bare)return m;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(m),e=new window.Worker(l);return e.objectURL=l,e}},"./src/config.ts":function(F,R,h){h.r(R),h.d(R,"hlsDefaultConfig",function(){return c}),h.d(R,"mergeConfig",function(){return E}),h.d(R,"enableStreamingMode",function(){return g});var _=h("./src/controller/abr-controller.ts"),T=h("./src/controller/audio-stream-controller.ts"),A=h("./src/controller/audio-track-controller.ts"),k=h("./src/controller/subtitle-stream-controller.ts"),I=h("./src/controller/subtitle-track-controller.ts"),D=h("./src/controller/buffer-controller.ts"),o=h("./src/controller/timeline-controller.ts"),b=h("./src/controller/cap-level-controller.ts"),y=h("./src/controller/fps-controller.ts"),d=h("./src/controller/eme-controller.ts"),p=h("./src/utils/xhr-loader.ts"),m=h("./src/utils/fetch-loader.ts"),l=h("./src/utils/cues.ts"),e=h("./src/utils/mediakeys-helper.ts"),i=h("./src/utils/logger.ts");function t(){return(t=Object.assign||function(v){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var f in s)Object.prototype.hasOwnProperty.call(s,f)&&(v[f]=s[f])}return v}).apply(this,arguments)}function n(v,r){var s=Object.keys(v);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(v);r&&(f=f.filter(function(S){return Object.getOwnPropertyDescriptor(v,S).enumerable})),s.push.apply(s,f)}return s}function u(v){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?n(Object(s),!0).forEach(function(f){a(v,f,s[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(f){Object.defineProperty(v,f,Object.getOwnPropertyDescriptor(s,f))})}return v}function a(v,r,s){return r in v?Object.defineProperty(v,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):v[r]=s,v}var c=u(u({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:_.default,bufferController:D.default,capLevelController:b.default,fpsController:y.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:l.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:k.SubtitleStreamController,subtitleTrackController:I.default,timelineController:o.TimelineController,audioStreamController:T.default,audioTrackController:A.default,emeController:d.default});function E(v,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},v,r)}function g(v){var r=v.loader;r!==m.default&&r!==p.default?(i.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),v.progressive=!1):Object(m.fetchSupported)()&&(v.loader=m.default,v.progressive=!0,v.enableSoftwareAES=!0,i.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(F,R,h){h.r(R);var _=h("./src/polyfills/number.ts"),T=h("./src/utils/ewma-bandwidth-estimator.ts"),A=h("./src/events.ts"),k=h("./src/utils/buffer-helper.ts"),I=h("./src/errors.ts"),D=h("./src/types/loader.ts"),o=h("./src/utils/logger.ts");function b(d,p){for(var m=0;m<p.length;m++){var l=p[m];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,l.key,l)}}var y=function(){function d(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var i=e.config;this.bwEstimator=new T.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var p,m,l=d.prototype;return l.registerListeners=function(){var e=this.hls;e.on(A.Events.FRAG_LOADING,this.onFragLoading,this),e.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var e=this.hls;e.off(A.Events.FRAG_LOADING,this.onFragLoading,this),e.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},l.onFragLoading=function(e,i){var t,n=i.frag;n.type===D.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=n,this.partCurrent=(t=i.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)))},l.onLevelLoaded=function(e,i){var t=this.hls.config;i.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},l._abandonRulesCheck=function(){var e=this.fragCurrent,i=this.partCurrent,t=this.hls,n=t.autoLevelEnabled,u=t.config,a=t.media;if(e&&a){var c=i?i.stats:e.stats,E=i?i.duration:e.duration;if(c.aborted)return o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!a.paused&&a.playbackRate&&a.readyState){var g=performance.now()-c.loading.start,v=Math.abs(a.playbackRate);if(!(g<=500*E/v)){var r=t.levels,s=t.minAutoLevel,f=r[e.level],S=c.total||Math.max(c.loaded,Math.round(E*f.maxBitrate/8)),L=Math.max(1,c.bwEstimate?c.bwEstimate/8:1e3*c.loaded/g),C=(S-c.loaded)/L,O=a.currentTime,w=(k.BufferHelper.bufferInfo(a,O,u.maxBufferHole).end-O)/v;if(!(w>=2*E/v||C<=w)){var P,x=Number.POSITIVE_INFINITY;for(P=e.level-1;P>s&&!((x=E*r[P].maxBitrate/(6.4*L))<w);P--);if(!(x>=C)){var M=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+e.sn+(i?" part "+i.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+P+`
      Current BW estimate: `+(Object(_.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+C.toFixed(3)+` s
      Estimated load time for the next fragment: `+x.toFixed(3)+` s
      Time to underbuffer: `+w.toFixed(3)+" s"),t.nextLoadLevel=P,this.bwEstimator.sample(g,c.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),t.trigger(A.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:i,stats:c})}}}}}},l.onFragLoaded=function(e,i){var t=i.frag,n=i.part;if(t.type===D.PlaylistLevelType.MAIN&&Object(_.isFiniteNumber)(t.sn)){var u=n?n.stats:t.stats,a=n?n.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[t.level],E=(c.loaded?c.loaded.bytes:0)+u.loaded,g=(c.loaded?c.loaded.duration:0)+a;c.loaded={bytes:E,duration:g},c.realBitrate=Math.round(8*E/g)}if(t.bitrateTest){var v={stats:u,frag:t,part:n,id:t.type};this.onFragBuffered(A.Events.FRAG_BUFFERED,v),t.bitrateTest=!1}}},l.onFragBuffered=function(e,i){var t=i.frag,n=i.part,u=n?n.stats:t.stats;if(!u.aborted&&t.type===D.PlaylistLevelType.MAIN&&t.sn!=="initSegment"){var a=u.parsing.end-u.loading.start;this.bwEstimator.sample(a,u.loaded),u.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},l.onError=function(e,i){switch(i.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},l.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},l.getNextABRAutoLevel=function(){var e=this.fragCurrent,i=this.partCurrent,t=this.hls,n=t.maxAutoLevel,u=t.config,a=t.minAutoLevel,c=t.media,E=i?i.duration:e?e.duration:0,g=c?c.currentTime:0,v=c&&c.playbackRate!==0?Math.abs(c.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():u.abrEwmaDefaultEstimate,s=(k.BufferHelper.bufferInfo(c,g,u.maxBufferHole).end-g)/v,f=this.findBestLevel(r,a,n,s,u.abrBandWidthFactor,u.abrBandWidthUpFactor);if(f>=0)return f;o.logger.trace((s?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var S=E?Math.min(E,u.maxStarvationDelay):u.maxStarvationDelay,L=u.abrBandWidthFactor,C=u.abrBandWidthUpFactor;if(!s){var O=this.bitrateTestDelay;O&&(S=(E?Math.min(E,u.maxLoadingDelay):u.maxLoadingDelay)-O,o.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*S)+" ms"),L=C=1)}return f=this.findBestLevel(r,a,n,s+S,L,C),Math.max(f,0)},l.findBestLevel=function(e,i,t,n,u,a){for(var c,E=this.fragCurrent,g=this.partCurrent,v=this.lastLoadedFragLevel,r=this.hls.levels,s=r[v],f=!(s==null||(c=s.details)===null||c===void 0||!c.live),S=s==null?void 0:s.codecSet,L=g?g.duration:E?E.duration:0,C=t;C>=i;C--){var O=r[C];if(O&&(!S||O.codecSet===S)){var w=O.details,P=(g?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||L,x=void 0;x=C<=v?u*e:a*e;var M=r[C].maxBitrate,N=M*P/x;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+C+"/"+Math.round(x)+"/"+M+"/"+P+"/"+n+"/"+N),x>M&&(!N||f&&!this.bitrateTestDelay||N<n))return C}}return-1},p=d,(m=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,i=this.bwEstimator;if(!(e===-1||i&&i.canEstimate()))return e;var t=this.getNextABRAutoLevel();return e!==-1&&(t=Math.min(e,t)),t},set:function(e){this._nextAutoLevel=e}}])&&b(p.prototype,m),d}();R.default=y},"./src/controller/audio-stream-controller.ts":function(F,R,h){h.r(R);var _=h("./src/polyfills/number.ts"),T=h("./src/controller/base-stream-controller.ts"),A=h("./src/events.ts"),k=h("./src/utils/buffer-helper.ts"),I=h("./src/controller/fragment-tracker.ts"),D=h("./src/types/level.ts"),o=h("./src/types/loader.ts"),b=h("./src/loader/fragment.ts"),y=h("./src/demux/chunk-cache.ts"),d=h("./src/demux/transmuxer-interface.ts"),p=h("./src/types/transmuxer.ts"),m=h("./src/controller/fragment-finders.ts"),l=h("./src/utils/discontinuities.ts"),e=h("./src/errors.ts"),i=h("./src/utils/logger.ts");function t(){return(t=Object.assign||function(a){for(var c=1;c<arguments.length;c++){var E=arguments[c];for(var g in E)Object.prototype.hasOwnProperty.call(E,g)&&(a[g]=E[g])}return a}).apply(this,arguments)}function n(a,c){return(n=Object.setPrototypeOf||function(E,g){return E.__proto__=g,E})(a,c)}var u=function(a){var c,E;function g(r,s){var f;return(f=a.call(this,r,s,"[audio-stream-controller]")||this).videoBuffer=null,f.videoTrackCC=-1,f.waitingVideoCC=-1,f.audioSwitch=!1,f.trackId=-1,f.waitingData=null,f.mainDetails=null,f.bufferFlushed=!1,f._registerListeners(),f}E=a,(c=g).prototype=Object.create(E.prototype),c.prototype.constructor=c,n(c,E);var v=g.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var r=this.hls;r.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(A.Events.ERROR,this.onError,this),r.on(A.Events.BUFFER_RESET,this.onBufferReset,this),r.on(A.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var r=this.hls;r.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(A.Events.ERROR,this.onError,this),r.off(A.Events.BUFFER_RESET,this.onBufferReset,this),r.off(A.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(r,s){var f=s.frag,S=s.id,L=s.initPTS;if(S==="main"){var C=f.cc;this.initPTS[f.cc]=L,this.log("InitPTS for cc: "+C+" found from main: "+L),this.videoTrackCC=C,this.state===T.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=T.State.STOPPED);var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,s>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),this.state=T.State.IDLE):(this.loadedmetadata=!1,this.state=T.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},v.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_TRACK:var r,s=this.levels,f=this.trackId,S=s==null||(r=s[f])===null||r===void 0?void 0:r.details;if(S){if(this.waitForCdnTuneIn(S))break;this.state=T.State.WAITING_INIT_PTS}break;case T.State.FRAG_LOADING_WAITING_RETRY:var L,C=performance.now(),O=this.retryDate;(!O||C>=O||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=T.State.IDLE);break;case T.State.WAITING_INIT_PTS:var w=this.waitingData;if(w){var P=w.frag,x=w.part,M=w.cache,N=w.complete;if(this.initPTS[P.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.FRAG_LOADING;var U={frag:P,part:x,payload:M.flush(),networkDetails:null};this._handleFragmentLoadProgress(U),N&&a.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)i.logger.log("Waiting fragment cc ("+P.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var G=this.getLoadPosition(),V=k.BufferHelper.bufferInfo(this.mediaBuffer,G,this.config.maxBufferHole);Object(m.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,P)<0&&(i.logger.log("Waiting fragment cc ("+P.cc+") @ "+P.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=T.State.IDLE}this.onTickEnd()},v.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.IDLE)},v.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var s=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&s.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},v.doTickIdle=function(){var r,s,f=this.hls,S=this.levels,L=this.media,C=this.trackId,O=f.config;if(S&&S[C]&&(L||!this.startFragRequested&&O.startFragPrefetch)){var w=S[C].details;if(!w||w.live&&this.levelLastLoaded!==C||this.waitForCdnTuneIn(w))this.state=T.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,b.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var P=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.AUDIO);if(P!==null){var x=P.len,M=this.getMaxBufferLength(),N=this.audioSwitch;if(!(x>=M)||N){if(!N&&this._streamEnded(P,w))return f.trigger(A.Events.BUFFER_EOS,{type:"audio"}),void(this.state=T.State.ENDED);var U=w.fragments[0].start,G=P.end;if(N){var V=this.getLoadPosition();G=V,w.PTSKnown&&V<U&&(P.end>U||P.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),L.currentTime=U+.05)}var W=this.getNextFragment(G,w);W?((r=W.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(s=W.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(W,w,G):this.loadKey(W,w):this.bufferFlushed=!0}}}}},v.getMaxBufferLength=function(){var r=a.prototype.getMaxBufferLength.call(this),s=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN);return s===null?r:Math.max(r,s.len)},v.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(r,s){var f=s.audioTracks;this.resetTransmuxer(),this.levels=f.map(function(S){return new D.Level(S)})},v.onAudioTrackSwitching=function(r,s){var f=!!s.url;this.trackId=s.id;var S=this.fragCurrent;S!=null&&S.loader&&S.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),f?this.setInterval(100):this.resetTransmuxer(),f?(this.audioSwitch=!0,this.state=T.State.IDLE):this.state=T.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(r,s){this.mainDetails=s.details},v.onAudioTrackLoaded=function(r,s){var f,S=this.levels,L=s.details,C=s.id;if(S){this.log("Track "+C+" loaded ["+L.startSN+","+L.endSN+"],duration:"+L.totalduration);var O=S[C],w=0;if(L.live||(f=O.details)!==null&&f!==void 0&&f.live){var P=this.mainDetails;if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed||!P)return;!O.details&&L.hasProgramDateTime&&P.hasProgramDateTime?(Object(l.alignPDT)(L,P),w=L.fragments[0].start):w=this.alignPlaylists(L,O.details)}O.details=L,this.levelLastLoaded=C,this.startFragRequested||!this.mainDetails&&L.live||this.setStartPosition(O.details,w),this.state!==T.State.WAITING_TRACK||this.waitForCdnTuneIn(L)||(this.state=T.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+C)},v._handleFragmentLoadProgress=function(r){var s,f=r.frag,S=r.part,L=r.payload,C=this.config,O=this.trackId,w=this.levels;if(w){var P=w[O];console.assert(P,"Audio track is defined on fragment load progress");var x=P.details;console.assert(x,"Audio track details are defined on fragment load progress");var M=C.defaultAudioCodec||P.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new d.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var U=this.initPTS[f.cc],G=(s=f.initSegment)===null||s===void 0?void 0:s.data;if(U!==void 0){var V=S?S.index:-1,W=V!==-1,Y=new p.ChunkMetadata(f.level,f.sn,f.stats.chunkCount,L.byteLength,V,W);N.push(L,G,M,"",f,S,x.totalduration,!1,Y,U)}else i.logger.log("Unknown video PTS for cc "+f.cc+", waiting for video PTS before demuxing audio frag "+f.sn+" of ["+x.startSN+" ,"+x.endSN+"],track "+O),(this.waitingData=this.waitingData||{frag:f,part:S,cache:new y.default,complete:!1}).cache.push(new Uint8Array(L)),this.waitingVideoCC=this.videoTrackCC,this.state=T.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+f.sn+" of level "+f.level+" will not be buffered")},v._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:a.prototype._handleFragmentLoadComplete.call(this,r)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(r,s){var f=s.tracks.audio;f&&(this.mediaBuffer=f.buffer),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer)},v.onFragBuffered=function(r,s){var f=s.frag,S=s.part;f.type===o.PlaylistLevelType.AUDIO&&(this.fragContextChanged(f)?this.warn("Fragment "+f.sn+(S?" p: "+S.index:"")+" of level "+f.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(f.sn!=="initSegment"&&(this.fragPrevious=f,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(f,S)))},v.onError=function(r,s){switch(s.details){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,s);break;case e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case e.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==T.State.ERROR&&this.state!==T.State.STOPPED&&(this.state=s.fatal?T.State.ERROR:T.State.IDLE,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case e.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var f=!0,S=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);S&&S.len>.5&&(f=!this.reduceMaxBufferLength(S.len)),f&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},v.onBufferFlushed=function(r,s){s.type===b.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},v._handleTransmuxComplete=function(r){var s,f="audio",S=this.hls,L=r.remuxResult,C=r.chunkMeta,O=this.getCurrentContext(C);if(!O)return this.warn("The loading context changed while buffering fragment "+C.sn+" of level "+C.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(C.level);var w=O.frag,P=O.part,x=L.audio,M=L.text,N=L.id3,U=L.initSegment;if(!this.fragContextChanged(w)){if(this.state=T.State.PARSING,this.audioSwitch&&x&&this.completeAudioSwitch(),U!=null&&U.tracks&&(this._bufferInitSegment(U.tracks,w,C),S.trigger(A.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:f,tracks:U.tracks})),x){var G=x.startPTS,V=x.endPTS,W=x.startDTS,Y=x.endDTS;P&&(P.elementaryStreams[b.ElementaryStreamTypes.AUDIO]={startPTS:G,endPTS:V,startDTS:W,endDTS:Y}),w.setElementaryStreamInfo(b.ElementaryStreamTypes.AUDIO,G,V,W,Y),this.bufferFragmentData(x,w,P,C)}if(N!=null&&(s=N.samples)!==null&&s!==void 0&&s.length){var X=t({frag:w,id:f},N);S.trigger(A.Events.FRAG_PARSING_METADATA,X)}if(M){var z=t({frag:w,id:f},M);S.trigger(A.Events.FRAG_PARSING_USERDATA,z)}}},v._bufferInitSegment=function(r,s,f){if(this.state===T.State.PARSING){r.video&&delete r.video;var S=r.audio;if(S){S.levelCodec=S.codec,S.id="audio",this.log("Init audio buffer, container:"+S.container+", codecs[parsed]=["+S.codec+"]"),this.hls.trigger(A.Events.BUFFER_CODECS,r);var L=S.initSegment;if(L!=null&&L.byteLength){var C={type:"audio",frag:s,part:null,chunkMeta:f,parent:s.type,data:L};this.hls.trigger(A.Events.BUFFER_APPENDING,C)}this.tick()}}},v.loadFragment=function(r,s,f){var S=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||S===I.FragmentState.NOT_LOADED||S===I.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):s.live&&!Object(_.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=T.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,r,s,f)))},v.completeAudioSwitch=function(){var r=this.hls,s=this.media,f=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:f})},g}(T.default);R.default=u},"./src/controller/audio-track-controller.ts":function(F,R,h){h.r(R);var _=h("./src/events.ts"),T=h("./src/errors.ts"),A=h("./src/controller/base-playlist-controller.ts"),k=h("./src/types/loader.ts");function I(b,y){for(var d=0;d<y.length;d++){var p=y[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(b,p.key,p)}}function D(b,y){return(D=Object.setPrototypeOf||function(d,p){return d.__proto__=p,d})(b,y)}var o=function(b){var y,d;function p(i){var t;return(t=b.call(this,i,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}d=b,(y=p).prototype=Object.create(d.prototype),y.prototype.constructor=y,D(y,d);var m,l,e=p.prototype;return e.registerListeners=function(){var i=this.hls;i.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(_.Events.ERROR,this.onError,this)},e.unregisterListeners=function(){var i=this.hls;i.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(_.Events.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,b.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},e.onManifestParsed=function(i,t){this.tracks=t.audioTracks||[]},e.onAudioTrackLoaded=function(i,t){var n=t.id,u=t.details,a=this.tracksInGroup[n];if(a){var c=a.details;a.details=t.details,this.log("audioTrack "+n+" loaded ["+u.startSN+"-"+u.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,t,c))}else this.warn("Invalid audio track id "+n)},e.onLevelLoading=function(i,t){this.switchLevel(t.level)},e.onLevelSwitching=function(i,t){this.switchLevel(t.level)},e.switchLevel=function(i){var t=this.hls.levels[i];if(t!=null&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];if(this.groupId!==n){this.groupId=n;var u=this.tracks.filter(function(c){return!n||c.groupId===n});this.selectDefaultTrack&&!u.some(function(c){return c.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var a={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(_.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},e.onError=function(i,t){b.prototype.onError.call(this,i,t),!t.fatal&&t.context&&t.context.type===k.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},e.setAudioTrack=function(i){var t=this.tracksInGroup;if(i<0||i>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var n=t[this.trackId];this.log("Now switching to audio-track index "+i);var u=t[i],a=u.id,c=u.groupId,E=c===void 0?"":c,g=u.name,v=u.type,r=u.url;if(this.trackId=i,this.trackName=g,this.selectDefaultTrack=!1,this.hls.trigger(_.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:E,name:g,type:v,url:r}),!u.details||u.details.live){var s=this.switchParams(u.url,n==null?void 0:n.details);this.loadPlaylist(s)}}},e.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,n=this.findTrackId(t)||this.findTrackId();n!==-1?this.setAudioTrack(n):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},e.findTrackId=function(i){for(var t=this.tracksInGroup,n=0;n<t.length;n++){var u=t[n];if((!this.selectDefaultTrack||u.default)&&(!i||i===u.name))return u.id}return-1},e.loadPlaylist=function(i){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var n=t.id,u=t.groupId,a=t.url;if(i)try{a=i.addDirectives(a)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(_.Events.AUDIO_TRACK_LOADING,{url:a,id:n,groupId:u,deliveryDirectives:i||null})}},m=p,(l=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}])&&I(m.prototype,l),p}(A.default);R.default=o},"./src/controller/base-playlist-controller.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return D});var _=h("./src/polyfills/number.ts"),T=h("./src/types/level.ts"),A=h("./src/controller/level-helper.ts"),k=h("./src/utils/logger.ts"),I=h("./src/errors.ts"),D=function(){function o(y,d){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=k.logger.log.bind(k.logger,d+":"),this.warn=k.logger.warn.bind(k.logger,d+":"),this.hls=y}var b=o.prototype;return b.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},b.onError=function(y,d){d.fatal&&d.type===I.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},b.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},b.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},b.stopLoad=function(){this.canLoad=!1,this.clearTimer()},b.switchParams=function(y,d){var p=d==null?void 0:d.renditionReports;if(p)for(var m=0;m<p.length;m++){var l=p[m],e=""+l.URI;if(e===y.substr(-e.length)){var i=parseInt(l["LAST-MSN"]),t=parseInt(l["LAST-PART"]);if(d&&this.hls.config.lowLatencyMode){var n=Math.min(d.age-d.partTarget,d.targetduration);t!==void 0&&n>d.partTarget&&(t+=1)}if(Object(_.isFiniteNumber)(i))return new T.HlsUrlParameters(i,Object(_.isFiniteNumber)(t)?t:void 0,T.HlsSkip.No)}}},b.loadPlaylist=function(y){},b.shouldLoadTrack=function(y){return this.canLoad&&y&&!!y.url&&(!y.details||y.details.live)},b.playlistLoaded=function(y,d,p){var m=this,l=d.details,e=d.stats,i=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(l.advancedDateTime=Date.now()-i,l.live||p!=null&&p.live){if(l.reloaded(p),p&&this.log("live playlist "+y+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:"MISSED")),p&&l.fragments.length>0&&Object(A.mergeDetails)(p,l),!this.canLoad||!l.live)return;var t,n=void 0,u=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var a=this.hls.config.lowLatencyMode,c=l.lastPartSn,E=l.endSN,g=l.lastPartIndex,v=c===E;g!==-1?(n=v?E+1:c,u=v?a?0:g:g+1):n=E+1;var r=l.age,s=r+l.ageHeader,f=Math.min(s-l.partTarget,1.5*l.targetduration);if(f>0){if(p&&f>p.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+p.tuneInGoal+" to: "+f+" with playlist age: "+l.age),f=0;else{var S=Math.floor(f/l.targetduration);n+=S,u!==void 0&&(u+=Math.round(f%l.targetduration/l.partTarget)),this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+f+" skip sn "+S+" to part "+u)}l.tuneInGoal=f}if(t=this.getDeliveryDirectives(l,d.deliveryDirectives,n,u),a||!v)return void this.loadPlaylist(t)}else t=this.getDeliveryDirectives(l,d.deliveryDirectives,n,u);var L=Object(A.computeReloadInterval)(l,e);n!==void 0&&l.canBlockReload&&(L-=l.partTarget||1),this.log("reload live playlist "+y+" in "+Math.round(L)+" ms"),this.timer=self.setTimeout(function(){return m.loadPlaylist(t)},L)}else this.clearTimer()},b.getDeliveryDirectives=function(y,d,p,m){var l=Object(T.getSkipValue)(y,p);return d!=null&&d.skip&&y.deltaUpdateFailed&&(p=d.msn,m=d.part,l=T.HlsSkip.No),new T.HlsUrlParameters(p,m,l)},b.retryLoadingOrFail=function(y){var d,p=this,m=this.hls.config,l=this.retryCount<m.levelLoadingMaxRetry;if(l)if(this.retryCount++,y.details.indexOf("LoadTimeOut")>-1&&(d=y.context)!==null&&d!==void 0&&d.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+y.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return p.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+y.details+'"')}else this.warn('cannot recover from error "'+y.details+'"'),this.clearTimer(),y.fatal=!0;return l},o}()},"./src/controller/base-stream-controller.ts":function(F,R,h){h.r(R),h.d(R,"State",function(){return a}),h.d(R,"default",function(){return c});var _=h("./src/polyfills/number.ts"),T=h("./src/task-loop.ts"),A=h("./src/controller/fragment-tracker.ts"),k=h("./src/utils/buffer-helper.ts"),I=h("./src/utils/logger.ts"),D=h("./src/events.ts"),o=h("./src/errors.ts"),b=h("./src/types/transmuxer.ts"),y=h("./src/utils/mp4-tools.ts"),d=h("./src/utils/discontinuities.ts"),p=h("./src/controller/fragment-finders.ts"),m=h("./src/controller/level-helper.ts"),l=h("./src/loader/fragment-loader.ts"),e=h("./src/crypt/decrypter.ts"),i=h("./src/utils/time-ranges.ts"),t=h("./src/types/loader.ts");function n(E,g){for(var v=0;v<g.length;v++){var r=g[v];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(E,r.key,r)}}function u(E,g){return(u=Object.setPrototypeOf||function(v,r){return v.__proto__=r,v})(E,g)}var a={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},c=function(E){var g,v;function r(L,C,O){var w;return(w=E.call(this)||this).hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=a.STOPPED,w.media=void 0,w.mediaBuffer=void 0,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=O,w.log=I.logger.log.bind(I.logger,O+":"),w.warn=I.logger.warn.bind(I.logger,O+":"),w.hls=L,w.fragmentLoader=new l.default(L.config),w.fragmentTracker=C,w.config=L.config,w.decrypter=new e.default(L,L.config),L.on(D.Events.KEY_LOADED,w.onKeyLoaded,function(P){if(P===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P}(w)),w}v=E,(g=r).prototype=Object.create(v.prototype),g.prototype.constructor=g,u(g,v);var s,f,S=r.prototype;return S.doTick=function(){this.onTickEnd()},S.onTickEnd=function(){},S.startLoad=function(L){},S.stopLoad=function(){this.fragmentLoader.abort();var L=this.fragCurrent;L&&this.fragmentTracker.removeFragment(L),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=a.STOPPED},S._streamEnded=function(L,C){var O=this.fragCurrent,w=this.fragmentTracker;if(!C.live&&O&&O.sn===C.endSN&&!L.nextStart){var P=w.getState(O);return P===A.FragmentState.PARTIAL||P===A.FragmentState.OK}return!1},S.onMediaAttached=function(L,C){var O=this.media=this.mediaBuffer=C.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===a.STOPPED&&this.startLoad(w.startPosition)},S.onMediaDetaching=function(){var L=this.media;L!=null&&L.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),L&&(L.removeEventListener("seeking",this.onvseeking),L.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},S.onMediaSeeking=function(){var L=this.config,C=this.fragCurrent,O=this.media,w=this.mediaBuffer,P=this.state,x=O?O.currentTime:0,M=k.BufferHelper.bufferInfo(w||O,x,L.maxBufferHole);if(this.log("media seeking to "+(Object(_.isFiniteNumber)(x)?x.toFixed(3):x)+", state: "+P),P===a.ENDED)this.resetLoadingState();else if(C&&!M.len){var N=L.maxFragLookUpTolerance,U=C.start-N,G=x>C.start+C.duration+N;(x<U||G)&&(G&&C.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),C.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=x),this.loadedmetadata||M.len||(this.nextLoadPosition=this.startPosition=x),this.tickImmediate()},S.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},S.onKeyLoaded=function(L,C){if(this.state===a.KEY_LOADING&&C.frag===this.fragCurrent&&this.levels){this.state=a.IDLE;var O=this.levels[C.frag.level].details;O&&this.loadFragment(C.frag,O,C.frag.start)}},S.onHandlerDestroying=function(){this.stopLoad(),E.prototype.onHandlerDestroying.call(this)},S.onHandlerDestroyed=function(){this.state=a.STOPPED,this.hls.off(D.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,E.prototype.onHandlerDestroyed.call(this)},S.loadKey=function(L,C){this.log("Loading key for "+L.sn+" of ["+C.startSN+"-"+C.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level),this.state=a.KEY_LOADING,this.fragCurrent=L,this.hls.trigger(D.Events.KEY_LOADING,{frag:L})},S.loadFragment=function(L,C,O){this._loadFragForPlayback(L,C,O)},S._loadFragForPlayback=function(L,C,O){var w=this;this._doFragLoad(L,C,O,function(P){if(w.fragContextChanged(L))return w.warn("Fragment "+L.sn+(P.part?" p: "+P.part.index:"")+" of level "+L.level+" was dropped during download."),void w.fragmentTracker.removeFragment(L);L.stats.chunkCount++,w._handleFragmentLoadProgress(P)}).then(function(P){if(P){w.fragLoadError=0;var x=w.state;if(!w.fragContextChanged(L))return"payload"in P&&(w.log("Loaded fragment "+L.sn+" of level "+L.level),w.hls.trigger(D.Events.FRAG_LOADED,P),w.state===a.BACKTRACKING)?(w.fragmentTracker.backtrack(L,P),void w.resetFragmentLoading(L)):void w._handleFragmentLoadComplete(P);(x===a.FRAG_LOADING||x===a.BACKTRACKING||!w.fragCurrent&&x===a.PARSING)&&(w.fragmentTracker.removeFragment(L),w.state=a.IDLE)}}).catch(function(P){w.warn(P),w.resetFragmentLoading(L)})},S.flushMainBuffer=function(L,C,O){if(O===void 0&&(O=null),L-C){var w={startOffset:L,endOffset:C,type:O};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,w)}},S._loadInitSegment=function(L){var C=this;this._doFragLoad(L).then(function(O){if(!O||C.fragContextChanged(L)||!C.levels)throw new Error("init load aborted");return O}).then(function(O){var w=C.hls,P=O.payload,x=L.decryptdata;if(P&&P.byteLength>0&&x&&x.key&&x.iv&&x.method==="AES-128"){var M=self.performance.now();return C.decrypter.webCryptoDecrypt(new Uint8Array(P),x.key.buffer,x.iv.buffer).then(function(N){var U=self.performance.now();return w.trigger(D.Events.FRAG_DECRYPTED,{frag:L,payload:N,stats:{tstart:M,tdecrypt:U}}),O.payload=N,O})}return O}).then(function(O){var w=C.fragCurrent,P=C.hls,x=C.levels;if(!x)throw new Error("init load aborted, missing levels");var M=x[L.level].details;console.assert(M,"Level details are defined when init segment is loaded");var N=L.stats;C.state=a.IDLE,C.fragLoadError=0,L.data=new Uint8Array(O.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),O.frag===w&&P.trigger(D.Events.FRAG_BUFFERED,{stats:N,frag:w,part:null,id:L.type}),C.tick()}).catch(function(O){C.warn(O),C.resetFragmentLoading(L)})},S.fragContextChanged=function(L){var C=this.fragCurrent;return!L||!C||L.level!==C.level||L.sn!==C.sn||L.urlId!==C.urlId},S.fragBufferedComplete=function(L,C){var O=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+L.type+" sn: "+L.sn+(C?" part: "+C.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level+" "+i.default.toString(k.BufferHelper.getBuffered(O))),this.state=a.IDLE,this.tick()},S._handleFragmentLoadComplete=function(L){var C=this.transmuxer;if(C){var O=L.frag,w=L.part,P=L.partsLoaded,x=!P||P.length===0||P.some(function(N){return!N}),M=new b.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,w?w.index:-1,!x);C.flush(M)}},S._handleFragmentLoadProgress=function(L){},S._doFragLoad=function(L,C,O,w){var P=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(L.start,O||0),this.config.lowLatencyMode&&C){var x=C.partList;if(x&&w){O>L.end&&C.fragmentHint&&(L=C.fragmentHint);var M=this.getNextPart(x,L,O);if(M>-1){var N=x[M];return this.log("Loading part sn: "+L.sn+" p: "+N.index+" cc: "+L.cc+" of playlist ["+C.startSN+"-"+C.endSN+"] parts [0-"+M+"-"+(x.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=a.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:L,part:x[M],targetBufferTime:O}),this.doFragPartsLoad(L,x,M,w).catch(function(U){return P.handleFragLoadError(U)})}if(!L.url||this.loadedEndOfParts(x,O))return Promise.resolve(null)}}return this.log("Loading fragment "+L.sn+" cc: "+L.cc+" "+(C?"of ["+C.startSN+"-"+C.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(O.toFixed(3))),Object(_.isFiniteNumber)(L.sn)&&!this.bitrateTest&&(this.nextLoadPosition=L.start+L.duration),this.state=a.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:L,targetBufferTime:O}),this.fragmentLoader.load(L,w).catch(function(U){return P.handleFragLoadError(U)})},S.doFragPartsLoad=function(L,C,O,w){var P=this;return new Promise(function(x,M){var N=[];(function U(G){var V=C[G];P.fragmentLoader.loadPart(L,V,w).then(function(W){N[V.index]=W;var Y=W.part;P.hls.trigger(D.Events.FRAG_LOADED,W);var X=C[G+1];if(!X||X.fragment!==L)return x({frag:L,part:Y,partsLoaded:N});U(G+1)}).catch(M)})(O)})},S.handleFragLoadError=function(L){var C=L.data;return C&&C.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(C.frag,C.part):this.hls.trigger(D.Events.ERROR,C),null},S._handleTransmuxerFlush=function(L){var C=this.getCurrentContext(L);if(C&&this.state===a.PARSING){var O=C.frag,w=C.part,P=C.level,x=self.performance.now();O.stats.parsing.end=x,w&&(w.stats.parsing.end=x),this.updateLevelTiming(O,w,P,L.partial)}else this.fragCurrent||(this.state=a.IDLE)},S.getCurrentContext=function(L){var C=this.levels,O=L.level,w=L.sn,P=L.part;if(!C||!C[O])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+O+". The current chunk will not be buffered."),null;var x=C[O],M=P>-1?Object(m.getPartWith)(x,w,P):null,N=M?M.fragment:Object(m.getFragmentWithSN)(x,w,this.fragCurrent);return N?{frag:N,part:M,level:x}:null},S.bufferFragmentData=function(L,C,O,w){if(L&&this.state===a.PARSING){var P=L.data1,x=L.data2,M=P;if(P&&x&&(M=Object(y.appendUint8Array)(P,x)),M&&M.length){var N={type:L.type,frag:C,part:O,chunkMeta:w,parent:C.type,data:M};this.hls.trigger(D.Events.BUFFER_APPENDING,N),L.dropped&&L.independent&&!O&&this.flushBufferGap(C)}}},S.flushBufferGap=function(L){var C=this.media;if(C)if(k.BufferHelper.isBuffered(C,C.currentTime)){var O=C.currentTime,w=k.BufferHelper.bufferInfo(C,O,0),P=L.duration,x=Math.min(2*this.config.maxFragLookUpTolerance,.25*P),M=Math.max(Math.min(L.start-x,w.end-x),O+x);L.start-M>x&&this.flushMainBuffer(M,L.start)}else this.flushMainBuffer(0,L.start)},S.getFwdBufferInfo=function(L,C){var O=this.config,w=this.getLoadPosition();if(!Object(_.isFiniteNumber)(w))return null;var P=k.BufferHelper.bufferInfo(L,w,O.maxBufferHole);if(P.len===0&&P.nextStart!==void 0){var x=this.fragmentTracker.getBufferedFrag(w,C);if(x&&P.nextStart<x.end)return k.BufferHelper.bufferInfo(L,w,Math.max(P.nextStart,O.maxBufferHole))}return P},S.getMaxBufferLength=function(L){var C,O=this.config;return C=L?Math.max(8*O.maxBufferSize/L,O.maxBufferLength):O.maxBufferLength,Math.min(C,O.maxMaxBufferLength)},S.reduceMaxBufferLength=function(L){var C=this.config,O=L||C.maxBufferLength;return C.maxMaxBufferLength>=O&&(C.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+C.maxMaxBufferLength+"s"),!0)},S.getNextFragment=function(L,C){var O,w,P=C.fragments,x=P.length;if(!x)return null;var M,N=this.config,U=P[0].start;if(C.live){var G=N.initialLiveManifestSize;if(x<G)return this.warn("Not enough fragments to start playback (have: "+x+", need: "+G+")"),null;C.PTSKnown||this.startFragRequested||this.startPosition!==-1||(M=this.getInitialLiveFragment(C,P),this.startPosition=M?this.hls.liveSyncPosition||M.start:L)}else L<=U&&(M=P[0]);if(!M){var V=N.lowLatencyMode?C.partEnd:C.fragmentEnd;M=this.getFragmentAtPosition(L,V,C)}return(O=M)===null||O===void 0||!O.initSegment||(w=M)!==null&&w!==void 0&&w.initSegment.data||this.bitrateTest||(M=M.initSegment),M},S.getNextPart=function(L,C,O){for(var w=-1,P=!1,x=!0,M=0,N=L.length;M<N;M++){var U=L[M];if(x=x&&!U.independent,w>-1&&O<U.start)break;var G=U.loaded;!G&&(P||U.independent||x)&&U.fragment===C&&(w=M),P=G}return w},S.loadedEndOfParts=function(L,C){var O=L[L.length-1];return O&&C>O.start&&O.loaded},S.getInitialLiveFragment=function(L,C){var O=this.fragPrevious,w=null;if(O){if(L.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),w=Object(p.findFragmentByPDT)(C,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var P=O.sn+1;if(P>=L.startSN&&P<=L.endSN){var x=C[P-L.startSN];O.cc===x.cc&&(w=x,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(p.findFragWithCC)(C,O.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn)}}else{var M=this.hls.liveSyncPosition;M!==null&&(w=this.getFragmentAtPosition(M,this.bitrateTest?L.fragmentEnd:L.edge,L))}return w},S.getFragmentAtPosition=function(L,C,O){var w,P=this.config,x=this.fragPrevious,M=O.fragments,N=O.endSN,U=O.fragmentHint,G=P.maxFragLookUpTolerance,V=!!(P.lowLatencyMode&&O.partList&&U);if(V&&U&&!this.bitrateTest&&(M=M.concat(U),N=U.sn),L<C){var W=L>C-G?0:G;w=Object(p.findFragmentByPTS)(x,M,L,W)}else w=M[M.length-1];if(w){var Y=w.sn-O.startSN,X=x&&w.level===x.level,z=M[Y+1];if(this.fragmentTracker.getState(w)===A.FragmentState.BACKTRACKED){w=null;for(var Z=Y;M[Z]&&this.fragmentTracker.getState(M[Z])===A.FragmentState.BACKTRACKED;)w=x?M[Z--]:M[--Z];w||(w=z)}else x&&w.sn===x.sn&&!V&&X&&(w.sn<N&&this.fragmentTracker.getState(z)!==A.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+z.sn),w=z):w=null)}return w},S.synchronizeToLiveEdge=function(L){var C=this.config,O=this.media;if(O){var w=this.hls.liveSyncPosition,P=O.currentTime,x=L.fragments[0].start,M=L.edge,N=P>=x-C.maxFragLookUpTolerance&&P<=M;if(w!==null&&O.duration>w&&(P<w||!N)){var U=C.liveMaxLatencyDuration!==void 0?C.liveMaxLatencyDuration:C.liveMaxLatencyDurationCount*L.targetduration;(!N&&O.readyState<4||P<M-U)&&(this.loadedmetadata||(this.nextLoadPosition=w),O.readyState&&(this.warn("Playback: "+P.toFixed(3)+" is located too far from the end of live sliding playlist: "+M+", reset currentTime to : "+w.toFixed(3)),O.currentTime=w))}}},S.alignPlaylists=function(L,C){var O=this.levels,w=this.levelLastLoaded,P=this.fragPrevious,x=w!==null?O[w]:null,M=L.fragments.length;if(!M)return this.warn("No fragments in live playlist"),0;var N=L.fragments[0].start,U=!C,G=L.alignedSliding&&Object(_.isFiniteNumber)(N);if(U||!G&&!N){Object(d.alignStream)(P,x,L);var V=L.fragments[0].start;return this.log("Live playlist sliding: "+V.toFixed(2)+" start-sn: "+(C?C.startSN:"na")+"->"+L.startSN+" prev-sn: "+(P?P.sn:"na")+" fragments: "+M),V}return N},S.waitForCdnTuneIn=function(L){return L.live&&L.canBlockReload&&L.tuneInGoal>Math.max(L.partHoldBack,3*L.partTarget)},S.setStartPosition=function(L,C){var O=this.startPosition;if(O<C&&(O=-1),O===-1||this.lastCurrentTime===-1){var w=L.startTimeOffset;Object(_.isFiniteNumber)(w)?(O=C+w,w<0&&(O+=L.totalduration),O=Math.min(Math.max(C,O),C+L.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+O),this.startPosition=O):L.live?O=this.hls.liveSyncPosition||C:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},S.getLoadPosition=function(){var L=this.media,C=0;return this.loadedmetadata&&L?C=L.currentTime:this.nextLoadPosition&&(C=this.nextLoadPosition),C},S.handleFragLoadAborted=function(L,C){this.transmuxer&&L.sn!=="initSegment"&&L.stats.aborted&&(this.warn("Fragment "+L.sn+(C?" part"+C.index:"")+" of level "+L.level+" was aborted"),this.resetFragmentLoading(L))},S.resetFragmentLoading=function(L){this.fragCurrent&&this.fragContextChanged(L)||(this.state=a.IDLE)},S.onFragmentOrKeyLoadError=function(L,C){if(!C.fatal){var O=C.frag;if(O&&O.type===L){var w=this.fragCurrent;console.assert(w&&O.sn===w.sn&&O.level===w.level&&O.urlId===w.urlId,"Frag load error must match current frag to retry");var P=this.config;if(this.fragLoadError+1<=P.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(O.level))return;var x=Math.min(Math.pow(2,this.fragLoadError)*P.fragLoadingRetryDelay,P.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+L+" "+O.level+" failed to load, retrying in "+x+"ms"),this.retryDate=self.performance.now()+x,this.fragLoadError++,this.state=a.FRAG_LOADING_WAITING_RETRY}else C.levelRetry?(L===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=a.IDLE):(I.logger.error(C.details+" reaches max retry, redispatch as fatal ..."),C.fatal=!0,this.hls.stopLoad(),this.state=a.ERROR)}}},S.afterBufferFlushed=function(L,C,O){if(L){var w=k.BufferHelper.getBuffered(L);this.fragmentTracker.detectEvictedFragments(C,w,O),this.state===a.ENDED&&this.resetLoadingState()}},S.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=a.IDLE},S.resetLiveStartWhenNotLoaded=function(L){if(!this.loadedmetadata){this.startFragRequested=!1;var C=this.levels?this.levels[L].details:null;if(C!=null&&C.live)return this.startPosition=-1,this.setStartPosition(C,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},S.updateLevelTiming=function(L,C,O,w){var P=this,x=O.details;console.assert(!!x,"level.details must be defined"),Object.keys(L.elementaryStreams).reduce(function(M,N){var U=L.elementaryStreams[N];if(U){var G=U.endPTS-U.startPTS;if(G<=0)return P.warn("Could not parse fragment "+L.sn+" "+N+" duration reliably ("+G+") resetting transmuxer to fallback to playlist timing"),P.resetTransmuxer(),M||!1;var V=w?0:Object(m.updateFragPTSDTS)(x,L,U.startPTS,U.endPTS,U.startDTS,U.endDTS);return P.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:x,level:O,drift:V,type:N,frag:L,start:U.startPTS,end:U.endPTS}),!0}return M},!1)?(this.state=a.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:L,part:C})):this.resetLoadingState()},S.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},s=r,(f=[{key:"state",get:function(){return this._state},set:function(L){var C=this._state;C!==L&&(this._state=L,this.log(C+"->"+L))}}])&&n(s.prototype,f),r}(T.default)},"./src/controller/buffer-controller.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return p});var _=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),A=h("./src/utils/logger.ts"),k=h("./src/errors.ts"),I=h("./src/utils/buffer-helper.ts"),D=h("./src/utils/mediasource-helper.ts"),o=h("./src/loader/fragment.ts"),b=h("./src/controller/buffer-operation-queue.ts"),y=Object(D.getMediaSource)(),d=/([ha]vc.)(?:\.[^.,]+)+/,p=function(){function m(e){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.hls,n=i.media,u=i.mediaSource;A.logger.log("[buffer-controller]: Media source opened"),n&&(i.updateMediaElementDuration(),t.trigger(T.Events.MEDIA_ATTACHED,{media:n})),u&&u.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){A.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){A.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var l=m.prototype;return l.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},l.destroy=function(){this.unregisterListeners(),this.details=null},l.registerListeners=function(){var e=this.hls;e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.Events.BUFFER_RESET,this.onBufferReset,this),e.on(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.Events.BUFFER_EOS,this.onBufferEos,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.Events.FRAG_PARSED,this.onFragParsed,this),e.on(T.Events.FRAG_CHANGED,this.onFragChanged,this)},l.unregisterListeners=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.Events.BUFFER_RESET,this.onBufferReset,this),e.off(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.Events.BUFFER_EOS,this.onBufferEos,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.Events.FRAG_PARSED,this.onFragParsed,this),e.off(T.Events.FRAG_CHANGED,this.onFragChanged,this)},l._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new b.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},l.onManifestParsed=function(e,i){var t=2;(i.audio&&!i.video||!i.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,A.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},l.onMediaAttaching=function(e,i){var t=this.media=i.media;if(t&&y){var n=this.mediaSource=new y;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(n),this._objectUrl=t.src}},l.onMediaDetaching=function(){var e=this.media,i=this.mediaSource,t=this._objectUrl;if(i){if(A.logger.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(n){A.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):A.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.Events.MEDIA_DETACHED,void 0)},l.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(i){var t=e.sourceBuffer[i];try{t&&(e.removeBufferListeners(i),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[i]=void 0)}catch(n){A.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",n)}}),this._initSourceBuffer()},l.onBufferCodecs=function(e,i){var t=this,n=this.getSourceBufferTypes().length;Object.keys(i).forEach(function(u){if(n){var a=t.tracks[u];if(a&&typeof a.buffer.changeType=="function"){var c=i[u],E=c.codec,g=c.levelCodec,v=c.container;if((a.levelCodec||a.codec).replace(d,"$1")!==(g||E).replace(d,"$1")){var r=v+";codecs="+(g||E);t.appendChangeType(u,r)}}}else t.pendingTracks[u]=i[u]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},l.appendChangeType=function(e,i){var t=this,n=this.operationQueue,u={execute:function(){var a=t.sourceBuffer[e];a&&(A.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+i),a.changeType(i)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(a){A.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",a)}};n.append(u,e)},l.onBufferAppending=function(e,i){var t=this,n=this.hls,u=this.operationQueue,a=this.tracks,c=i.data,E=i.type,g=i.frag,v=i.part,r=i.chunkMeta,s=r.buffering[E],f=self.performance.now();s.start=f;var S=g.stats.buffering,L=v?v.stats.buffering:null;S.start===0&&(S.start=f),L&&L.start===0&&(L.start=f);var C=a.audio,O=E==="audio"&&r.id===1&&(C==null?void 0:C.container)==="audio/mpeg",w={execute:function(){if(s.executeStart=self.performance.now(),O){var P=t.sourceBuffer[E];if(P){var x=g.start-P.timestampOffset;Math.abs(x)>=.1&&(A.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+g.start+" (delta: "+x+") sn: "+g.sn+")"),P.timestampOffset=g.start)}}t.appendExecutor(c,E)},onStart:function(){},onComplete:function(){var P=self.performance.now();s.executeEnd=s.end=P,S.first===0&&(S.first=P),L&&L.first===0&&(L.first=P);var x=t.sourceBuffer,M={};for(var N in x)M[N]=I.BufferHelper.getBuffered(x[N]);t.appendError=0,t.hls.trigger(T.Events.BUFFER_APPENDED,{type:E,frag:g,part:v,chunkMeta:r,parent:g.type,timeRanges:M})},onError:function(P){A.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",P);var x={type:k.ErrorTypes.MEDIA_ERROR,parent:g.type,details:k.ErrorDetails.BUFFER_APPEND_ERROR,err:P,fatal:!1};P.code===DOMException.QUOTA_EXCEEDED_ERR?x.details=k.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,x.details=k.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>n.config.appendErrorMaxRetry&&(A.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),x.fatal=!0)),n.trigger(T.Events.ERROR,x)}};u.append(w,E)},l.onBufferFlushing=function(e,i){var t=this,n=this.operationQueue,u=function(a){return{execute:t.removeExecutor.bind(t,a,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(T.Events.BUFFER_FLUSHED,{type:a})},onError:function(c){A.logger.warn("[buffer-controller]: Failed to remove from "+a+" SourceBuffer",c)}}};i.type?n.append(u(i.type),i.type):this.getSourceBufferTypes().forEach(function(a){n.append(u(a),a)})},l.onFragParsed=function(e,i){var t=this,n=i.frag,u=i.part,a=[],c=u?u.elementaryStreams:n.elementaryStreams;c[o.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(c[o.ElementaryStreamTypes.AUDIO]&&a.push("audio"),c[o.ElementaryStreamTypes.VIDEO]&&a.push("video")),a.length===0&&A.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var E=self.performance.now();n.stats.buffering.end=E,u&&(u.stats.buffering.end=E);var g=u?u.stats:n.stats;t.hls.trigger(T.Events.FRAG_BUFFERED,{frag:n,part:u,stats:g,id:n.type})},a)},l.onFragChanged=function(e,i){this.flushBackBuffer()},l.onBufferEos=function(e,i){var t=this;this.getSourceBufferTypes().reduce(function(n,u){var a=t.sourceBuffer[u];return i.type&&i.type!==u||a&&!a.ended&&(a.ended=!0,A.logger.log("[buffer-controller]: "+u+" sourceBuffer now EOS")),n&&!(a&&!a.ended)},!0)&&this.blockBuffers(function(){var n=t.mediaSource;n&&n.readyState==="open"&&n.endOfStream()})},l.onLevelUpdated=function(e,i){var t=i.details;t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},l.flushBackBuffer=function(){var e=this.hls,i=this.details,t=this.media,n=this.sourceBuffer;if(t&&i!==null){var u=this.getSourceBufferTypes();if(u.length){var a=i.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(_.isFiniteNumber)(a)&&!(a<0)){var c=t.currentTime,E=i.levelTargetDuration,g=Math.max(a,E),v=Math.floor(c/E)*E-g;u.forEach(function(r){var s=n[r];if(s){var f=I.BufferHelper.getBuffered(s);f.length>0&&v>f.start(0)&&(e.trigger(T.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),i.live&&e.trigger(T.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v}),e.trigger(T.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:r}))}})}}}},l.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,i=this.hls,t=this.media,n=this.mediaSource,u=e.fragments[0].start+e.totalduration,a=t.duration,c=Object(_.isFiniteNumber)(n.duration)?n.duration:0;e.live&&i.config.liveDurationInfinity?(A.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(u>c&&u>a||!Object(_.isFiniteNumber)(a))&&(A.logger.log("[buffer-controller]: Updating Media Source duration to "+u.toFixed(3)),n.duration=u)}},l.updateSeekableRange=function(e){var i=this.mediaSource,t=e.fragments;if(t.length&&e.live&&i!=null&&i.setLiveSeekableRange){var n=Math.max(0,t[0].start),u=Math.max(n,n+e.totalduration);i.setLiveSeekableRange(n,u)}},l.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,i=this.operationQueue,t=this.pendingTracks,n=Object.keys(t).length;if(n&&!e||n===2){this.createSourceBuffers(t),this.pendingTracks={};var u=this.getSourceBufferTypes();if(u.length===0)return void this.hls.trigger(T.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});u.forEach(function(a){i.executeNext(a)})}},l.createSourceBuffers=function(e){var i=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var u in e)if(!i[u]){var a=e[u];if(!a)throw Error("source buffer exists for track "+u+", however track does not");var c=a.levelCodec||a.codec,E=a.container+";codecs="+c;A.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var g=i[u]=t.addSourceBuffer(E),v=u;this.addBufferListener(v,"updatestart",this._onSBUpdateStart),this.addBufferListener(v,"updateend",this._onSBUpdateEnd),this.addBufferListener(v,"error",this._onSBUpdateError),this.tracks[u]={buffer:g,codec:c,container:a.container,levelCodec:a.levelCodec,id:a.id},n++}catch(r){A.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(T.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:E})}}n&&this.hls.trigger(T.Events.BUFFER_CREATED,{tracks:this.tracks})},l._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},l._onSBUpdateEnd=function(e){var i=this.operationQueue;i.current(e).onComplete(),i.shiftAndExecuteNext(e)},l._onSBUpdateError=function(e,i){A.logger.error("[buffer-controller]: "+e+" SourceBuffer error",i),this.hls.trigger(T.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(i)},l.removeExecutor=function(e,i,t){var n=this.media,u=this.mediaSource,a=this.operationQueue,c=this.sourceBuffer[e];if(!n||!u||!c)return A.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(e);var E=Object(_.isFiniteNumber)(n.duration)?n.duration:1/0,g=Object(_.isFiniteNumber)(u.duration)?u.duration:1/0,v=Math.max(0,i),r=Math.min(t,E,g);r>v?(A.logger.log("[buffer-controller]: Removing ["+v+","+r+"] from the "+e+" SourceBuffer"),console.assert(!c.updating,e+" sourceBuffer must not be updating"),c.remove(v,r)):a.shiftAndExecuteNext(e)},l.appendExecutor=function(e,i){var t=this.operationQueue,n=this.sourceBuffer[i];if(!n)return A.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),void t.shiftAndExecuteNext(i);n.ended=!1,console.assert(!n.updating,i+" sourceBuffer must not be updating"),n.appendBuffer(e)},l.blockBuffers=function(e,i){var t=this;if(i===void 0&&(i=this.getSourceBufferTypes()),!i.length)return A.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var n=this.operationQueue,u=i.map(function(a){return n.appendBlocker(a)});Promise.all(u).then(function(){e(),i.forEach(function(a){var c=t.sourceBuffer[a];c&&c.updating||n.shiftAndExecuteNext(a)})})},l.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},l.addBufferListener=function(e,i,t){var n=this.sourceBuffer[e];if(n){var u=t.bind(this,e);this.listeners[e].push({event:i,listener:u}),n.addEventListener(i,u)}},l.removeBufferListeners=function(e){var i=this.sourceBuffer[e];i&&this.listeners[e].forEach(function(t){i.removeEventListener(t.event,t.listener)})},m}()},"./src/controller/buffer-operation-queue.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return T});var _=h("./src/utils/logger.ts"),T=function(){function A(I){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=I}var k=A.prototype;return k.append=function(I,D){var o=this.queues[D];o.push(I),o.length===1&&this.buffers[D]&&this.executeNext(D)},k.insertAbort=function(I,D){this.queues[D].unshift(I),this.executeNext(D)},k.appendBlocker=function(I){var D,o=new Promise(function(y){D=y}),b={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(b,I),o},k.executeNext=function(I){var D=this.buffers,o=this.queues,b=D[I],y=o[I];if(y.length){var d=y[0];try{d.execute()}catch(p){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),d.onError(p),b&&b.updating||(y.shift(),this.executeNext(I))}}},k.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},k.current=function(I){return this.queues[I][0]},A}()},"./src/controller/cap-level-controller.ts":function(F,R,h){h.r(R);var _=h("./src/events.ts");function T(k,I){for(var D=0;D<I.length;D++){var o=I[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var A=function(){function k(y){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=y,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I,D,o,b=k.prototype;return b.setStreamController=function(y){this.streamController=y},b.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},b.registerListeners=function(){var y=this.hls;y.on(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),y.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),y.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),y.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.unregisterListener=function(){var y=this.hls;y.off(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),y.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),y.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),y.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.onFpsDropLevelCapping=function(y,d){k.isLevelAllowed(d.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(d.droppedLevel)},b.onMediaAttaching=function(y,d){this.media=d.media instanceof HTMLVideoElement?d.media:null},b.onManifestParsed=function(y,d){var p=this.hls;this.restrictedLevels=[],this.firstLevel=d.firstLevel,p.config.capLevelToPlayerSize&&d.video&&this.startCapping()},b.onBufferCodecs=function(y,d){this.hls.config.capLevelToPlayerSize&&d.video&&this.startCapping()},b.onMediaDetaching=function(){this.stopCapping()},b.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var y=this.hls.levels;if(y.length){var d=this.hls;d.autoLevelCapping=this.getMaxLevel(y.length-1),d.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=d.autoLevelCapping}}},b.getMaxLevel=function(y){var d=this,p=this.hls.levels;if(!p.length)return-1;var m=p.filter(function(l,e){return k.isLevelAllowed(e,d.restrictedLevels)&&e<=y});return this.clientRect=null,k.getMaxLevelByMediaSize(m,this.mediaWidth,this.mediaHeight)},b.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},b.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},b.getDimensions=function(){if(this.clientRect)return this.clientRect;var y=this.media,d={width:0,height:0};if(y){var p=y.getBoundingClientRect();d.width=p.width,d.height=p.height,d.width||d.height||(d.width=p.right-p.left||y.width||0,d.height=p.bottom-p.top||y.height||0)}return this.clientRect=d,d},k.isLevelAllowed=function(y,d){return d===void 0&&(d=[]),d.indexOf(y)===-1},k.getMaxLevelByMediaSize=function(y,d,p){if(!y||!y.length)return-1;for(var m,l,e=y.length-1,i=0;i<y.length;i+=1){var t=y[i];if((t.width>=d||t.height>=p)&&(m=t,!(l=y[i+1])||m.width!==l.width||m.height!==l.height)){e=i;break}}return e},I=k,o=[{key:"contentScaleFactor",get:function(){var y=1;try{y=self.devicePixelRatio}catch{}return y}}],(D=[{key:"mediaWidth",get:function(){return this.getDimensions().width*k.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*k.contentScaleFactor}}])&&T(I.prototype,D),o&&T(I,o),k}();R.default=A},"./src/controller/eme-controller.ts":function(F,R,h){h.r(R);var _=h("./src/events.ts"),T=h("./src/errors.ts"),A=h("./src/utils/logger.ts"),k=h("./src/utils/mediakeys-helper.ts");function I(o,b){for(var y=0;y<b.length;y++){var d=b[y];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(o,d.key,d)}}var D=function(){function o(p){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=p,this._config=p.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var b,y,d=o.prototype;return d.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},d._registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},d._unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},d.getLicenseServerUrl=function(p){switch(p){case k.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+p+'"')},d._attemptKeySystemAccess=function(p,m,l){var e=this,i=function(n,u,a,c){switch(n){case k.KeySystems.WIDEVINE:return function(E,g,v){var r={audioCapabilities:[],videoCapabilities:[]};return E.forEach(function(s){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+s+'"',robustness:v.audioRobustness||""})}),g.forEach(function(s){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+s+'"',robustness:v.videoRobustness||""})}),[r]}(u,a,c);default:throw new Error("Unknown key-system: "+n)}}(p,m,l,this._drmSystemOptions);A.logger.log("Requesting encrypted media key-system access");var t=this.requestMediaKeySystemAccess(p,i);this.mediaKeysPromise=t.then(function(n){return e._onMediaKeySystemAccessObtained(p,n)}),t.catch(function(n){A.logger.error('Failed to obtain key-system "'+p+'" access:',n)})},d._onMediaKeySystemAccessObtained=function(p,m){var l=this;A.logger.log('Access for key-system "'+p+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:m,mediaKeySystemDomain:p};this._mediaKeysList.push(e);var i=Promise.resolve().then(function(){return m.createMediaKeys()}).then(function(t){return e.mediaKeys=t,A.logger.log('Media-keys created for key-system "'+p+'"'),l._onMediaKeysCreated(),t});return i.catch(function(t){A.logger.error("Failed to create media-keys:",t)}),i},d._onMediaKeysCreated=function(){var p=this;this._mediaKeysList.forEach(function(m){m.mediaKeysSession||(m.mediaKeysSession=m.mediaKeys.createSession(),p._onNewMediaKeySession(m.mediaKeysSession))})},d._onNewMediaKeySession=function(p){var m=this;A.logger.log("New key-system session "+p.sessionId),p.addEventListener("message",function(l){m._onKeySessionMessage(p,l.message)},!1)},d._onKeySessionMessage=function(p,m){A.logger.log("Got EME message event, creating license request"),this._requestLicense(m,function(l){A.logger.log("Received license data (length: "+(l&&l.byteLength)+"), updating key-session"),p.update(l)})},d.onMediaEncrypted=function(p){var m=this;if(A.logger.log('Media is encrypted using "'+p.initDataType+'" init data type'),!this.mediaKeysPromise)return A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var l=function(e){m._media&&(m._attemptSetMediaKeys(e),m._generateRequestWithPreferredKeySession(p.initDataType,p.initData))};this.mediaKeysPromise.then(l).catch(l)},d._attemptSetMediaKeys=function(p){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var m=this._mediaKeysList[0];if(!m||!m.mediaKeys)return A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});A.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(m.mediaKeys),this._hasSetMediaKeys=!0}},d._generateRequestWithPreferredKeySession=function(p,m){var l=this,e=this._mediaKeysList[0];if(!e)return A.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)A.logger.warn("Key-Session already initialized but requested again");else{var i=e.mediaKeysSession;if(!i)return A.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!m)return A.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});A.logger.log('Generating key-session request for "'+p+'" init data type'),e.mediaKeysSessionInitialized=!0,i.generateRequest(p,m).then(function(){A.logger.debug("Key-session generation succeeded")}).catch(function(t){A.logger.error("Error generating key-session request:",t),l.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},d._createLicenseXhr=function(p,m,l){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,p,m,l);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,e,p),i=void 0}catch(t){A.logger.error(t)}try{e.readyState||e.open("POST",p,!0),i&&i.call(this.hls,e,p)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return e},d._onLicenseRequestReadyStageChange=function(p,m,l,e){switch(p.readyState){case 4:if(p.status===200){this._requestLicenseFailureCount=0,A.logger.log("License request succeeded");var i=p.response,t=this._licenseResponseCallback;if(t)try{i=t.call(this.hls,p,m)}catch(u){A.logger.error(u)}e(i)}else{if(A.logger.error("License Request XHR failed ("+m+"). Status: "+p.status+" ("+p.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var n=3-this._requestLicenseFailureCount+1;A.logger.warn("Retrying license request, "+n+" attempts left"),this._requestLicense(l,e)}}},d._generateLicenseRequestChallenge=function(p,m){switch(p.mediaKeySystemDomain){case k.KeySystems.WIDEVINE:return m}throw new Error("unsupported key-system: "+p.mediaKeySystemDomain)},d._requestLicense=function(p,m){A.logger.log("Requesting content license for key-system");var l=this._mediaKeysList[0];if(!l)return A.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var e=this.getLicenseServerUrl(l.mediaKeySystemDomain),i=this._createLicenseXhr(e,p,m);A.logger.log("Sending license request to URL: "+e);var t=this._generateLicenseRequestChallenge(l,p);i.send(t)}catch(n){A.logger.error("Failure requesting DRM license: "+n),this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},d.onMediaAttached=function(p,m){if(this._emeEnabled){var l=m.media;this._media=l,l.addEventListener("encrypted",this._onMediaEncrypted)}},d.onMediaDetached=function(){var p=this._media,m=this._mediaKeysList;p&&(p.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(m.map(function(l){if(l.mediaKeysSession)return l.mediaKeysSession.close().catch(function(){})})).then(function(){return p.setMediaKeys(null)}).catch(function(){}))},d.onManifestParsed=function(p,m){if(this._emeEnabled){var l=m.levels.map(function(i){return i.audioCodec}).filter(function(i){return!!i}),e=m.levels.map(function(i){return i.videoCodec}).filter(function(i){return!!i});this._attemptKeySystemAccess(k.KeySystems.WIDEVINE,l,e)}},b=o,(y=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&I(b.prototype,y),o}();R.default=D},"./src/controller/fps-controller.ts":function(F,R,h){h.r(R);var _=h("./src/events.ts"),T=h("./src/utils/logger.ts"),A=function(){function k(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var I=k.prototype;return I.setStreamController=function(D){this.streamController=D},I.registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},I.unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching)},I.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},I.onMediaAttaching=function(D,o){var b=this.hls.config;if(b.capLevelOnFPSDrop){var y=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=y,y&&typeof y.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}},I.checkFPS=function(D,o,b){var y=performance.now();if(o){if(this.lastTime){var d=y-this.lastTime,p=b-this.lastDroppedFrames,m=o-this.lastDecodedFrames,l=1e3*p/d,e=this.hls;if(e.trigger(_.Events.FPS_DROP,{currentDropped:p,currentDecoded:m,totalDroppedFrames:b}),l>0&&p>e.config.fpsDroppedMonitoringThreshold*m){var i=e.currentLevel;T.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=i)&&(i-=1,e.trigger(_.Events.FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:e.currentLevel}),e.autoLevelCapping=i,this.streamController.nextLevelSwitch())}}this.lastTime=y,this.lastDroppedFrames=b,this.lastDecodedFrames=o}},I.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var o=D.getVideoPlaybackQuality();this.checkFPS(D,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},k}();R.default=A},"./src/controller/fragment-finders.ts":function(F,R,h){h.r(R),h.d(R,"findFragmentByPDT",function(){return A}),h.d(R,"findFragmentByPTS",function(){return k}),h.d(R,"fragmentWithinToleranceTest",function(){return I}),h.d(R,"pdtWithinToleranceTest",function(){return D}),h.d(R,"findFragWithCC",function(){return o});var _=h("./src/polyfills/number.ts"),T=h("./src/utils/binary-search.ts");function A(b,y,d){if(y===null||!Array.isArray(b)||!b.length||!Object(_.isFiniteNumber)(y)||y<(b[0].programDateTime||0)||y>=(b[b.length-1].endProgramDateTime||0))return null;d=d||0;for(var p=0;p<b.length;++p){var m=b[p];if(D(y,d,m))return m}return null}function k(b,y,d,p){d===void 0&&(d=0),p===void 0&&(p=0);var m=null;if(b?m=y[b.sn-y[0].sn+1]||null:d===0&&y[0].start===0&&(m=y[0]),m&&I(d,p,m)===0)return m;var l=T.default.search(y,I.bind(null,d,p));return l||m}function I(b,y,d){b===void 0&&(b=0),y===void 0&&(y=0);var p=Math.min(y,d.duration+(d.deltaPTS?d.deltaPTS:0));return d.start+d.duration-p<=b?1:d.start-p>b&&d.start?-1:0}function D(b,y,d){var p=1e3*Math.min(y,d.duration+(d.deltaPTS?d.deltaPTS:0));return(d.endProgramDateTime||0)-p>b}function o(b,y){return T.default.search(b,function(d){return d.cc<y?1:d.cc>y?-1:0})}},"./src/controller/fragment-tracker.ts":function(F,R,h){h.r(R),h.d(R,"FragmentState",function(){return _}),h.d(R,"FragmentTracker",function(){return I});var _,T,A=h("./src/events.ts"),k=h("./src/types/loader.ts");(T=_||(_={})).NOT_LOADED="NOT_LOADED",T.BACKTRACKED="BACKTRACKED",T.APPENDING="APPENDING",T.PARTIAL="PARTIAL",T.OK="OK";var I=function(){function b(d){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=d,this._registerListeners()}var y=b.prototype;return y._registerListeners=function(){var d=this.hls;d.on(A.Events.BUFFER_APPENDED,this.onBufferAppended,this),d.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.on(A.Events.FRAG_LOADED,this.onFragLoaded,this)},y._unregisterListeners=function(){var d=this.hls;d.off(A.Events.BUFFER_APPENDED,this.onBufferAppended,this),d.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.off(A.Events.FRAG_LOADED,this.onFragLoaded,this)},y.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},y.getAppendedFrag=function(d,p){if(p===k.PlaylistLevelType.MAIN){var m=this.activeFragment,l=this.activeParts;if(!m)return null;if(l)for(var e=l.length;e--;){var i=l[e],t=i?i.end:m.appendedPTS;if(i.start<=d&&t!==void 0&&d<=t)return e>9&&(this.activeParts=l.slice(e-9)),i}else if(m.start<=d&&m.appendedPTS!==void 0&&d<=m.appendedPTS)return m}return this.getBufferedFrag(d,p)},y.getBufferedFrag=function(d,p){for(var m=this.fragments,l=Object.keys(m),e=l.length;e--;){var i=m[l[e]];if((i==null?void 0:i.body.type)===p&&i.buffered){var t=i.body;if(t.start<=d&&d<=t.end)return t}}return null},y.detectEvictedFragments=function(d,p,m){var l=this;Object.keys(this.fragments).forEach(function(e){var i=l.fragments[e];if(i)if(i.buffered){var t=i.range[d];t&&t.time.some(function(n){var u=!l.isTimeBuffered(n.startPTS,n.endPTS,p);return u&&l.removeFragment(i.body),u})}else i.body.type===m&&l.removeFragment(i.body)})},y.detectPartialFragments=function(d){var p=this,m=this.timeRanges,l=d.frag,e=d.part;if(m&&l.sn!=="initSegment"){var i=o(l),t=this.fragments[i];t&&(Object.keys(m).forEach(function(n){var u=l.elementaryStreams[n];if(u){var a=m[n],c=e!==null||u.partial===!0;t.range[n]=p.getBufferedTimes(l,e,c,a)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},y.fragBuffered=function(d){var p=o(d),m=this.fragments[p];m&&(m.backtrack=m.loaded=null,m.buffered=!0)},y.getBufferedTimes=function(d,p,m,l){for(var e={time:[],partial:m},i=p?p.start:d.start,t=p?p.end:d.end,n=d.minEndPTS||t,u=d.maxStartPTS||i,a=0;a<l.length;a++){var c=l.start(a)-this.bufferPadding,E=l.end(a)+this.bufferPadding;if(u>=c&&n<=E){e.time.push({startPTS:Math.max(i,l.start(a)),endPTS:Math.min(t,l.end(a))});break}if(i<E&&t>c)e.partial=!0,e.time.push({startPTS:Math.max(i,l.start(a)),endPTS:Math.min(t,l.end(a))});else if(t<=c)break}return e},y.getPartialFragment=function(d){var p,m,l,e=null,i=0,t=this.bufferPadding,n=this.fragments;return Object.keys(n).forEach(function(u){var a=n[u];a&&D(a)&&(m=a.body.start-t,l=a.body.end+t,d>=m&&d<=l&&(p=Math.min(d-m,l-d),i<=p&&(e=a.body,i=p)))}),e},y.getState=function(d){var p=o(d),m=this.fragments[p];return m?m.buffered?D(m)?_.PARTIAL:_.OK:m.backtrack?_.BACKTRACKED:_.APPENDING:_.NOT_LOADED},y.backtrack=function(d,p){var m=o(d),l=this.fragments[m];if(!l||l.backtrack)return null;var e=l.backtrack=p||l.loaded;return l.loaded=null,e},y.getBacktrackData=function(d){var p=o(d),m=this.fragments[p];if(m){var l,e=m.backtrack;if(e!=null&&(l=e.payload)!==null&&l!==void 0&&l.byteLength)return e;this.removeFragment(d)}return null},y.isTimeBuffered=function(d,p,m){for(var l,e,i=0;i<m.length;i++){if(l=m.start(i)-this.bufferPadding,e=m.end(i)+this.bufferPadding,d>=l&&p<=e)return!0;if(p<=l)return!1}return!1},y.onFragLoaded=function(d,p){var m=p.frag,l=p.part;if(m.sn!=="initSegment"&&!m.bitrateTest&&!l){var e=o(m);this.fragments[e]={body:m,loaded:p,backtrack:null,buffered:!1,range:Object.create(null)}}},y.onBufferAppended=function(d,p){var m=this,l=p.frag,e=p.part,i=p.timeRanges;if(l.type===k.PlaylistLevelType.MAIN)if(this.activeFragment=l,e){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(e)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(n){var u=i[n];if(m.detectEvictedFragments(n,u),!e)for(var a=0;a<u.length;a++)l.appendedPTS=Math.max(u.end(a),l.appendedPTS||0)})},y.onFragBuffered=function(d,p){this.detectPartialFragments(p)},y.hasFragment=function(d){var p=o(d);return!!this.fragments[p]},y.removeFragmentsInRange=function(d,p,m){var l=this;Object.keys(this.fragments).forEach(function(e){var i=l.fragments[e];if(i&&i.buffered){var t=i.body;t.type===m&&t.start<p&&t.end>d&&l.removeFragment(t)}})},y.removeFragment=function(d){var p=o(d);d.stats.loaded=0,d.clearElementaryStreamInfo(),delete this.fragments[p]},y.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},b}();function D(b){var y,d;return b.buffered&&(((y=b.range.video)===null||y===void 0?void 0:y.partial)||((d=b.range.audio)===null||d===void 0?void 0:d.partial))}function o(b){return b.type+"_"+b.level+"_"+b.urlId+"_"+b.sn}},"./src/controller/gap-controller.ts":function(F,R,h){h.r(R),h.d(R,"STALL_MINIMUM_DURATION_MS",function(){return I}),h.d(R,"MAX_START_GAP_JUMP",function(){return D}),h.d(R,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),h.d(R,"SKIP_BUFFER_RANGE_START",function(){return b}),h.d(R,"default",function(){return y});var _=h("./src/utils/buffer-helper.ts"),T=h("./src/errors.ts"),A=h("./src/events.ts"),k=h("./src/utils/logger.ts"),I=250,D=2,o=.1,b=.05,y=function(){function d(m,l,e,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=m,this.media=l,this.fragmentTracker=e,this.hls=i}var p=d.prototype;return p.destroy=function(){this.hls=this.fragmentTracker=this.media=null},p.poll=function(m){var l=this.config,e=this.media,i=this.stalled,t=e.currentTime,n=e.seeking,u=this.seeking&&!n,a=!this.seeking&&n;if(this.seeking=n,t===m){if((a||u)&&(this.stalled=null),!e.paused&&!e.ended&&e.playbackRate!==0&&_.BufferHelper.getBuffered(e).length){var c=_.BufferHelper.bufferInfo(e,t,0),E=c.len>0,g=c.nextStart||0;if(E||g){if(n){var v=c.len>D,r=!g||g-t>D&&!this.fragmentTracker.getPartialFragment(t);if(v||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var s,f=Math.max(g,c.start||0)-t,S=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,L=!(S==null||(s=S.details)===null||s===void 0)&&s.live?2*S.details.targetduration:D;if(f>0&&f<=L)return void this._trySkipBufferHole(null)}var C=self.performance.now();if(i!==null){var O=C-i;!n&&O>=I&&this._reportStall(c.len);var w=_.BufferHelper.bufferInfo(e,t,l.maxBufferHole);this._tryFixBufferStall(w,O)}else this.stalled=C}}}else if(this.moved=!0,i!==null){if(this.stallReported){var P=self.performance.now()-i;k.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(P)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},p._tryFixBufferStall=function(m,l){var e=this.config,i=this.fragmentTracker,t=this.media.currentTime,n=i.getPartialFragment(t);n&&this._trySkipBufferHole(n)||m.len>e.maxBufferHole&&l>1e3*e.highBufferWatchdogPeriod&&(k.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},p._reportStall=function(m){var l=this.hls,e=this.media;this.stallReported||(this.stallReported=!0,k.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+m+")"),l.trigger(A.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:m}))},p._trySkipBufferHole=function(m){for(var l=this.config,e=this.hls,i=this.media,t=i.currentTime,n=0,u=_.BufferHelper.getBuffered(i),a=0;a<u.length;a++){var c=u.start(a);if(t+l.maxBufferHole>=n&&t<c){var E=Math.max(c+b,i.currentTime+o);return k.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+E),this.moved=!0,this.stalled=null,i.currentTime=E,m&&e.trigger(A.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+E,frag:m}),E}n=u.end(a)}return 0},p._tryNudgeBuffer=function(){var m=this.config,l=this.hls,e=this.media,i=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<m.nudgeMaxRetry){var n=i+t*m.nudgeOffset;k.logger.warn("Nudging 'currentTime' from "+i+" to "+n),e.currentTime=n,l.trigger(A.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else k.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+m.nudgeMaxRetry+" nudges"),l.trigger(A.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},d}()},"./src/controller/id3-track-controller.ts":function(F,R,h){h.r(R);var _=h("./src/events.ts"),T=h("./src/utils/texttrack-utils.ts"),A=h("./src/demux/id3.ts"),k=function(){function I(o){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=o,this._registerListeners()}var D=I.prototype;return D.destroy=function(){this._unregisterListeners()},D._registerListeners=function(){var o=this.hls;o.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D._unregisterListeners=function(){var o=this.hls;o.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D.onMediaAttached=function(o,b){this.media=b.media},D.onMediaDetaching=function(){this.id3Track&&(Object(T.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},D.getID3Track=function(o){if(this.media){for(var b=0;b<o.length;b++){var y=o[b];if(y.kind==="metadata"&&y.label==="id3")return Object(T.sendAddTrackEvent)(y,this.media),y}return this.media.addTextTrack("metadata","id3")}},D.onFragParsingMetadata=function(o,b){if(this.media){var y=b.frag,d=b.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var p=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,m=0;m<d.length;m++){var l=A.getID3Frames(d[m].data);if(l){var e=d[m].pts,i=m<d.length-1?d[m+1].pts:y.end;i-e<=0&&(i=e+.25);for(var t=0;t<l.length;t++){var n=l[t];if(!A.isTimeStampFrame(n)){var u=new p(e,i,"");u.value=n,this.id3Track.addCue(u)}}}}}},D.onBufferFlushing=function(o,b){var y=b.startOffset,d=b.endOffset,p=b.type;if(!p||p==="audio"){var m=this.id3Track;m&&Object(T.removeCuesInRange)(m,y,d)}},I}();R.default=k},"./src/controller/latency-controller.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return I});var _=h("./src/errors.ts"),T=h("./src/events.ts"),A=h("./src/utils/logger.ts");function k(D,o){for(var b=0;b<o.length;b++){var y=o[b];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(D,y.key,y)}}var I=function(){function D(d){var p=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return p.timeupdate()},this.hls=d,this.config=d.config,this.registerListeners()}var o,b,y=D.prototype;return y.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},y.registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(T.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(T.Events.ERROR,this.onError)},y.onMediaAttached=function(d,p){this.media=p.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},y.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},y.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},y.onLevelUpdated=function(d,p){var m=p.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},y.onError=function(d,p){p.details===_.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,A.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},y.timeupdate=function(){var d=this.media,p=this.levelDetails;if(d&&p){this.currentTime=d.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var l=this.config,e=l.lowLatencyMode,i=l.maxLiveSyncPlaybackRate;if(e&&i!==1){var t=this.targetLatency;if(t!==null){var n=m-t,u=n<Math.min(this.maxLatency,t+p.targetduration);if(p.live&&u&&n>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,i)),c=Math.round(2/(1+Math.exp(-.75*n-this.edgeStalled))*20)/20;d.playbackRate=Math.min(a,Math.max(1,c))}else d.playbackRate!==1&&d.playbackRate!==0&&(d.playbackRate=1)}}}}},y.estimateLiveEdge=function(){var d=this.levelDetails;return d===null?null:d.edge+d.age},y.computeLatency=function(){var d=this.estimateLiveEdge();return d===null?null:d-this.currentTime},o=D,(b=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var d=this.config,p=this.levelDetails;return d.liveMaxLatencyDuration!==void 0?d.liveMaxLatencyDuration:p?d.liveMaxLatencyDurationCount*p.targetduration:0}},{key:"targetLatency",get:function(){var d=this.levelDetails;if(d===null)return null;var p=d.holdBack,m=d.partHoldBack,l=d.targetduration,e=this.config,i=e.liveSyncDuration,t=e.liveSyncDurationCount,n=e.lowLatencyMode,u=this.hls.userConfig,a=n&&m||p;(u.liveSyncDuration||u.liveSyncDurationCount||a===0)&&(a=i!==void 0?i:t*l);var c=l;return a+Math.min(1*this.stallCount,c)}},{key:"liveSyncPosition",get:function(){var d=this.estimateLiveEdge(),p=this.targetLatency,m=this.levelDetails;if(d===null||p===null||m===null)return null;var l=m.edge,e=d-p-this.edgeStalled,i=l-m.totalduration,t=l-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(i,e),t)}},{key:"drift",get:function(){var d=this.levelDetails;return d===null?1:d.drift}},{key:"edgeStalled",get:function(){var d=this.levelDetails;if(d===null)return 0;var p=3*(this.config.lowLatencyMode&&d.partTarget||d.targetduration);return Math.max(d.age-p,0)}},{key:"forwardBufferLength",get:function(){var d=this.media,p=this.levelDetails;if(!d||!p)return 0;var m=d.buffered.length;return m?d.buffered.end(m-1):p.edge-this.currentTime}}])&&k(o.prototype,b),D}()},"./src/controller/level-controller.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return m});var _=h("./src/types/level.ts"),T=h("./src/events.ts"),A=h("./src/errors.ts"),k=h("./src/utils/codecs.ts"),I=h("./src/controller/level-helper.ts"),D=h("./src/controller/base-playlist-controller.ts"),o=h("./src/types/loader.ts");function b(){return(b=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(l[t]=i[t])}return l}).apply(this,arguments)}function y(l,e){for(var i=0;i<e.length;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(l,t.key,t)}}function d(l,e){return(d=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(l,e)}var p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),m=function(l){var e,i;function t(c){var E;return(E=l.call(this,c,"[level-controller]")||this)._levels=[],E._firstLevel=-1,E._startLevel=void 0,E.currentLevelIndex=-1,E.manualLevelIndex=-1,E.onParsedComplete=void 0,E._registerListeners(),E}i=l,(e=t).prototype=Object.create(i.prototype),e.prototype.constructor=e,d(e,i);var n,u,a=t.prototype;return a._registerListeners=function(){var c=this.hls;c.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.on(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),c.on(T.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var c=this.hls;c.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.off(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),c.off(T.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,l.prototype.destroy.call(this)},a.startLoad=function(){this._levels.forEach(function(c){c.loadError=0}),l.prototype.startLoad.call(this)},a.onManifestLoaded=function(c,E){var g,v,r=[],s=[],f=[],S={},L=!1,C=!1,O=!1;if(E.levels.forEach(function(M){var N=M.attrs;L=L||!(!M.width||!M.height),C=C||!!M.videoCodec,O=O||!!M.audioCodec,p&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var U=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;(v=S[U])?v.url.push(M.url):(v=new _.Level(M),S[U]=v,r.push(v)),N&&(N.AUDIO&&Object(I.addGroupId)(v,"audio",N.AUDIO),N.SUBTITLES&&Object(I.addGroupId)(v,"text",N.SUBTITLES))}),(L||C)&&O&&(r=r.filter(function(M){var N=M.videoCodec,U=M.width,G=M.height;return!!N||!(!U||!G)})),r=r.filter(function(M){var N=M.audioCodec,U=M.videoCodec;return(!N||Object(k.isCodecSupportedInMp4)(N,"audio"))&&(!U||Object(k.isCodecSupportedInMp4)(U,"video"))}),E.audioTracks&&(s=E.audioTracks.filter(function(M){return!M.audioCodec||Object(k.isCodecSupportedInMp4)(M.audioCodec,"audio")}),Object(I.assignTrackIdsByGroup)(s)),E.subtitles&&(f=E.subtitles,Object(I.assignTrackIdsByGroup)(f)),r.length>0){g=r[0].bitrate,r.sort(function(M,N){return M.bitrate-N.bitrate}),this._levels=r;for(var w=0;w<r.length;w++)if(r[w].bitrate===g){this._firstLevel=w,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+g);break}var P=O&&!C,x={levels:r,audioTracks:s,subtitleTracks:f,firstLevel:this._firstLevel,stats:E.stats,audio:O,video:C,altAudio:!P&&s.some(function(M){return!!M.url})};this.hls.trigger(T.Events.MANIFEST_PARSED,x),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(T.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:E.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(c,E){if(l.prototype.onError.call(this,c,E),!E.fatal){var g=E.context,v=this._levels[this.currentLevelIndex];if(g&&(g.type===o.PlaylistContextType.AUDIO_TRACK&&v.audioGroupIds&&g.groupId===v.audioGroupIds[v.urlId]||g.type===o.PlaylistContextType.SUBTITLE_TRACK&&v.textGroupIds&&g.groupId===v.textGroupIds[v.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,s=!1,f=!0;switch(E.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(E.frag){var S=this._levels[E.frag.level];S?(S.fragmentError++,S.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=E.frag.level)):r=E.frag.level}break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:g&&(g.deliveryDirectives&&(f=!1),r=g.level),s=!0;break;case A.ErrorDetails.REMUX_ALLOC_ERROR:r=E.level,s=!0}r!==void 0&&this.recoverLevel(E,r,s,f)}}},a.recoverLevel=function(c,E,g,v){var r=c.details,s=this._levels[E];if(s.loadError++,g){if(!this.retryLoadingOrFail(c))return void(this.currentLevelIndex=-1);c.levelRetry=!0}if(v){var f=s.url.length;if(f>1&&s.loadError<f)c.levelRetry=!0,this.redundantFailover(E);else if(this.manualLevelIndex===-1){var S=E===0?this._levels.length-1:E-1;this.currentLevelIndex!==S&&this._levels[S].loadError===0&&(this.warn(r+": switch to "+S),c.levelRetry=!0,this.hls.nextAutoLevel=S)}}},a.redundantFailover=function(c){var E=this._levels[c],g=E.url.length;if(g>1){var v=(E.urlId+1)%g;this.warn("Switching to redundant URL-id "+v),this._levels.forEach(function(r){r.urlId=v}),this.level=c}},a.onFragLoaded=function(c,E){var g=E.frag;if(g!==void 0&&g.type===o.PlaylistLevelType.MAIN){var v=this._levels[g.level];v!==void 0&&(v.fragmentError=0,v.loadError=0)}},a.onLevelLoaded=function(c,E){var g,v,r=E.level,s=E.details,f=this._levels[r];if(!f)return this.warn("Invalid level index "+r),void((v=E.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(s.deltaUpdateFailed=!0));r===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0,this.retryCount=0),this.playlistLoaded(r,E,f.details)):(g=E.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(s.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(c,E){var g=this.hls.levels[this.currentLevelIndex];if(g&&g.audioGroupIds){for(var v=-1,r=this.hls.audioTracks[E.id].groupId,s=0;s<g.audioGroupIds.length;s++)if(g.audioGroupIds[s]===r){v=s;break}v!==g.urlId&&(g.urlId=v,this.startLoad())}},a.loadPlaylist=function(c){var E=this.currentLevelIndex,g=this._levels[E];if(this.canLoad&&g&&g.url.length>0){var v=g.urlId,r=g.url[v];if(c)try{r=c.addDirectives(r)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+E+(c?" at sn "+c.msn+" part "+c.part:"")+" with URL-id "+v+" "+r),this.clearTimer(),this.hls.trigger(T.Events.LEVEL_LOADING,{url:r,level:E,id:v,deliveryDirectives:c||null})}},a.removeLevel=function(c,E){var g=function(r,s){return s!==E},v=this._levels.filter(function(r,s){return s!==c||r.url.length>1&&E!==void 0&&(r.url=r.url.filter(g),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(g)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(g)),r.urlId=0,!0)}).map(function(r,s){var f=r.details;return f!=null&&f.fragments&&f.fragments.forEach(function(S){S.level=s}),r});this._levels=v,this.hls.trigger(T.Events.LEVELS_UPDATED,{levels:v})},n=t,(u=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(c){var E,g=this._levels;if(g.length!==0&&(this.currentLevelIndex!==c||(E=g[c])===null||E===void 0||!E.details)){if(c<0||c>=g.length){var v=c<0;if(this.hls.trigger(T.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.LEVEL_SWITCH_ERROR,level:c,fatal:v,reason:"invalid level idx"}),v)return;c=Math.min(c,g.length-1)}this.clearTimer();var r=this.currentLevelIndex,s=g[r],f=g[c];this.log("switching to level "+c+" from "+r),this.currentLevelIndex=c;var S=b({},f,{level:c,maxBitrate:f.maxBitrate,uri:f.uri,urlId:f.urlId});delete S._urlId,this.hls.trigger(T.Events.LEVEL_SWITCHING,S);var L=f.details;if(!L||L.live){var C=this.switchParams(f.uri,s==null?void 0:s.details);this.loadPlaylist(C)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(c){this.manualLevelIndex=c,this._startLevel===void 0&&(this._startLevel=c),c!==-1&&(this.level=c)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(c){this._firstLevel=c}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var c=this.hls.config.startLevel;return c!==void 0?c:this._firstLevel}return this._startLevel},set:function(c){this._startLevel=c}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(c){this.level=c,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=c)}}])&&y(n.prototype,u),t}(D.default)},"./src/controller/level-helper.ts":function(F,R,h){h.r(R),h.d(R,"addGroupId",function(){return A}),h.d(R,"assignTrackIdsByGroup",function(){return k}),h.d(R,"updatePTS",function(){return I}),h.d(R,"updateFragPTSDTS",function(){return o}),h.d(R,"mergeDetails",function(){return b}),h.d(R,"mapPartIntersection",function(){return y}),h.d(R,"mapFragmentIntersection",function(){return d}),h.d(R,"adjustSliding",function(){return p}),h.d(R,"addSliding",function(){return m}),h.d(R,"computeReloadInterval",function(){return l}),h.d(R,"getFragmentWithSN",function(){return e}),h.d(R,"getPartWith",function(){return i});var _=h("./src/polyfills/number.ts"),T=h("./src/utils/logger.ts");function A(t,n,u){switch(n){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(u);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(u)}}function k(t){var n={};t.forEach(function(u){var a=u.groupId||"";u.id=n[a]=n[a]||0,n[a]++})}function I(t,n,u){D(t[n],t[u])}function D(t,n){var u=n.startPTS;if(Object(_.isFiniteNumber)(u)){var a,c=0;n.sn>t.sn?(c=u-t.start,a=t):(c=t.start-u,a=n),a.duration!==c&&(a.duration=c)}else n.sn>t.sn?t.cc===n.cc&&t.minEndPTS?n.start=t.start+(t.minEndPTS-t.start):n.start=t.start+t.duration:n.start=Math.max(t.start-n.duration,0)}function o(t,n,u,a,c,E){a-u<=0&&(T.logger.warn("Fragment should have a positive duration",n),a=u+n.duration,E=c+n.duration);var g=u,v=a,r=n.startPTS,s=n.endPTS;if(Object(_.isFiniteNumber)(r)){var f=Math.abs(r-u);Object(_.isFiniteNumber)(n.deltaPTS)?n.deltaPTS=Math.max(f,n.deltaPTS):n.deltaPTS=f,g=Math.max(u,r),u=Math.min(u,r),c=Math.min(c,n.startDTS),v=Math.min(a,s),a=Math.max(a,s),E=Math.max(E,n.endDTS)}n.duration=a-u;var S=u-n.start;n.appendedPTS=a,n.start=n.startPTS=u,n.maxStartPTS=g,n.startDTS=c,n.endPTS=a,n.minEndPTS=v,n.endDTS=E;var L,C=n.sn;if(!t||C<t.startSN||C>t.endSN)return 0;var O=C-t.startSN,w=t.fragments;for(w[O]=n,L=O;L>0;L--)D(w[L],w[L-1]);for(L=O;L<w.length-1;L++)D(w[L],w[L+1]);return t.fragmentHint&&D(w[w.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,S}function b(t,n){for(var u=null,a=t.fragments,c=a.length-1;c>=0;c--){var E=a[c].initSegment;if(E){u=E;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var g,v=0;if(d(t,n,function(C,O){var w;C.relurl&&(v=C.cc-O.cc),Object(_.isFiniteNumber)(C.startPTS)&&Object(_.isFiniteNumber)(C.endPTS)&&(O.start=O.startPTS=C.startPTS,O.startDTS=C.startDTS,O.appendedPTS=C.appendedPTS,O.maxStartPTS=C.maxStartPTS,O.endPTS=C.endPTS,O.endDTS=C.endDTS,O.minEndPTS=C.minEndPTS,O.duration=C.endPTS-C.startPTS,O.duration&&(g=O),n.PTSKnown=n.alignedSliding=!0),O.elementaryStreams=C.elementaryStreams,O.loader=C.loader,O.stats=C.stats,O.urlId=C.urlId,C.initSegment?(O.initSegment=C.initSegment,u=C.initSegment):O.initSegment&&O.initSegment.relurl!=((w=u)===null||w===void 0?void 0:w.relurl)||(O.initSegment=u)}),n.skippedSegments&&(n.deltaUpdateFailed=n.fragments.some(function(C){return!C}),n.deltaUpdateFailed)){T.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=n.skippedSegments;r--;)n.fragments.shift();n.startSN=n.fragments[0].sn,n.startCC=n.fragments[0].cc}var s=n.fragments;if(v){T.logger.warn("discontinuity sliding from playlist, take drift into account");for(var f=0;f<s.length;f++)s[f].cc+=v}n.skippedSegments&&(n.startCC=n.fragments[0].cc),y(t.partList,n.partList,function(C,O){O.elementaryStreams=C.elementaryStreams,O.stats=C.stats}),g?o(n,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):p(t,n),s.length&&(n.totalduration=n.edge-s[0].start),n.driftStartTime=t.driftStartTime,n.driftStart=t.driftStart;var S=n.advancedDateTime;if(n.advanced&&S){var L=n.edge;n.driftStart||(n.driftStartTime=S,n.driftStart=L),n.driftEndTime=S,n.driftEnd=L}else n.driftEndTime=t.driftEndTime,n.driftEnd=t.driftEnd,n.advancedDateTime=t.advancedDateTime}function y(t,n,u){if(t&&n)for(var a=0,c=0,E=t.length;c<=E;c++){var g=t[c],v=n[c+a];g&&v&&g.index===v.index&&g.fragment.sn===v.fragment.sn?u(g,v):a--}}function d(t,n,u){for(var a=n.skippedSegments,c=Math.max(t.startSN,n.startSN)-n.startSN,E=(t.fragmentHint?1:0)+(a?n.endSN:Math.min(t.endSN,n.endSN))-n.startSN,g=n.startSN-t.startSN,v=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments,r=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,s=c;s<=E;s++){var f=r[g+s],S=v[s];a&&!S&&s<a&&(S=n.fragments[s]=f),f&&S&&u(f,S)}}function p(t,n){var u=n.startSN+n.skippedSegments-t.startSN,a=t.fragments;u<0||u>=a.length||m(n,a[u].start)}function m(t,n){if(n){for(var u=t.fragments,a=t.skippedSegments;a<u.length;a++)u[a].start+=n;t.fragmentHint&&(t.fragmentHint.start+=n)}}function l(t,n){var u,a=1e3*t.levelTargetDuration,c=a/2,E=t.age,g=E>0&&E<3*a,v=n.loading.end-n.loading.start,r=t.availabilityDelay;if(t.updated===!1)if(g){var s=333*t.misses;u=Math.max(Math.min(c,2*v),s),t.availabilityDelay=(t.availabilityDelay||0)+u}else u=c;else g?(r=Math.min(r||a/2,E),t.availabilityDelay=r,u=r+a-E):u=a-v;return Math.round(u)}function e(t,n,u){if(!t||!t.details)return null;var a=t.details,c=a.fragments[n-a.startSN];return c||((c=a.fragmentHint)&&c.sn===n?c:n<a.startSN&&u&&u.sn===n?u:null)}function i(t,n,u){if(!t||!t.details)return null;var a=t.details.partList;if(a)for(var c=a.length;c--;){var E=a[c];if(E.index===u&&E.fragment.sn===n)return E}return null}},"./src/controller/stream-controller.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return t});var _=h("./src/polyfills/number.ts"),T=h("./src/controller/base-stream-controller.ts"),A=h("./src/is-supported.ts"),k=h("./src/events.ts"),I=h("./src/utils/buffer-helper.ts"),D=h("./src/controller/fragment-tracker.ts"),o=h("./src/types/loader.ts"),b=h("./src/loader/fragment.ts"),y=h("./src/demux/transmuxer-interface.ts"),d=h("./src/types/transmuxer.ts"),p=h("./src/controller/gap-controller.ts"),m=h("./src/errors.ts"),l=h("./src/utils/logger.ts");function e(n,u){for(var a=0;a<u.length;a++){var c=u[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}function i(n,u){return(i=Object.setPrototypeOf||function(a,c){return a.__proto__=c,a})(n,u)}var t=function(n){var u,a;function c(r,s){var f;return(f=n.call(this,r,s,"[stream-controller]")||this).audioCodecSwap=!1,f.gapController=null,f.level=-1,f._forceStartLoad=!1,f.altAudio=!1,f.audioOnly=!1,f.fragPlaying=null,f.onvplaying=null,f.onvseeked=null,f.fragLastKbps=0,f.stalled=!1,f.couldBacktrack=!1,f.audioCodecSwitch=!1,f.videoBuffer=null,f._registerListeners(),f}a=n,(u=c).prototype=Object.create(a.prototype),u.prototype.constructor=u,i(u,a);var E,g,v=c.prototype;return v._registerListeners=function(){var r=this.hls;r.on(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(k.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(k.Events.ERROR,this.onError,this),r.on(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(k.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var r=this.hls;r.off(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(k.Events.ERROR,this.onError,this),r.off(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(k.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(r){if(this.levels){var s=this.lastCurrentTime,f=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var S=f.startLevel;S===-1&&(f.config.testBandwidth?(S=0,this.bitrateTest=!0):S=f.nextAutoLevel),this.level=f.nextLoadLevel=S,this.loadedmetadata=!1}s>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),r=s),this.state=T.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=T.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_LEVEL:var r,s=this.levels,f=this.level,S=s==null||(r=s[f])===null||r===void 0?void 0:r.details;if(S&&(!S.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(S))break;this.state=T.State.IDLE;break}break;case T.State.FRAG_LOADING_WAITING_RETRY:var L,C=self.performance.now(),O=this.retryDate;(!O||C>=O||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=T.State.IDLE)}this.onTickEnd()},v.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var r,s,f=this.hls,S=this.levelLastLoaded,L=this.levels,C=this.media,O=f.config,w=f.nextLoadLevel;if(S!==null&&(C||!this.startFragRequested&&O.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&L&&L[w]){var P=L[w];this.level=f.nextLoadLevel=w;var x=P.details;if(!x||this.state===T.State.WAITING_LEVEL||x.live&&this.levelLastLoaded!==w)this.state=T.State.WAITING_LEVEL;else{var M=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:C,o.PlaylistLevelType.MAIN);if(M!==null&&!(M.len>=this.getMaxBufferLength(P.maxBitrate))){if(this._streamEnded(M,x)){var N={};return this.altAudio&&(N.type="video"),this.hls.trigger(k.Events.BUFFER_EOS,N),void(this.state=T.State.ENDED)}var U=M.end,G=this.getNextFragment(U,x);if(this.couldBacktrack&&!this.fragPrevious&&G&&G.sn!=="initSegment"){var V=G.sn-x.startSN;V>1&&(G=x.fragments[V-1],this.fragmentTracker.removeFragment(G))}if(G&&this.fragmentTracker.getState(G)===D.FragmentState.OK&&this.nextLoadPosition>U){var W=this.audioOnly&&!this.altAudio?b.ElementaryStreamTypes.AUDIO:b.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(C,W,o.PlaylistLevelType.MAIN),G=this.getNextFragment(this.nextLoadPosition,x)}G&&(!G.initSegment||G.initSegment.data||this.bitrateTest||(G=G.initSegment),((r=G.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(s=G.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(G,x,U):this.loadKey(G,x))}}}},v.loadFragment=function(r,s,f){var S,L=this.fragmentTracker.getState(r);if(this.fragCurrent=r,L===D.FragmentState.BACKTRACKED){var C=this.fragmentTracker.getBacktrackData(r);if(C)return this._handleFragmentLoadProgress(C),void this._handleFragmentLoadComplete(C);L=D.FragmentState.NOT_LOADED}L===D.FragmentState.NOT_LOADED||L===D.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,r,s,f)):L===D.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((S=this.media)===null||S===void 0?void 0:S.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(r){var s=this.fragmentTracker.getAppendedFrag(r,o.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},v.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,o.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var r=this.levels,s=this.media;if(s!=null&&s.readyState){var f,S=this.getAppendedFrag(s.currentTime);if(S&&S.start>1&&this.flushMainBuffer(0,S.start-1),!s.paused&&r){var L=r[this.hls.nextLoadLevel],C=this.fragLastKbps;f=C&&this.fragCurrent?this.fragCurrent.duration*L.maxBitrate/(1e3*C)+1:0}else f=0;var O=this.getBufferedFrag(s.currentTime+f);if(O){var w=this.followingBufferedFrag(O);if(w){this.abortCurrentFrag();var P=w.maxStartPTS?w.maxStartPTS:w.start,x=w.duration,M=Math.max(O.end,P+Math.min(Math.max(x-this.config.maxFragLookUpTolerance,.5*x),.75*x));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===T.State.KEY_LOADING&&(this.state=T.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(r,s){n.prototype.flushMainBuffer.call(this,r,s,this.altAudio?"video":null)},v.onMediaAttached=function(r,s){n.prototype.onMediaAttached.call(this,r,s);var f=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),f.addEventListener("playing",this.onvplaying),f.addEventListener("seeked",this.onvseeked),this.gapController=new p.default(this.config,f,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var r=this.media,s=r?r.currentTime:null;Object(_.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(k.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},v.onManifestParsed=function(r,s){var f,S=!1,L=!1;s.levels.forEach(function(C){(f=C.audioCodec)&&(f.indexOf("mp4a.40.2")!==-1&&(S=!0),f.indexOf("mp4a.40.5")!==-1&&(L=!0))}),this.audioCodecSwitch=S&&L&&!Object(A.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},v.onLevelLoading=function(r,s){var f=this.levels;if(f&&this.state===T.State.IDLE){var S=f[s.level];(!S.details||S.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(S.details))&&(this.state=T.State.WAITING_LEVEL)}},v.onLevelLoaded=function(r,s){var f,S=this.levels,L=s.level,C=s.details,O=C.totalduration;if(S){this.log("Level "+L+" loaded ["+C.startSN+","+C.endSN+"], cc ["+C.startCC+", "+C.endCC+"] duration:"+O);var w=this.fragCurrent;!w||this.state!==T.State.FRAG_LOADING&&this.state!==T.State.FRAG_LOADING_WAITING_RETRY||w.level!==s.level&&w.loader&&(this.state=T.State.IDLE,w.loader.abort());var P=S[L],x=0;if(C.live||(f=P.details)!==null&&f!==void 0&&f.live){if(C.fragments[0]||(C.deltaUpdateFailed=!0),C.deltaUpdateFailed)return;x=this.alignPlaylists(C,P.details)}if(P.details=C,this.levelLastLoaded=L,this.hls.trigger(k.Events.LEVEL_UPDATED,{details:C,level:L}),this.state===T.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(C))return;this.state=T.State.IDLE}this.startFragRequested?C.live&&this.synchronizeToLiveEdge(C):this.setStartPosition(C,x),this.tick()}else this.warn("Levels were reset while loading level "+L)},v._handleFragmentLoadProgress=function(r){var s,f=r.frag,S=r.part,L=r.payload,C=this.levels;if(C){var O=C[f.level],w=O.details;if(w){var P=O.videoCodec,x=w.PTSKnown||!w.live,M=(s=f.initSegment)===null||s===void 0?void 0:s.data,N=this._getAudioCodec(O),U=this.transmuxer=this.transmuxer||new y.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),G=S?S.index:-1,V=G!==-1,W=new d.ChunkMetadata(f.level,f.sn,f.stats.chunkCount,L.byteLength,G,V),Y=this.initPTS[f.cc];U.push(L,M,N,P,f,S,w.totalduration,x,W,Y)}else this.warn("Dropping fragment "+f.sn+" of level "+f.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+f.sn+" of level "+f.level+" will not be buffered")},v.onAudioTrackSwitching=function(r,s){var f=this.altAudio,S=!!s.url,L=s.id;if(!S){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var C=this.fragCurrent;C!=null&&C.loader&&(this.log("Switching to main audio track, cancel main fragment load"),C.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var O=this.hls;f&&O.trigger(k.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),O.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:L})}},v.onAudioTrackSwitched=function(r,s){var f=s.id,S=!!this.hls.audioTracks[f].url;if(S){var L=this.videoBuffer;L&&this.mediaBuffer!==L&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=L)}this.altAudio=S,this.tick()},v.onBufferCreated=function(r,s){var f,S,L=s.tracks,C=!1;for(var O in L){var w=L[O];if(w.id==="main"){if(S=O,f=w,O==="video"){var P=L[O];P&&(this.videoBuffer=P.buffer)}}else C=!0}C&&f?(this.log("Alternate track found, use "+S+".buffered to schedule main fragment loading"),this.mediaBuffer=f.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(r,s){var f=s.frag,S=s.part;if(!f||f.type===o.PlaylistLevelType.MAIN){if(this.fragContextChanged(f))return this.warn("Fragment "+f.sn+(S?" p: "+S.index:"")+" of level "+f.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===T.State.PARSED&&(this.state=T.State.IDLE));var L=S?S.stats:f.stats;this.fragLastKbps=Math.round(8*L.total/(L.buffering.end-L.loading.first)),f.sn!=="initSegment"&&(this.fragPrevious=f),this.fragBufferedComplete(f,S)}},v.onError=function(r,s){switch(s.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,s);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==T.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=T.State.ERROR):s.levelRetry||this.state!==T.State.WAITING_LEVEL||(this.state=T.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var f=!0,S=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);S&&S.len>.5&&(f=!this.reduceMaxBufferLength(S.len)),f&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},v.checkBuffer=function(){var r=this.media,s=this.gapController;if(r&&s&&r.readyState){var f=I.BufferHelper.getBuffered(r);!this.loadedmetadata&&f.length?(this.loadedmetadata=!0,this.seekToStartPos()):s.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=T.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(r,s){var f=s.type;if(f!==b.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var S=(f===b.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(S,f,o.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(r,s){this.levels=s.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var r=this.media,s=r.currentTime,f=this.startPosition;if(f>=0&&s<f){if(r.seeking)return void l.logger.log("could not seek to "+f+", already seeking at "+s);var S=I.BufferHelper.getBuffered(r),L=(S.length?S.start(0):0)-f;L>0&&L<this.config.maxBufferHole&&(l.logger.log("adjusting start position by "+L+" to match buffer start"),f+=L,this.startPosition=f),this.log("seek to target start position "+f+" from current time "+s),r.currentTime=f}},v._getAudioCodec=function(r){var s=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s=s.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),s},v._loadBitrateTestFrag=function(r){var s=this;this._doFragLoad(r).then(function(f){var S=s.hls;if(f&&!S.nextLoadLevel&&!s.fragContextChanged(r)){s.fragLoadError=0,s.state=T.State.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var L=r.stats;L.parsing.start=L.parsing.end=L.buffering.start=L.buffering.end=self.performance.now(),S.trigger(k.Events.FRAG_LOADED,f)}})},v._handleTransmuxComplete=function(r){var s,f="main",S=this.hls,L=r.remuxResult,C=r.chunkMeta,O=this.getCurrentContext(C);if(!O)return this.warn("The loading context changed while buffering fragment "+C.sn+" of level "+C.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(C.level);var w=O.frag,P=O.part,x=O.level,M=L.video,N=L.text,U=L.id3,G=L.initSegment,V=this.altAudio?void 0:L.audio;if(!this.fragContextChanged(w)){if(this.state=T.State.PARSING,G){G.tracks&&(this._bufferInitSegment(x,G.tracks,w,C),S.trigger(k.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:f,tracks:G.tracks}));var W=G.initPTS,Y=G.timescale;Object(_.isFiniteNumber)(W)&&(this.initPTS[w.cc]=W,S.trigger(k.Events.INIT_PTS_FOUND,{frag:w,id:f,initPTS:W,timescale:Y}))}if(M&&L.independent!==!1){if(x.details){var X=M.startPTS,z=M.endPTS,Z=M.startDTS,ne=M.endDTS;if(P)P.elementaryStreams[M.type]={startPTS:X,endPTS:z,startDTS:Z,endDTS:ne};else if(M.firstKeyFrame&&M.independent&&(this.couldBacktrack=!0),M.dropped&&M.independent){if(this.getLoadPosition()+this.config.maxBufferHole<X)return void this.backtrack(w);w.setElementaryStreamInfo(M.type,w.start,z,w.start,ne,!0)}w.setElementaryStreamInfo(M.type,X,z,Z,ne),this.bufferFragmentData(M,w,P,C)}}else if(L.independent===!1)return void this.backtrack(w);if(V){var se=V.startPTS,de=V.endPTS,re=V.startDTS,ge=V.endDTS;P&&(P.elementaryStreams[b.ElementaryStreamTypes.AUDIO]={startPTS:se,endPTS:de,startDTS:re,endDTS:ge}),w.setElementaryStreamInfo(b.ElementaryStreamTypes.AUDIO,se,de,re,ge),this.bufferFragmentData(V,w,P,C)}if(U!=null&&(s=U.samples)!==null&&s!==void 0&&s.length){var te={frag:w,id:f,samples:U.samples};S.trigger(k.Events.FRAG_PARSING_METADATA,te)}if(N){var ae={frag:w,id:f,samples:N.samples};S.trigger(k.Events.FRAG_PARSING_USERDATA,ae)}}},v._bufferInitSegment=function(r,s,f,S){var L=this;if(this.state===T.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var C=s.audio,O=s.video,w=s.audiovideo;if(C){var P=r.audioCodec,x=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P=P.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),C.metadata.channelCount!==1&&x.indexOf("firefox")===-1&&(P="mp4a.40.5")),x.indexOf("android")!==-1&&C.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),r.audioCodec&&r.audioCodec!==P&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+P+'"'),C.levelCodec=P,C.id="main",this.log("Init audio buffer, container:"+C.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(r.audioCodec||"")+"/"+C.codec+"]")}O&&(O.levelCodec=r.videoCodec,O.id="main",this.log("Init video buffer, container:"+O.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+O.codec+"]")),w&&this.log("Init audiovideo buffer, container:"+w.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+w.codec+"]"),this.hls.trigger(k.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(M){var N=s[M].initSegment;N!=null&&N.byteLength&&L.hls.trigger(k.Events.BUFFER_APPENDING,{type:M,data:N,frag:f,part:null,chunkMeta:S,parent:f.type})}),this.tick()}},v.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var s=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,s?this.resetFragmentLoading(r):this.state=T.State.BACKTRACKING},v.checkFragmentChanged=function(){var r=this.media,s=null;if(r&&r.readyState>1&&r.seeking===!1){var f=r.currentTime;if(I.BufferHelper.isBuffered(r,f)?s=this.getAppendedFrag(f):I.BufferHelper.isBuffered(r,f+.1)&&(s=this.getAppendedFrag(f+.1)),s){var S=this.fragPlaying,L=s.level;S&&s.sn===S.sn&&S.level===L&&s.urlId===S.urlId||(this.hls.trigger(k.Events.FRAG_CHANGED,{frag:s}),S&&S.level===L||this.hls.trigger(k.Events.LEVEL_SWITCHED,{level:L}),this.fragPlaying=s)}}},E=c,(g=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var s=this.getAppendedFrag(r.currentTime);if(s)return s.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var s=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(s)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&e(E.prototype,g),c}(T.default)},"./src/controller/subtitle-stream-controller.ts":function(F,R,h){h.r(R),h.d(R,"SubtitleStreamController",function(){return l});var _=h("./src/events.ts"),T=h("./src/utils/logger.ts"),A=h("./src/utils/buffer-helper.ts"),k=h("./src/controller/fragment-finders.ts"),I=h("./src/utils/discontinuities.ts"),D=h("./src/controller/level-helper.ts"),o=h("./src/controller/fragment-tracker.ts"),b=h("./src/controller/base-stream-controller.ts"),y=h("./src/types/loader.ts"),d=h("./src/types/level.ts");function p(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,i){return(m=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(e,i)}var l=function(e){var i,t;function n(E,g){var v;return(v=e.call(this,E,g,"[subtitle-stream-controller]")||this).levels=[],v.currentTrackId=-1,v.tracksBuffered=[],v.mainDetails=null,v._registerListeners(),v}t=e,(i=n).prototype=Object.create(t.prototype),i.prototype.constructor=i,m(i,t);var u,a,c=n.prototype;return c.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},c._registerListeners=function(){var E=this.hls;E.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(_.Events.ERROR,this.onError,this),E.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),E.on(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),E.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),E.on(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),E.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c._unregisterListeners=function(){var E=this.hls;E.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(_.Events.ERROR,this.onError,this),E.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),E.off(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),E.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),E.off(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),E.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c.startLoad=function(){this.stopLoad(),this.state=b.State.IDLE,this.setInterval(500),this.tick()},c.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},c.onLevelLoaded=function(E,g){this.mainDetails=g.details},c.onSubtitleFragProcessed=function(E,g){var v=g.frag,r=g.success;if(this.fragPrevious=v,this.state=b.State.IDLE,r){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var f,S=v.start,L=0;L<s.length;L++)if(S>=s[L].start&&S<=s[L].end){f=s[L];break}var C=v.start+v.duration;f?f.end=C:(f={start:S,end:C},s.push(f)),this.fragmentTracker.fragBuffered(v)}}},c.onBufferFlushing=function(E,g){var v=g.startOffset,r=g.endOffset;if(v===0&&r!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,f=this.levels;if(!f.length||!f[s]||!f[s].details)return;var S=r-f[s].details.targetduration;if(S<=0)return;g.endOffsetSubtitles=Math.max(0,S),this.tracksBuffered.forEach(function(L){for(var C=0;C<L.length;)if(L[C].end<=S)L.shift();else{if(!(L[C].start<S))break;L[C].start=S,C++}}),this.fragmentTracker.removeFragmentsInRange(v,S,y.PlaylistLevelType.SUBTITLE)}},c.onError=function(E,g){var v,r=g.frag;r&&r.type===y.PlaylistLevelType.SUBTITLE&&((v=this.fragCurrent)!==null&&v!==void 0&&v.loader&&this.fragCurrent.loader.abort(),this.state=b.State.IDLE)},c.onSubtitleTracksUpdated=function(E,g){var v=this,r=g.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(s){return new d.Level(s)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(s){v.tracksBuffered[s.id]=[]}),this.mediaBuffer=null},c.onSubtitleTrackSwitch=function(E,g){if(this.currentTrackId=g.id,this.levels.length&&this.currentTrackId!==-1){var v=this.levels[this.currentTrackId];v!=null&&v.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},c.onSubtitleTrackLoaded=function(E,g){var v,r=g.details,s=g.id,f=this.currentTrackId,S=this.levels;if(S.length){var L=S[f];if(!(s>=S.length||s!==f)&&L){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(v=L.details)!==null&&v!==void 0&&v.live){var C=this.mainDetails;if(r.deltaUpdateFailed||!C)return;var O=C.fragments[0];L.details?this.alignPlaylists(r,L.details)===0&&O&&Object(D.addSliding)(r,O.start):r.hasProgramDateTime&&C.hasProgramDateTime?Object(I.alignPDT)(r,C):O&&Object(D.addSliding)(r,O.start)}L.details=r,this.levelLastLoaded=s,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===b.State.IDLE&&(Object(k.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),L.details=void 0))}}},c._handleFragmentLoadComplete=function(E){var g=E.frag,v=E.payload,r=g.decryptdata,s=this.hls;if(!this.fragContextChanged(g)&&v&&v.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var f=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(v),r.key.buffer,r.iv.buffer).then(function(S){var L=performance.now();s.trigger(_.Events.FRAG_DECRYPTED,{frag:g,payload:S,stats:{tstart:f,tdecrypt:L}})})}},c.doTick=function(){if(this.media){if(this.state===b.State.IDLE){var E,g=this.currentTrackId,v=this.levels;if(!v.length||!v[g]||!v[g].details)return;var r=v[g].details,s=r.targetduration,f=this.config,S=this.media,L=A.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,S.currentTime-s,f.maxBufferHole),C=L.end;if(L.len>this.getMaxBufferLength()+s)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var O,w=r.fragments,P=w.length,x=r.edge,M=this.fragPrevious;if(C<x){var N=f.maxFragLookUpTolerance;M&&r.hasProgramDateTime&&(O=Object(k.findFragmentByPDT)(w,M.endProgramDateTime,N)),O||!(O=Object(k.findFragmentByPTS)(M,w,C,N))&&M&&M.start<w[0].start&&(O=w[0])}else O=w[P-1];(E=O)!==null&&E!==void 0&&E.encrypted?(T.logger.log("Loading key for "+O.sn),this.state=b.State.KEY_LOADING,this.hls.trigger(_.Events.KEY_LOADING,{frag:O})):O&&this.fragmentTracker.getState(O)===o.FragmentState.NOT_LOADED&&this.loadFragment(O,r,C)}}else this.state=b.State.IDLE},c.loadFragment=function(E,g,v){this.fragCurrent=E,e.prototype.loadFragment.call(this,E,g,v)},u=n,(a=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&p(u.prototype,a),n}(b.default)},"./src/controller/subtitle-track-controller.ts":function(F,R,h){h.r(R);var _=h("./src/events.ts"),T=h("./src/utils/texttrack-utils.ts"),A=h("./src/controller/base-playlist-controller.ts"),k=h("./src/types/loader.ts");function I(y,d){for(var p=0;p<d.length;p++){var m=d[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(y,m.key,m)}}function D(y,d){return(D=Object.setPrototypeOf||function(p,m){return p.__proto__=m,p})(y,d)}var o=function(y){var d,p;function m(t){var n;return(n=y.call(this,t,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n.subtitleDisplay=!0,n.registerListeners(),n}p=y,(d=m).prototype=Object.create(p.prototype),d.prototype.constructor=d,D(d,p);var l,e,i=m.prototype;return i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,y.prototype.destroy.call(this)},i.registerListeners=function(){var t=this.hls;t.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(_.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var t=this.hls;t.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(_.Events.ERROR,this.onError,this)},i.onMediaAttached=function(t,n){this.media=n.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},i.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},i.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),b(this.media.textTracks).forEach(function(t){Object(T.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null)},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},i.onManifestParsed=function(t,n){this.tracks=n.subtitleTracks},i.onSubtitleTrackLoaded=function(t,n){var u=n.id,a=n.details,c=this.trackId,E=this.tracksInGroup[c];if(E){var g=E.details;E.details=n.details,this.log("subtitle track "+u+" loaded ["+a.startSN+"-"+a.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,n,g))}else this.warn("Invalid subtitle track id "+u)},i.onLevelLoading=function(t,n){this.switchLevel(n.level)},i.onLevelSwitching=function(t,n){this.switchLevel(n.level)},i.switchLevel=function(t){var n=this.hls.levels[t];if(n!=null&&n.textGroupIds){var u=n.textGroupIds[n.urlId];if(this.groupId!==u){var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,c=this.tracks.filter(function(v){return!u||v.groupId===u});this.tracksInGroup=c;var E=this.findTrackId(a==null?void 0:a.name)||this.findTrackId();this.groupId=u;var g={subtitleTracks:c};this.log("Updating subtitle tracks, "+c.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(_.Events.SUBTITLE_TRACKS_UPDATED,g),E!==-1&&this.setSubtitleTrack(E,a)}}},i.findTrackId=function(t){for(var n=this.tracksInGroup,u=0;u<n.length;u++){var a=n[u];if((!this.selectDefaultTrack||a.default)&&(!t||t===a.name))return a.id}return-1},i.onError=function(t,n){y.prototype.onError.call(this,t,n),!n.fatal&&n.context&&n.context.type===k.PlaylistContextType.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},i.loadPlaylist=function(t){var n=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(n)){var u=n.id,a=n.groupId,c=n.url;if(t)try{c=t.addDirectives(c)}catch(E){this.warn("Could not construct new URL with HLS Delivery Directives: "+E)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADING,{url:c,id:u,groupId:a,deliveryDirectives:t||null})}},i.toggleTrackModes=function(t){var n=this,u=this.media,a=this.subtitleDisplay,c=this.trackId;if(u){var E=b(u.textTracks),g=E.filter(function(s){return s.groupId===n.groupId});if(t===-1)[].slice.call(E).forEach(function(s){s.mode="disabled"});else{var v=g[c];v&&(v.mode="disabled")}var r=g[t];r&&(r.mode=a?"showing":"hidden")}},i.setSubtitleTrack=function(t,n){var u,a=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(u=a[t])!==null&&u!==void 0&&u.details)||t<-1||t>=a.length)){this.clearTimer();var c=a[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,c){var E=c.id,g=c.groupId,v=g===void 0?"":g,r=c.name,s=c.type,f=c.url;this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:E,groupId:v,name:r,type:s,url:f});var S=this.switchParams(c.url,n==null?void 0:n.details);this.loadPlaylist(S)}else this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},i.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,n=b(this.media.textTracks),u=0;u<n.length;u++)if(n[u].mode==="hidden")t=u;else if(n[u].mode==="showing"){t=u;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},l=m,(e=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,n)}}])&&I(l.prototype,e),m}(A.default);function b(y){for(var d=[],p=0;p<y.length;p++){var m=y[p];m.kind==="subtitles"&&m.label&&d.push(y[p])}return d}R.default=o},"./src/controller/timeline-controller.ts":function(F,R,h){h.r(R),h.d(R,"TimelineController",function(){return d});var _=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),A=h("./src/utils/cea-608-parser.ts"),k=h("./src/utils/output-filter.ts"),I=h("./src/utils/webvtt-parser.ts"),D=h("./src/utils/texttrack-utils.ts"),o=h("./src/utils/imsc1-ttml-parser.ts"),b=h("./src/types/loader.ts"),y=h("./src/utils/logger.ts"),d=function(){function m(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var i=new k.default(this,"textTrack1"),t=new k.default(this,"textTrack2"),n=new k.default(this,"textTrack3"),u=new k.default(this,"textTrack4");this.cea608Parser1=new A.default(1,i,t),this.cea608Parser2=new A.default(3,n,u)}e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.Events.FRAG_LOADING,this.onFragLoading,this),e.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var l=m.prototype;return l.destroy=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.Events.FRAG_LOADING,this.onFragLoading,this),e.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},l.addCues=function(e,i,t,n,u){for(var a,c,E,g,v=!1,r=u.length;r--;){var s=u[r],f=(a=s[0],c=s[1],E=i,g=t,Math.min(c,g)-Math.max(a,E));if(f>=0&&(s[0]=Math.min(s[0],i),s[1]=Math.max(s[1],t),v=!0,f/(t-i)>.5))return}if(v||u.push([i,t]),this.config.renderTextTracksNatively){var S=this.captionsTracks[e];this.Cues.newCue(S,i,t,n)}else{var L=this.Cues.newCue(null,i,t,n);this.hls.trigger(T.Events.CUES_PARSED,{type:"captions",cues:L,track:e})}},l.onInitPtsFound=function(e,i){var t=this,n=i.frag,u=i.id,a=i.initPTS,c=i.timescale,E=this.unparsedVttFrags;u==="main"&&(this.initPTS[n.cc]=a,this.timescale[n.cc]=c),E.length&&(this.unparsedVttFrags=[],E.forEach(function(g){t.onFragLoaded(T.Events.FRAG_LOADED,g)}))},l.getExistingTrack=function(e){var i=this.media;if(i)for(var t=0;t<i.textTracks.length;t++){var n=i.textTracks[t];if(n[e])return n}return null},l.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},l.createNativeTrack=function(e){if(!this.captionsTracks[e]){var i=this.captionsProperties,t=this.captionsTracks,n=this.media,u=i[e],a=u.label,c=u.languageCode,E=this.getExistingTrack(e);if(E)t[e]=E,Object(D.clearCurrentCues)(t[e]),Object(D.sendAddTrackEvent)(t[e],n);else{var g=this.createTextTrack("captions",a,c);g&&(g[e]=!0,t[e]=g)}}},l.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var i=this.captionsProperties[e];if(i){var t={_id:e,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]})}}},l.createTextTrack=function(e,i,t){var n=this.media;if(n)return n.addTextTrack(e,i,t)},l.onMediaAttaching=function(e,i){this.media=i.media,this._cleanTracks()},l.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(i){Object(D.clearCurrentCues)(e[i]),delete e[i]}),this.nonNativeCaptionsTracks={}},l.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},l._cleanTracks=function(){var e=this.media;if(e){var i=e.textTracks;if(i)for(var t=0;t<i.length;t++)Object(D.clearCurrentCues)(i[t])}},l.onSubtitleTracksUpdated=function(e,i){var t=this;this.textTracks=[];var n=i.subtitleTracks||[],u=n.some(function(g){return g.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||u&&this.config.enableIMSC1){var a=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(g,v){var r;if(v<c.length){for(var s=null,f=0;f<c.length;f++)if(p(c[f],g)){s=c[f];break}s&&(r=s)}r?Object(D.clearCurrentCues)(r):(r=t.createTextTrack("subtitles",g.name,g.lang))&&(r.mode="disabled"),r&&(r.groupId=g.groupId,t.textTracks.push(r))})}else if(!a&&this.tracks&&this.tracks.length){var E=this.tracks.map(function(g){return{label:g.name,kind:g.type.toLowerCase(),default:g.default,subtitleTrack:g}});this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:E})}}},l.onManifestLoaded=function(e,i){var t=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(n){var u=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(u){var a="textTrack"+u[1],c=t.captionsProperties[a];c&&(c.label=n.name,n.lang&&(c.languageCode=n.lang),c.media=n)}})},l.onFragLoading=function(e,i){var t=this.cea608Parser1,n=this.cea608Parser2,u=this.lastSn;if(this.enabled&&t&&n&&i.frag.type===b.PlaylistLevelType.MAIN){var a=i.frag.sn;a!==u+1&&(t.reset(),n.reset()),this.lastSn=a}},l.onFragLoaded=function(e,i){var t=i.frag,n=i.payload,u=this.initPTS,a=this.unparsedVttFrags;if(t.type===b.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!Object(_.isFiniteNumber)(u[t.cc]))return a.push(i),void(u.length&&this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")}));var c=t.decryptdata;if(c==null||c.key==null||c.method!=="AES-128"){var E=this.tracks[t.level],g=this.vttCCs;g[t.cc]||(g[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),E&&E.textCodec===o.IMSC1_CODEC?this._parseIMSC1(t,n):this._parseVTTs(t,n,g)}}else this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},l._parseIMSC1=function(e,i){var t=this,n=this.hls;Object(o.parseIMSC1)(i,this.initPTS[e.cc],this.timescale[e.cc],function(u){t._appendCues(u,e.level),n.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(u){y.logger.log("Failed to parse IMSC1: "+u),n.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:u})})},l._parseVTTs=function(e,i,t){var n=this,u=this.hls;Object(I.parseWebVTT)(i,this.initPTS[e.cc],this.timescale[e.cc],t,e.cc,e.start,function(a){n._appendCues(a,e.level),u.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){n._fallbackToIMSC1(e,i),y.logger.log("Failed to parse VTT cue: "+a),u.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},l._fallbackToIMSC1=function(e,i){var t=this,n=this.tracks[e.level];n.textCodec||Object(o.parseIMSC1)(i,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=o.IMSC1_CODEC,t._parseIMSC1(e,i)},function(){n.textCodec="wvtt"})},l._appendCues=function(e,i){var t=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[i];if(n.mode==="disabled")return;e.forEach(function(a){return Object(D.addCueToTrack)(n,a)})}else{var u=this.tracks[i].default?"default":"subtitles"+i;t.trigger(T.Events.CUES_PARSED,{type:"subtitles",cues:e,track:u})}},l.onFragDecrypted=function(e,i){var t=i.frag;if(t.type===b.PlaylistLevelType.SUBTITLE){if(!Object(_.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(i);this.onFragLoaded(T.Events.FRAG_LOADED,i)}},l.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},l.onFragParsingUserdata=function(e,i){var t=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&t&&n)for(var u=0;u<i.samples.length;u++){var a=i.samples[u].bytes;if(a){var c=this.extractCea608Data(a);t.addData(i.samples[u].pts,c[0]),n.addData(i.samples[u].pts,c[1])}}},l.onBufferFlushing=function(e,i){var t=i.startOffset,n=i.endOffset,u=i.endOffsetSubtitles,a=i.type,c=this.media;if(c&&!(c.currentTime<n)){if(!a||a==="video"){var E=this.captionsTracks;Object.keys(E).forEach(function(v){return Object(D.removeCuesInRange)(E[v],t,n)})}if(this.config.renderTextTracksNatively&&t===0&&u!==void 0){var g=this.textTracks;Object.keys(g).forEach(function(v){return Object(D.removeCuesInRange)(g[v],t,u)})}}},l.extractCea608Data=function(e){for(var i=31&e[0],t=2,n=[[],[]],u=0;u<i;u++){var a=e[t++],c=127&e[t++],E=127&e[t++],g=3&a;c===0&&E===0||(4&a)!=0&&(g!==0&&g!==1||(n[g].push(c),n[g].push(E)))}return n},m}();function p(m,l){return m&&m.label===l.name&&!(m.textTrack1||m.textTrack2)}},"./src/crypt/aes-crypto.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return _});var _=function(){function T(A,k){this.subtle=void 0,this.aesIV=void 0,this.subtle=A,this.aesIV=k}return T.prototype.decrypt=function(A,k){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},k,A)},T}()},"./src/crypt/aes-decryptor.ts":function(F,R,h){h.r(R),h.d(R,"removePadding",function(){return T}),h.d(R,"default",function(){return A});var _=h("./src/utils/typed-array.ts");function T(k){var I=k.byteLength,D=I&&new DataView(k.buffer).getUint8(I-1);return D?Object(_.sliceUint8)(k,0,I-D):k}var A=function(){function k(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var I=k.prototype;return I.uint8ArrayToUint32Array_=function(D){for(var o=new DataView(D),b=new Uint32Array(4),y=0;y<4;y++)b[y]=o.getUint32(4*y);return b},I.initTable=function(){var D=this.sBox,o=this.invSBox,b=this.subMix,y=b[0],d=b[1],p=b[2],m=b[3],l=this.invSubMix,e=l[0],i=l[1],t=l[2],n=l[3],u=new Uint32Array(256),a=0,c=0,E=0;for(E=0;E<256;E++)u[E]=E<128?E<<1:E<<1^283;for(E=0;E<256;E++){var g=c^c<<1^c<<2^c<<3^c<<4;g=g>>>8^255&g^99,D[a]=g,o[g]=a;var v=u[a],r=u[v],s=u[r],f=257*u[g]^16843008*g;y[a]=f<<24|f>>>8,d[a]=f<<16|f>>>16,p[a]=f<<8|f>>>24,m[a]=f,f=16843009*s^65537*r^257*v^16843008*a,e[g]=f<<24|f>>>8,i[g]=f<<16|f>>>16,t[g]=f<<8|f>>>24,n[g]=f,a?(a=v^u[u[u[s^v]]],c^=u[u[c]]):a=c=1}},I.expandKey=function(D){for(var o=this.uint8ArrayToUint32Array_(D),b=!0,y=0;y<o.length&&b;)b=o[y]===this.key[y],y++;if(!b){this.key=o;var d=this.keySize=o.length;if(d!==4&&d!==6&&d!==8)throw new Error("Invalid aes key size="+d);var p,m,l,e,i=this.ksRows=4*(d+6+1),t=this.keySchedule=new Uint32Array(i),n=this.invKeySchedule=new Uint32Array(i),u=this.sBox,a=this.rcon,c=this.invSubMix,E=c[0],g=c[1],v=c[2],r=c[3];for(p=0;p<i;p++)p<d?l=t[p]=o[p]:(e=l,p%d==0?(e=u[(e=e<<8|e>>>24)>>>24]<<24|u[e>>>16&255]<<16|u[e>>>8&255]<<8|u[255&e],e^=a[p/d|0]<<24):d>6&&p%d==4&&(e=u[e>>>24]<<24|u[e>>>16&255]<<16|u[e>>>8&255]<<8|u[255&e]),t[p]=l=(t[p-d]^e)>>>0);for(m=0;m<i;m++)p=i-m,e=3&m?t[p]:t[p-4],n[m]=m<4||p<=4?e:E[u[e>>>24]]^g[u[e>>>16&255]]^v[u[e>>>8&255]]^r[u[255&e]],n[m]=n[m]>>>0}},I.networkToHostOrderSwap=function(D){return D<<24|(65280&D)<<8|(16711680&D)>>8|D>>>24},I.decrypt=function(D,o,b){for(var y,d,p,m,l,e,i,t,n,u,a,c,E,g,v=this.keySize+6,r=this.invKeySchedule,s=this.invSBox,f=this.invSubMix,S=f[0],L=f[1],C=f[2],O=f[3],w=this.uint8ArrayToUint32Array_(b),P=w[0],x=w[1],M=w[2],N=w[3],U=new Int32Array(D),G=new Int32Array(U.length),V=this.networkToHostOrderSwap;o<U.length;){for(n=V(U[o]),u=V(U[o+1]),a=V(U[o+2]),c=V(U[o+3]),l=n^r[0],e=c^r[1],i=a^r[2],t=u^r[3],E=4,g=1;g<v;g++)y=S[l>>>24]^L[e>>16&255]^C[i>>8&255]^O[255&t]^r[E],d=S[e>>>24]^L[i>>16&255]^C[t>>8&255]^O[255&l]^r[E+1],p=S[i>>>24]^L[t>>16&255]^C[l>>8&255]^O[255&e]^r[E+2],m=S[t>>>24]^L[l>>16&255]^C[e>>8&255]^O[255&i]^r[E+3],l=y,e=d,i=p,t=m,E+=4;y=s[l>>>24]<<24^s[e>>16&255]<<16^s[i>>8&255]<<8^s[255&t]^r[E],d=s[e>>>24]<<24^s[i>>16&255]<<16^s[t>>8&255]<<8^s[255&l]^r[E+1],p=s[i>>>24]<<24^s[t>>16&255]<<16^s[l>>8&255]<<8^s[255&e]^r[E+2],m=s[t>>>24]<<24^s[l>>16&255]<<16^s[e>>8&255]<<8^s[255&i]^r[E+3],G[o]=V(y^P),G[o+1]=V(m^x),G[o+2]=V(p^M),G[o+3]=V(d^N),P=n,x=u,M=a,N=c,o+=4}return G.buffer},k}()},"./src/crypt/decrypter.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return o});var _=h("./src/crypt/aes-crypto.ts"),T=h("./src/crypt/fast-aes-key.ts"),A=h("./src/crypt/aes-decryptor.ts"),k=h("./src/utils/logger.ts"),I=h("./src/utils/mp4-tools.ts"),D=h("./src/utils/typed-array.ts"),o=function(){function b(d,p,m){var l=(m===void 0?{}:m).removePKCS7Padding,e=l===void 0||l;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=d,this.config=p,this.removePKCS7Padding=e,e)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var y=b.prototype;return y.destroy=function(){this.observer=null},y.isSync=function(){return this.config.enableSoftwareAES},y.flush=function(){var d=this.currentResult;if(d){var p=new Uint8Array(d);return this.reset(),this.removePKCS7Padding?Object(A.removePadding)(p):p}this.reset()},y.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},y.decrypt=function(d,p,m,l){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(d),p,m);var e=this.flush();e&&l(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(d),p,m).then(l)},y.softwareDecrypt=function(d,p,m){var l=this.currentIV,e=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(d=Object(I.appendUint8Array)(i,d),this.remainderData=null);var t=this.getValidChunk(d);if(!t.length)return null;l&&(m=l);var n=this.softwareDecrypter;n||(n=this.softwareDecrypter=new A.default),n.expandKey(p);var u=e;return this.currentResult=n.decrypt(t.buffer,0,m),this.currentIV=Object(D.sliceUint8)(t,-16).buffer,u||null},y.webCryptoDecrypt=function(d,p,m){var l=this,e=this.subtle;return this.key===p&&this.fastAesKey||(this.key=p,this.fastAesKey=new T.default(e,p)),this.fastAesKey.expandKey().then(function(i){return e?new _.default(e,m).decrypt(d.buffer,i):Promise.reject(new Error("web crypto not initialized"))}).catch(function(i){return l.onWebCryptoError(i,d,p,m)})},y.onWebCryptoError=function(d,p,m,l){return k.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",d),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(p,m,l)},y.getValidChunk=function(d){var p=d,m=d.length-d.length%16;return m!==d.length&&(p=Object(D.sliceUint8)(d,0,m),this.remainderData=Object(D.sliceUint8)(d,m)),p},y.logOnce=function(d){this.logEnabled&&(k.logger.log("[decrypter.ts]: "+d),this.logEnabled=!1)},b}()},"./src/crypt/fast-aes-key.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return _});var _=function(){function T(A,k){this.subtle=void 0,this.key=void 0,this.subtle=A,this.key=k}return T.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},T}()},"./src/demux/aacdemuxer.ts":function(F,R,h){h.r(R);var _=h("./src/demux/base-audio-demuxer.ts"),T=h("./src/demux/adts.ts"),A=h("./src/utils/logger.ts"),k=h("./src/demux/id3.ts");function I(o,b){return(I=Object.setPrototypeOf||function(y,d){return y.__proto__=d,y})(o,b)}var D=function(o){var b,y;function d(m,l){var e;return(e=o.call(this)||this).observer=void 0,e.config=void 0,e.observer=m,e.config=l,e}y=o,(b=d).prototype=Object.create(y.prototype),b.prototype.constructor=b,I(b,y);var p=d.prototype;return p.resetInitSegment=function(m,l,e){o.prototype.resetInitSegment.call(this,m,l,e),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:m,duration:e,inputTimeScale:9e4,dropped:0}},d.probe=function(m){if(!m)return!1;for(var l=(k.getID3Data(m,0)||[]).length,e=m.length;l<e;l++)if(T.probe(m,l))return A.logger.log("ADTS sync word found !"),!0;return!1},p.canParse=function(m,l){return T.canParse(m,l)},p.appendFrame=function(m,l,e){T.initTrackConfig(m,this.observer,l,e,m.manifestCodec);var i=T.appendFrame(m,l,e,this.initPTS,this.frameIndex);if(i&&i.missing===0)return i},d}(_.default);D.minProbeByteLength=9,R.default=D},"./src/demux/adts.ts":function(F,R,h){h.r(R),h.d(R,"getAudioConfig",function(){return k}),h.d(R,"isHeaderPattern",function(){return I}),h.d(R,"getHeaderLength",function(){return D}),h.d(R,"getFullFrameLength",function(){return o}),h.d(R,"canGetFrameLength",function(){return b}),h.d(R,"isHeader",function(){return y}),h.d(R,"canParse",function(){return d}),h.d(R,"probe",function(){return p}),h.d(R,"initTrackConfig",function(){return m}),h.d(R,"getFrameDuration",function(){return l}),h.d(R,"parseFrameHeader",function(){return e}),h.d(R,"appendFrame",function(){return i});var _=h("./src/utils/logger.ts"),T=h("./src/errors.ts"),A=h("./src/events.ts");function k(t,n,u,a){var c,E,g,v,r=navigator.userAgent.toLowerCase(),s=a,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];c=1+((192&n[u+2])>>>6);var S=(60&n[u+2])>>>2;if(!(S>f.length-1))return g=(1&n[u+2])<<2,g|=(192&n[u+3])>>>6,_.logger.log("manifest codec:"+a+", ADTS type:"+c+", samplingIndex:"+S),/firefox/i.test(r)?S>=6?(c=5,v=new Array(4),E=S-3):(c=2,v=new Array(2),E=S):r.indexOf("android")!==-1?(c=2,v=new Array(2),E=S):(c=5,v=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&S>=6?E=S-3:((a&&a.indexOf("mp4a.40.2")!==-1&&(S>=6&&g===1||/vivaldi/i.test(r))||!a&&g===1)&&(c=2,v=new Array(2)),E=S)),v[0]=c<<3,v[0]|=(14&S)>>1,v[1]|=(1&S)<<7,v[1]|=g<<3,c===5&&(v[1]|=(14&E)>>1,v[2]=(1&E)<<7,v[2]|=8,v[3]=0),{config:v,samplerate:f[S],channelCount:g,codec:"mp4a.40."+c,manifestCodec:s};t.trigger(A.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+S})}function I(t,n){return t[n]===255&&(246&t[n+1])==240}function D(t,n){return 1&t[n+1]?7:9}function o(t,n){return(3&t[n+3])<<11|t[n+4]<<3|(224&t[n+5])>>>5}function b(t,n){return n+5<t.length}function y(t,n){return n+1<t.length&&I(t,n)}function d(t,n){return b(t,n)&&I(t,n)&&o(t,n)<=t.length-n}function p(t,n){if(y(t,n)){var u=D(t,n);if(n+u>=t.length)return!1;var a=o(t,n);if(a<=u)return!1;var c=n+a;return c===t.length||y(t,c)}return!1}function m(t,n,u,a,c){if(!t.samplerate){var E=k(n,u,a,c);if(!E)return;t.config=E.config,t.samplerate=E.samplerate,t.channelCount=E.channelCount,t.codec=E.codec,t.manifestCodec=E.manifestCodec,_.logger.log("parsed codec:"+t.codec+", rate:"+E.samplerate+", channels:"+E.channelCount)}}function l(t){return 9216e4/t}function e(t,n,u,a,c){var E=D(t,n),g=o(t,n);if((g-=E)>0)return{headerLength:E,frameLength:g,stamp:u+a*c}}function i(t,n,u,a,c){var E=e(n,u,a,c,l(t.samplerate));if(E){var g,v=E.frameLength,r=E.headerLength,s=E.stamp,f=r+v,S=Math.max(0,u+f-n.length);S?(g=new Uint8Array(f-r)).set(n.subarray(u+r,n.length),0):g=n.subarray(u+r,u+f);var L={unit:g,pts:s};return S||t.samples.push(L),{sample:L,length:f,missing:S}}}},"./src/demux/base-audio-demuxer.ts":function(F,R,h){h.r(R),h.d(R,"initPTSFn",function(){return o});var _=h("./src/polyfills/number.ts"),T=h("./src/demux/id3.ts"),A=h("./src/demux/dummy-demuxed-track.ts"),k=h("./src/utils/mp4-tools.ts"),I=h("./src/utils/typed-array.ts"),D=function(){function b(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var y=b.prototype;return y.resetInitSegment=function(d,p,m){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},y.resetTimeStamp=function(){},y.resetContiguity=function(){},y.canParse=function(d,p){return!1},y.appendFrame=function(d,p,m){},y.demux=function(d,p){this.cachedData&&(d=Object(k.appendUint8Array)(this.cachedData,d),this.cachedData=null);var m,l,e=T.getID3Data(d,0),i=e?e.length:0,t=this._audioTrack,n=this._id3Track,u=e?T.getTimeStamp(e):void 0,a=d.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=o(u,p)),e&&e.length>0&&n.samples.push({pts:this.initPTS,dts:this.initPTS,data:e}),l=this.initPTS;i<a;){if(this.canParse(d,i)){var c=this.appendFrame(t,d,i);c?(this.frameIndex++,l=c.sample.pts,m=i+=c.length):i=a}else T.canParse(d,i)?(e=T.getID3Data(d,i),n.samples.push({pts:l,dts:l,data:e}),m=i+=e.length):i++;if(i===a&&m!==a){var E=Object(I.sliceUint8)(d,m);this.cachedData?this.cachedData=Object(k.appendUint8Array)(this.cachedData,E):this.cachedData=E}}return{audioTrack:t,avcTrack:Object(A.dummyTrack)(),id3Track:n,textTrack:Object(A.dummyTrack)()}},y.demuxSampleAes=function(d,p,m){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},y.flush=function(d){var p=this.cachedData;return p&&(this.cachedData=null,this.demux(p,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(A.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(A.dummyTrack)()}},y.destroy=function(){},b}(),o=function(b,y){return Object(_.isFiniteNumber)(b)?90*b:9e4*y};R.default=D},"./src/demux/chunk-cache.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return _});var _=function(){function T(){this.chunks=[],this.dataLength=0}var A=T.prototype;return A.push=function(k){this.chunks.push(k),this.dataLength+=k.length},A.flush=function(){var k,I=this.chunks,D=this.dataLength;return I.length?(k=I.length===1?I[0]:function(o,b){for(var y=new Uint8Array(b),d=0,p=0;p<o.length;p++){var m=o[p];y.set(m,d),d+=m.length}return y}(I,D),this.reset(),k):new Uint8Array(0)},A.reset=function(){this.chunks.length=0,this.dataLength=0},T}()},"./src/demux/dummy-demuxed-track.ts":function(F,R,h){function _(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}h.r(R),h.d(R,"dummyTrack",function(){return _})},"./src/demux/exp-golomb.ts":function(F,R,h){h.r(R);var _=h("./src/utils/logger.ts"),T=function(){function A(I){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=I,this.bytesAvailable=I.byteLength,this.word=0,this.bitsAvailable=0}var k=A.prototype;return k.loadWord=function(){var I=this.data,D=this.bytesAvailable,o=I.byteLength-D,b=new Uint8Array(4),y=Math.min(4,D);if(y===0)throw new Error("no bytes available");b.set(I.subarray(o,o+y)),this.word=new DataView(b.buffer).getUint32(0),this.bitsAvailable=8*y,this.bytesAvailable-=y},k.skipBits=function(I){var D;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,I-=(D=I>>3)>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},k.readBits=function(I){var D=Math.min(this.bitsAvailable,I),o=this.word>>>32-D;return I>32&&_.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),(D=I-D)>0&&this.bitsAvailable?o<<D|this.readBits(D):o},k.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!=0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},k.skipUEG=function(){this.skipBits(1+this.skipLZ())},k.skipEG=function(){this.skipBits(1+this.skipLZ())},k.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},k.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},k.readBoolean=function(){return this.readBits(1)===1},k.readUByte=function(){return this.readBits(8)},k.readUShort=function(){return this.readBits(16)},k.readUInt=function(){return this.readBits(32)},k.skipScalingList=function(I){for(var D=8,o=8,b=0;b<I;b++)o!==0&&(o=(D+this.readEG()+256)%256),D=o===0?D:o},k.readSPS=function(){var I,D,o,b=0,y=0,d=0,p=0,m=this.readUByte.bind(this),l=this.readBits.bind(this),e=this.readUEG.bind(this),i=this.readBoolean.bind(this),t=this.skipBits.bind(this),n=this.skipEG.bind(this),u=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);m();var c=m();if(l(5),t(3),m(),u(),c===100||c===110||c===122||c===244||c===44||c===83||c===86||c===118||c===128){var E=e();if(E===3&&t(1),u(),u(),t(1),i())for(D=E!==3?8:12,o=0;o<D;o++)i()&&a(o<6?16:64)}u();var g=e();if(g===0)e();else if(g===1)for(t(1),n(),n(),I=e(),o=0;o<I;o++)n();u(),t(1);var v=e(),r=e(),s=l(1);s===0&&t(1),t(1),i()&&(b=e(),y=e(),d=e(),p=e());var f=[1,1];if(i()&&i())switch(m()){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[m()<<8|m(),m()<<8|m()]}return{width:Math.ceil(16*(v+1)-2*b-2*y),height:(2-s)*(r+1)*16-(s?2:4)*(d+p),pixelRatio:f}},k.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},A}();R.default=T},"./src/demux/id3.ts":function(F,R,h){h.r(R),h.d(R,"isHeader",function(){return T}),h.d(R,"isFooter",function(){return A}),h.d(R,"getID3Data",function(){return k}),h.d(R,"canParse",function(){return D}),h.d(R,"getTimeStamp",function(){return o}),h.d(R,"isTimeStampFrame",function(){return b}),h.d(R,"getID3Frames",function(){return d}),h.d(R,"decodeFrame",function(){return p}),h.d(R,"utf8ArrayToStr",function(){return t}),h.d(R,"testables",function(){return n});var _,T=function(u,a){return a+10<=u.length&&u[a]===73&&u[a+1]===68&&u[a+2]===51&&u[a+3]<255&&u[a+4]<255&&u[a+6]<128&&u[a+7]<128&&u[a+8]<128&&u[a+9]<128},A=function(u,a){return a+10<=u.length&&u[a]===51&&u[a+1]===68&&u[a+2]===73&&u[a+3]<255&&u[a+4]<255&&u[a+6]<128&&u[a+7]<128&&u[a+8]<128&&u[a+9]<128},k=function(u,a){for(var c=a,E=0;T(u,a);)E+=10,E+=I(u,a+6),A(u,a+10)&&(E+=10),a+=E;if(E>0)return u.subarray(c,c+E)},I=function(u,a){var c=0;return c=(127&u[a])<<21,c|=(127&u[a+1])<<14,c|=(127&u[a+2])<<7,c|=127&u[a+3]},D=function(u,a){return T(u,a)&&I(u,a+6)+10<=u.length-a},o=function(u){for(var a=d(u),c=0;c<a.length;c++){var E=a[c];if(b(E))return i(E)}},b=function(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"},y=function(u){var a=String.fromCharCode(u[0],u[1],u[2],u[3]),c=I(u,4);return{type:a,size:c,data:u.subarray(10,10+c)}},d=function(u){for(var a=0,c=[];T(u,a);){for(var E=I(u,a+6),g=(a+=10)+E;a+8<g;){var v=y(u.subarray(a)),r=p(v);r&&c.push(r),a+=v.size+10}A(u,a)&&(a+=10)}return c},p=function(u){return u.type==="PRIV"?m(u):u.type[0]==="W"?e(u):l(u)},m=function(u){if(!(u.size<2)){var a=t(u.data,!0),c=new Uint8Array(u.data.subarray(a.length+1));return{key:u.type,info:a,data:c.buffer}}},l=function(u){if(!(u.size<2)){if(u.type==="TXXX"){var a=1,c=t(u.data.subarray(a),!0);a+=c.length+1;var E=t(u.data.subarray(a));return{key:u.type,info:c,data:E}}var g=t(u.data.subarray(1));return{key:u.type,data:g}}},e=function(u){if(u.type==="WXXX"){if(u.size<2)return;var a=1,c=t(u.data.subarray(a),!0);a+=c.length+1;var E=t(u.data.subarray(a));return{key:u.type,info:c,data:E}}var g=t(u.data);return{key:u.type,data:g}},i=function(u){if(u.data.byteLength===8){var a=new Uint8Array(u.data),c=1&a[3],E=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return E/=45,c&&(E+=4772185884e-2),Math.round(E)}},t=function(u,a){a===void 0&&(a=!1);var c=(_||self.TextDecoder===void 0||(_=new self.TextDecoder("utf-8")),_);if(c){var E=c.decode(u);if(a){var g=E.indexOf("\0");return g!==-1?E.substring(0,g):E}return E.replace(/\0/g,"")}for(var v,r,s,f=u.length,S="",L=0;L<f;){if((v=u[L++])===0&&a)return S;if(v!==0&&v!==3)switch(v>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(v);break;case 12:case 13:r=u[L++],S+=String.fromCharCode((31&v)<<6|63&r);break;case 14:r=u[L++],s=u[L++],S+=String.fromCharCode((15&v)<<12|(63&r)<<6|(63&s)<<0)}}return S},n={decodeTextFrame:l}},"./src/demux/mp3demuxer.ts":function(F,R,h){h.r(R);var _=h("./src/demux/base-audio-demuxer.ts"),T=h("./src/demux/id3.ts"),A=h("./src/utils/logger.ts"),k=h("./src/demux/mpegaudio.ts");function I(o,b){return(I=Object.setPrototypeOf||function(y,d){return y.__proto__=d,y})(o,b)}var D=function(o){var b,y;function d(){return o.apply(this,arguments)||this}y=o,(b=d).prototype=Object.create(y.prototype),b.prototype.constructor=b,I(b,y);var p=d.prototype;return p.resetInitSegment=function(m,l,e){o.prototype.resetInitSegment.call(this,m,l,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:m,duration:e,inputTimeScale:9e4,dropped:0}},d.probe=function(m){if(!m)return!1;for(var l=(T.getID3Data(m,0)||[]).length,e=m.length;l<e;l++)if(k.probe(m,l))return A.logger.log("MPEG Audio sync word found !"),!0;return!1},p.canParse=function(m,l){return k.canParse(m,l)},p.appendFrame=function(m,l,e){if(this.initPTS!==null)return k.appendFrame(m,l,e,this.initPTS,this.frameIndex)},d}(_.default);D.minProbeByteLength=4,R.default=D},"./src/demux/mp4demuxer.ts":function(F,R,h){h.r(R);var _=h("./src/utils/mp4-tools.ts"),T=h("./src/demux/dummy-demuxed-track.ts"),A=function(){function k(D,o){this.remainderData=null,this.config=void 0,this.config=o}var I=k.prototype;return I.resetTimeStamp=function(){},I.resetInitSegment=function(){},I.resetContiguity=function(){},k.probe=function(D){return Object(_.findBox)({data:D,start:0,end:Math.min(D.length,16384)},["moof"]).length>0},I.demux=function(D){var o=D,b=Object(T.dummyTrack)();if(this.config.progressive){this.remainderData&&(o=Object(_.appendUint8Array)(this.remainderData,D));var y=Object(_.segmentValidRange)(o);this.remainderData=y.remainder,b.samples=y.valid||new Uint8Array}else b.samples=o;return{audioTrack:Object(T.dummyTrack)(),avcTrack:b,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},I.flush=function(){var D=Object(T.dummyTrack)();return D.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(T.dummyTrack)(),avcTrack:D,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},I.demuxSampleAes=function(D,o,b){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},I.destroy=function(){},k}();A.minProbeByteLength=1024,R.default=A},"./src/demux/mpegaudio.ts":function(F,R,h){h.r(R),h.d(R,"appendFrame",function(){return D}),h.d(R,"parseHeader",function(){return o}),h.d(R,"isHeaderPattern",function(){return b}),h.d(R,"isHeader",function(){return y}),h.d(R,"canParse",function(){return d}),h.d(R,"probe",function(){return p});var _=null,T=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],A=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],k=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],I=[0,1,1,4];function D(m,l,e,i,t){if(!(e+24>l.length)){var n=o(l,e);if(n&&e+n.frameLength<=l.length){var u=i+t*(9e4*n.samplesPerFrame/n.sampleRate),a={unit:l.subarray(e,e+n.frameLength),pts:u,dts:u};return m.config=[],m.channelCount=n.channelCount,m.samplerate=n.sampleRate,m.samples.push(a),{sample:a,length:n.frameLength,missing:0}}}}function o(m,l){var e=m[l+1]>>3&3,i=m[l+1]>>1&3,t=m[l+2]>>4&15,n=m[l+2]>>2&3;if(e!==1&&t!==0&&t!==15&&n!==3){var u=m[l+2]>>1&1,a=m[l+3]>>6,c=1e3*T[14*(e===3?3-i:i===3?3:4)+t-1],E=A[3*(e===3?0:e===2?1:2)+n],g=a===3?1:2,v=k[e][i],r=I[i],s=8*v*r,f=Math.floor(v*c/E+u)*r;if(_===null){var S=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);_=S?parseInt(S[1]):0}return!!_&&_<=87&&i===2&&c>=224e3&&a===0&&(m[l+3]=128|m[l+3]),{sampleRate:E,channelCount:g,frameLength:f,samplesPerFrame:s}}}function b(m,l){return m[l]===255&&(224&m[l+1])==224&&(6&m[l+1])!=0}function y(m,l){return l+1<m.length&&b(m,l)}function d(m,l){return b(m,l)&&4<=m.length-l}function p(m,l){if(l+1<m.length&&b(m,l)){var e=o(m,l),i=4;e!=null&&e.frameLength&&(i=e.frameLength);var t=l+i;return t===m.length||y(m,t)}return!1}},"./src/demux/sample-aes.ts":function(F,R,h){h.r(R);var _=h("./src/crypt/decrypter.ts"),T=h("./src/demux/tsdemuxer.ts"),A=function(){function k(D,o,b){this.keyData=void 0,this.decrypter=void 0,this.keyData=b,this.decrypter=new _.default(D,o,{removePKCS7Padding:!1})}var I=k.prototype;return I.decryptBuffer=function(D,o){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,o)},I.decryptAacSample=function(D,o,b,y){var d=D[o].unit,p=d.subarray(16,d.length-d.length%16),m=p.buffer.slice(p.byteOffset,p.byteOffset+p.length),l=this;this.decryptBuffer(m,function(e){var i=new Uint8Array(e);d.set(i,16),y||l.decryptAacSamples(D,o+1,b)})},I.decryptAacSamples=function(D,o,b){for(;;o++){if(o>=D.length)return void b();if(!(D[o].unit.length<32)){var y=this.decrypter.isSync();if(this.decryptAacSample(D,o,b,y),!y)return}}},I.getAvcEncryptedData=function(D){for(var o=16*Math.floor((D.length-48)/160)+16,b=new Int8Array(o),y=0,d=32;d<=D.length-16;d+=160,y+=16)b.set(D.subarray(d,d+16),y);return b},I.getAvcDecryptedUnit=function(D,o){for(var b=new Uint8Array(o),y=0,d=32;d<=D.length-16;d+=160,y+=16)D.set(b.subarray(y,y+16),d);return D},I.decryptAvcSample=function(D,o,b,y,d,p){var m=Object(T.discardEPB)(d.data),l=this.getAvcEncryptedData(m),e=this;this.decryptBuffer(l.buffer,function(i){d.data=e.getAvcDecryptedUnit(m,i),p||e.decryptAvcSamples(D,o,b+1,y)})},I.decryptAvcSamples=function(D,o,b,y){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,b=0){if(o>=D.length)return void y();for(var d=D[o].units;!(b>=d.length);b++){var p=d[b];if(!(p.data.length<=48||p.type!==1&&p.type!==5)){var m=this.decrypter.isSync();if(this.decryptAvcSample(D,o,b,y,p,m),!m)return}}}},k}();R.default=A},"./src/demux/transmuxer-interface.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return y});var _=h("./node_modules/webworkify-webpack/index.js"),T=h("./src/events.ts"),A=h("./src/demux/transmuxer.ts"),k=h("./src/utils/logger.ts"),I=h("./src/errors.ts"),D=h("./src/utils/mediasource-helper.ts"),o=h("./node_modules/eventemitter3/index.js"),b=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},y=function(){function d(m,l,e,i){var t=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=m,this.id=l,this.onTransmuxComplete=e,this.onFlush=i;var n=m.config,u=function(g,v){(v=v||{}).frag=t.frag,v.id=t.id,m.trigger(g,v)};this.observer=new o.EventEmitter,this.observer.on(T.Events.FRAG_DECRYPTED,u),this.observer.on(T.Events.ERROR,u);var a={mp4:b.isTypeSupported("video/mp4"),mpeg:b.isTypeSupported("audio/mpeg"),mp3:b.isTypeSupported('audio/mp4; codecs="mp3"')},c=navigator.vendor;if(n.enableWorker&&typeof Worker!="undefined"){var E;k.logger.log("demuxing in webworker");try{E=this.worker=_("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),E.addEventListener("message",this.onwmsg),E.onerror=function(g){m.trigger(T.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(g.message+"  ("+g.filename+":"+g.lineno+")")})},E.postMessage({cmd:"init",typeSupported:a,vendor:c,id:l,config:JSON.stringify(n)})}catch(g){k.logger.warn("Error in worker:",g),k.logger.error("Error while initializing DemuxerWorker, fallback to inline"),E&&self.URL.revokeObjectURL(E.objectURL),this.transmuxer=new A.default(this.observer,a,n,c,l),this.worker=null}}else this.transmuxer=new A.default(this.observer,a,n,c,l)}var p=d.prototype;return p.destroy=function(){var m=this.worker;if(m)m.removeEventListener("message",this.onwmsg),m.terminate(),this.worker=null;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},p.push=function(m,l,e,i,t,n,u,a,c,E){var g=this;c.transmuxing.start=self.performance.now();var v=this.transmuxer,r=this.worker,s=n?n.start:t.start,f=t.decryptdata,S=this.frag,L=!(S&&t.cc===S.cc),C=!(S&&c.level===S.level),O=S?c.sn-S.sn:-1,w=this.part?c.part-this.part.index:1,P=!C&&(O===1||O===0&&w===1),x=self.performance.now();(C||O||t.stats.parsing.start===0)&&(t.stats.parsing.start=x),!n||!w&&P||(n.stats.parsing.start=x);var M=new A.TransmuxState(L,P,a,C,s);if(!P||L){k.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+`
        discontinuity: `+L+`
        trackSwitch: `+C+`
        contiguous: `+P+`
        accurateTimeOffset: `+a+`
        timeOffset: `+s);var N=new A.TransmuxConfig(e,i,l,u,E);this.configureTransmuxer(N)}if(this.frag=t,this.part=n,r)r.postMessage({cmd:"demux",data:m,decryptdata:f,chunkMeta:c,state:M},m instanceof ArrayBuffer?[m]:[]);else if(v){var U=v.push(m,f,c,M);Object(A.isPromise)(U)?U.then(function(G){g.handleTransmuxComplete(G)}):this.handleTransmuxComplete(U)}},p.flush=function(m){var l=this;m.transmuxing.start=self.performance.now();var e=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:m});else if(e){var t=e.flush(m);Object(A.isPromise)(t)?t.then(function(n){l.handleFlushResult(n,m)}):this.handleFlushResult(t,m)}},p.handleFlushResult=function(m,l){var e=this;m.forEach(function(i){e.handleTransmuxComplete(i)}),this.onFlush(l)},p.onWorkerMessage=function(m){var l=m.data,e=this.hls;switch(l.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(l.data);break;case"flush":this.onFlush(l.data);break;default:l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,e.trigger(l.event,l.data)}},p.configureTransmuxer=function(m){var l=this.worker,e=this.transmuxer;l?l.postMessage({cmd:"configure",config:m}):e&&e.configure(m)},p.handleTransmuxComplete=function(m){m.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(m)},d}()},"./src/demux/transmuxer-worker.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return I});var _=h("./src/demux/transmuxer.ts"),T=h("./src/events.ts"),A=h("./src/utils/logger.ts"),k=h("./node_modules/eventemitter3/index.js");function I(y){var d=new k.EventEmitter,p=function(m,l){y.postMessage({event:m,data:l})};d.on(T.Events.FRAG_DECRYPTED,p),d.on(T.Events.ERROR,p),y.addEventListener("message",function(m){var l=m.data;switch(l.cmd){case"init":var e=JSON.parse(l.config);y.transmuxer=new _.default(d,l.typeSupported,e,l.vendor,l.id),Object(A.enableLogs)(e.debug),p("init",null);break;case"configure":y.transmuxer.configure(l.config);break;case"demux":var i=y.transmuxer.push(l.data,l.decryptdata,l.chunkMeta,l.state);Object(_.isPromise)(i)?i.then(function(u){D(y,u)}):D(y,i);break;case"flush":var t=l.chunkMeta,n=y.transmuxer.flush(t);Object(_.isPromise)(n)?n.then(function(u){b(y,u,t)}):b(y,n,t)}})}function D(y,d){if((p=d.remuxResult).audio||p.video||p.text||p.id3||p.initSegment){var p,m=[],l=d.remuxResult,e=l.audio,i=l.video;e&&o(m,e),i&&o(m,i),y.postMessage({event:"transmuxComplete",data:d},m)}}function o(y,d){d.data1&&y.push(d.data1.buffer),d.data2&&y.push(d.data2.buffer)}function b(y,d,p){d.forEach(function(m){D(y,m)}),y.postMessage({event:"flush",data:p})}},"./src/demux/transmuxer.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return t}),h.d(R,"isPromise",function(){return u}),h.d(R,"TransmuxConfig",function(){return a}),h.d(R,"TransmuxState",function(){return c});var _,T=h("./src/events.ts"),A=h("./src/errors.ts"),k=h("./src/crypt/decrypter.ts"),I=h("./src/demux/aacdemuxer.ts"),D=h("./src/demux/mp4demuxer.ts"),o=h("./src/demux/tsdemuxer.ts"),b=h("./src/demux/mp3demuxer.ts"),y=h("./src/remux/mp4-remuxer.ts"),d=h("./src/remux/passthrough-remuxer.ts"),p=h("./src/demux/chunk-cache.ts"),m=h("./src/utils/mp4-tools.ts"),l=h("./src/utils/logger.ts");try{_=self.performance.now.bind(self.performance)}catch{l.logger.debug("Unable to use Performance API on this environment"),_=self.Date.now}var e=[{demux:o.default,remux:y.default},{demux:D.default,remux:d.default},{demux:I.default,remux:y.default},{demux:b.default,remux:y.default}],i=1024;e.forEach(function(E){var g=E.demux;i=Math.max(i,g.minProbeByteLength)});var t=function(){function E(v,r,s,f,S){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new p.default,this.observer=v,this.typeSupported=r,this.config=s,this.vendor=f,this.id=S}var g=E.prototype;return g.configure=function(v){this.transmuxConfig=v,this.decrypter&&this.decrypter.reset()},g.push=function(v,r,s,f){var S=this,L=s.transmuxing;L.executeStart=_();var C=new Uint8Array(v),O=this.cache,w=this.config,P=this.currentTransmuxState,x=this.transmuxConfig;f&&(this.currentTransmuxState=f);var M=function(he,ce){var Ae=null;return he.byteLength>0&&ce!=null&&ce.key!=null&&ce.iv!==null&&ce.method!=null&&(Ae=ce),Ae}(C,r);if(M&&M.method==="AES-128"){var N=this.getDecrypter();if(!w.enableSoftwareAES)return this.decryptionPromise=N.webCryptoDecrypt(C,M.key.buffer,M.iv.buffer).then(function(he){var ce=S.push(he,null,s);return S.decryptionPromise=null,ce}),this.decryptionPromise;var U=N.softwareDecrypt(C,M.key.buffer,M.iv.buffer);if(!U)return L.executeEnd=_(),n(s);C=new Uint8Array(U)}var G=f||P,V=G.contiguous,W=G.discontinuity,Y=G.trackSwitch,X=G.accurateTimeOffset,z=G.timeOffset,Z=x.audioCodec,ne=x.videoCodec,se=x.defaultInitPts,de=x.duration,re=x.initSegmentData;if((W||Y)&&this.resetInitSegment(re,Z,ne,de),W&&this.resetInitialTimestamp(se),V||this.resetContiguity(),this.needsProbing(C,W,Y)){if(O.dataLength){var ge=O.flush();C=Object(m.appendUint8Array)(ge,C)}this.configureTransmuxer(C,x)}var te=this.transmux(C,M,z,X,s),ae=this.currentTransmuxState;return ae.contiguous=!0,ae.discontinuity=!1,ae.trackSwitch=!1,L.executeEnd=_(),te},g.flush=function(v){var r=this,s=v.transmuxing;s.executeStart=_();var f=this.decrypter,S=this.cache,L=this.currentTransmuxState,C=this.decryptionPromise;if(C)return C.then(function(){return r.flush(v)});var O=[],w=L.timeOffset;if(f){var P=f.flush();P&&O.push(this.push(P,null,v))}var x=S.dataLength;S.reset();var M=this.demuxer,N=this.remuxer;if(!M||!N)return x>=i&&this.observer.emit(T.Events.ERROR,T.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),s.executeEnd=_(),[n(v)];var U=M.flush(w);return u(U)?U.then(function(G){return r.flushRemux(O,G,v),O}):(this.flushRemux(O,U,v),O)},g.flushRemux=function(v,r,s){var f=r.audioTrack,S=r.avcTrack,L=r.id3Track,C=r.textTrack,O=this.currentTransmuxState,w=O.accurateTimeOffset,P=O.timeOffset;l.logger.log("[transmuxer.ts]: Flushed fragment "+s.sn+(s.part>-1?" p: "+s.part:"")+" of level "+s.level);var x=this.remuxer.remux(f,S,L,C,P,w,!0,this.id);v.push({remuxResult:x,chunkMeta:s}),s.transmuxing.executeEnd=_()},g.resetInitialTimestamp=function(v){var r=this.demuxer,s=this.remuxer;r&&s&&(r.resetTimeStamp(v),s.resetTimeStamp(v))},g.resetContiguity=function(){var v=this.demuxer,r=this.remuxer;v&&r&&(v.resetContiguity(),r.resetNextTimestamp())},g.resetInitSegment=function(v,r,s,f){var S=this.demuxer,L=this.remuxer;S&&L&&(S.resetInitSegment(r,s,f),L.resetInitSegment(v,r,s))},g.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},g.transmux=function(v,r,s,f,S){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(v,r,s,f,S):this.transmuxUnencrypted(v,s,f,S)},g.transmuxUnencrypted=function(v,r,s,f){var S=this.demuxer.demux(v,r,!1,!this.config.progressive),L=S.audioTrack,C=S.avcTrack,O=S.id3Track,w=S.textTrack;return{remuxResult:this.remuxer.remux(L,C,O,w,r,s,!1,this.id),chunkMeta:f}},g.transmuxSampleAes=function(v,r,s,f,S){var L=this;return this.demuxer.demuxSampleAes(v,r,s).then(function(C){return{remuxResult:L.remuxer.remux(C.audioTrack,C.avcTrack,C.id3Track,C.textTrack,s,f,!1,L.id),chunkMeta:S}})},g.configureTransmuxer=function(v,r){for(var s,f=this.config,S=this.observer,L=this.typeSupported,C=this.vendor,O=r.audioCodec,w=r.defaultInitPts,P=r.duration,x=r.initSegmentData,M=r.videoCodec,N=0,U=e.length;N<U;N++)if(e[N].demux.probe(v)){s=e[N];break}s||(l.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),s={demux:D.default,remux:d.default});var G=this.demuxer,V=this.remuxer,W=s.remux,Y=s.demux;V&&V instanceof W||(this.remuxer=new W(S,f,L,C)),G&&G instanceof Y||(this.demuxer=new Y(S,f,L),this.probe=Y.probe),this.resetInitSegment(x,O,M,P),this.resetInitialTimestamp(w)},g.needsProbing=function(v,r,s){return!this.demuxer||!this.remuxer||r||s},g.getDecrypter=function(){var v=this.decrypter;return v||(v=this.decrypter=new k.default(this.observer,this.config)),v},E}(),n=function(E){return{remuxResult:{},chunkMeta:E}};function u(E){return"then"in E&&E.then instanceof Function}var a=function(E,g,v,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=E,this.videoCodec=g,this.initSegmentData=v,this.duration=r,this.defaultInitPts=s},c=function(E,g,v,r,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=E,this.contiguous=g,this.accurateTimeOffset=v,this.trackSwitch=r,this.timeOffset=s}},"./src/demux/tsdemuxer.ts":function(F,R,h){h.r(R),h.d(R,"discardEPB",function(){return u});var _=h("./src/demux/adts.ts"),T=h("./src/demux/mpegaudio.ts"),A=h("./src/demux/exp-golomb.ts"),k=h("./src/demux/id3.ts"),I=h("./src/demux/sample-aes.ts"),D=h("./src/events.ts"),o=h("./src/utils/mp4-tools.ts"),b=h("./src/utils/logger.ts"),y=h("./src/errors.ts"),d={video:1,audio:2,id3:3,text:4},p=function(){function a(E,g,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=E,this.config=g,this.typeSupported=v}a.probe=function(E){var g=a.syncOffset(E);return!(g<0||(g&&b.logger.warn("MPEG2-TS detected but first sync word found @ offset "+g+", junk ahead ?"),0))},a.syncOffset=function(E){for(var g=Math.min(1e3,E.length-564),v=0;v<g;){if(E[v]===71&&E[v+188]===71&&E[v+376]===71)return v;v++}return-1},a.createTrack=function(E,g){return{container:E==="video"||E==="audio"?"video/mp2t":void 0,type:E,id:d[E],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:E==="audio"?g:void 0}};var c=a.prototype;return c.resetInitSegment=function(E,g,v){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",v),this._audioTrack=a.createTrack("audio",v),this._id3Track=a.createTrack("id3",v),this._txtTrack=a.createTrack("text",v),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=E,this.videoCodec=g,this._duration=v},c.resetTimeStamp=function(){},c.resetContiguity=function(){var E=this._audioTrack,g=this._avcTrack,v=this._id3Track;E&&(E.pesData=null),g&&(g.pesData=null),v&&(v.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},c.demux=function(E,g,v,r){var s;v===void 0&&(v=!1),r===void 0&&(r=!1),v||(this.sampleAes=null);var f=this._avcTrack,S=this._audioTrack,L=this._id3Track,C=f.pid,O=f.pesData,w=S.pid,P=L.pid,x=S.pesData,M=L.pesData,N=!1,U=this.pmtParsed,G=this._pmtId,V=E.length;if(this.remainderData&&(V=(E=Object(o.appendUint8Array)(this.remainderData,E)).length,this.remainderData=null),V<188&&!r)return this.remainderData=E,{audioTrack:S,avcTrack:f,id3Track:L,textTrack:this._txtTrack};var W=Math.max(0,a.syncOffset(E));(V-=(V+W)%188)<E.byteLength&&!r&&(this.remainderData=new Uint8Array(E.buffer,V,E.buffer.byteLength-V));for(var Y=W;Y<V;Y+=188)if(E[Y]===71){var X=!!(64&E[Y+1]),z=((31&E[Y+1])<<8)+E[Y+2],Z=void 0;if((48&E[Y+3])>>4>1){if((Z=Y+5+E[Y+4])===Y+188)continue}else Z=Y+4;switch(z){case C:X&&(O&&(s=i(O))&&this.parseAVCPES(s,!1),O={data:[],size:0}),O&&(O.data.push(E.subarray(Z,Y+188)),O.size+=Y+188-Z);break;case w:X&&(x&&(s=i(x))&&(S.isAAC?this.parseAACPES(s):this.parseMPEGPES(s)),x={data:[],size:0}),x&&(x.data.push(E.subarray(Z,Y+188)),x.size+=Y+188-Z);break;case P:X&&(M&&(s=i(M))&&this.parseID3PES(s),M={data:[],size:0}),M&&(M.data.push(E.subarray(Z,Y+188)),M.size+=Y+188-Z);break;case 0:X&&(Z+=E[Z]+1),G=this._pmtId=l(E,Z);break;case G:X&&(Z+=E[Z]+1);var ne=e(E,Z,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,v);(C=ne.avc)>0&&(f.pid=C),(w=ne.audio)>0&&(S.pid=w,S.isAAC=ne.isAAC),(P=ne.id3)>0&&(L.pid=P),N&&!U&&(b.logger.log("reparse from beginning"),N=!1,Y=W-188),U=this.pmtParsed=!0;break;case 17:case 8191:break;default:N=!0}}else this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});f.pesData=O,S.pesData=x,L.pesData=M;var se={audioTrack:S,avcTrack:f,id3Track:L,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(se),se},c.flush=function(){var E,g=this.remainderData;return this.remainderData=null,E=g?this.demux(g,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(E),this.sampleAes?this.decrypt(E,this.sampleAes):E},c.extractRemainingSamples=function(E){var g,v=E.audioTrack,r=E.avcTrack,s=E.id3Track,f=r.pesData,S=v.pesData,L=s.pesData;f&&(g=i(f))?(this.parseAVCPES(g,!0),r.pesData=null):r.pesData=f,S&&(g=i(S))?(v.isAAC?this.parseAACPES(g):this.parseMPEGPES(g),v.pesData=null):(S!=null&&S.size&&b.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=S),L&&(g=i(L))?(this.parseID3PES(g),s.pesData=null):s.pesData=L},c.demuxSampleAes=function(E,g,v){var r=this.demux(E,v,!0,!this.config.progressive),s=this.sampleAes=new I.default(this.observer,this.config,g);return this.decrypt(r,s)},c.decrypt=function(E,g){return new Promise(function(v){var r=E.audioTrack,s=E.avcTrack;r.samples&&r.isAAC?g.decryptAacSamples(r.samples,0,function(){s.samples?g.decryptAvcSamples(s.samples,0,0,function(){v(E)}):v(E)}):s.samples&&g.decryptAvcSamples(s.samples,0,0,function(){v(E)})})},c.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},c.parseAVCPES=function(E,g){var v,r=this,s=this._avcTrack,f=this.parseAVCNALu(E.data),S=this.avcSample,L=!1;E.data=null,S&&f.length&&!s.audFound&&(t(S,s),S=this.avcSample=m(!1,E.pts,E.dts,"")),f.forEach(function(C){switch(C.type){case 1:v=!0,S||(S=r.avcSample=m(!0,E.pts,E.dts,"")),S.frame=!0;var O=C.data;if(L&&O.length>4){var w=new A.default(O).readSliceType();w!==2&&w!==4&&w!==7&&w!==9||(S.key=!0)}break;case 5:v=!0,S||(S=r.avcSample=m(!0,E.pts,E.dts,"")),S.key=!0,S.frame=!0;break;case 6:v=!0;var P=new A.default(u(C.data));P.readUByte();for(var x=0,M=0,N=!1,U=0;!N&&P.bytesAvailable>1;){x=0;do x+=U=P.readUByte();while(U===255);M=0;do M+=U=P.readUByte();while(U===255);if(x===4&&P.bytesAvailable!==0){if(N=!0,P.readUByte()===181&&P.readUShort()===49&&P.readUInt()===1195456820&&P.readUByte()===3){for(var G=P.readUByte(),V=31&G,W=[G,P.readUByte()],Y=0;Y<V;Y++)W.push(P.readUByte()),W.push(P.readUByte()),W.push(P.readUByte());n(r._txtTrack.samples,{type:3,pts:E.pts,bytes:W})}}else if(x===5&&P.bytesAvailable!==0){if(N=!0,M>16){for(var X=[],z=0;z<16;z++)X.push(P.readUByte().toString(16)),z!==3&&z!==5&&z!==7&&z!==9||X.push("-");for(var Z=M-16,ne=new Uint8Array(Z),se=0;se<Z;se++)ne[se]=P.readUByte();n(r._txtTrack.samples,{pts:E.pts,payloadType:x,uuid:X.join(""),userData:Object(k.utf8ArrayToStr)(ne),userDataBytes:ne})}}else if(M<P.bytesAvailable)for(var de=0;de<M;de++)P.readUByte()}break;case 7:if(v=!0,L=!0,!s.sps){var re=new A.default(C.data).readSPS();s.width=re.width,s.height=re.height,s.pixelRatio=re.pixelRatio,s.sps=[C.data],s.duration=r._duration;for(var ge=C.data.subarray(1,4),te="avc1.",ae=0;ae<3;ae++){var he=ge[ae].toString(16);he.length<2&&(he="0"+he),te+=he}s.codec=te}break;case 8:v=!0,s.pps||(s.pps=[C.data]);break;case 9:v=!1,s.audFound=!0,S&&t(S,s),S=r.avcSample=m(!1,E.pts,E.dts,"");break;case 12:v=!1;break;default:v=!1,S&&(S.debug+="unknown NAL "+C.type+" ")}S&&v&&S.units.push(C)}),g&&S&&(t(S,s),this.avcSample=null)},c.getLastNalUnit=function(){var E,g,v=this.avcSample;if(!v||v.units.length===0){var r=this._avcTrack.samples;v=r[r.length-1]}if((E=v)!==null&&E!==void 0&&E.units){var s=v.units;g=s[s.length-1]}return g},c.parseAVCNALu=function(E){var g,v,r=E.byteLength,s=this._avcTrack,f=s.naluState||0,S=f,L=[],C=0,O=-1,w=0;for(f===-1&&(O=0,w=31&E[0],f=0,C=1);C<r;)if(g=E[C++],f)if(f!==1)if(g)if(g===1){if(O>=0){var P={data:E.subarray(O,C-f-1),type:w};L.push(P)}else{var x=this.getLastNalUnit();if(x&&(S&&C<=4-S&&x.state&&(x.data=x.data.subarray(0,x.data.byteLength-S)),(v=C-f-1)>0)){var M=new Uint8Array(x.data.byteLength+v);M.set(x.data,0),M.set(E.subarray(0,v),x.data.byteLength),x.data=M}}C<r?(O=C,w=31&E[C],f=0):f=-1}else f=0;else f=3;else f=g?0:2;else f=g?0:1;if(O>=0&&f>=0){var N={data:E.subarray(O,r),type:w,state:f};L.push(N)}if(L.length===0){var U=this.getLastNalUnit();if(U){var G=new Uint8Array(U.data.byteLength+E.byteLength);G.set(U.data,0),G.set(E,U.data.byteLength),U.data=G}}return s.naluState=f,L},c.parseAACPES=function(E){var g,v,r,s,f,S=0,L=this._audioTrack,C=this.aacOverFlow,O=E.data;if(C){this.aacOverFlow=null;var w=C.sample.unit.byteLength,P=Math.min(C.missing,w),x=w-P;C.sample.unit.set(O.subarray(0,P),x),L.samples.push(C.sample),S=C.missing}for(g=S,v=O.length;g<v-1&&!_.isHeader(O,g);g++);if(g===S||(g<v-1?(r="AAC PES did not start with ADTS header,offset:"+g,s=!1):(r="no ADTS header found in AAC PES",s=!0),b.logger.warn("parsing error:"+r),this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:r}),!s)){if(_.initTrackConfig(L,this.observer,O,g,this.audioCodec),E.pts!==void 0)f=E.pts;else{if(!C)return void b.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var M=_.getFrameDuration(L.samplerate);f=C.sample.pts+M}for(var N=0;g<v;){if(_.isHeader(O,g)){if(g+5<v){var U=_.appendFrame(L,O,g,f,N);if(U){if(!U.missing){g+=U.length,N++;continue}this.aacOverFlow=U}}break}g++}}},c.parseMPEGPES=function(E){var g=E.data,v=g.length,r=0,s=0,f=E.pts;if(f!==void 0)for(;s<v;)if(T.isHeader(g,s)){var S=T.appendFrame(this._audioTrack,g,s,f,r);if(!S)break;s+=S.length,r++}else s++;else b.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},c.parseID3PES=function(E){E.pts!==void 0?this._id3Track.samples.push(E):b.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},a}();function m(a,c,E,g){return{key:a,frame:!1,pts:c,dts:E,units:[],debug:g,length:0}}function l(a,c){return(31&a[c+10])<<8|a[c+11]}function e(a,c,E,g){var v={audio:-1,avc:-1,id3:-1,isAAC:!0},r=c+3+((15&a[c+1])<<8|a[c+2])-4;for(c+=12+((15&a[c+10])<<8|a[c+11]);c<r;){var s=(31&a[c+1])<<8|a[c+2];switch(a[c]){case 207:if(!g){b.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:v.audio===-1&&(v.audio=s);break;case 21:v.id3===-1&&(v.id3=s);break;case 219:if(!g){b.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:v.avc===-1&&(v.avc=s);break;case 3:case 4:E?v.audio===-1&&(v.audio=s,v.isAAC=!1):b.logger.log("MPEG audio found, not supported in this browser");break;case 36:b.logger.warn("Unsupported HEVC stream type found")}c+=5+((15&a[c+3])<<8|a[c+4])}return v}function i(a){var c,E,g,v,r,s=0,f=a.data;if(!a||a.size===0)return null;for(;f[0].length<19&&f.length>1;){var S=new Uint8Array(f[0].length+f[1].length);S.set(f[0]),S.set(f[1],f[0].length),f[0]=S,f.splice(1,1)}if(((c=f[0])[0]<<16)+(c[1]<<8)+c[2]===1){if((E=(c[4]<<8)+c[5])&&E>a.size-6)return null;var L=c[7];192&L&&(v=536870912*(14&c[9])+4194304*(255&c[10])+16384*(254&c[11])+128*(255&c[12])+(254&c[13])/2,64&L?v-(r=536870912*(14&c[14])+4194304*(255&c[15])+16384*(254&c[16])+128*(255&c[17])+(254&c[18])/2)>54e5&&(b.logger.warn(Math.round((v-r)/9e4)+"s delta between PTS and DTS, align them"),v=r):r=v);var C=(g=c[8])+9;if(a.size<=C)return null;a.size-=C;for(var O=new Uint8Array(a.size),w=0,P=f.length;w<P;w++){var x=(c=f[w]).byteLength;if(C){if(C>x){C-=x;continue}c=c.subarray(C),x-=C,C=0}O.set(c,s),s+=x}return E&&(E-=g+3),{data:O,pts:v,dts:r,len:E}}return null}function t(a,c){if(a.units.length&&a.frame){if(a.pts===void 0){var E=c.samples,g=E.length;if(!g)return void c.dropped++;var v=E[g-1];a.pts=v.pts,a.dts=v.dts}c.samples.push(a)}a.debug.length&&b.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function n(a,c){var E=a.length;if(E>0){if(c.pts>=a[E-1].pts)a.push(c);else for(var g=E-1;g>=0;g--)if(c.pts<a[g].pts){a.splice(g,0,c);break}}else a.push(c)}function u(a){for(var c=a.byteLength,E=[],g=1;g<c-2;)a[g]===0&&a[g+1]===0&&a[g+2]===3?(E.push(g+2),g+=2):g++;if(E.length===0)return a;var v=c-E.length,r=new Uint8Array(v),s=0;for(g=0;g<v;s++,g++)s===E[0]&&(s++,E.shift()),r[g]=a[s];return r}p.minProbeByteLength=188,R.default=p},"./src/errors.ts":function(F,R,h){var _,T,A,k;h.r(R),h.d(R,"ErrorTypes",function(){return _}),h.d(R,"ErrorDetails",function(){return A}),(T=_||(_={})).NETWORK_ERROR="networkError",T.MEDIA_ERROR="mediaError",T.KEY_SYSTEM_ERROR="keySystemError",T.MUX_ERROR="muxError",T.OTHER_ERROR="otherError",(k=A||(A={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",k.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",k.KEY_SYSTEM_NO_SESSION="keySystemNoSession",k.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",k.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",k.MANIFEST_LOAD_ERROR="manifestLoadError",k.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",k.MANIFEST_PARSING_ERROR="manifestParsingError",k.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",k.LEVEL_EMPTY_ERROR="levelEmptyError",k.LEVEL_LOAD_ERROR="levelLoadError",k.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",k.LEVEL_SWITCH_ERROR="levelSwitchError",k.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",k.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",k.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",k.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",k.FRAG_LOAD_ERROR="fragLoadError",k.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",k.FRAG_DECRYPT_ERROR="fragDecryptError",k.FRAG_PARSING_ERROR="fragParsingError",k.REMUX_ALLOC_ERROR="remuxAllocError",k.KEY_LOAD_ERROR="keyLoadError",k.KEY_LOAD_TIMEOUT="keyLoadTimeOut",k.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",k.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",k.BUFFER_APPEND_ERROR="bufferAppendError",k.BUFFER_APPENDING_ERROR="bufferAppendingError",k.BUFFER_STALLED_ERROR="bufferStalledError",k.BUFFER_FULL_ERROR="bufferFullError",k.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",k.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",k.INTERNAL_EXCEPTION="internalException",k.INTERNAL_ABORTED="aborted",k.UNKNOWN="unknown"},"./src/events.ts":function(F,R,h){var _,T;h.r(R),h.d(R,"Events",function(){return _}),(T=_||(_={})).MEDIA_ATTACHING="hlsMediaAttaching",T.MEDIA_ATTACHED="hlsMediaAttached",T.MEDIA_DETACHING="hlsMediaDetaching",T.MEDIA_DETACHED="hlsMediaDetached",T.BUFFER_RESET="hlsBufferReset",T.BUFFER_CODECS="hlsBufferCodecs",T.BUFFER_CREATED="hlsBufferCreated",T.BUFFER_APPENDING="hlsBufferAppending",T.BUFFER_APPENDED="hlsBufferAppended",T.BUFFER_EOS="hlsBufferEos",T.BUFFER_FLUSHING="hlsBufferFlushing",T.BUFFER_FLUSHED="hlsBufferFlushed",T.MANIFEST_LOADING="hlsManifestLoading",T.MANIFEST_LOADED="hlsManifestLoaded",T.MANIFEST_PARSED="hlsManifestParsed",T.LEVEL_SWITCHING="hlsLevelSwitching",T.LEVEL_SWITCHED="hlsLevelSwitched",T.LEVEL_LOADING="hlsLevelLoading",T.LEVEL_LOADED="hlsLevelLoaded",T.LEVEL_UPDATED="hlsLevelUpdated",T.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",T.LEVELS_UPDATED="hlsLevelsUpdated",T.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",T.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",T.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",T.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",T.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",T.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",T.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",T.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",T.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",T.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",T.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",T.CUES_PARSED="hlsCuesParsed",T.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",T.INIT_PTS_FOUND="hlsInitPtsFound",T.FRAG_LOADING="hlsFragLoading",T.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",T.FRAG_LOADED="hlsFragLoaded",T.FRAG_DECRYPTED="hlsFragDecrypted",T.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",T.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",T.FRAG_PARSING_METADATA="hlsFragParsingMetadata",T.FRAG_PARSED="hlsFragParsed",T.FRAG_BUFFERED="hlsFragBuffered",T.FRAG_CHANGED="hlsFragChanged",T.FPS_DROP="hlsFpsDrop",T.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",T.ERROR="hlsError",T.DESTROYING="hlsDestroying",T.KEY_LOADING="hlsKeyLoading",T.KEY_LOADED="hlsKeyLoaded",T.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",T.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return t});var _=h("./node_modules/url-toolkit/src/url-toolkit.js"),T=h("./src/loader/playlist-loader.ts"),A=h("./src/loader/key-loader.ts"),k=h("./src/controller/id3-track-controller.ts"),I=h("./src/controller/latency-controller.ts"),D=h("./src/controller/level-controller.ts"),o=h("./src/controller/fragment-tracker.ts"),b=h("./src/controller/stream-controller.ts"),y=h("./src/is-supported.ts"),d=h("./src/utils/logger.ts"),p=h("./src/config.ts"),m=h("./node_modules/eventemitter3/index.js"),l=h("./src/events.ts"),e=h("./src/errors.ts");function i(n,u){for(var a=0;a<u.length;a++){var c=u[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}var t=function(){function n(g){g===void 0&&(g={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var v=this.config=Object(p.mergeConfig)(n.DefaultConfig,g);this.userConfig=g,Object(d.enableLogs)(v.debug),this._autoLevelCapping=-1,v.progressive&&Object(p.enableStreamingMode)(v);var r=v.abrController,s=v.bufferController,f=v.capLevelController,S=v.fpsController,L=this.abrController=new r(this),C=this.bufferController=new s(this),O=this.capLevelController=new f(this),w=new S(this),P=new T.default(this),x=new A.default(this),M=new k.default(this),N=this.levelController=new D.default(this),U=new o.FragmentTracker(this),G=this.streamController=new b.default(this,U);O.setStreamController(G),w.setStreamController(G);var V=[N,G];this.networkControllers=V;var W=[P,x,L,C,O,w,M,U];this.audioTrackController=this.createController(v.audioTrackController,null,V),this.createController(v.audioStreamController,U,V),this.subtitleTrackController=this.createController(v.subtitleTrackController,null,V),this.createController(v.subtitleStreamController,U,V),this.createController(v.timelineController,null,W),this.emeController=this.createController(v.emeController,null,W),this.latencyController=this.createController(I.default,null,W),this.coreComponents=W}n.isSupported=function(){return Object(y.isSupported)()};var u,a,c,E=n.prototype;return E.createController=function(g,v,r){if(g){var s=v?new g(this,v):new g(this);return r&&r.push(s),s}return null},E.on=function(g,v,r){r===void 0&&(r=this),this._emitter.on(g,v,r)},E.once=function(g,v,r){r===void 0&&(r=this),this._emitter.once(g,v,r)},E.removeAllListeners=function(g){this._emitter.removeAllListeners(g)},E.off=function(g,v,r,s){r===void 0&&(r=this),this._emitter.off(g,v,r,s)},E.listeners=function(g){return this._emitter.listeners(g)},E.emit=function(g,v,r){return this._emitter.emit(g,v,r)},E.trigger=function(g,v){if(this.config.debug)return this.emit(g,g,v);try{return this.emit(g,g,v)}catch(r){d.logger.error("An internal error happened while handling event "+g+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(l.Events.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:g,error:r})}return!1},E.listenerCount=function(g){return this._emitter.listenerCount(g)},E.destroy=function(){d.logger.log("destroy"),this.trigger(l.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(g){return g.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(g){return g.destroy()}),this.coreComponents.length=0},E.attachMedia=function(g){d.logger.log("attachMedia"),this._media=g,this.trigger(l.Events.MEDIA_ATTACHING,{media:g})},E.detachMedia=function(){d.logger.log("detachMedia"),this.trigger(l.Events.MEDIA_DETACHING,void 0),this._media=null},E.loadSource=function(g){this.stopLoad();var v=this.media,r=this.url,s=this.url=_.buildAbsoluteURL(self.location.href,g,{alwaysNormalize:!0});d.logger.log("loadSource:"+s),v&&r&&r!==s&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(v)),this.trigger(l.Events.MANIFEST_LOADING,{url:g})},E.startLoad=function(g){g===void 0&&(g=-1),d.logger.log("startLoad("+g+")"),this.networkControllers.forEach(function(v){v.startLoad(g)})},E.stopLoad=function(){d.logger.log("stopLoad"),this.networkControllers.forEach(function(g){g.stopLoad()})},E.swapAudioCodec=function(){d.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},E.recoverMediaError=function(){d.logger.log("recoverMediaError");var g=this._media;this.detachMedia(),g&&this.attachMedia(g)},E.removeLevel=function(g,v){v===void 0&&(v=0),this.levelController.removeLevel(g,v)},u=n,c=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return l.Events}},{key:"ErrorTypes",get:function(){return e.ErrorTypes}},{key:"ErrorDetails",get:function(){return e.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig?n.defaultConfig:p.hlsDefaultConfig},set:function(g){n.defaultConfig=g}}],(a=[{key:"levels",get:function(){var g=this.levelController.levels;return g||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(g){d.logger.log("set currentLevel:"+g),this.loadLevel=g,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(g){d.logger.log("set nextLevel:"+g),this.levelController.manualLevel=g,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(g){d.logger.log("set loadLevel:"+g),this.levelController.manualLevel=g}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(g){this.levelController.nextLoadLevel=g}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(g){d.logger.log("set firstLevel:"+g),this.levelController.firstLevel=g}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(g){d.logger.log("set startLevel:"+g),g!==-1&&(g=Math.max(g,this.minAutoLevel)),this.levelController.startLevel=g}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(g){var v=!!g;v!==this.config.capLevelToPlayerSize&&(v?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=v)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(g){this._autoLevelCapping!==g&&(d.logger.log("set autoLevelCapping:"+g),this._autoLevelCapping=g)}},{key:"bandwidthEstimate",get:function(){var g=this.abrController.bwEstimator;return g?g.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var g=this.levels,v=this.config.minAutoBitrate;if(!g)return 0;for(var r=g.length,s=0;s<r;s++)if(g[s].maxBitrate>v)return s;return 0}},{key:"maxAutoLevel",get:function(){var g=this.levels,v=this.autoLevelCapping;return v===-1&&g&&g.length?g.length-1:v}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(g){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,g)}},{key:"audioTracks",get:function(){var g=this.audioTrackController;return g?g.audioTracks:[]}},{key:"audioTrack",get:function(){var g=this.audioTrackController;return g?g.audioTrack:-1},set:function(g){var v=this.audioTrackController;v&&(v.audioTrack=g)}},{key:"subtitleTracks",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTrack:-1},set:function(g){var v=this.subtitleTrackController;v&&(v.subtitleTrack=g)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var g=this.subtitleTrackController;return!!g&&g.subtitleDisplay},set:function(g){var v=this.subtitleTrackController;v&&(v.subtitleDisplay=g)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(g){this.config.lowLatencyMode=g}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&i(u.prototype,a),c&&i(u,c),n}();t.defaultConfig=void 0},"./src/is-supported.ts":function(F,R,h){h.r(R),h.d(R,"isSupported",function(){return A}),h.d(R,"changeTypeSupported",function(){return k});var _=h("./src/utils/mediasource-helper.ts");function T(){return self.SourceBuffer||self.WebKitSourceBuffer}function A(){var I=Object(_.getMediaSource)();if(!I)return!1;var D=T(),o=I&&typeof I.isTypeSupported=="function"&&I.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),b=!D||D.prototype&&typeof D.prototype.appendBuffer=="function"&&typeof D.prototype.remove=="function";return!!o&&!!b}function k(){var I,D=T();return typeof(D==null||(I=D.prototype)===null||I===void 0?void 0:I.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return y}),h.d(R,"LoadError",function(){return p});var _=h("./src/polyfills/number.ts"),T=h("./src/errors.ts");function A(m){var l=typeof Map=="function"?new Map:void 0;return(A=function(e){if(e===null||(i=e,Function.toString.call(i).indexOf("[native code]")===-1))return e;var i;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,t)}function t(){return k(e,arguments,o(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),D(t,e)})(m)}function k(m,l,e){return(k=I()?Reflect.construct:function(i,t,n){var u=[null];u.push.apply(u,t);var a=new(Function.bind.apply(i,u));return n&&D(a,n.prototype),a}).apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(m,l){return(D=Object.setPrototypeOf||function(e,i){return e.__proto__=i,e})(m,l)}function o(m){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)})(m)}var b=Math.pow(2,17),y=function(){function m(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var l=m.prototype;return l.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},l.abort=function(){this.loader&&this.loader.abort()},l.load=function(e,i){var t=this,n=e.url;if(!n)return Promise.reject(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var u=this.config,a=u.fLoader,c=u.loader;return new Promise(function(E,g){t.loader&&t.loader.destroy();var v=t.loader=e.loader=a?new a(u):new c(u),r=d(e),s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:b};e.stats=v.stats,v.load(r,s,{onSuccess:function(f,S,L,C){t.resetLoader(e,v),E({frag:e,part:null,payload:f.data,networkDetails:C})},onError:function(f,S,L){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:f,networkDetails:L}))},onAbort:function(f,S,L){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:L}))},onTimeout:function(f,S,L){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:L}))},onProgress:function(f,S,L,C){i&&i({frag:e,part:null,payload:L,networkDetails:C})}})})},l.loadPart=function(e,i,t){var n=this;this.abort();var u=this.config,a=u.fLoader,c=u.loader;return new Promise(function(E,g){n.loader&&n.loader.destroy();var v=n.loader=e.loader=a?new a(u):new c(u),r=d(e,i),s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:b};i.stats=v.stats,v.load(r,s,{onSuccess:function(f,S,L,C){n.resetLoader(e,v),n.updateStatsFromPart(e,i);var O={frag:e,part:i,payload:f.data,networkDetails:C};t(O),E(O)},onError:function(f,S,L){n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:i,response:f,networkDetails:L}))},onAbort:function(f,S,L){e.stats.aborted=i.stats.aborted,n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:i,networkDetails:L}))},onTimeout:function(f,S,L){n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:i,networkDetails:L}))}})})},l.updateStatsFromPart=function(e,i){var t=e.stats,n=i.stats,u=n.total;if(t.loaded+=n.loaded,u){var a=Math.round(e.duration/i.duration),c=Math.min(Math.round(t.loaded/u),a),E=(a-c)*Math.round(t.loaded/c);t.total=t.loaded+E}else t.total=Math.max(t.loaded,t.total);var g=t.loading,v=n.loading;g.start?g.first+=v.first-v.start:(g.start=v.start,g.first=v.first),g.end=v.end},l.resetLoader=function(e,i){e.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()},m}();function d(m,l){l===void 0&&(l=null);var e=l||m,i={frag:m,part:l,responseType:"arraybuffer",url:e.url,rangeStart:0,rangeEnd:0},t=e.byteRangeStartOffset,n=e.byteRangeEndOffset;return Object(_.isFiniteNumber)(t)&&Object(_.isFiniteNumber)(n)&&(i.rangeStart=t,i.rangeEnd=n),i}var p=function(m){var l,e;function i(t){for(var n,u=arguments.length,a=new Array(u>1?u-1:0),c=1;c<u;c++)a[c-1]=arguments[c];return(n=m.call.apply(m,[this].concat(a))||this).data=void 0,n.data=t,n}return e=m,(l=i).prototype=Object.create(e.prototype),l.prototype.constructor=l,D(l,e),i}(A(Error))},"./src/loader/fragment.ts":function(F,R,h){h.r(R),h.d(R,"ElementaryStreamTypes",function(){return _}),h.d(R,"BaseSegment",function(){return m}),h.d(R,"Fragment",function(){return l}),h.d(R,"Part",function(){return e});var _,T,A=h("./src/polyfills/number.ts"),k=h("./node_modules/url-toolkit/src/url-toolkit.js"),I=h("./src/utils/logger.ts"),D=h("./src/loader/level-key.ts"),o=h("./src/loader/load-stats.ts");function b(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,y(i,t)}function y(i,t){return(y=Object.setPrototypeOf||function(n,u){return n.__proto__=u,n})(i,t)}function d(i,t){for(var n=0;n<t.length;n++){var u=t[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}function p(i,t,n){return t&&d(i.prototype,t),n&&d(i,n),i}(T=_||(_={})).AUDIO="audio",T.VIDEO="video",T.AUDIOVIDEO="audiovideo";var m=function(){function i(t){var n;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((n={})[_.AUDIO]=null,n[_.VIDEO]=null,n[_.AUDIOVIDEO]=null,n),this.baseurl=t}return i.prototype.setByteRange=function(t,n){var u=t.split("@",2),a=[];u.length===1?a[0]=n?n.byteRangeEndOffset:0:a[0]=parseInt(u[1]),a[1]=parseInt(u[0])+a[0],this._byteRange=a},p(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(k.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),i}(),l=function(i){function t(u,a){var c;return(c=i.call(this,a)||this)._decryptdata=null,c.rawProgramDateTime=null,c.programDateTime=null,c.tagList=[],c.duration=0,c.sn=0,c.levelkey=void 0,c.type=void 0,c.loader=null,c.level=-1,c.cc=0,c.startPTS=void 0,c.endPTS=void 0,c.appendedPTS=void 0,c.startDTS=void 0,c.endDTS=void 0,c.start=0,c.deltaPTS=void 0,c.maxStartPTS=void 0,c.minEndPTS=void 0,c.stats=new o.LoadStats,c.urlId=0,c.data=void 0,c.bitrateTest=!1,c.title=null,c.initSegment=null,c.type=u,c}b(t,i);var n=t.prototype;return n.createInitializationVector=function(u){for(var a=new Uint8Array(16),c=12;c<16;c++)a[c]=u>>8*(15-c)&255;return a},n.setDecryptDataFromLevelKey=function(u,a){var c=u;return(u==null?void 0:u.method)==="AES-128"&&u.uri&&!u.iv&&((c=D.LevelKey.fromURI(u.uri)).method=u.method,c.iv=this.createInitializationVector(a),c.keyFormat="identity"),c},n.setElementaryStreamInfo=function(u,a,c,E,g,v){v===void 0&&(v=!1);var r=this.elementaryStreams,s=r[u];s?(s.startPTS=Math.min(s.startPTS,a),s.endPTS=Math.max(s.endPTS,c),s.startDTS=Math.min(s.startDTS,E),s.endDTS=Math.max(s.endDTS,g)):r[u]={startPTS:a,endPTS:c,startDTS:E,endDTS:g,partial:v}},n.clearElementaryStreamInfo=function(){var u=this.elementaryStreams;u[_.AUDIO]=null,u[_.VIDEO]=null,u[_.AUDIOVIDEO]=null},p(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var u=this.sn;typeof u!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&I.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),u=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,u)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(A.isFiniteNumber)(this.programDateTime))return null;var u=Object(A.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*u}},{key:"encrypted",get:function(){var u;return!((u=this.decryptdata)===null||u===void 0||!u.keyFormat||!this.decryptdata.uri)}}]),t}(m),e=function(i){function t(n,u,a,c,E){var g;(g=i.call(this,a)||this).fragOffset=0,g.duration=0,g.gap=!1,g.independent=!1,g.relurl=void 0,g.fragment=void 0,g.index=void 0,g.stats=new o.LoadStats,g.duration=n.decimalFloatingPoint("DURATION"),g.gap=n.bool("GAP"),g.independent=n.bool("INDEPENDENT"),g.relurl=n.enumeratedString("URI"),g.fragment=u,g.index=c;var v=n.enumeratedString("BYTERANGE");return v&&g.setByteRange(v,E),E&&(g.fragOffset=E.fragOffset+E.duration),g}return b(t,i),p(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var n=this.elementaryStreams;return!!(n.audio||n.video||n.audiovideo)}}]),t}(m)},"./src/loader/key-loader.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return k});var _=h("./src/events.ts"),T=h("./src/errors.ts"),A=h("./src/utils/logger.ts"),k=function(){function I(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this._registerListeners()}var D=I.prototype;return D._registerListeners=function(){this.hls.on(_.Events.KEY_LOADING,this.onKeyLoading,this)},D._unregisterListeners=function(){this.hls.off(_.Events.KEY_LOADING,this.onKeyLoading)},D.destroy=function(){for(var o in this._unregisterListeners(),this.loaders){var b=this.loaders[o];b&&b.destroy()}this.loaders={}},D.onKeyLoading=function(o,b){var y=b.frag,d=y.type,p=this.loaders[d];if(y.decryptdata){var m=y.decryptdata.uri;if(m!==this.decrypturl||this.decryptkey===null){var l=this.hls.config;if(p&&(A.logger.warn("abort previous key loader for type:"+d),p.abort()),!m)return void A.logger.warn("key uri is falsy");var e=l.loader,i=y.loader=this.loaders[d]=new e(l);this.decrypturl=m,this.decryptkey=null;var t={url:m,frag:y,responseType:"arraybuffer"},n={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.load(t,n,u)}else this.decryptkey&&(y.decryptdata.key=this.decryptkey,this.hls.trigger(_.Events.KEY_LOADED,{frag:y}))}else A.logger.warn("Missing decryption data on fragment in onKeyLoading")},D.loadsuccess=function(o,b,y){var d=y.frag;d.decryptdata?(this.decryptkey=d.decryptdata.key=new Uint8Array(o.data),d.loader=null,delete this.loaders[d.type],this.hls.trigger(_.Events.KEY_LOADED,{frag:d})):A.logger.error("after key load, decryptdata unset")},D.loaderror=function(o,b){var y=b.frag,d=y.loader;d&&d.abort(),delete this.loaders[y.type],this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:y,response:o})},D.loadtimeout=function(o,b){var y=b.frag,d=y.loader;d&&d.abort(),delete this.loaders[y.type],this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:y})},I}()},"./src/loader/level-details.ts":function(F,R,h){h.r(R),h.d(R,"LevelDetails",function(){return A});var _=h("./src/polyfills/number.ts");function T(k,I){for(var D=0;D<I.length;D++){var o=I[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var A=function(){function k(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=o}var I,D;return k.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var b=this.lastPartSn-o.lastPartSn,y=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!y||!!b,this.advanced=this.endSN>o.endSN||b>0||b===0&&y>0,this.updated||this.advanced?this.misses=Math.floor(.6*o.misses):this.misses=o.misses+1,this.availabilityDelay=o.availabilityDelay},I=k,(D=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(_.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return(o=this.fragments)!==null&&o!==void 0&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&T(I.prototype,D),k}()},"./src/loader/level-key.ts":function(F,R,h){h.r(R),h.d(R,"LevelKey",function(){return A});var _=h("./node_modules/url-toolkit/src/url-toolkit.js");function T(k,I){for(var D=0;D<I.length;D++){var o=I[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var A=function(){function k(o,b){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=b?Object(_.buildAbsoluteURL)(o,b,{alwaysNormalize:!0}):o}var I,D;return k.fromURL=function(o,b){return new k(o,b)},k.fromURI=function(o){return new k(o)},I=k,(D=[{key:"uri",get:function(){return this._uri}}])&&T(I.prototype,D),k}()},"./src/loader/load-stats.ts":function(F,R,h){h.r(R),h.d(R,"LoadStats",function(){return _});var _=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return e});var _=h("./src/polyfills/number.ts"),T=h("./node_modules/url-toolkit/src/url-toolkit.js"),A=h("./src/loader/fragment.ts"),k=h("./src/loader/level-details.ts"),I=h("./src/loader/level-key.ts"),D=h("./src/utils/attr-list.ts"),o=h("./src/utils/logger.ts"),b=h("./src/utils/codecs.ts"),y=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,d=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),m=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),l=/\.(mp4|m4s|m4v|m4a)$/i,e=function(){function u(){}return u.findGroup=function(a,c){for(var E=0;E<a.length;E++){var g=a[E];if(g.id===c)return g}},u.convertAVC1ToAVCOTI=function(a){var c=a.split(".");if(c.length>2){var E=c.shift()+".";return E+=parseInt(c.shift()).toString(16),E+=("000"+parseInt(c.shift()).toString(16)).substr(-4)}return a},u.resolve=function(a,c){return T.buildAbsoluteURL(c,a,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(a,c){var E,g=[],v={},r=!1;for(y.lastIndex=0;(E=y.exec(a))!=null;)if(E[1]){var s=new D.AttrList(E[1]),f={attrs:s,bitrate:s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),name:s.NAME,url:u.resolve(E[2],c)},S=s.decimalResolution("RESOLUTION");S&&(f.width=S.width,f.height=S.height),i((s.CODECS||"").split(/[ ,]+/).filter(function(C){return C}),f),f.videoCodec&&f.videoCodec.indexOf("avc1")!==-1&&(f.videoCodec=u.convertAVC1ToAVCOTI(f.videoCodec)),g.push(f)}else if(E[3]){var L=new D.AttrList(E[3]);L["DATA-ID"]&&(r=!0,v[L["DATA-ID"]]=L)}return{levels:g,sessionData:r?v:null}},u.parseMasterPlaylistMedia=function(a,c,E,g){var v;g===void 0&&(g=[]);var r=[],s=0;for(d.lastIndex=0;(v=d.exec(a))!==null;){var f=new D.AttrList(v[1]);if(f.TYPE===E){var S={attrs:f,bitrate:0,id:s++,groupId:f["GROUP-ID"],instreamId:f["INSTREAM-ID"],name:f.NAME||f.LANGUAGE||"",type:E,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:f.LANGUAGE,url:f.URI?u.resolve(f.URI,c):""};if(g.length){var L=u.findGroup(g,S.groupId)||g[0];t(S,L,"audioCodec"),t(S,L,"textCodec")}r.push(S)}}return r},u.parseLevelPlaylist=function(a,c,E,g,v){var r,s,f,S=new k.LevelDetails(c),L=S.fragments,C=null,O=0,w=0,P=0,x=0,M=null,N=new A.Fragment(g,c),U=-1,G=!1;for(p.lastIndex=0,S.m3u8=a;(r=p.exec(a))!==null;){G&&(G=!1,(N=new A.Fragment(g,c)).start=P,N.sn=O,N.cc=x,N.level=E,C&&(N.initSegment=C,N.rawProgramDateTime=C.rawProgramDateTime));var V=r[1];if(V){N.duration=parseFloat(V);var W=(" "+r[2]).slice(1);N.title=W||null,N.tagList.push(W?["INF",V,W]:["INF",V])}else if(r[3])Object(_.isFiniteNumber)(N.duration)&&(N.start=P,f&&(N.levelkey=f),N.sn=O,N.level=E,N.cc=x,N.urlId=v,L.push(N),N.relurl=(" "+r[3]).slice(1),n(N,M),M=N,P+=N.duration,O++,w=0,G=!0);else if(r[4]){var Y=(" "+r[4]).slice(1);M?N.setByteRange(Y,M):N.setByteRange(Y)}else if(r[5])N.rawProgramDateTime=(" "+r[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),U===-1&&(U=L.length);else{if(!(r=r[0].match(m))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<r.length&&r[s]===void 0;s++);var X=(" "+r[s]).slice(1),z=(" "+r[s+1]).slice(1),Z=r[s+2]?(" "+r[s+2]).slice(1):"";switch(X){case"PLAYLIST-TYPE":S.type=z.toUpperCase();break;case"MEDIA-SEQUENCE":O=S.startSN=parseInt(z);break;case"SKIP":var ne=new D.AttrList(z),se=ne.decimalInteger("SKIPPED-SEGMENTS");if(Object(_.isFiniteNumber)(se)){S.skippedSegments=se;for(var de=se;de--;)L.unshift(null);O+=se}var re=ne.enumeratedString("RECENTLY-REMOVED-DATERANGES");re&&(S.recentlyRemovedDateranges=re.split("	"));break;case"TARGETDURATION":S.targetduration=parseFloat(z);break;case"VERSION":S.version=parseInt(z);break;case"EXTM3U":break;case"ENDLIST":S.live=!1;break;case"#":(z||Z)&&N.tagList.push(Z?[z,Z]:[z]);break;case"DIS":x++;case"GAP":N.tagList.push([X]);break;case"BITRATE":N.tagList.push([X,z]);break;case"DISCONTINUITY-SEQ":x=parseInt(z);break;case"KEY":var ge,te=new D.AttrList(z),ae=te.enumeratedString("METHOD"),he=te.URI,ce=te.hexadecimalInteger("IV"),Ae=te.enumeratedString("KEYFORMATVERSIONS"),_e=te.enumeratedString("KEYID"),De=(ge=te.enumeratedString("KEYFORMAT"))!=null?ge:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(De)>-1){o.logger.warn("Keyformat "+De+" is not supported from the manifest");continue}if(De!=="identity")continue;ae&&(f=I.LevelKey.fromURL(c,he),he&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ae)>=0&&(f.method=ae,f.keyFormat=De,_e&&(f.keyID=_e),Ae&&(f.keyFormatVersions=Ae),f.iv=ce));break;case"START":var Ce=new D.AttrList(z).decimalFloatingPoint("TIME-OFFSET");Object(_.isFiniteNumber)(Ce)&&(S.startTimeOffset=Ce);break;case"MAP":var be=new D.AttrList(z);N.relurl=be.URI,be.BYTERANGE&&N.setByteRange(be.BYTERANGE),N.level=E,N.sn="initSegment",f&&(N.levelkey=f),N.initSegment=null,C=N,G=!0;break;case"SERVER-CONTROL":var me=new D.AttrList(z);S.canBlockReload=me.bool("CAN-BLOCK-RELOAD"),S.canSkipUntil=me.optionalFloat("CAN-SKIP-UNTIL",0),S.canSkipDateRanges=S.canSkipUntil>0&&me.bool("CAN-SKIP-DATERANGES"),S.partHoldBack=me.optionalFloat("PART-HOLD-BACK",0),S.holdBack=me.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Ye=new D.AttrList(z);S.partTarget=Ye.decimalFloatingPoint("PART-TARGET");break;case"PART":var Ie=S.partList;Ie||(Ie=S.partList=[]);var Me=w>0?Ie[Ie.length-1]:void 0,ze=w++,Ke=new A.Part(new D.AttrList(z),N,c,ze,Me);Ie.push(Ke),N.duration+=Ke.duration;break;case"PRELOAD-HINT":var Fe=new D.AttrList(z);S.preloadHint=Fe;break;case"RENDITION-REPORT":var it=new D.AttrList(z);S.renditionReports=S.renditionReports||[],S.renditionReports.push(it);break;default:o.logger.warn("line parsed but not handled: "+r)}}}M&&!M.relurl?(L.pop(),P-=M.duration,S.partList&&(S.fragmentHint=M)):S.partList&&(n(N,M),N.cc=x,S.fragmentHint=N);var Xe=L.length,Pe=L[0],nt=L[Xe-1];if((P+=S.skippedSegments*S.targetduration)>0&&Xe&&nt){S.averagetargetduration=P/Xe;var Qe=nt.sn;S.endSN=Qe!=="initSegment"?Qe:0,Pe&&(S.startCC=Pe.cc,Pe.initSegment||S.fragments.every(function(He){return He.relurl&&(Ne=He.relurl,l.test((We=(we=T.parseURL(Ne))===null||we===void 0?void 0:we.path)!=null?We:""));var Ne,We,we})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(N=new A.Fragment(g,c)).relurl=nt.relurl,N.level=E,N.sn="initSegment",Pe.initSegment=N,S.needSidxRanges=!0))}else S.endSN=0,S.startCC=0;return S.fragmentHint&&(P+=S.fragmentHint.duration),S.totalduration=P,S.endCC=x,U>0&&function(He,Ne){for(var We=He[Ne],we=Ne;we--;){var $e=He[we];if(!$e)return;$e.programDateTime=We.programDateTime-1e3*$e.duration,We=$e}}(L,U),S},u}();function i(u,a){["video","audio","text"].forEach(function(c){var E=u.filter(function(v){return Object(b.isCodecType)(v,c)});if(E.length){var g=E.filter(function(v){return v.lastIndexOf("avc1",0)===0||v.lastIndexOf("mp4a",0)===0});a[c+"Codec"]=g.length>0?g[0]:E[0],u=u.filter(function(v){return E.indexOf(v)===-1})}}),a.unknownCodecs=u}function t(u,a,c){var E=a[c];E&&(u[c]=E)}function n(u,a){u.rawProgramDateTime?u.programDateTime=Date.parse(u.rawProgramDateTime):a!=null&&a.programDateTime&&(u.programDateTime=a.endProgramDateTime),Object(_.isFiniteNumber)(u.programDateTime)||(u.programDateTime=null,u.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(F,R,h){h.r(R);var _=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),A=h("./src/errors.ts"),k=h("./src/utils/logger.ts"),I=h("./src/utils/mp4-tools.ts"),D=h("./src/loader/m3u8-parser.ts"),o=h("./src/types/loader.ts"),b=h("./src/utils/attr-list.ts");function y(p,m){var l=p.url;return l!==void 0&&l.indexOf("data:")!==0||(l=m.url),l}var d=function(){function p(l){this.hls=void 0,this.loaders=Object.create(null),this.hls=l,this.registerListeners()}var m=p.prototype;return m.registerListeners=function(){var l=this.hls;l.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),l.on(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.unregisterListeners=function(){var l=this.hls;l.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),l.off(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.createInternalLoader=function(l){var e=this.hls.config,i=e.pLoader,t=e.loader,n=new(i||t)(e);return l.loader=n,this.loaders[l.type]=n,n},m.getInternalLoader=function(l){return this.loaders[l.type]},m.resetInternalLoader=function(l){this.loaders[l]&&delete this.loaders[l]},m.destroyInternalLoaders=function(){for(var l in this.loaders){var e=this.loaders[l];e&&e.destroy(),this.resetInternalLoader(l)}},m.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},m.onManifestLoading=function(l,e){var i=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},m.onLevelLoading=function(l,e){var i=e.id,t=e.level,n=e.url,u=e.deliveryDirectives;this.load({id:i,groupId:null,level:t,responseType:"text",type:o.PlaylistContextType.LEVEL,url:n,deliveryDirectives:u})},m.onAudioTrackLoading=function(l,e){var i=e.id,t=e.groupId,n=e.url,u=e.deliveryDirectives;this.load({id:i,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:u})},m.onSubtitleTrackLoading=function(l,e){var i=e.id,t=e.groupId,n=e.url,u=e.deliveryDirectives;this.load({id:i,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:u})},m.load=function(l){var e,i,t,n,u,a,c=this.hls.config,E=this.getInternalLoader(l);if(E){var g=E.context;if(g&&g.url===l.url)return void k.logger.trace("[playlist-loader]: playlist request ongoing");k.logger.log("[playlist-loader]: aborting previous loader for type: "+l.type),E.abort()}switch(l.type){case o.PlaylistContextType.MANIFEST:i=c.manifestLoadingMaxRetry,t=c.manifestLoadingTimeOut,n=c.manifestLoadingRetryDelay,u=c.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:i=0,t=c.levelLoadingTimeOut;break;default:i=c.levelLoadingMaxRetry,t=c.levelLoadingTimeOut,n=c.levelLoadingRetryDelay,u=c.levelLoadingMaxRetryTimeout}if(E=this.createInternalLoader(l),(e=l.deliveryDirectives)!==null&&e!==void 0&&e.part&&(l.type===o.PlaylistContextType.LEVEL&&l.level!==null?a=this.hls.levels[l.level].details:l.type===o.PlaylistContextType.AUDIO_TRACK&&l.id!==null?a=this.hls.audioTracks[l.id].details:l.type===o.PlaylistContextType.SUBTITLE_TRACK&&l.id!==null&&(a=this.hls.subtitleTracks[l.id].details),a)){var v=a.partTarget,r=a.targetduration;v&&r&&(t=Math.min(1e3*Math.max(3*v,.8*r),t))}var s={timeout:t,maxRetry:i,retryDelay:n,maxRetryDelay:u,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};E.load(l,s,f)},m.loadsuccess=function(l,e,i,t){if(t===void 0&&(t=null),i.isSidxRequest)return this.handleSidxRequest(l,i),void this.handlePlaylistLoaded(l,e,i,t);this.resetInternalLoader(i.type);var n=l.data;n.indexOf("#EXTM3U")===0?(e.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(l,e,i,t):this.handleMasterPlaylist(l,e,i,t)):this.handleManifestParsingError(l,i,"no EXTM3U delimiter",t)},m.loaderror=function(l,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!1,l)},m.loadtimeout=function(l,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!0)},m.handleMasterPlaylist=function(l,e,i,t){var n=this.hls,u=l.data,a=y(l,i),c=D.default.parseMasterPlaylist(u,a),E=c.levels,g=c.sessionData;if(E.length){var v=E.map(function(L){return{id:L.attrs.AUDIO,audioCodec:L.audioCodec}}),r=E.map(function(L){return{id:L.attrs.SUBTITLES,textCodec:L.textCodec}}),s=D.default.parseMasterPlaylistMedia(u,a,"AUDIO",v),f=D.default.parseMasterPlaylistMedia(u,a,"SUBTITLES",r),S=D.default.parseMasterPlaylistMedia(u,a,"CLOSED-CAPTIONS");s.length&&(s.some(function(L){return!L.url})||!E[0].audioCodec||E[0].attrs.AUDIO||(k.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),s.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new b.AttrList({}),bitrate:0,url:""}))),n.trigger(T.Events.MANIFEST_LOADED,{levels:E,audioTracks:s,subtitles:f,captions:S,url:a,stats:e,networkDetails:t,sessionData:g})}else this.handleManifestParsingError(l,i,"no level found in manifest",t)},m.handleTrackOrLevelPlaylist=function(l,e,i,t){var n=this.hls,u=i.id,a=i.level,c=i.type,E=y(l,i),g=Object(_.isFiniteNumber)(u)?u:0,v=Object(_.isFiniteNumber)(a)?a:g,r=function(C){switch(C.type){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}(i),s=D.default.parseLevelPlaylist(l.data,E,v,r,g);if(s.fragments.length){if(c===o.PlaylistContextType.MANIFEST){var f={attrs:new b.AttrList({}),bitrate:0,details:s,name:"",url:E};n.trigger(T.Events.MANIFEST_LOADED,{levels:[f],audioTracks:[],url:E,stats:e,networkDetails:t,sessionData:null})}if(e.parsing.end=performance.now(),s.needSidxRanges){var S,L=(S=s.fragments[0].initSegment)===null||S===void 0?void 0:S.url;this.load({url:L,isSidxRequest:!0,type:c,level:a,levelDetails:s,id:u,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=s,this.handlePlaylistLoaded(l,e,i,t)}else n.trigger(T.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:E,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},m.handleSidxRequest=function(l,e){var i=Object(I.parseSegmentIndex)(new Uint8Array(l.data));if(i){var t=i.references,n=e.levelDetails;t.forEach(function(u,a){var c=u.info,E=n.fragments[a];E.byteRange.length===0&&E.setByteRange(String(1+c.end-c.start)+"@"+String(c.start)),E.initSegment&&E.initSegment.setByteRange(String(i.moovEndOffset)+"@0")})}},m.handleManifestParsingError=function(l,e,i,t){this.hls.trigger(T.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===o.PlaylistContextType.MANIFEST,url:l.url,reason:i,response:l,context:e,networkDetails:t})},m.handleNetworkError=function(l,e,i,t){i===void 0&&(i=!1),k.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+l.type+" level: "+l.level+" id: "+l.id+' group-id: "'+l.groupId+'"');var n=A.ErrorDetails.UNKNOWN,u=!1,a=this.getInternalLoader(l);switch(l.type){case o.PlaylistContextType.MANIFEST:n=i?A.ErrorDetails.MANIFEST_LOAD_TIMEOUT:A.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case o.PlaylistContextType.LEVEL:n=i?A.ErrorDetails.LEVEL_LOAD_TIMEOUT:A.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case o.PlaylistContextType.AUDIO_TRACK:n=i?A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:n=i?A.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:A.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1}a&&this.resetInternalLoader(l.type);var c={type:A.ErrorTypes.NETWORK_ERROR,details:n,fatal:u,url:l.url,loader:a,context:l,networkDetails:e};t&&(c.response=t),this.hls.trigger(T.Events.ERROR,c)},m.handlePlaylistLoaded=function(l,e,i,t){var n=i.type,u=i.level,a=i.id,c=i.groupId,E=i.loader,g=i.levelDetails,v=i.deliveryDirectives;if(g!=null&&g.targetduration){if(E)switch(g.live&&(E.getCacheAge&&(g.ageHeader=E.getCacheAge()||0),E.getCacheAge&&!isNaN(g.ageHeader)||(g.ageHeader=0)),n){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(T.Events.LEVEL_LOADED,{details:g,level:u||0,id:a||0,stats:e,networkDetails:t,deliveryDirectives:v});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(T.Events.AUDIO_TRACK_LOADED,{details:g,id:a||0,groupId:c||"",stats:e,networkDetails:t,deliveryDirectives:v});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(T.Events.SUBTITLE_TRACK_LOADED,{details:g,id:a||0,groupId:c||"",stats:e,networkDetails:t,deliveryDirectives:v})}}else this.handleManifestParsingError(l,i,"invalid target duration",t)},p}();R.default=d},"./src/polyfills/number.ts":function(F,R,h){h.r(R),h.d(R,"isFiniteNumber",function(){return _}),h.d(R,"MAX_SAFE_INTEGER",function(){return T});var _=Number.isFinite||function(A){return typeof A=="number"&&isFinite(A)},T=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(F,R,h){h.r(R);var _=function(){function T(){}return T.getSilentFrame=function(A,k){switch(A){case"mp4a.40.2":if(k===1)return new Uint8Array([0,200,0,128,35,128]);if(k===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(k===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(k===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(k===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(k===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(k===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},T}();R.default=_},"./src/remux/mp4-generator.ts":function(F,R,h){h.r(R);var _=Math.pow(2,32)-1,T=function(){function A(){}return A.init=function(){var k;for(k in A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},A.types)A.types.hasOwnProperty(k)&&(A.types[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:I,audio:D};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),b=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=b,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var y=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),p=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,y,p,y,d),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,o))},A.box=function(k){for(var I=8,D=arguments.length,o=new Array(D>1?D-1:0),b=1;b<D;b++)o[b-1]=arguments[b];for(var y=o.length,d=y;y--;)I+=o[y].byteLength;var p=new Uint8Array(I);for(p[0]=I>>24&255,p[1]=I>>16&255,p[2]=I>>8&255,p[3]=255&I,p.set(k,4),y=0,I=8;y<d;y++)p.set(o[y],I),I+=o[y].byteLength;return p},A.hdlr=function(k){return A.box(A.types.hdlr,A.HDLR_TYPES[k])},A.mdat=function(k){return A.box(A.types.mdat,k)},A.mdhd=function(k,I){I*=k;var D=Math.floor(I/(_+1)),o=Math.floor(I%(_+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,255&k,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},A.mdia=function(k){return A.box(A.types.mdia,A.mdhd(k.timescale,k.duration),A.hdlr(k.type),A.minf(k))},A.mfhd=function(k){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,k>>24,k>>16&255,k>>8&255,255&k]))},A.minf=function(k){return k.type==="audio"?A.box(A.types.minf,A.box(A.types.smhd,A.SMHD),A.DINF,A.stbl(k)):A.box(A.types.minf,A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(k))},A.moof=function(k,I,D){return A.box(A.types.moof,A.mfhd(k),A.traf(D,I))},A.moov=function(k){for(var I=k.length,D=[];I--;)D[I]=A.trak(k[I]);return A.box.apply(null,[A.types.moov,A.mvhd(k[0].timescale,k[0].duration)].concat(D).concat(A.mvex(k)))},A.mvex=function(k){for(var I=k.length,D=[];I--;)D[I]=A.trex(k[I]);return A.box.apply(null,[A.types.mvex].concat(D))},A.mvhd=function(k,I){I*=k;var D=Math.floor(I/(_+1)),o=Math.floor(I%(_+1)),b=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,255&k,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,b)},A.sdtp=function(k){var I,D,o=k.samples||[],b=new Uint8Array(4+o.length);for(I=0;I<o.length;I++)D=o[I].flags,b[I+4]=D.dependsOn<<4|D.isDependedOn<<2|D.hasRedundancy;return A.box(A.types.sdtp,b)},A.stbl=function(k){return A.box(A.types.stbl,A.stsd(k),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))},A.avc1=function(k){var I,D,o,b=[],y=[];for(I=0;I<k.sps.length;I++)o=(D=k.sps[I]).byteLength,b.push(o>>>8&255),b.push(255&o),b=b.concat(Array.prototype.slice.call(D));for(I=0;I<k.pps.length;I++)o=(D=k.pps[I]).byteLength,y.push(o>>>8&255),y.push(255&o),y=y.concat(Array.prototype.slice.call(D));var d=A.box(A.types.avcC,new Uint8Array([1,b[3],b[4],b[5],255,224|k.sps.length].concat(b).concat([k.pps.length]).concat(y))),p=k.width,m=k.height,l=k.pixelRatio[0],e=k.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>8&255,255&p,m>>8&255,255&m,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,e>>24,e>>16&255,e>>8&255,255&e])))},A.esds=function(k){var I=k.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(k.config).concat([6,1,2]))},A.mp4a=function(k){var I=k.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]),A.box(A.types.esds,A.esds(k)))},A.mp3=function(k){var I=k.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]))},A.stsd=function(k){return k.type==="audio"?k.isAAC||k.codec!=="mp3"?A.box(A.types.stsd,A.STSD,A.mp4a(k)):A.box(A.types.stsd,A.STSD,A.mp3(k)):A.box(A.types.stsd,A.STSD,A.avc1(k))},A.tkhd=function(k){var I=k.id,D=k.duration*k.timescale,o=k.width,b=k.height,y=Math.floor(D/(_+1)),d=Math.floor(D%(_+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,0,0,0,0,y>>24,y>>16&255,y>>8&255,255&y,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,b>>8&255,255&b,0,0]))},A.traf=function(k,I){var D=A.sdtp(k),o=k.id,b=Math.floor(I/(_+1)),y=Math.floor(I%(_+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,b>>24,b>>16&255,b>>8&255,255&b,y>>24,y>>16&255,y>>8&255,255&y])),A.trun(k,D.length+16+20+8+16+8+8),D)},A.trak=function(k){return k.duration=k.duration||4294967295,A.box(A.types.trak,A.tkhd(k),A.mdia(k))},A.trex=function(k){var I=k.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,255&I,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},A.trun=function(k,I){var D,o,b,y,d,p,m=k.samples||[],l=m.length,e=12+16*l,i=new Uint8Array(e);for(I+=8+e,i.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,I>>>24&255,I>>>16&255,I>>>8&255,255&I],0),D=0;D<l;D++)b=(o=m[D]).duration,y=o.size,d=o.flags,p=o.cts,i.set([b>>>24&255,b>>>16&255,b>>>8&255,255&b,y>>>24&255,y>>>16&255,y>>>8&255,255&y,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,p>>>24&255,p>>>16&255,p>>>8&255,255&p],12+16*D);return A.box(A.types.trun,i)},A.initSegment=function(k){A.types||A.init();var I=A.moov(k),D=new Uint8Array(A.FTYP.byteLength+I.byteLength);return D.set(A.FTYP),D.set(I,A.FTYP.byteLength),D},A}();T.types=void 0,T.HDLR_TYPES=void 0,T.STTS=void 0,T.STSC=void 0,T.STCO=void 0,T.STSZ=void 0,T.VMHD=void 0,T.SMHD=void 0,T.STSD=void 0,T.FTYP=void 0,T.DINF=void 0,R.default=T},"./src/remux/mp4-remuxer.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return l}),h.d(R,"normalizePts",function(){return e});var _=h("./src/polyfills/number.ts"),T=h("./src/remux/aac-helper.ts"),A=h("./src/remux/mp4-generator.ts"),k=h("./src/events.ts"),I=h("./src/errors.ts"),D=h("./src/utils/logger.ts"),o=h("./src/types/loader.ts"),b=h("./src/utils/timescale-conversion.ts");function y(){return(y=Object.assign||function(n){for(var u=1;u<arguments.length;u++){var a=arguments[u];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])}return n}).apply(this,arguments)}var d=null,p=null,m=!1,l=function(){function n(a,c,E,g){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=a,this.config=c,this.typeSupported=E,this.ISGenerated=!1,d===null){var v=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);d=v?parseInt(v[1]):0}if(p===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);p=r?parseInt(r[1]):0}m=!!d&&d<75||!!p&&p<600}var u=n.prototype;return u.destroy=function(){},u.resetTimeStamp=function(a){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},u.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},u.getVideoStartPts=function(a){var c=!1,E=a.reduce(function(g,v){var r=v.pts-g;return r<-4294967296?(c=!0,e(g,v.pts)):r>0?g:v.pts},a[0].pts);return c&&D.logger.debug("PTS rollover detected"),E},u.remux=function(a,c,E,g,v,r,s,f){var S,L,C,O,w,P,x=v,M=v,N=a.pid>-1,U=c.pid>-1,G=c.samples.length,V=a.samples.length>0,W=G>1;if((!N||V)&&(!U||W)||this.ISGenerated||s){this.ISGenerated||(C=this.generateIS(a,c,v));var Y=this.isVideoContiguous,X=-1;if(W&&(X=function(de){for(var re=0;re<de.length;re++)if(de[re].key)return re;return-1}(c.samples),!Y&&this.config.forceKeyFrameOnDiscontinuity))if(P=!0,X>0){D.logger.warn("[mp4-remuxer]: Dropped "+X+" out of "+G+" video samples due to a missing keyframe");var z=this.getVideoStartPts(c.samples);c.samples=c.samples.slice(X),c.dropped+=X,M+=(c.samples[0].pts-z)/(c.timescale||9e4)}else X===-1&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+G+" video samples"),P=!1);if(this.ISGenerated){if(V&&W){var Z=this.getVideoStartPts(c.samples),ne=(e(a.samples[0].pts,Z)-Z)/c.inputTimeScale;x+=Math.max(0,ne),M+=Math.max(0,-ne)}if(V){if(a.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),C=this.generateIS(a,c,v)),L=this.remuxAudio(a,x,this.isAudioContiguous,r,U||W||f===o.PlaylistLevelType.AUDIO?M:void 0),W){var se=L?L.endPTS-L.startPTS:0;c.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),C=this.generateIS(a,c,v)),S=this.remuxVideo(c,M,Y,se)}}else W&&(S=this.remuxVideo(c,M,Y,0));S&&(S.firstKeyFrame=X,S.independent=X!==-1)}}return this.ISGenerated&&(E.samples.length&&(w=this.remuxID3(E,v)),g.samples.length&&(O=this.remuxText(g,v))),{audio:L,video:S,initSegment:C,independent:P,text:O,id3:w}},u.generateIS=function(a,c,E){var g,v,r,s=a.samples,f=c.samples,S=this.typeSupported,L={},C=!Object(_.isFiniteNumber)(this._initPTS),O="audio/mp4";if(C&&(g=v=1/0),a.config&&s.length&&(a.timescale=a.samplerate,a.isAAC||(S.mpeg?(O="audio/mpeg",a.codec=""):S.mp3&&(a.codec="mp3")),L.audio={id:"audio",container:O,codec:a.codec,initSegment:!a.isAAC&&S.mpeg?new Uint8Array(0):A.default.initSegment([a]),metadata:{channelCount:a.channelCount}},C&&(r=a.inputTimeScale,g=v=s[0].pts-Math.round(r*E))),c.sps&&c.pps&&f.length&&(c.timescale=c.inputTimeScale,L.video={id:"main",container:"video/mp4",codec:c.codec,initSegment:A.default.initSegment([c]),metadata:{width:c.width,height:c.height}},C)){r=c.inputTimeScale;var w=this.getVideoStartPts(f),P=Math.round(r*E);v=Math.min(v,e(f[0].dts,w)-P),g=Math.min(g,w-P)}if(Object.keys(L).length)return this.ISGenerated=!0,C&&(this._initPTS=g,this._initDTS=v),{tracks:L,initPTS:g,timescale:r}},u.remuxVideo=function(a,c,E,g){var v,r,s,f=a.inputTimeScale,S=a.samples,L=[],C=S.length,O=this._initPTS,w=this.nextAvcDts,P=8,x=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,N=0,U=!1;E&&w!==null||(w=c*f-(S[0].pts-e(S[0].dts,S[0].pts)));for(var G=0;G<C;G++){var V=S[G];V.pts=e(V.pts-O,w),V.dts=e(V.dts-O,w),V.dts>V.pts&&(N=Math.max(Math.min(N,V.pts-V.dts),-18e3)),V.dts<S[G>0?G-1:G].dts&&(U=!0)}U&&S.sort(function(we,$e){var nr=we.dts-$e.dts,ar=we.pts-$e.pts;return nr||ar}),r=S[0].dts,s=S[S.length-1].dts;var W=Math.round((s-r)/(C-1));if(N<0){if(N<-2*W){D.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(b.toMsFromMpegTsClock)(-W,!0)+" ms");for(var Y=N,X=0;X<C;X++)S[X].dts=Y=Math.max(Y,S[X].pts-W),S[X].pts=Math.max(Y,S[X].pts)}else{D.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(b.toMsFromMpegTsClock)(N,!0)+" ms to overcome this issue");for(var z=0;z<C;z++)S[z].dts=S[z].dts+N}r=S[0].dts}if(E){var Z=r-w,ne=Z>W;if(ne||Z<-1){ne?D.logger.warn("AVC: "+Object(b.toMsFromMpegTsClock)(Z,!0)+" ms ("+Z+"dts) hole between fragments detected, filling it"):D.logger.warn("AVC: "+Object(b.toMsFromMpegTsClock)(-Z,!0)+" ms ("+Z+"dts) overlapping between fragments detected"),r=w;var se=S[0].pts-Z;S[0].dts=r,S[0].pts=se,D.logger.log("Video: First PTS/DTS adjusted: "+Object(b.toMsFromMpegTsClock)(se,!0)+"/"+Object(b.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(b.toMsFromMpegTsClock)(Z,!0)+" ms")}}m&&(r=Math.max(0,r));for(var de=0,re=0,ge=0;ge<C;ge++){for(var te=S[ge],ae=te.units,he=ae.length,ce=0,Ae=0;Ae<he;Ae++)ce+=ae[Ae].data.length;re+=ce,de+=he,te.length=ce,te.dts=Math.max(te.dts,r),te.pts=Math.max(te.pts,te.dts,0),x=Math.min(te.pts,x),M=Math.max(te.pts,M)}s=S[C-1].dts;var _e,De=re+4*de+8;try{_e=new Uint8Array(De)}catch{return void this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:De,reason:"fail allocating video mdat "+De})}var Ce=new DataView(_e.buffer);Ce.setUint32(0,De),_e.set(A.default.types.mdat,4);for(var be=0;be<C;be++){for(var me=S[be],Ye=me.units,Ie=0,Me=0,ze=Ye.length;Me<ze;Me++){var Ke=Ye[Me],Fe=Ke.data,it=Ke.data.byteLength;Ce.setUint32(P,it),P+=4,_e.set(Fe,P),P+=it,Ie+=4+it}if(be<C-1)v=S[be+1].dts-me.dts;else{var Xe=this.config,Pe=me.dts-S[be>0?be-1:be].dts;if(Xe.stretchShortVideoTrack&&this.nextAudioPts!==null){var nt=Math.floor(Xe.maxBufferHole*f),Qe=(g?x+g*f:this.nextAudioPts)-me.pts;Qe>nt?((v=Qe-Pe)<0&&(v=Pe),D.logger.log("[mp4-remuxer]: It is approximately "+Qe/90+" ms to the next segment; using duration "+v/90+" ms for the last video frame.")):v=Pe}else v=Pe}var He=Math.round(me.pts-me.dts);L.push(new i(me.key,v,Ie,He))}if(L.length&&d&&d<70){var Ne=L[0].flags;Ne.dependsOn=2,Ne.isNonSync=0}console.assert(v!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=w=s+v,this.isVideoContiguous=!0;var We={data1:A.default.moof(a.sequenceNumber++,r,y({},a,{samples:L})),data2:_e,startPTS:x/f,endPTS:(M+v)/f,startDTS:r/f,endDTS:w/f,type:"video",hasAudio:!1,hasVideo:!0,nb:L.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(_e.length,"MDAT length must not be zero"),We},u.remuxAudio=function(a,c,E,g,v){var r=a.inputTimeScale,s=r/(a.samplerate?a.samplerate:r),f=a.isAAC?1024:1152,S=f*s,L=this._initPTS,C=!a.isAAC&&this.typeSupported.mpeg,O=[],w=a.samples,P=C?0:8,x=this.nextAudioPts||-1,M=c*r;if(this.isAudioContiguous=E=E||w.length&&x>0&&(g&&Math.abs(M-x)<9e3||Math.abs(e(w[0].pts-L,M)-x)<20*S),w.forEach(function(Fe){Fe.pts=e(Fe.pts-L,M)}),!E||x<0){if(!(w=w.filter(function(Fe){return Fe.pts>=0})).length)return;x=v===0?0:g?Math.max(0,M):w[0].pts}if(a.isAAC)for(var N=v!==void 0,U=this.config.maxAudioFramesDrift,G=0,V=x;G<w.length;G++){var W=w[G],Y=W.pts,X=Y-V,z=Math.abs(1e3*X/r);if(X<=-U*S&&N)G===0&&(D.logger.warn("Audio frame @ "+(Y/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*X/r)+" ms."),this.nextAudioPts=x=V=Y);else if(X>=U*S&&z<1e4&&N){var Z=Math.round(X/S);(V=Y-Z*S)<0&&(Z--,V+=S),G===0&&(this.nextAudioPts=x=V),D.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(V/r).toFixed(3)+"s due to "+Math.round(1e3*X/r)+" ms gap.");for(var ne=0;ne<Z;ne++){var se=Math.max(V,0),de=T.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);de||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),de=W.unit.subarray()),w.splice(G,0,{unit:de,pts:se}),V+=S,G++}}W.pts=V,V+=S}for(var re,ge=null,te=null,ae=0,he=w.length;he--;)ae+=w[he].unit.byteLength;for(var ce=0,Ae=w.length;ce<Ae;ce++){var _e=w[ce],De=_e.unit,Ce=_e.pts;if(te!==null)O[ce-1].duration=Math.round((Ce-te)/s);else{if(E&&a.isAAC&&(Ce=x),ge=Ce,!(ae>0))return;ae+=P;try{re=new Uint8Array(ae)}catch{return void this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ae,reason:"fail allocating audio mdat "+ae})}C||(new DataView(re.buffer).setUint32(0,ae),re.set(A.default.types.mdat,4))}re.set(De,P);var be=De.byteLength;P+=be,O.push(new i(!0,f,be,0)),te=Ce}var me=O.length;if(me){var Ye=O[O.length-1];this.nextAudioPts=x=te+s*Ye.duration;var Ie=C?new Uint8Array(0):A.default.moof(a.sequenceNumber++,ge/s,y({},a,{samples:O}));a.samples=[];var Me=ge/r,ze=x/r,Ke={data1:Ie,data2:re,startPTS:Me,endPTS:ze,startDTS:Me,endDTS:ze,type:"audio",hasAudio:!0,hasVideo:!1,nb:me};return this.isAudioContiguous=!0,console.assert(re.length,"MDAT length must not be zero"),Ke}},u.remuxEmptyAudio=function(a,c,E,g){var v=a.inputTimeScale,r=v/(a.samplerate?a.samplerate:v),s=this.nextAudioPts,f=(s!==null?s:g.startDTS*v)+this._initDTS,S=g.endDTS*v+this._initDTS,L=1024*r,C=Math.ceil((S-f)/L),O=T.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),O){for(var w=[],P=0;P<C;P++){var x=f+P*L;w.push({unit:O,pts:x,dts:x})}return a.samples=w,this.remuxAudio(a,c,E,!1)}D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},u.remuxID3=function(a,c){var E=a.samples.length;if(E){for(var g=a.inputTimeScale,v=this._initPTS,r=this._initDTS,s=0;s<E;s++){var f=a.samples[s];f.pts=e(f.pts-v,c*g)/g,f.dts=e(f.dts-r,c*g)/g}var S=a.samples;return a.samples=[],{samples:S}}},u.remuxText=function(a,c){var E=a.samples.length;if(E){for(var g=a.inputTimeScale,v=this._initPTS,r=0;r<E;r++){var s=a.samples[r];s.pts=e(s.pts-v,c*g)/g}a.samples.sort(function(S,L){return S.pts-L.pts});var f=a.samples;return a.samples=[],{samples:f}}},n}();function e(n,u){var a;if(u===null)return n;for(a=u<n?-8589934592:8589934592;Math.abs(n-u)>4294967296;)n+=a;return n}var i=function(n,u,a,c){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=u,this.size=a,this.cts=c,this.flags=new t(n)},t=function(n){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=n?2:1,this.isNonSync=n?0:1}},"./src/remux/passthrough-remuxer.ts":function(F,R,h){h.r(R);var _=h("./src/polyfills/number.ts"),T=h("./src/utils/mp4-tools.ts"),A=h("./src/loader/fragment.ts"),k=h("./src/utils/logger.ts"),I=function(){function b(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var y=b.prototype;return y.destroy=function(){},y.resetTimeStamp=function(d){this.initPTS=d,this.lastEndDTS=null},y.resetNextTimestamp=function(){this.lastEndDTS=null},y.resetInitSegment=function(d,p,m){this.audioCodec=p,this.videoCodec=m,this.generateInitSegment(d),this.emitInitSegment=!0},y.generateInitSegment=function(d){var p=this.audioCodec,m=this.videoCodec;if(!d||!d.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var l=this.initData=Object(T.parseInitSegment)(d);p||(p=o(l.audio,A.ElementaryStreamTypes.AUDIO)),m||(m=o(l.video,A.ElementaryStreamTypes.VIDEO));var e={};l.audio&&l.video?e.audiovideo={container:"video/mp4",codec:p+","+m,initSegment:d,id:"main"}:l.audio?e.audio={container:"audio/mp4",codec:p,initSegment:d,id:"audio"}:l.video?e.video={container:"video/mp4",codec:m,initSegment:d,id:"main"}:k.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},y.remux=function(d,p,m,l,e){var i=this.initPTS,t=this.lastEndDTS,n={audio:void 0,video:void 0,text:l,id3:m,initSegment:void 0};Object(_.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var u=p.samples;if(!u||!u.length)return n;var a={initPTS:void 0,timescale:1},c=this.initData;if(c&&c.length||(this.generateInitSegment(u),c=this.initData),!c||!c.length)return k.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),n;this.emitInitSegment&&(a.tracks=this.initTracks,this.emitInitSegment=!1),Object(_.isFiniteNumber)(i)||(this.initPTS=a.initPTS=i=D(c,u,t));var E=Object(T.getDuration)(u,c),g=t,v=E+g;Object(T.offsetStartDTS)(c,u,i),E>0?this.lastEndDTS=v:(k.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!c.audio,s=!!c.video,f="";r&&(f+="audio"),s&&(f+="video");var S={data1:u,startPTS:g,startDTS:g,endPTS:v,endDTS:v,type:f,hasAudio:r,hasVideo:s,nb:1,dropped:0};return n.audio=S.type==="audio"?S:void 0,n.video=S.type!=="audio"?S:void 0,n.text=l,n.id3=m,n.initSegment=a,n},b}(),D=function(b,y,d){return Object(T.getStartDTS)(b,y)-d};function o(b,y){var d=b==null?void 0:b.codec;return d&&d.length>4?d:d==="hvc1"?"hvc1.1.c.L120.90":d==="av01"?"av01.0.04M.08":d==="avc1"||y===A.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}R.default=I},"./src/task-loop.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return _});var _=function(){function T(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var A=T.prototype;return A.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},A.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},A.onHandlerDestroyed=function(){},A.hasInterval=function(){return!!this._tickInterval},A.hasNextTick=function(){return!!this._tickTimer},A.setInterval=function(k){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,k),!0)},A.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},A.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},A.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},A.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},A.doTick=function(){},T}()},"./src/types/level.ts":function(F,R,h){function _(o,b){for(var y=0;y<b.length;y++){var d=b[y];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(o,d.key,d)}}var T,A;function k(o,b){var y=o.canSkipUntil,d=o.canSkipDateRanges,p=o.endSN;return y&&(b!==void 0?b-p:0)<y?d?T.v2:T.Yes:T.No}h.r(R),h.d(R,"HlsSkip",function(){return T}),h.d(R,"getSkipValue",function(){return k}),h.d(R,"HlsUrlParameters",function(){return I}),h.d(R,"Level",function(){return D}),(A=T||(T={})).No="",A.Yes="YES",A.v2="v2";var I=function(){function o(b,y,d){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=b,this.part=y,this.skip=d}return o.prototype.addDirectives=function(b){var y=new self.URL(b);return this.msn!==void 0&&y.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&y.searchParams.set("_HLS_part",this.part.toString()),this.skip&&y.searchParams.set("_HLS_skip",this.skip),y.toString()},o}(),D=function(){function o(d){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[d.url],this.attrs=d.attrs,this.bitrate=d.bitrate,d.details&&(this.details=d.details),this.id=d.id||0,this.name=d.name,this.width=d.width||0,this.height=d.height||0,this.audioCodec=d.audioCodec,this.videoCodec=d.videoCodec,this.unknownCodecs=d.unknownCodecs,this.codecSet=[d.videoCodec,d.audioCodec].filter(function(p){return p}).join(",").replace(/\.[^.,]+/g,"")}var b,y;return b=o,(y=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(d){var p=d%this.url.length;this._urlId!==p&&(this.details=void 0,this._urlId=p)}}])&&_(b.prototype,y),o}()},"./src/types/loader.ts":function(F,R,h){var _,T,A,k;h.r(R),h.d(R,"PlaylistContextType",function(){return _}),h.d(R,"PlaylistLevelType",function(){return A}),(T=_||(_={})).MANIFEST="manifest",T.LEVEL="level",T.AUDIO_TRACK="audioTrack",T.SUBTITLE_TRACK="subtitleTrack",(k=A||(A={})).MAIN="main",k.AUDIO="audio",k.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(F,R,h){h.r(R),h.d(R,"ChunkMetadata",function(){return _});var _=function(T,A,k,I,D,o){I===void 0&&(I=0),D===void 0&&(D=-1),o===void 0&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=T,this.sn=A,this.id=k,this.size=I,this.part=D,this.partial=o}},"./src/utils/attr-list.ts":function(F,R,h){h.r(R),h.d(R,"AttrList",function(){return A});var _=/^(\d+)x(\d+)$/,T=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function k(D){for(var o in typeof D=="string"&&(D=k.parseAttrList(D)),D)D.hasOwnProperty(o)&&(this[o]=D[o])}var I=k.prototype;return I.decimalInteger=function(D){var o=parseInt(this[D],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},I.hexadecimalInteger=function(D){if(this[D]){var o=(this[D]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var b=new Uint8Array(o.length/2),y=0;y<o.length/2;y++)b[y]=parseInt(o.slice(2*y,2*y+2),16);return b}return null},I.hexadecimalIntegerAsNumber=function(D){var o=parseInt(this[D],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},I.decimalFloatingPoint=function(D){return parseFloat(this[D])},I.optionalFloat=function(D,o){var b=this[D];return b?parseFloat(b):o},I.enumeratedString=function(D){return this[D]},I.bool=function(D){return this[D]==="YES"},I.decimalResolution=function(D){var o=_.exec(this[D]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},k.parseAttrList=function(D){var o,b={};for(T.lastIndex=0;(o=T.exec(D))!==null;){var y=o[2];y.indexOf('"')===0&&y.lastIndexOf('"')===y.length-1&&(y=y.slice(1,-1)),b[o[1]]=y}return b},k}()},"./src/utils/binary-search.ts":function(F,R,h){h.r(R),R.default={search:function(_,T){for(var A=0,k=_.length-1,I=null,D=null;A<=k;){var o=T(D=_[I=(A+k)/2|0]);if(o>0)A=I+1;else{if(!(o<0))return D;k=I-1}}return null}}},"./src/utils/buffer-helper.ts":function(F,R,h){h.r(R),h.d(R,"BufferHelper",function(){return A});var _=h("./src/utils/logger.ts"),T={length:0,start:function(){return 0},end:function(){return 0}},A=function(){function k(){}return k.isBuffered=function(I,D){try{if(I){for(var o=k.getBuffered(I),b=0;b<o.length;b++)if(D>=o.start(b)&&D<=o.end(b))return!0}}catch{}return!1},k.bufferInfo=function(I,D,o){try{if(I){var b,y=k.getBuffered(I),d=[];for(b=0;b<y.length;b++)d.push({start:y.start(b),end:y.end(b)});return this.bufferedInfo(d,D,o)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},k.bufferedInfo=function(I,D,o){D=Math.max(0,D),I.sort(function(a,c){var E=a.start-c.start;return E||c.end-a.end});var b=[];if(o)for(var y=0;y<I.length;y++){var d=b.length;if(d){var p=b[d-1].end;I[y].start-p<o?I[y].end>p&&(b[d-1].end=I[y].end):b.push(I[y])}else b.push(I[y])}else b=I;for(var m,l=0,e=D,i=D,t=0;t<b.length;t++){var n=b[t].start,u=b[t].end;if(D+o>=n&&D<u)e=n,l=(i=u)-D;else if(D+o<n){m=n;break}}return{len:l,start:e||0,end:i||0,nextStart:m}},k.getBuffered=function(I){try{return I.buffered}catch(D){return _.logger.log("failed to get media.buffered",D),T}},k}()},"./src/utils/cea-608-parser.ts":function(F,R,h){h.r(R),h.d(R,"Row",function(){return n}),h.d(R,"CaptionScreen",function(){return u});var _,T,A=h("./src/utils/logger.ts"),k={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},I=function(v){var r=v;return k.hasOwnProperty(v)&&(r=k[v]),String.fromCharCode(r)},D=15,o=100,b={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},y={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},m=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(T=_||(_={}))[T.ERROR=0]="ERROR",T[T.TEXT=1]="TEXT",T[T.WARNING=2]="WARNING",T[T.INFO=2]="INFO",T[T.DEBUG=3]="DEBUG",T[T.DATA=3]="DATA";var l=function(){function v(){this.time=null,this.verboseLevel=_.ERROR}return v.prototype.log=function(r,s){this.verboseLevel>=r&&A.logger.log(this.time+" ["+r+"] "+s)},v}(),e=function(v){for(var r=[],s=0;s<v.length;s++)r.push(v[s].toString(16));return r},i=function(){function v(s,f,S,L,C){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=s||"white",this.underline=f||!1,this.italics=S||!1,this.background=L||"black",this.flash=C||!1}var r=v.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(s){for(var f=["foreground","underline","italics","background","flash"],S=0;S<f.length;S++){var L=f[S];s.hasOwnProperty(L)&&(this[L]=s[L])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(s){return this.foreground===s.foreground&&this.underline===s.underline&&this.italics===s.italics&&this.background===s.background&&this.flash===s.flash},r.copy=function(s){this.foreground=s.foreground,this.underline=s.underline,this.italics=s.italics,this.background=s.background,this.flash=s.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),t=function(){function v(s,f,S,L,C,O){this.uchar=void 0,this.penState=void 0,this.uchar=s||" ",this.penState=new i(f,S,L,C,O)}var r=v.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(s,f){this.uchar=s,this.penState.copy(f)},r.setPenState=function(s){this.penState.copy(s)},r.equals=function(s){return this.uchar===s.uchar&&this.penState.equals(s.penState)},r.copy=function(s){this.uchar=s.uchar,this.penState.copy(s.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),n=function(){function v(s){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var f=0;f<o;f++)this.chars.push(new t);this.logger=s,this.pos=0,this.currPenState=new i}var r=v.prototype;return r.equals=function(s){for(var f=!0,S=0;S<o;S++)if(!this.chars[S].equals(s.chars[S])){f=!1;break}return f},r.copy=function(s){for(var f=0;f<o;f++)this.chars[f].copy(s.chars[f])},r.isEmpty=function(){for(var s=!0,f=0;f<o;f++)if(!this.chars[f].isEmpty()){s=!1;break}return s},r.setCursor=function(s){this.pos!==s&&(this.pos=s),this.pos<0?(this.logger.log(_.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(_.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},r.moveCursor=function(s){var f=this.pos+s;if(s>1)for(var S=this.pos+1;S<f+1;S++)this.chars[S].setPenState(this.currPenState);this.setCursor(f)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(s){s>=144&&this.backSpace();var f=I(s);this.pos>=o?this.logger.log(_.ERROR,"Cannot insert "+s.toString(16)+" ("+f+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(f,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(s){var f;for(f=s;f<o;f++)this.chars[f].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var s=[],f=!0,S=0;S<o;S++){var L=this.chars[S].uchar;L!==" "&&(f=!1),s.push(L)}return f?"":s.join("")},r.setPenStyles=function(s){this.currPenState.setStyles(s),this.chars[this.pos].setPenState(this.currPenState)},v}(),u=function(){function v(s){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var f=0;f<D;f++)this.rows.push(new n(s));this.logger=s,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=v.prototype;return r.reset=function(){for(var s=0;s<D;s++)this.rows[s].clear();this.currRow=14},r.equals=function(s){for(var f=!0,S=0;S<D;S++)if(!this.rows[S].equals(s.rows[S])){f=!1;break}return f},r.copy=function(s){for(var f=0;f<D;f++)this.rows[f].copy(s.rows[f])},r.isEmpty=function(){for(var s=!0,f=0;f<D;f++)if(!this.rows[f].isEmpty()){s=!1;break}return s},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(s){this.rows[this.currRow].insertChar(s)},r.setPen=function(s){this.rows[this.currRow].setPenStyles(s)},r.moveCursor=function(s){this.rows[this.currRow].moveCursor(s)},r.setCursor=function(s){this.logger.log(_.INFO,"setCursor: "+s),this.rows[this.currRow].setCursor(s)},r.setPAC=function(s){this.logger.log(_.INFO,"pacData = "+JSON.stringify(s));var f=s.row-1;if(this.nrRollUpRows&&f<this.nrRollUpRows-1&&(f=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==f){for(var S=0;S<D;S++)this.rows[S].clear();var L=this.currRow+1-this.nrRollUpRows,C=this.lastOutputScreen;if(C){var O=C.rows[L].cueStartTime,w=this.logger.time;if(O&&w!==null&&O<w)for(var P=0;P<this.nrRollUpRows;P++)this.rows[f-this.nrRollUpRows+P+1].copy(C.rows[L+P])}}this.currRow=f;var x=this.rows[this.currRow];if(s.indent!==null){var M=s.indent,N=Math.max(M-1,0);x.setCursor(s.indent),s.color=x.chars[N].penState.foreground}var U={foreground:s.color,underline:s.underline,italics:s.italics,background:"black",flash:!1};this.setPen(U)},r.setBkgData=function(s){this.logger.log(_.INFO,"bkgData = "+JSON.stringify(s)),this.backSpace(),this.setPen(s),this.insertChar(32)},r.setRollUpRows=function(s){this.nrRollUpRows=s},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(_.TEXT,this.getDisplayText());var s=this.currRow+1-this.nrRollUpRows,f=this.rows.splice(s,1)[0];f.clear(),this.rows.splice(this.currRow,0,f),this.logger.log(_.INFO,"Rolling up")}else this.logger.log(_.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(s){s=s||!1;for(var f=[],S="",L=-1,C=0;C<D;C++){var O=this.rows[C].getTextString();O&&(L=C+1,s?f.push("Row "+L+": '"+O+"'"):f.push(O.trim()))}return f.length>0&&(S=s?"["+f.join(" | ")+"]":f.join(`
`)),S},r.getTextAndFormat=function(){return this.rows},v}(),a=function(){function v(s,f,S){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=s,this.outputFilter=f,this.mode=null,this.verbose=0,this.displayedMemory=new u(S),this.nonDisplayedMemory=new u(S),this.lastOutputScreen=new u(S),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=S}var r=v.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(s){this.outputFilter=s},r.setPAC=function(s){this.writeScreen.setPAC(s)},r.setBkgData=function(s){this.writeScreen.setBkgData(s)},r.setMode=function(s){s!==this.mode&&(this.mode=s,this.logger.log(_.INFO,"MODE="+s),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=s)},r.insertChars=function(s){for(var f=0;f<s.length;f++)this.writeScreen.insertChar(s[f]);var S=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(_.INFO,S+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(_.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(_.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(_.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(_.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(s){this.logger.log(_.INFO,"RU("+s+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(s)},r.ccFON=function(){this.logger.log(_.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(_.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(_.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(_.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(_.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(_.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(_.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(_.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var s=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=s,this.writeScreen=this.nonDisplayedMemory,this.logger.log(_.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(s){this.logger.log(_.INFO,"TO("+s+") - Tab Offset"),this.writeScreen.moveCursor(s)},r.ccMIDROW=function(s){var f={flash:!1};if(f.underline=s%2==1,f.italics=s>=46,f.italics)f.foreground="white";else{var S=Math.floor(s/2)-16;f.foreground=["white","green","blue","cyan","red","yellow","magenta"][S]}this.logger.log(_.INFO,"MIDROW: "+JSON.stringify(f)),this.writeScreen.setPen(f)},r.outputDataUpdate=function(s){s===void 0&&(s=!1);var f=this.logger.time;f!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,f,this.lastOutputScreen),s&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:f):this.cueStartTime=f,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(s){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,s,this.displayedMemory),this.cueStartTime=s))},v}(),c=function(){function v(s,f,S){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var L=new l;this.channels=[null,new a(s,f,L),new a(s+1,S,L)],this.cmdHistory={a:null,b:null},this.logger=L}var r=v.prototype;return r.getHandler=function(s){return this.channels[s].getHandler()},r.setHandler=function(s,f){this.channels[s].setHandler(f)},r.addData=function(s,f){var S,L,C,O=!1;this.logger.time=s;for(var w=0;w<f.length;w+=2)if(L=127&f[w],C=127&f[w+1],L!==0||C!==0){if(this.logger.log(_.DATA,"["+e([f[w],f[w+1]])+"] -> ("+e([L,C])+")"),(S=this.parseCmd(L,C))||(S=this.parseMidrow(L,C)),S||(S=this.parsePAC(L,C)),S||(S=this.parseBackgroundAttributes(L,C)),!S&&(O=this.parseChars(L,C))){var P=this.currentChannel;P&&P>0?this.channels[P].insertChars(O):this.logger.log(_.WARNING,"No channel found yet. TEXT-MODE?")}S||O||this.logger.log(_.WARNING,"Couldn't parse cleaned data "+e([L,C])+" orig: "+e([f[w],f[w+1]]))}},r.parseCmd=function(s,f){var S=this.cmdHistory;if(!((s===20||s===28||s===21||s===29)&&f>=32&&f<=47||(s===23||s===31)&&f>=33&&f<=35))return!1;if(g(s,f,S))return E(null,null,S),this.logger.log(_.DEBUG,"Repeated command ("+e([s,f])+") is dropped"),!0;var L=s===20||s===21||s===23?1:2,C=this.channels[L];return s===20||s===21||s===28||s===29?f===32?C.ccRCL():f===33?C.ccBS():f===34?C.ccAOF():f===35?C.ccAON():f===36?C.ccDER():f===37?C.ccRU(2):f===38?C.ccRU(3):f===39?C.ccRU(4):f===40?C.ccFON():f===41?C.ccRDC():f===42?C.ccTR():f===43?C.ccRTD():f===44?C.ccEDM():f===45?C.ccCR():f===46?C.ccENM():f===47&&C.ccEOC():C.ccTO(f-32),E(s,f,S),this.currentChannel=L,!0},r.parseMidrow=function(s,f){var S=0;if((s===17||s===25)&&f>=32&&f<=47){if((S=s===17?1:2)!==this.currentChannel)return this.logger.log(_.ERROR,"Mismatch channel in midrow parsing"),!1;var L=this.channels[S];return!!L&&(L.ccMIDROW(f),this.logger.log(_.DEBUG,"MIDROW ("+e([s,f])+")"),!0)}return!1},r.parsePAC=function(s,f){var S,L=this.cmdHistory;if(!((s>=17&&s<=23||s>=25&&s<=31)&&f>=64&&f<=127||(s===16||s===24)&&f>=64&&f<=95))return!1;if(g(s,f,L))return E(null,null,L),!0;var C=s<=23?1:2;S=f>=64&&f<=95?C===1?b[s]:d[s]:C===1?y[s]:p[s];var O=this.channels[C];return!!O&&(O.setPAC(this.interpretPAC(S,f)),E(s,f,L),this.currentChannel=C,!0)},r.interpretPAC=function(s,f){var S,L={color:null,italics:!1,indent:null,underline:!1,row:s};return S=f>95?f-96:f-64,L.underline=(1&S)==1,S<=13?L.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(S/2)]:S<=15?(L.italics=!0,L.color="white"):L.indent=4*Math.floor((S-16)/2),L},r.parseChars=function(s,f){var S,L,C=null,O=null;if(s>=25?(S=2,O=s-8):(S=1,O=s),O>=17&&O<=19?(L=O===17?f+80:O===18?f+112:f+144,this.logger.log(_.INFO,"Special char '"+I(L)+"' in channel "+S),C=[L]):s>=32&&s<=127&&(C=f===0?[s]:[s,f]),C){var w=e(C);this.logger.log(_.DEBUG,"Char codes =  "+w.join(",")),E(s,f,this.cmdHistory)}return C},r.parseBackgroundAttributes=function(s,f){var S;if(!((s===16||s===24)&&f>=32&&f<=47||(s===23||s===31)&&f>=45&&f<=47))return!1;var L={};s===16||s===24?(S=Math.floor((f-32)/2),L.background=m[S],f%2==1&&(L.background=L.background+"_semi")):f===45?L.background="transparent":(L.foreground="black",f===47&&(L.underline=!0));var C=s<=23?1:2;return this.channels[C].setBkgData(L),E(s,f,this.cmdHistory),!0},r.reset=function(){for(var s=0;s<Object.keys(this.channels).length;s++){var f=this.channels[s];f&&f.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(s){for(var f=0;f<this.channels.length;f++){var S=this.channels[f];S&&S.cueSplitAtTime(s)}},v}();function E(v,r,s){s.a=v,s.b=r}function g(v,r,s){return s.a===v&&s.b===r}R.default=c},"./src/utils/codecs.ts":function(F,R,h){h.r(R),h.d(R,"isCodecType",function(){return T}),h.d(R,"isCodecSupportedInMp4",function(){return A});var _={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function T(k,I){var D=_[I];return!!D&&D[k.slice(0,4)]===!0}function A(k,I){return MediaSource.isTypeSupported((I||"video")+'/mp4;codecs="'+k+'"')}},"./src/utils/cues.ts":function(F,R,h){h.r(R);var _=h("./src/utils/vttparser.ts"),T=h("./src/utils/webvtt-parser.ts"),A=h("./src/utils/texttrack-utils.ts"),k=/\s/,I={newCue:function(D,o,b,y){for(var d,p,m,l,e,i=[],t=self.VTTCue||self.TextTrackCue,n=0;n<y.rows.length;n++)if(m=!0,l=0,e="",!(d=y.rows[n]).isEmpty()){for(var u=0;u<d.chars.length;u++)k.test(d.chars[u].uchar)&&m?l++:(e+=d.chars[u].uchar,m=!1);d.cueStartTime=o,o===b&&(b+=1e-4),l>=16?l--:l++;var a=Object(_.fixLineBreaks)(e.trim()),c=Object(T.generateCueId)(o,b,a);D&&D.cues&&D.cues.getCueById(c)||((p=new t(o,b,a)).id=c,p.line=n+1,p.align="left",p.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(p))}return D&&i.length&&(i.sort(function(E,g){return E.line==="auto"||g.line==="auto"?0:E.line>8&&g.line>8?g.line-E.line:E.line-g.line}),i.forEach(function(E){return Object(A.addCueToTrack)(D,E)})),i}};R.default=I},"./src/utils/discontinuities.ts":function(F,R,h){h.r(R),h.d(R,"findFirstFragWithCC",function(){return k}),h.d(R,"shouldAlignOnDiscontinuities",function(){return I}),h.d(R,"findDiscontinuousReferenceFrag",function(){return D}),h.d(R,"adjustSlidingStart",function(){return b}),h.d(R,"alignStream",function(){return y}),h.d(R,"alignPDT",function(){return d});var _=h("./src/polyfills/number.ts"),T=h("./src/utils/logger.ts"),A=h("./src/controller/level-helper.ts");function k(p,m){for(var l=null,e=0,i=p.length;e<i;e++){var t=p[e];if(t&&t.cc===m){l=t;break}}return l}function I(p,m,l){return!(!m.details||!(l.endCC>l.startCC||p&&p.cc<l.startCC))}function D(p,m){var l=p.fragments,e=m.fragments;if(e.length&&l.length){var i=k(l,e[0].cc);if(i&&(!i||i.startPTS))return i;T.logger.log("No frag in previous level to align on")}else T.logger.log("No fragments to align")}function o(p,m){if(p){var l=p.start+m;p.start=p.startPTS=l,p.endPTS=l+p.duration}}function b(p,m){for(var l=m.fragments,e=0,i=l.length;e<i;e++)o(l[e],p);m.fragmentHint&&o(m.fragmentHint,p),m.alignedSliding=!0}function y(p,m,l){m&&(function(e,i,t){if(I(e,t,i)){var n=D(t.details,i);n&&Object(_.isFiniteNumber)(n.start)&&(T.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),b(n.start,i))}}(p,l,m),!l.alignedSliding&&m.details&&d(l,m.details),l.alignedSliding||!m.details||l.skippedSegments||Object(A.adjustSliding)(m.details,l))}function d(p,m){if(m.fragments.length&&p.hasProgramDateTime&&m.hasProgramDateTime){var l=m.fragments[0].programDateTime,e=p.fragments[0].programDateTime,i=(e-l)/1e3+m.fragments[0].start;i&&Object(_.isFiniteNumber)(i)&&(T.logger.log("Adjusting PTS using programDateTime delta "+(e-l)+"ms, sliding:"+i.toFixed(3)+" "+p.url+" "),b(i,p))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(F,R,h){h.r(R);var _=h("./src/utils/ewma.ts"),T=function(){function A(I,D,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _.default(I),this.fast_=new _.default(D)}var k=A.prototype;return k.update=function(I,D){var o=this.slow_,b=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new _.default(I,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new _.default(D,b.getEstimate(),b.getTotalWeight()))},k.sample=function(I,D){var o=(I=Math.max(I,this.minDelayMs_))/1e3,b=8*D/o;this.fast_.sample(o,b),this.slow_.sample(o,b)},k.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},k.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},k.destroy=function(){},A}();R.default=T},"./src/utils/ewma.ts":function(F,R,h){h.r(R);var _=function(){function T(k,I,D){I===void 0&&(I=0),D===void 0&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=k,this.alpha_=k?Math.exp(Math.log(.5)/k):0,this.estimate_=I,this.totalWeight_=D}var A=T.prototype;return A.sample=function(k,I){var D=Math.pow(this.alpha_,k);this.estimate_=I*(1-D)+D*this.estimate_,this.totalWeight_+=k},A.getTotalWeight=function(){return this.totalWeight_},A.getEstimate=function(){if(this.alpha_){var k=1-Math.pow(this.alpha_,this.totalWeight_);if(k)return this.estimate_/k}return this.estimate_},T}();R.default=_},"./src/utils/fetch-loader.ts":function(F,R,h){h.r(R),h.d(R,"fetchSupported",function(){return y});var _=h("./src/polyfills/number.ts"),T=h("./src/loader/load-stats.ts"),A=h("./src/demux/chunk-cache.ts");function k(l){var e=typeof Map=="function"?new Map:void 0;return(k=function(i){if(i===null||(t=i,Function.toString.call(t).indexOf("[native code]")===-1))return i;var t;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,n)}function n(){return I(i,arguments,b(this).constructor)}return n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,i)})(l)}function I(l,e,i){return(I=D()?Reflect.construct:function(t,n,u){var a=[null];a.push.apply(a,n);var c=new(Function.bind.apply(t,a));return u&&o(c,u.prototype),c}).apply(null,arguments)}function D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(l,e){return(o=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(l,e)}function b(l){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(l)}function y(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var d=function(){function l(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||p,this.controller=new self.AbortController,this.stats=new T.LoadStats}var e=l.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var i=this.response;i&&i.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(i,t,n){var u=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var c=function(r,s){var f={method:"GET",mode:"cors",credentials:"same-origin",signal:s};return r.rangeEnd&&(f.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),f}(i,this.controller.signal),E=n.onProgress,g=i.responseType==="arraybuffer",v=g?"byteLength":"length";this.context=i,this.config=t,this.callbacks=n,this.request=this.fetchSetup(i,c),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){u.abortInternal(),n.onTimeout(a,i,u.response)},t.timeout),self.fetch(this.request).then(function(r){if(u.response=u.loader=r,!r.ok){var s=r.status,f=r.statusText;throw new m(f||"fetch, bad network response",s,r)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(r.headers.get("Content-Length")||"0"),E&&Object(_.isFiniteNumber)(t.highWaterMark)?u.loadProgressively(r,a,i,t.highWaterMark,E):g?r.arrayBuffer():r.text()}).then(function(r){var s=u.response;self.clearTimeout(u.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=r[v];var f={url:s.url,data:r};E&&!Object(_.isFiniteNumber)(t.highWaterMark)&&E(a,i,r,s),n.onSuccess(f,a,i,s)}).catch(function(r){if(self.clearTimeout(u.requestTimeout),!a.aborted){var s=r.code||0;n.onError({code:s,text:r.message},i,r.details)}})},e.getCacheAge=function(){var i=null;if(this.response){var t=this.response.headers.get("age");i=t?parseFloat(t):null}return i},e.loadProgressively=function(i,t,n,u,a){u===void 0&&(u=0);var c=new A.default,E=i.body.getReader();return function g(){return E.read().then(function(v){if(v.done)return c.dataLength&&a(t,n,c.flush(),i),Promise.resolve(new ArrayBuffer(0));var r=v.value,s=r.length;return t.loaded+=s,s<u||c.dataLength?(c.push(r),c.dataLength>=u&&a(t,n,c.flush(),i)):a(t,n,r,i),g()}).catch(function(){return Promise.reject()})}()},l}();function p(l,e){return new self.Request(l.url,e)}var m=function(l){var e,i;function t(n,u,a){var c;return(c=l.call(this,n)||this).code=void 0,c.details=void 0,c.code=u,c.details=a,c}return i=l,(e=t).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i),t}(k(Error));R.default=d},"./src/utils/imsc1-ttml-parser.ts":function(F,R,h){h.r(R),h.d(R,"IMSC1_CODEC",function(){return b}),h.d(R,"parseIMSC1",function(){return m});var _=h("./src/utils/mp4-tools.ts"),T=h("./src/utils/vttparser.ts"),A=h("./src/utils/vttcue.ts"),k=h("./src/demux/id3.ts"),I=h("./src/utils/timescale-conversion.ts"),D=h("./src/utils/webvtt-parser.ts");function o(){return(o=Object.assign||function(a){for(var c=1;c<arguments.length;c++){var E=arguments[c];for(var g in E)Object.prototype.hasOwnProperty.call(E,g)&&(a[g]=E[g])}return a}).apply(this,arguments)}var b="stpp.ttml.im1t",y=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,d=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(a,c,E,g,v){var r=Object(_.findBox)(new Uint8Array(a),["mdat"]);if(r.length!==0){var s=r[0],f=Object(k.utf8ArrayToStr)(new Uint8Array(a,s.start,s.end-s.start)),S=Object(I.toTimescaleFromScale)(c,1,E);try{g(function(L,C){var O=new DOMParser().parseFromString(L,"text/xml").getElementsByTagName("tt")[0];if(!O)throw new Error("Invalid ttml");var w={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},P=Object.keys(w).reduce(function(G,V){return G[V]=O.getAttribute("ttp:"+V)||w[V],G},{}),x=O.getAttribute("xml:space")!=="preserve",M=e(l(O,"styling","style")),N=e(l(O,"layout","region")),U=l(O,"body","[begin]");return[].map.call(U,function(G){var V=i(G,x);if(!V||!G.hasAttribute("begin"))return null;var W=u(G.getAttribute("begin"),P),Y=u(G.getAttribute("dur"),P),X=u(G.getAttribute("end"),P);if(W===null)throw n(G);if(X===null){if(Y===null)throw n(G);X=W+Y}var z=new A.default(W-C,X-C,V);z.id=Object(D.generateCueId)(z.startTime,z.endTime,z.text);var Z=N[G.getAttribute("region")],ne=M[G.getAttribute("style")];z.position=10,z.size=80;var se=function(ge,te){var ae="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(he,ce){var Ae=t(te,ae,ce)||t(ge,ae,ce);return Ae&&(he[ce]=Ae),he},{})}(Z,ne),de=se.textAlign;if(de){var re=p[de];re&&(z.lineAlign=re),z.align=de}return o(z,se),z}).filter(function(G){return G!==null})}(f,S))}catch(L){v(L)}}else v(new Error("Could not parse IMSC1 mdat"))}function l(a,c,E){var g=a.getElementsByTagName(c)[0];return g?[].slice.call(g.querySelectorAll(E)):[]}function e(a){return a.reduce(function(c,E){var g=E.getAttribute("xml:id");return g&&(c[g]=E),c},{})}function i(a,c){return[].slice.call(a.childNodes).reduce(function(E,g,v){var r;return g.nodeName==="br"&&v?E+`
`:(r=g.childNodes)!==null&&r!==void 0&&r.length?i(g,c):c?E+g.textContent.trim().replace(/\s+/g," "):E+g.textContent},"")}function t(a,c,E){return a.hasAttributeNS(c,E)?a.getAttributeNS(c,E):null}function n(a){return new Error("Could not parse ttml timestamp "+a)}function u(a,c){if(!a)return null;var E=Object(T.parseTimeStamp)(a);return E===null&&(y.test(a)?E=function(g,v){var r=y.exec(g),s=(0|r[4])+(0|r[5])/v.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+s/v.frameRate}(a,c):d.test(a)&&(E=function(g,v){var r=d.exec(g),s=Number(r[1]);switch(r[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/v.frameRate;case"t":return s/v.tickRate}return s}(a,c))),E}},"./src/utils/logger.ts":function(F,R,h){h.r(R),h.d(R,"enableLogs",function(){return I}),h.d(R,"logger",function(){return D});var _=function(){},T={trace:_,debug:_,log:_,warn:_,info:_,error:_},A=T;function k(o){var b=self.console[o];return b?b.bind(self.console,"["+o+"] >"):_}function I(o){if(self.console&&o===!0||typeof o=="object"){(function(b){for(var y=arguments.length,d=new Array(y>1?y-1:0),p=1;p<y;p++)d[p-1]=arguments[p];d.forEach(function(m){A[m]=b[m]?b[m].bind(b):k(m)})})(o,"debug","log","info","warn","error");try{A.log()}catch{A=T}}else A=T}var D=T},"./src/utils/mediakeys-helper.ts":function(F,R,h){var _,T;h.r(R),h.d(R,"KeySystems",function(){return _}),h.d(R,"requestMediaKeySystemAccess",function(){return A}),(T=_||(_={})).WIDEVINE="com.widevine.alpha",T.PLAYREADY="com.microsoft.playready";var A=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(F,R,h){function _(){return self.MediaSource||self.WebKitMediaSource}h.r(R),h.d(R,"getMediaSource",function(){return _})},"./src/utils/mp4-tools.ts":function(F,R,h){h.r(R),h.d(R,"bin2str",function(){return I}),h.d(R,"readUint16",function(){return D}),h.d(R,"readUint32",function(){return o}),h.d(R,"writeUint32",function(){return b}),h.d(R,"findBox",function(){return y}),h.d(R,"parseSegmentIndex",function(){return d}),h.d(R,"parseInitSegment",function(){return p}),h.d(R,"getStartDTS",function(){return m}),h.d(R,"getDuration",function(){return l}),h.d(R,"computeRawDurationFromSamples",function(){return e}),h.d(R,"offsetStartDTS",function(){return i}),h.d(R,"segmentValidRange",function(){return t}),h.d(R,"appendUint8Array",function(){return n});var _=h("./src/utils/typed-array.ts"),T=h("./src/loader/fragment.ts"),A=Math.pow(2,32)-1,k=[].push;function I(u){return String.fromCharCode.apply(null,u)}function D(u,a){"data"in u&&(a+=u.start,u=u.data);var c=u[a]<<8|u[a+1];return c<0?65536+c:c}function o(u,a){"data"in u&&(a+=u.start,u=u.data);var c=u[a]<<24|u[a+1]<<16|u[a+2]<<8|u[a+3];return c<0?4294967296+c:c}function b(u,a,c){"data"in u&&(a+=u.start,u=u.data),u[a]=c>>24,u[a+1]=c>>16&255,u[a+2]=c>>8&255,u[a+3]=255&c}function y(u,a){var c,E,g,v=[];if(!a.length)return v;"data"in u?(c=u.data,E=u.start,g=u.end):(E=0,g=(c=u).byteLength);for(var r=E;r<g;){var s=o(c,r),f=s>1?r+s:g;if(I(c.subarray(r+4,r+8))===a[0])if(a.length===1)v.push({data:c,start:r+8,end:f});else{var S=y({data:c,start:r+8,end:f},a.slice(1));S.length&&k.apply(v,S)}r=f}return v}function d(u){var a=y(u,["moov"])[0],c=a?a.end:null,E=y(u,["sidx"]);if(!E||!E[0])return null;var g=[],v=E[0],r=v.data[0],s=r===0?8:16,f=o(v,s);s+=4,s+=r===0?8:16,s+=2;var S=v.end+0,L=D(v,s);s+=2;for(var C=0;C<L;C++){var O=s,w=o(v,O);O+=4;var P=2147483647&w;if((2147483648&w)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var x=o(v,O);O+=4,g.push({referenceSize:P,subsegmentDuration:x,info:{duration:x/f,start:S,end:S+P-1}}),S+=P,s=O+=4}return{earliestPresentationTime:0,timescale:f,version:r,referencesCount:L,references:g,moovEndOffset:c}}function p(u){for(var a=[],c=y(u,["moov","trak"]),E=0;E<c.length;E++){var g=c[E],v=y(g,["tkhd"])[0];if(v){var r=v.data[v.start],s=r===0?12:20,f=o(v,s),S=y(g,["mdia","mdhd"])[0];if(S){var L=o(S,s=(r=S.data[S.start])===0?12:20),C=y(g,["mdia","hdlr"])[0];if(C){var O=I(C.data.subarray(C.start+8,C.start+12)),w={soun:T.ElementaryStreamTypes.AUDIO,vide:T.ElementaryStreamTypes.VIDEO}[O];if(w){var P=y(g,["mdia","minf","stbl","stsd"])[0],x=void 0;P&&(x=I(P.data.subarray(P.start+12,P.start+16))),a[f]={timescale:L,type:w},a[w]={timescale:L,id:f,codec:x}}}}}}return y(u,["moov","mvex","trex"]).forEach(function(M){var N=o(M,4),U=a[N];U&&(U.default={duration:o(M,12),flags:o(M,20)})}),a}function m(u,a){return y(a,["moof","traf"]).reduce(function(c,E){var g=y(E,["tfdt"])[0],v=g.data[g.start],r=y(E,["tfhd"]).reduce(function(s,f){var S=o(f,4),L=u[S];if(L){var C=o(g,4);v===1&&(C*=Math.pow(2,32),C+=o(g,8));var O=C/(L.timescale||9e4);if(isFinite(O)&&(s===null||O<s))return O}return s},null);return r!==null&&isFinite(r)&&(c===null||r<c)?r:c},null)||0}function l(u,a){for(var c=0,E=0,g=0,v=y(u,["moof","traf"]),r=0;r<v.length;r++){var s=v[r],f=y(s,["tfhd"])[0],S=a[o(f,4)];if(S){var L=S.default,C=o(f,0)|(L==null?void 0:L.flags),O=L==null?void 0:L.duration;8&C&&(O=o(f,2&C?12:8));for(var w=S.timescale||9e4,P=y(s,["trun"]),x=0;x<P.length;x++)c=O?O*o(P[x],4):e(P[x]),S.type===T.ElementaryStreamTypes.VIDEO?E+=c/w:S.type===T.ElementaryStreamTypes.AUDIO&&(g+=c/w)}}if(E===0&&g===0){var M=d(u);if(M!=null&&M.references)return M.references.reduce(function(N,U){return N+U.info.duration||0},0)}return E||g}function e(u){var a=o(u,0),c=8;1&a&&(c+=4),4&a&&(c+=4);for(var E=0,g=o(u,4),v=0;v<g;v++)256&a&&(E+=o(u,c),c+=4),512&a&&(c+=4),1024&a&&(c+=4),2048&a&&(c+=4);return E}function i(u,a,c){y(a,["moof","traf"]).forEach(function(E){y(E,["tfhd"]).forEach(function(g){var v=o(g,4),r=u[v];if(r){var s=r.timescale||9e4;y(E,["tfdt"]).forEach(function(f){var S=f.data[f.start],L=o(f,4);if(S===0)b(f,4,L-c*s);else{L*=Math.pow(2,32),L+=o(f,8),L-=c*s,L=Math.max(L,0);var C=Math.floor(L/(A+1)),O=Math.floor(L%(A+1));b(f,4,C),b(f,8,O)}})}})})}function t(u){var a={valid:null,remainder:null},c=y(u,["moof"]);if(!c)return a;if(c.length<2)return a.remainder=u,a;var E=c[c.length-1];return a.valid=Object(_.sliceUint8)(u,0,E.start-8),a.remainder=Object(_.sliceUint8)(u,E.start-8),a}function n(u,a){var c=new Uint8Array(u.length+a.length);return c.set(u),c.set(a,u.length),c}},"./src/utils/output-filter.ts":function(F,R,h){h.r(R),h.d(R,"default",function(){return _});var _=function(){function T(k,I){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=k,this.trackName=I}var A=T.prototype;return A.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},A.newCue=function(k,I,D){(this.startTime===null||this.startTime>k)&&(this.startTime=k),this.endTime=I,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},A.reset=function(){this.cueRanges=[]},T}()},"./src/utils/texttrack-utils.ts":function(F,R,h){h.r(R),h.d(R,"sendAddTrackEvent",function(){return T}),h.d(R,"addCueToTrack",function(){return A}),h.d(R,"clearCurrentCues",function(){return k}),h.d(R,"removeCuesInRange",function(){return I}),h.d(R,"getCuesInRange",function(){return D});var _=h("./src/utils/logger.ts");function T(o,b){var y;try{y=new Event("addtrack")}catch{(y=document.createEvent("Event")).initEvent("addtrack",!1,!1)}y.track=o,b.dispatchEvent(y)}function A(o,b){var y=o.mode;if(y==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(b.id))try{if(o.addCue(b),!o.cues.getCueById(b.id))throw new Error("addCue is failed for: "+b)}catch(p){_.logger.debug("[texttrack-utils]: "+p);var d=new self.TextTrackCue(b.startTime,b.endTime,b.text);d.id=b.id,o.addCue(d)}y==="disabled"&&(o.mode=y)}function k(o){var b=o.mode;if(b==="disabled"&&(o.mode="hidden"),o.cues)for(var y=o.cues.length;y--;)o.removeCue(o.cues[y]);b==="disabled"&&(o.mode=b)}function I(o,b,y){var d=o.mode;if(d==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var p=D(o.cues,b,y),m=0;m<p.length;m++)o.removeCue(p[m]);d==="disabled"&&(o.mode=d)}function D(o,b,y){var d=[],p=function(i,t){if(t<i[0].startTime)return 0;var n=i.length-1;if(t>i[n].endTime)return-1;for(var u=0,a=n;u<=a;){var c=Math.floor((a+u)/2);if(t<i[c].startTime)a=c-1;else{if(!(t>i[c].startTime&&u<n))return c;u=c+1}}return i[u].startTime-t<t-i[a].startTime?u:a}(o,b);if(p>-1)for(var m=p,l=o.length;m<l;m++){var e=o[m];if(e.startTime>=b&&e.endTime<=y)d.push(e);else if(e.startTime>y)return d}return d}},"./src/utils/time-ranges.ts":function(F,R,h){h.r(R),R.default={toString:function(_){for(var T="",A=_.length,k=0;k<A;k++)T+="["+_.start(k).toFixed(3)+","+_.end(k).toFixed(3)+"]";return T}}},"./src/utils/timescale-conversion.ts":function(F,R,h){function _(I,D,o,b){o===void 0&&(o=1),b===void 0&&(b=!1);var y=I*D*o;return b?Math.round(y):y}function T(I,D,o,b){return o===void 0&&(o=1),b===void 0&&(b=!1),_(I,D,1/o,b)}function A(I,D){return D===void 0&&(D=!1),_(I,1e3,1/9e4,D)}function k(I,D){return D===void 0&&(D=1),_(I,9e4,1/D)}h.r(R),h.d(R,"toTimescaleFromBase",function(){return _}),h.d(R,"toTimescaleFromScale",function(){return T}),h.d(R,"toMsFromMpegTsClock",function(){return A}),h.d(R,"toMpegTsClockFromTimescale",function(){return k})},"./src/utils/typed-array.ts":function(F,R,h){function _(T,A,k){return Uint8Array.prototype.slice?T.slice(A,k):new Uint8Array(Array.prototype.slice.call(T,A,k))}h.r(R),h.d(R,"sliceUint8",function(){return _})},"./src/utils/vttcue.ts":function(F,R,h){h.r(R),R.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var _=["","lr","rl"],T=["start","middle","end","left","right"];function A(o,b){if(typeof b!="string"||!Array.isArray(o))return!1;var y=b.toLowerCase();return!!~o.indexOf(y)&&y}function k(o){return A(T,o)}function I(o){for(var b=arguments.length,y=new Array(b>1?b-1:0),d=1;d<b;d++)y[d-1]=arguments[d];for(var p=1;p<arguments.length;p++){var m=arguments[p];for(var l in m)o[l]=m[l]}return o}function D(o,b,y){var d=this,p={enumerable:!0};d.hasBeenReset=!1;var m="",l=!1,e=o,i=b,t=y,n=null,u="",a=!0,c="auto",E="start",g=50,v="middle",r=50,s="middle";Object.defineProperty(d,"id",I({},p,{get:function(){return m},set:function(f){m=""+f}})),Object.defineProperty(d,"pauseOnExit",I({},p,{get:function(){return l},set:function(f){l=!!f}})),Object.defineProperty(d,"startTime",I({},p,{get:function(){return e},set:function(f){if(typeof f!="number")throw new TypeError("Start time must be set to a number.");e=f,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",I({},p,{get:function(){return i},set:function(f){if(typeof f!="number")throw new TypeError("End time must be set to a number.");i=f,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",I({},p,{get:function(){return t},set:function(f){t=""+f,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",I({},p,{get:function(){return n},set:function(f){n=f,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",I({},p,{get:function(){return u},set:function(f){var S=function(L){return A(_,L)}(f);if(S===!1)throw new SyntaxError("An invalid or illegal string was specified.");u=S,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",I({},p,{get:function(){return a},set:function(f){a=!!f,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",I({},p,{get:function(){return c},set:function(f){if(typeof f!="number"&&f!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");c=f,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",I({},p,{get:function(){return E},set:function(f){var S=k(f);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");E=S,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",I({},p,{get:function(){return g},set:function(f){if(f<0||f>100)throw new Error("Position must be between 0 and 100.");g=f,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",I({},p,{get:function(){return v},set:function(f){var S=k(f);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");v=S,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",I({},p,{get:function(){return r},set:function(f){if(f<0||f>100)throw new Error("Size must be between 0 and 100.");r=f,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",I({},p,{get:function(){return s},set:function(f){var S=k(f);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");s=S,this.hasBeenReset=!0}})),d.displayState=void 0}return D.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":function(F,R,h){h.r(R),h.d(R,"parseTimeStamp",function(){return A}),h.d(R,"fixLineBreaks",function(){return y}),h.d(R,"VTTParser",function(){return d});var _=h("./src/utils/vttcue.ts"),T=function(){function p(){}return p.prototype.decode=function(m,l){if(!m)return"";if(typeof m!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(m))},p}();function A(p){function m(e,i,t,n){return 3600*(0|e)+60*(0|i)+(0|t)+parseFloat(n||0)}var l=p.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return l?parseFloat(l[2])>59?m(l[2],l[3],0,l[4]):m(l[1],l[2],l[3],l[4]):null}var k=function(){function p(){this.values=Object.create(null)}var m=p.prototype;return m.set=function(l,e){this.get(l)||e===""||(this.values[l]=e)},m.get=function(l,e,i){return i?this.has(l)?this.values[l]:e[i]:this.has(l)?this.values[l]:e},m.has=function(l){return l in this.values},m.alt=function(l,e,i){for(var t=0;t<i.length;++t)if(e===i[t]){this.set(l,e);break}},m.integer=function(l,e){/^-?\d+$/.test(e)&&this.set(l,parseInt(e,10))},m.percent=function(l,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var i=parseFloat(e);if(i>=0&&i<=100)return this.set(l,i),!0}return!1},p}();function I(p,m,l,e){var i=e?p.split(e):[p];for(var t in i)if(typeof i[t]=="string"){var n=i[t].split(l);n.length===2&&m(n[0],n[1])}}var D=new _.default(0,0,""),o=D.align==="middle"?"middle":"center";function b(p,m,l){var e=p;function i(){var n=A(p);if(n===null)throw new Error("Malformed timestamp: "+e);return p=p.replace(/^[^\sa-zA-Z-]+/,""),n}function t(){p=p.replace(/^\s+/,"")}if(t(),m.startTime=i(),t(),p.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);p=p.substr(3),t(),m.endTime=i(),t(),function(n,u){var a=new k;I(n,function(g,v){var r;switch(g){case"region":for(var s=l.length-1;s>=0;s--)if(l[s].id===v){a.set(g,l[s].region);break}break;case"vertical":a.alt(g,v,["rl","lr"]);break;case"line":r=v.split(","),a.integer(g,r[0]),a.percent(g,r[0])&&a.set("snapToLines",!1),a.alt(g,r[0],["auto"]),r.length===2&&a.alt("lineAlign",r[1],["start",o,"end"]);break;case"position":r=v.split(","),a.percent(g,r[0]),r.length===2&&a.alt("positionAlign",r[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":a.percent(g,v);break;case"align":a.alt(g,v,["start",o,"end","left","right"])}},/:/,/\s/),u.region=a.get("region",null),u.vertical=a.get("vertical","");var c=a.get("line","auto");c==="auto"&&D.line===-1&&(c=-1),u.line=c,u.lineAlign=a.get("lineAlign","start"),u.snapToLines=a.get("snapToLines",!0),u.size=a.get("size",100),u.align=a.get("align",o);var E=a.get("position","auto");E==="auto"&&D.position===50&&(E=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=E}(p,m)}function y(p){return p.replace(/<br(?: \/)?>/gi,`
`)}var d=function(){function p(){this.state="INITIAL",this.buffer="",this.decoder=new T,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var m=p.prototype;return m.parse=function(l){var e=this;function i(){var c=e.buffer,E=0;for(c=y(c);E<c.length&&c[E]!=="\r"&&c[E]!==`
`;)++E;var g=c.substr(0,E);return c[E]==="\r"&&++E,c[E]===`
`&&++E,e.buffer=c.substr(E),g}l&&(e.buffer+=e.decoder.decode(l,{stream:!0}));try{var t="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;var n=(t=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var u=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(u?u=!1:t=i(),e.state){case"HEADER":/:/.test(t)?I(t,function(c,E){},/:/):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new _.default(0,0,""),e.state="CUE",t.indexOf("-->")===-1){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{b(t,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var a=t.indexOf("-->")!==-1;if(!t||a&&(u=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=t;continue;case"BADCUE":t||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},m.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){l.onparsingerror&&l.onparsingerror(e)}return l.onflush&&l.onflush(),this},p}()},"./src/utils/webvtt-parser.ts":function(F,R,h){h.r(R),h.d(R,"generateCueId",function(){return y}),h.d(R,"parseWebVTT",function(){return d});var _=h("./src/polyfills/number.ts"),T=h("./src/utils/vttparser.ts"),A=h("./src/demux/id3.ts"),k=h("./src/utils/timescale-conversion.ts"),I=h("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,o=function(p,m,l){return l===void 0&&(l=0),p.substr(l,m.length)===m},b=function(p){for(var m=5381,l=p.length;l;)m=33*m^p.charCodeAt(--l);return(m>>>0).toString()};function y(p,m,l){return b(p.toString())+b(m.toString())+b(l)}function d(p,m,l,e,i,t,n,u){var a,c=new T.VTTParser,E=Object(A.utf8ArrayToStr)(new Uint8Array(p)).trim().replace(D,`
`).split(`
`),g=[],v=Object(k.toMpegTsClockFromTimescale)(m,l),r="00:00.000",s=0,f=0,S=!0,L=!1;c.oncue=function(C){var O=e[i],w=e.ccOffset,P=(s-v)/9e4;if(O!=null&&O.new&&(f!==void 0?w=e.ccOffset=O.start:function(U,G,V){var W=U[G],Y=U[W.prevCC];if(!Y||!Y.new&&W.new)return U.ccOffset=U.presentationOffset=W.start,void(W.new=!1);for(;(X=Y)!==null&&X!==void 0&&X.new;){var X;U.ccOffset+=W.start-Y.start,W.new=!1,Y=U[(W=Y).prevCC]}U.presentationOffset=V}(e,i,P)),P&&(w=P-e.presentationOffset),L){var x=C.endTime-C.startTime,M=Object(I.normalizePts)(9e4*(C.startTime+w-f),9e4*t)/9e4;C.startTime=M,C.endTime=M+x}var N=C.text.trim();C.text=decodeURIComponent(encodeURIComponent(N)),C.id||(C.id=y(C.startTime,C.endTime,N)),C.endTime>0&&g.push(C)},c.onparsingerror=function(C){a=C},c.onflush=function(){a?u(a):n(g)},E.forEach(function(C){if(S){if(o(C,"X-TIMESTAMP-MAP=")){S=!1,L=!0,C.substr(16).split(",").forEach(function(O){o(O,"LOCAL:")?r=O.substr(6):o(O,"MPEGTS:")&&(s=parseInt(O.substr(7)))});try{f=function(O){var w=parseInt(O.substr(-3)),P=parseInt(O.substr(-6,2)),x=parseInt(O.substr(-9,2)),M=O.length>9?parseInt(O.substr(0,O.indexOf(":"))):0;if(!(Object(_.isFiniteNumber)(w)&&Object(_.isFiniteNumber)(P)&&Object(_.isFiniteNumber)(x)&&Object(_.isFiniteNumber)(M)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+O);return w+=1e3*P,(w+=6e4*x)+36e5*M}(r)/1e3}catch(O){L=!1,a=O}return}C===""&&(S=!1)}c.parse(C+`
`)}),c.flush()}},"./src/utils/xhr-loader.ts":function(F,R,h){h.r(R);var _=h("./src/utils/logger.ts"),T=h("./src/loader/load-stats.ts"),A=/^age:\s*[\d.]+\s*$/m,k=function(){function I(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new T.LoadStats,this.retryDelay=0}var D=I.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},D.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(o,b,y){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=b,this.callbacks=y,this.retryDelay=b.retryDelay,this.loadInternal()},D.loadInternal=function(){var o=this.config,b=this.context;if(o){var y=this.loader=new self.XMLHttpRequest,d=this.stats;d.loading.first=0,d.loaded=0;var p=this.xhrSetup;try{if(p)try{p(y,b.url)}catch{y.open("GET",b.url,!0),p(y,b.url)}y.readyState||y.open("GET",b.url,!0)}catch(m){return void this.callbacks.onError({code:y.status,text:m.message},b,y)}b.rangeEnd&&y.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),y.onreadystatechange=this.readystatechange.bind(this),y.onprogress=this.loadprogress.bind(this),y.responseType=b.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),y.send()}},D.readystatechange=function(){var o=this.context,b=this.loader,y=this.stats;if(o&&b){var d=b.readyState,p=this.config;if(!y.aborted&&d>=2)if(self.clearTimeout(this.requestTimeout),y.loading.first===0&&(y.loading.first=Math.max(self.performance.now(),y.loading.start)),d===4){b.onreadystatechange=null,b.onprogress=null;var m=b.status;if(m>=200&&m<300){var l,e;if(y.loading.end=Math.max(self.performance.now(),y.loading.first),e=o.responseType==="arraybuffer"?(l=b.response).byteLength:(l=b.responseText).length,y.loaded=y.total=e,!this.callbacks)return;var i=this.callbacks.onProgress;if(i&&i(y,o,l,b),!this.callbacks)return;var t={url:b.responseURL,data:l};this.callbacks.onSuccess(t,y,o,b)}else y.retry>=p.maxRetry||m>=400&&m<499?(_.logger.error(m+" while loading "+o.url),this.callbacks.onError({code:m,text:b.statusText},o,b)):(_.logger.warn(m+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,p.maxRetryDelay),y.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout)}},D.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(o){var b=this.stats;b.loaded=o.loaded,o.lengthComputable&&(b.total=o.total)},D.getCacheAge=function(){var o=null;if(this.loader&&A.test(this.loader.getAllResponseHeaders())){var b=this.loader.getResponseHeader("age");o=b?parseFloat(b):null}return o},I}();R.default=k}}).default);var ft=yn(er.exports);const En={name:"d-icon"},Re=Object.assign(En,{props:{icon:String,size:[Number,String]},setup:function(F){const R=F,h=le(()=>({fontSize:/^\d+$/.test(R.size)?R.size+"px":R.size}));return(_,T)=>(H(),q("i",{class:J(["d-icon iconfont",F.icon]),style:Ee(B(h))},null,6))}});Re.__scopeId="data-v-0c690e66";je("data-v-4cb76d59");const Tn={class:"d-player-top"},Sn={class:"top-title"},bn={class:"top-title"};Ve();const An={props:{title:{default:""}},setup(F){Date.prototype.format=function(_){let T={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var A in T)new RegExp("("+A+")").test(_)&&(_=_.replace(RegExp.$1,RegExp.$1.length==1?T[A]:("00"+T[A]).substr((""+T[A]).length)));return _};let R=oe("00:00:00");R.value=new Date().format("hh:mm:ss");let h=null;return h=setInterval(()=>{R.value=new Date().format("hh:mm:ss")},1e3),jt(()=>{clearInterval(h)}),(_,T)=>(H(),q("div",Tn,[j("p",Sn,ie(F.title||""),1),j("p",bn,ie(B(R)),1)]))},__scopeId:"data-v-4cb76d59"};je("data-v-ac2469ec");const Ln={class:"d-status"},kn={class:"d-flex-center"},_n={class:"d-flex-center"},Dn=ee("5X\u901F\u64AD\u653E\u4E2D ");Ve();var tr=ve({props:["state"],setup:F=>(R,h)=>Te((H(),q("div",Ln,[Te(j("li",kn,[K(Re,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(F.state.volume==0?"mute":F.state.volume>.5?"up":"down")},null,8,["icon"]),ee(" "+ie(~~(100*F.state.volume))+"% ",1)],512),[[Se,F.state.handleType=="volume"]]),Te(j("li",_n,[K(Re,{size:"12",icon:"icon-play"}),K(Re,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),Dn],512),[[Se,F.state.handleType=="playbackRate"||F.state.isMultiplesPlay]])],512)),[[Se,F.state.handleType||F.state.isMultiplesPlay]])});tr.__scopeId="data-v-ac2469ec",je("data-v-385f7870");const Rn=["checked","true-value","false-value"],Cn=j("span",{class:"d-switch_action"},null,-1);Ve();var dt=ve({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(F,{emit:R}){const h=F;bt(k=>({"014e5dc0":F.width,e4e32852:F.activeColor}));const _=oe(null),T=le(()=>h.modelValue===h.trueValue),A=()=>{At(()=>{const k=_.value.checked;R("update:modelValue",k),R("change",k)})};return(k,I)=>(H(),q("div",{class:J(["d-switch",{"is-checked":B(T)}])},[j("input",{class:"d-switch__input",ref:_,type:"checkbox",checked:B(T),onChange:A,"true-value":F.trueValue,"false-value":F.falseValue},null,40,Rn),Cn],2))}});dt.__scopeId="data-v-385f7870",je("data-v-b2384226");const In={key:0},wn=j("i",{class:"rotating iconfont icon-loading f50"},null,-1),On=[j("i",{class:"rotating iconfont icon-loading f50"},null,-1),j("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],Fn=[j("i",{class:"iconfont icon-replay f24 mr5"},null,-1),ee("\u91CD\u65B0\u64AD\u653E ")],Pn=[j("i",{class:"iconfont icon-replay f24 mr5"},null,-1),ee("\u8BF7\u6C42\u9519\u8BEF ")];Ve();var rr=ve({props:{loadType:String,text:{type:String,default:""}},setup(F){const R=F,{proxy:h}=Mr(),_=["loadstart","waiting","ended","error","stalled"],T=()=>{h.$parent.play()},A=le(()=>{let k="background: rgba(0, 0, 0, .1);z-index:1";return R.loadType=="loadstart"&&(k="background: rgba(0, 0, 0, 1);;z-index:3"),k});return(k,I)=>Te((H(),q("div",{class:"d-loading",style:Ee(B(A))},[j("div",null,[F.loadType=="loadstart"?(H(),q("span",In,[wn,j("p",null,ie(F.text),1)])):Q("",!0),Te(j("span",null,On,512),[[Se,F.loadType=="waiting"]]),Te(j("span",null,[j("p",{onClick:T,class:"d-flex-x d-pointer"},Fn)],512),[[Se,F.loadType=="ended"]]),Te(j("span",null,[j("p",{onClick:T,class:"d-flex-x d-pointer"},Pn)],512),[[Se,F.loadType=="error"||F.loadType=="stalled"]])])],4)),[[Se,_.includes(F.loadType)]])}});rr.__scopeId="data-v-b2384226";const qe=function(F,R,h,_=!1){F&&R&&h&&F.addEventListener(R,h,_)},Le=function(F,R,h,_=!1){F&&R&&h&&F.removeEventListener(R,h,_)};je("data-v-5a794390");const xn=["onMousedown"];Ve();var Je=ve(Et(yt({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(F,{emit:R}){const h=F;bt(e=>({"5242b67b":F.size}));const _=oe(null),T=oe(null),A=tt({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),k=le(()=>{let e=h.modelValue<0?0:h.modelValue>1?1:h.modelValue;return h.vertical?`height:${100*e}%`:`width:${100*e}%`}),I=le(()=>{let e=h.preload<0?0:h.preload>1?1:h.preload;return h.vertical?`height:${100*e}%`:`width:${100*e}%`}),D=le(()=>{let e=A.hoverPosition<0?0:A.hoverPosition>1?1:A.hoverPosition;return h.vertical?`bottom:${100*e}%`:`left:${100*e}%`}),o=e=>{e.preventDefault()},b=e=>{h.disabled||(e.preventDefault(),A.dragging=!0,d(e),qe(window,"mousemove",m),qe(window,"touchmove",m),qe(window,"mouseup",l),qe(window,"touchend",l))},y=e=>{if(!h.hover)return;let i=p(e);if(R("onMousemove",e,i),A.hoverPosition=i,h.vertical)return;let t=_.value,n=T.value.clientWidth/2,u=e.clientX-t.getBoundingClientRect().left;u<n?A.hoverTipsLeft=n-u+"px":t.clientWidth-u<n?A.hoverTipsLeft=t.clientWidth-u-n+"px":A.hoverTipsLeft="50%"},d=e=>{let i=p(e);R("update:modelValue",i),R("change",e,i)},p=e=>{let i=_.value,t=0;if(h.vertical){let n=i.clientHeight;t=(i.getBoundingClientRect().bottom-e.clientY)/n}else t=(e.clientX-i.getBoundingClientRect().left)/i.clientWidth;return t<0?0:t>1?1:t},m=e=>{d(e)},l=e=>{A.dragging&&(Le(window,"mousemove",m),Le(window,"touchmove",m),Le(window,"mouseup",l),Le(window,"touchend",l),Le(window,"contextmenu",l),setTimeout(()=>{A.dragging=!1},0))};return(e,i)=>(H(),q("div",{ref:_,class:J(["d-slider",{"is-vertical":h.vertical}]),onMousedown:Ue(b,["stop"]),onContextmenu:o},[j("div",{class:"d-slider__runway",onMousemove:y},[Te(j("div",{class:"d-slider__cursor",style:Ee(B(D))},[Te(j("div",{class:"d-slider__tips",ref:T,style:Ee({left:B(A).hoverTipsLeft})},ie(h.hoverText),5),[[Se,h.hoverText]])],4),[[Se,h.hover]]),j("div",{class:"d-slider__preload",style:Ee(B(I))},null,4),j("div",{class:"d-slider__bar",style:Ee(B(k))},null,4)],32)],42,xn))}}));Je.__scopeId="data-v-5a794390";je("data-v-570fa0d1");const Mn={key:0,class:"d-player-dialog"},Nn={class:"d-player-dialog-body"},Bn={class:"d-player-dialog-title"},Un={class:"d-player-hotkey-panel"},Gn={class:"d-player-filter-panel"},jn={class:"d-player-filter-panel-item"},Vn=j("span",null,"\u9971\u548C\u5EA6",-1),Kn={class:"d-player-filter-panel-item"},Hn=j("span",null,"\u4EAE\u5EA6",-1),Wn={class:"d-player-filter-panel-item"},$n=j("span",null,"\u5BF9\u6BD4\u5EA6",-1),qn={key:0,class:"d-player-contextmenu"},Yn=["dplayerKeyCode"],zn=j("input",{class:"d-player-copyText"},null,-1);Ve();var ir=ve({setup(F){const R=tt({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),h=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],_=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],T=tt({saturate:.392,brightness:.392,contrast:.392}),A=le(()=>({left:R.mouseX+"px",top:R.mouseY+"px"}));Ge(T,b=>{let y=document.querySelector("#dPlayerVideo"),d=(2.55*b.saturate).toFixed(2),p=(2.55*b.brightness).toFixed(2),m=(2.55*b.contrast).toFixed(2);y.style.filter=`saturate(${d}) brightness(${p}) contrast(${m})`});const k=()=>{T.saturate=.392,T.brightness=.392,T.contrast=.392},I=b=>{b.key=="Escape"&&o(0)},D=b=>{b.preventDefault(),qe(window,"keydown",I),qe(window,"click",o);let y=document.querySelector("#refPlayerWrap"),d=y.clientWidth;y.clientHeight,R.mouseX=b.clientX-y.getBoundingClientRect().left,d-R.mouseX<130&&(R.mouseX=R.mouseX+(d-R.mouseX-130)),R.mouseY=b.clientY-y.getBoundingClientRect().top,R.show=!0},o=b=>{let y=b.path[0].tagName=="LI",d=b.path[0].attributes.dplayerKeyCode&&b.path[0].attributes.dplayerKeyCode.value,p=h.map(m=>m.key);if(y&&p.includes(d))if(R.dialogTitle=b.path[0].innerText,R.dialogType=d,d=="copy"){let m=document.querySelector(".d-player-copyText");m.value=window.location.href,m.select(),document.execCommand("copy"),R.dialogType=""}else d=="version"&&(R.dialogType="");R.show=!1,Le(window,"keydown",I),Le(window,"click",o)};return St(()=>{let b=document.querySelector("#refPlayerWrap");Le(window,"keydown",I),Le(window,"click",o),Le(b,"contextmenu",D),qe(b,"contextmenu",D)}),jt(()=>{let b=document.querySelector("#refPlayerWrap");Le(window,"keydown",I),Le(window,"click",o),Le(b,"contextmenu",D)}),(b,y)=>(H(),q("div",null,[K(mt,{name:"d-fade-in"},{default:$(()=>[B(R).dialogType?(H(),q("div",Mn,[j("div",Nn,[j("h5",Bn,[ee(ie(B(R).dialogTitle)+" ",1),j("i",{onClick:y[0]||(y[0]=d=>B(R).dialogType=!1),class:"icon icon-close"},"X")]),Te(j("ul",Un,[(H(),q(ke,null,Oe(_,d=>j("li",{class:"d-player-hotkey-panel-item",key:d.key},[j("span",null,ie(d.key),1),j("span",null,ie(d.label),1)])),64))],512),[[Se,B(R).dialogType=="hotkey"]]),Te(j("ul",Gn,[j("li",jn,[Vn,K(Je,{class:"filter-panel-slider",size:"5px",modelValue:B(T).saturate,"onUpdate:modelValue":y[1]||(y[1]=d=>B(T).saturate=d)},null,8,["modelValue"]),j("span",null,ie(Math.round(255*B(T).saturate)),1)]),j("li",Kn,[Hn,K(Je,{class:"filter-panel-slider",size:"5px",modelValue:B(T).brightness,"onUpdate:modelValue":y[2]||(y[2]=d=>B(T).brightness=d)},null,8,["modelValue"]),j("span",null,ie(Math.round(255*B(T).brightness)),1)]),j("li",Wn,[$n,K(Je,{class:"filter-panel-slider",size:"5px",modelValue:B(T).contrast,"onUpdate:modelValue":y[3]||(y[3]=d=>B(T).contrast=d)},null,8,["modelValue"]),j("span",null,ie(Math.round(255*B(T).contrast)),1)]),j("span",{onClick:k,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[Se,B(R).dialogType=="filter"]])])])):Q("",!0)]),_:1}),B(R).show?(H(),q("div",qn,[j("ul",{class:"d-player-contextmenu-body",style:Ee(B(A))},[(H(),q(ke,null,Oe(h,d=>j("li",{dplayerKeyCode:d.key,key:d.key},ie(d.label),9,Yn)),64))],4),zn])):Q("",!0)]))}});ir.__scopeId="data-v-570fa0d1";const gt=F=>{let R=~~(F/3600),h=~~(F%3600/60),_=~~(F%60);return R=R<10?"0"+R:R,h=h<10?"0"+h:h,_=_<10?"0"+_:_,`${R}:${h}:${_}`},at="ontouchstart"in window,Pt=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],Xn={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};je("data-v-01791e9e");const Qn={class:"d-player-video",id:"dPlayerVideo"},Zn=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],Jn={class:"d-player-lightoff"},ea={key:1,class:"d-player-state"},ta={class:"d-play-btn"},ra=["onKeyup","onKeydown"],ia={class:"d-control-progress"},na={class:"d-tool-bar"},aa={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},sa=j("span",{style:{margin:"0 3px"}},"/",-1),oa={class:"total-time"},la={class:"d-tool-bar"},ua={key:0,class:"d-tool-item quality-btn"},da={class:"d-tool-item-main"},ca={class:"speed-main",style:{"text-align":"center"}},ha=["onClick"],fa={key:1,class:"d-tool-item speedRate-btn"},ga={class:"d-tool-item-main"},pa={class:"speed-main"},va=["onClick"],ma={key:2,class:"d-tool-item volume-btn"},ya={class:"d-tool-item-main volume-box",style:{width:"52px"}},Ea={class:"volume-text-size"},Ta={key:3,class:"d-tool-item setting-btn"},Sa={class:"d-tool-item-main"},ba={class:"speed-main"},Aa=ee(" \u955C\u50CF\u753B\u9762 "),La=ee(" \u5FAA\u73AF\u64AD\u653E "),ka=ee(" \u5173\u706F\u6A21\u5F0F "),_a=j("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),Da=j("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Ra=j("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);Ve();var st=ve(Et(yt({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:Xn,emits:[...Pt,"mirrorChange","loopChange","lightOffChange"],setup:function(F,{expose:R,emit:h}){const _=F;bt(w=>({"51d4439c":B(p),"77e758a6":w.width,b8a1afc0:w.height}));const T=new ft({fragLoadingTimeOut:2e3}),A=oe(null),k=oe(null),I=oe(null),D=oe(null),o=tt(Et(yt({dVideo:null},_),{muted:_.muted,playBtnState:_.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),b=(...w)=>P=>w.reverse().reduce((x,M)=>M(x),P),y=Pt.reduce((w,P)=>{var x;return w[`on${x=P,x.charAt(0).toUpperCase()+x.slice(1)}`]=M=>{o.loadStateType=P,h(P,M)},w},{});y.onCanplay=b(y.onCanplay,()=>{o.playBtnState!="play"&&o.dVideo.play(),o.autoPlay&&(o.dVideo.play(),o.playBtnState="pause")}),y.onEnded=b(y.onEnded,()=>{o.playBtnState="replay"}),y.onDurationchange=w=>{h("durationchange",w),_.currentTime!=0&&(o.dVideo.currentTime=_.currentTime),y.onTimeupdate(w)},y.onProgress=w=>{console.log("\u7F13\u51B2\u4E2D..."),h("progress",w);let P=w.target.duration,x=w.target.buffered,M=w.target.buffered.length&&w.target.buffered.end(x-1);o.preloadBar=M/P},y.onTimeupdate=w=>{h("timeupdate",w);let P=w.duration||w.target.duration||0,x=w.currentTime||w.target.currentTime;o.playProgress=x/P,o.currentTime=gt(x),o.totalTime=gt(P)},y.onError=b(y.onError,()=>{o.playBtnState="replay"});let d=xr();for(let w in d)y[w]=d[w];const p=(m=o.color,`${parseInt("0x"+m.slice(1,3))},${parseInt("0x"+m.slice(3,5))},${parseInt("0x"+m.slice(5,7))}`);var m;const l=Ft(500,()=>{o.handleType=""}),e=w=>{w.preventDefault(),w.code=="ArrowUp"?o.volume=o.volume+.1>1?1:o.volume+.1:o.volume=o.volume-.1<0?0:o.volume-.1,o.muted=!1,o.handleType="volume",l()},i=w=>{_.speed&&(o.dVideo.currentTime=o.dVideo.currentTime<10?.1:o.dVideo.currentTime-10,y.onTimeupdate(o.dVideo),u())},t=w=>{w.preventDefault();let P=w.type;if(w.key=="ArrowRight"){if(u(),P=="keyup"){if(clearTimeout(o.longPressTimeout),!_.speed&&!o.longPressTimeout)return;o.isMultiplesPlay?(o.dVideo.playbackRate=o.speedActive,o.isMultiplesPlay=!1):(o.dVideo.currentTime=o.dVideo.currentTime+10,y.onTimeupdate(o.dVideo))}else if(P=="keydown"){if(!_.speed)return;o.isMultiplesPlay&&clearTimeout(o.longPressTimeout),o.longPressTimeout=setTimeout(()=>{o.isMultiplesPlay=!0,o.dVideo.playbackRate=5,o.handleType="playbackRate",l()},500)}}},n=()=>{at||D.value.focus()},u=()=>{o.loadStateType="play",o.dVideo.play().catch(()=>{setTimeout(()=>{o.playBtnState="replay",o.loadStateType="error"},500)}),o.playBtnState="pause"},a=()=>{o.dVideo.pause(),o.playBtnState="play"},c=w=>{w&&w.preventDefault(),o.playBtnState=="play"||o.playBtnState=="replay"?u():o.playBtnState=="pause"&&a()},E=()=>{o.muted=!o.muted,o.volume==0&&(o.volume=.05)},g=(w,P)=>{let x=o.dVideo.duration||o.dVideo.target.duration;o.dVideo.currentTime=x*P,o.playBtnState=="play"&&(o.dVideo.play(),o.playBtnState="pause")},v=(w,P)=>{o.progressCursorTime=gt(o.dVideo.duration*P)},r=Ft(2500,()=>{o.isVideoHovering=!1}),s=w=>{o.isVideoHovering=!0,r()},f=w=>{h("mirrorChange",w,o.dVideo)},S=w=>{h("loopChange",w,o.dVideo)},L=w=>{h("lightOffChange",w,o.dVideo)},C=()=>{var w;w=o.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(P=>{console.log(P,"Video failed to leave Picture-in-Picture mode.")}):w.requestPictureInPicture().catch(P=>{console.log(P,"Video failed to enter Picture-in-Picture mode.")})},O=()=>{o.fullScreen=(w=>{let P=document,x=P.webkitIsFullScreen||P.fullscreen;return x?(document.exitFullscreen||P.webkitExitFullScreen).call(P):(w.requestFullscreen||w.webkitRequestFullScreen).call(w),!x})(A.value)};return Ge(()=>_.src,()=>{At(()=>{o.dVideo.canPlayType(_.type)||o.dVideo.canPlayType("application/vnd.apple.mpegurl")?o.muted=_.autoPlay:ft.isSupported()&&(T.detachMedia(),T.attachMedia(o.dVideo),T.on(ft.Events.MEDIA_ATTACHED,()=>{T.loadSource(_.src),T.on("hlsManifestParsed",(w,P)=>{console.log(P),o.currentLevel=P.level,o.qualityLevels=P.levels||[]})}),T.on("hlsLevelSwitching",(w,P)=>{console.log(P),console.log("LEVEL_SWITCHING")}),T.on("hlsLevelSwitched",(w,P)=>{o.currentLevel=P.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),St(()=>{o.dVideo=k,n()}),R({play:u,pause:a,togglePlay:c}),(w,P)=>(H(),q("div",{ref:A,id:"refPlayerWrap",class:J(["d-player-wrap",{"web-full-screen":B(o).webFullScreen,"is-lightoff":B(o).lightOff,"d-player-wrap-hover":B(o).playBtnState=="play"||B(o).isVideoHovering}]),onMousemove:s},[j("div",Qn,[j("video",ct({ref:k,class:["d-player-video-main",{"video-mirror":B(o).mirror}],id:"dPlayerVideoMain",controls:!(!B(at)||!B(o).speed),"webkit-playsinline":_.playsinline,playsinline:_.playsinline},B(y),{volume:B(o).volume,muted:B(o).muted,loop:B(o).loop,preload:w.preload,width:"100%",height:"100%",src:_.src,poster:_.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,Zn)]),K(mt,{name:"d-fade-in"},{default:$(()=>[Te(j("div",Jn,null,512),[[Se,B(o).lightOff]])]),_:1}),B(o).fullScreen?(H(),fe(An,{key:0,title:_.title},null,8,["title"])):Q("",!0),B(at)?Q("",!0):(H(),q("div",ea,[K(mt,{name:"d-scale-out"},{default:$(()=>[Te(j("div",ta,[K(Re,{icon:"icon-play",size:40})],512),[[Se,B(o).playBtnState=="play"]])]),_:1}),K(tr,{state:B(o)},null,8,["state"])])),B(at)?Q("",!0):(H(),q("input",{key:2,type:"input",readonly:"readonly",ref:D,onDblclick:O,onKeyup:[Be(O,["f"]),P[0]||(P[0]=Be(x=>B(o).webFullScreen=!1,["esc"])),t],onClick:c,onKeydown:[Be(c,["space"]),Be(i,["arrow-left"]),Be(e,["arrow-up","arrow-down"]),t],class:"d-player-input",maxlength:"0"},null,40,ra)),K(rr,{loadType:B(o).loadStateType},null,8,["loadType"]),K(ir),!B(at)&&B(o).control?(H(),q("div",{key:3,class:"d-player-control",ref:I},[j("div",ia,[K(Je,{class:"d-progress-bar",onOnMousemove:v,onChange:g,disabled:!B(o).speed,hoverText:B(o).progressCursorTime,modelValue:B(o).playProgress,"onUpdate:modelValue":P[1]||(P[1]=x=>B(o).playProgress=x),preload:B(o).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),j("div",{class:"d-control-tool",onClick:n},[j("div",na,[j("div",{class:"d-tool-item",onClick:c},[K(Re,{size:"24",icon:`icon-${B(o).playBtnState}`},null,8,["icon"])]),_.controlBtns.includes("audioTrack")?(H(),q("div",aa,[j("span",null,ie(B(o).currentTime),1),sa,j("span",oa,ie(B(o).totalTime),1)])):Q("",!0)]),j("div",la,[B(o).qualityLevels.length&&_.controlBtns.includes("quality")?(H(),q("div",ua,[ee(ie(B(o).qualityLevels.length&&(B(o).qualityLevels[B(o).currentLevel]||{}).height)+"P ",1),j("div",da,[j("ul",ca,[(H(!0),q(ke,null,Oe(B(o).qualityLevels,(x,M)=>(H(),q("li",{class:J({"speed-active":B(o).currentLevel==M}),onClick:N=>((U,G)=>{T.currentLevel=G,o.currentLevel=G})(0,M),key:x},ie(x.height)+"P",11,ha))),128))])])])):Q("",!0),_.controlBtns.includes("speedRate")?(H(),q("div",fa,[ee(ie(B(o).speedActive=="1.0"?"\u500D\u901F":B(o).speedActive+"x")+" ",1),j("div",ga,[j("ul",pa,[(H(!0),q(ke,null,Oe(B(o).speedRate,x=>(H(),q("li",{class:J({"speed-active":B(o).speedActive==x}),onClick:M=>(N=>{o.speedActive=N,o.dVideo.playbackRate=N})(x),key:x},ie(x)+"x",11,va))),128))])])])):Q("",!0),_.controlBtns.includes("volume")?(H(),q("div",ma,[j("div",ya,[j("div",{class:J(["volume-main",{"is-muted":B(o).muted}])},[j("span",Ea,ie(B(o).muted?0:~~(100*B(o).volume))+"%",1),K(Je,{onChange:P[2]||(P[2]=x=>B(o).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:B(o).volume,"onUpdate:modelValue":P[3]||(P[3]=x=>B(o).volume=x)},null,8,["modelValue"])],2)]),j("span",{onClick:E,style:{display:"flex"}},[K(Re,{size:"20",icon:"icon-volume-"+(B(o).volume==0||B(o).muted?"mute":B(o).volume>.5?"up":"down")},null,8,["icon"])])])):Q("",!0),_.controlBtns.includes("setting")?(H(),q("div",Ta,[K(Re,{size:"20",class:"rotateHover",icon:"icon-settings"}),j("div",Sa,[j("ul",ba,[j("li",null,[Aa,K(dt,{onChange:f,modelValue:B(o).mirror,"onUpdate:modelValue":P[4]||(P[4]=x=>B(o).mirror=x)},null,8,["modelValue"])]),j("li",null,[La,K(dt,{onChange:S,modelValue:B(o).loop,"onUpdate:modelValue":P[5]||(P[5]=x=>B(o).loop=x)},null,8,["modelValue"])]),j("li",null,[ka,K(dt,{onChange:L,modelValue:B(o).lightOff,"onUpdate:modelValue":P[6]||(P[6]=x=>B(o).lightOff=x)},null,8,["modelValue"])])])])])):Q("",!0),_.controlBtns.includes("pip")?(H(),q("div",{key:4,class:"d-tool-item pip-btn",onClick:C},[K(Re,{size:"20",icon:"icon-pip"}),_a])):Q("",!0),_.controlBtns.includes("pageFullScreen")?(H(),q("div",{key:5,class:"d-tool-item pip-btn",onClick:P[7]||(P[7]=x=>B(o).webFullScreen=!B(o).webFullScreen)},[K(Re,{size:"20",icon:"icon-web-screen"}),Da])):Q("",!0),_.controlBtns.includes("fullScreen")?(H(),q("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:O},[Ra,K(Re,{size:"20",icon:"icon-screen"})])):Q("",!0)])])],512)):Q("",!0)],34))}}));function Ca(F){F.component(st.name,st)}st.__scopeId="data-v-01791e9e",st.install=Ca;const Ia=ve({__name:"index",props:{src:{type:String,required:!0},width:String,height:String,poster:String},setup(F,{expose:R}){const h=F,_=et(),T=tt({color:Nr.color_primary,muted:!1,webFullScreen:!1,speedRate:["0.75","1.0","1.25","1.5","2.0"],autoPlay:!0,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,title:"",poster:"",...h}),A=()=>{_.value.play()},k=()=>{_.value.pause()},I=y=>{console.log("\u64AD\u653E")},D=y=>{console.log(y,"\u6682\u505C")},o=y=>{console.log(y,"\u65F6\u95F4\u66F4\u65B0")},b=y=>{console.log(y,"\u53EF\u4EE5\u64AD\u653E")};return R({play:A,pause:k}),(y,d)=>(H(),q("div",null,[K(B(st),ct({ref_key:"playerRef",ref:_},T,{src:F.src,onPlay:I,onPause:D,onTimeupdate:o,onCanplay:b}),null,16,["src"])]))}}),wa={key:0},Oa={key:1},Fa=ve({__name:"preview",props:{modelValue:{type:Boolean,default:""},url:{type:String,default:""},type:{type:String,default:"image"}},emits:["update:modelValue"],setup(F,{emit:R}){const h=F,_=et(),T=()=>{R("update:modelValue",!1)};return Ge(()=>h.modelValue,A=>{var k;A?At(()=>{var I;(I=_.value)==null||I.play()}):(k=_.value)==null||k.pause()}),(A,k)=>{const I=ri,D=Ia,o=Wt;return Te((H(),q("div",null,[F.type=="image"?(H(),q("div",wa,[K(I,{"url-list":[F.url],"hide-on-click-modal":"",onClose:T},null,8,["url-list"])])):Q("",!0),F.type=="video"?(H(),q("div",Oa,[K(o,{modelValue:F.modelValue,"onUpdate:modelValue":k[0]||(k[0]=b=>Br(modelValue)?modelValue.value=b:null),width:"740px",title:"\u89C6\u9891\u9884\u89C8","before-close":T},{default:$(()=>[K(D,{ref_key:"playerRef",ref:_,src:F.url,width:"700px",height:"450px"},null,8,["src"])]),_:1},8,["modelValue"])])):Q("",!0)],512)),[[Se,F.modelValue]])}}});var Pa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAACJElEQVRYR+2YMWsUURSFz3m7s+nskjUIQSutbMRi7WzUVjSadMHCbVLkByjmLygaCVYWRqMEUhkFS9Gg0cJfYCPZjYUQFbPs+I7c2R1Q2ZjZfRNYYS4MAzPv3vnmvDvL3kMA2Hl5/CjLI9ckf4ZwY3Zt15C+gfwIao3So0rt3XsJtPUk9M/cAW6y9ap2DIyfAjgCwANwGeoYiEFtk/5e5CvXeer1D2neATcGgiTZM4+t9RNLEKcBtAFEGeBsiRWzl7EoSXo+8rV9gWc/fDc1B1VSEoEnDpj0KTB33tS26DGaEezvZQZpRxmODyoT5+vwBwS3zeTcT4yjTdZNJEiPSykk1bjZX6HeD/WQJ1zUApgq2w+etcsniBuAVlH9vELOx6Yo1VywgkmTB4X1kEGGhyAtg/Ecq3NNqnknDwVTrNBaactEts88OHs5b8Bw/Tof4M+kr4WrwwhoL9n5uRPWhxWwsxPEl+EGNMacP5I8evCPGgVgqKSFgoWCoQqE5hc9WCgYqkBoftGDeSiYz1/+UJLe+foftvh2A2B1fwQIrapkaFoDcK4PVyH0qVnyU4fjGdW4NQ2WlgDE5hLkMoJmQdh9zW9Dk59K5lhtLjyE01TX/jDILP5MGEbvbFPOJroIXvc5PjvTBbx7GM4vAjjd9WdSc2g/IPaqaTv5Aq58haP1TSb2Au20GGErvgTxIqiTAA7tVSnn+2Z9vAXdCsa4bD6Nsf0C/gYA5PMzcW0AAAAASUVORK5CYII=";const xa=ve({components:{PopoverInput:Jt,Pagination:Vt,Popup:Ht,Upload:Zt,FileItem:Xi,Preview:Fa},props:{fileSize:{type:String,default:"100px"},limit:{type:Number,default:1},type:{type:String,default:"image"},mode:{type:String,default:"select"},pageSize:{type:Number,default:10}},emits:["change"],setup(F,{emit:R}){const h=oe(null),{limit:_}=Ur(F),T=le(()=>{switch(F.type){case"image":return 10;case"video":return 20;case"file":return 30}}),A=Ut("visible"),k=oe(""),I=oe(!1),{cateId:D,cateLists:o,handleAddCate:b,handleEditCate:y,handleDeleteCate:d,getCateLists:p}=cn(T),{tableRef:m,listShowType:l,moveId:e,pager:i,fileParams:t,select:n,isCheckAll:u,isIndeterminate:a,getFileList:c,refresh:E,batchFileDelete:g,batchFileMove:v,selectFile:r,selectStatus:s,clearSelect:f,cancelSelete:S,selectAll:L,fileRename:C}=hn(D,T,_,F.pageSize),O=M=>{D.value=M.id},w=async()=>{var M;await p(),(M=h.value)==null||M.setCurrentKey(D.value),c()},P=M=>n.value.findIndex(N=>N.id==M)!=-1,x=M=>{k.value=M,I.value=!0};return Ge(A,async M=>{M&&w()},{immediate:!0}),Ge(D,M=>{t.name="",E()}),Ge(n,M=>{if(R("change",M),M.length==i.lists.length&&M.length!==0){a.value=!1,u.value=!0;return}M.length>0?a.value=!0:(u.value=!1,a.value=!1)},{deep:!0}),St(()=>{F.mode=="page"&&w()}),{showPreview:I,handlePreview:x,isSelected:P,tableRef:m,listShowType:l,previewUrl:k,treeRefs:h,Search:Gr,limit:_,cateId:D,cateLists:o,handleAddCate:b,handleEditCate:y,handleDeleteCate:d,currentChange:O,moveId:e,pager:i,fileParams:t,select:n,isCheckAll:u,isIndeterminate:a,getFileList:c,refresh:E,batchFileDelete:g,batchFileMove:v,selectFile:r,selectStatus:s,clearSelect:f,cancelSelete:S,selectAll:L,fileRename:C}}}),ht=F=>(je("data-v-7f24adba"),F=F(),Ve(),F),Ma={class:"material flex col-stretch"},Na={class:"material__left"},Ba={class:"material-left__content p-t-16 p-b-16"},Ua={class:"flex flex-1 flex-center",style:{"min-width":"0"}},Ga=ht(()=>j("img",{style:{width:"20px",height:"16px"},src:Pa,class:"m-r-10"},null,-1)),ja={class:"flex-1 line-1 m-r-10"},Va=ht(()=>j("span",{class:"muted m-r-10"},"\xB7\xB7\xB7",-1)),Ka=ee("\u547D\u540D\u5206\u7EC4"),Ha=["onClick"],Wa=ee("\u5220\u9664\u5206\u7EC4"),$a={class:"flex flex-center"},qa=ee("\u6DFB\u52A0\u5206\u7EC4"),Ya={class:"material__center flex flex-col"},za={class:"operate-btn flex"},Xa={class:"flex-1 flex"},Qa=ee("\u672C\u5730\u4E0A\u4F20"),Za=ee("\u5220\u9664"),Ja=ee("\u79FB\u52A8"),es=ht(()=>j("span",{class:"m-r-20"},"\u79FB\u52A8\u6587\u4EF6\u81F3",-1)),ts={class:"flex col-center m-l-10"},rs={key:0,class:"m-t-10"},is=ee("\u5F53\u9875\u5168\u9009"),ns={class:"material-center__content flex flex-col flex-1 m-b-4"},as={class:"file-list flex flex-wrap m-t-14"},ss={key:0,class:"item-selected"},os={class:"item-name line-1 xs p-t-10"},ls={class:"operation-btns flex col-center"},us=ee("\u91CD\u547D\u540D"),ds=ee("\u67E5\u770B"),cs=ee("\u5220\u9664"),hs=ee("\u91CD\u547D\u540D"),fs=ee("\u67E5\u770B"),gs=ee("\u5220\u9664"),ps={key:0,class:"flex flex-1 row-center col-center"},vs={class:"material-center__footer flex row-between col-center"},ms={class:"flex"},ys={class:"m-r-10"},Es=ee("\u5F53\u9875\u5168\u9009"),Ts=ee("\u5220\u9664"),Ss=ee("\u79FB\u52A8"),bs=ht(()=>j("span",{class:"m-r-20"},"\u79FB\u52A8\u6587\u4EF6\u81F3",-1)),As={key:0,class:"material__right"},Ls={class:"flex row-between p-l-10 p-r-10"},ks={class:"sm flex flex-center"},_s={key:0},Ds=ee("\u6E05\u7A7A"),Rs={class:"select-lists flex-col p-t-10"},Cs={class:"select-item"};function Is(F,R,h,_,T,A){const k=Vr,I=Jt,D=Kr,o=Hr,b=Zr,y=Wr,d=Gt,p=Zt,m=Ht,l=Xr,e=Qr,i=Kt,t=$r,n=jr,u=zr,a=ut("check"),c=xe,E=ut("file-item"),g=qr,v=Yr,r=Vt,s=Qt,f=ut("Preview");return H(),q("div",Ma,[j("div",Na,[K(y,{class:"ls-scrollbar",style:{height:"calc(100% - 40px)"}},{default:$(()=>[j("div",Ba,[K(b,{ref:"treeRefs","node-key":"id",data:F.cateLists,"empty-text":"","highlight-current":!0,"expand-on-click-node":!1,"icon-class":"el-icon-arrow-right","current-node-key":F.cateId,onNodeClick:F.currentChange},{default:$(({data:S})=>[j("div",Ua,[Ga,j("span",ja,ie(S.name),1),S.id>0?(H(),fe(o,{key:0,"hide-on-click":!1},{dropdown:$(()=>[K(D,null,{default:$(()=>[j("div",null,[K(I,{type:"text",tips:"\u5206\u7C7B\u540D\u79F0",onConfirm:L=>F.handleEditCate(L,S.id)},{default:$(()=>[K(k,null,{default:$(()=>[Ka]),_:1})]),_:2},1032,["onConfirm"])]),j("div",{onClick:L=>F.handleDeleteCate(S.id)},[K(k,null,{default:$(()=>[Wa]),_:1})],8,Ha)]),_:2},1024)]),default:$(()=>[Va]),_:2},1024)):Q("",!0)])]),_:1},8,["data","current-node-key","onNodeClick"])])]),_:1}),j("div",$a,[K(I,{tips:"\u5206\u7C7B\u540D\u79F0",type:"text",onConfirm:F.handleAddCate},{default:$(()=>[K(d,null,{default:$(()=>[qa]),_:1})]),_:1},8,["onConfirm"])])]),j("div",Ya,[j("div",za,[j("div",Xa,[K(p,{class:"m-r-10",data:{cid:F.cateId},type:F.type,"show-progress":!0,onChange:F.refresh},{default:$(()=>[K(d,{type:"primary"},{default:$(()=>[Qa]),_:1})]),_:1},8,["data","type","onChange"]),F.mode=="page"?(H(),fe(m,{key:0,class:"m-r-10 inline",content:"\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",disabled:!F.select.length,onConfirm:R[0]||(R[0]=S=>F.batchFileDelete())},{trigger:$(()=>[K(d,{disabled:!F.select.length},{default:$(()=>[Za]),_:1},8,["disabled"])]),_:1},8,["disabled"])):Q("",!0),F.mode=="page"?(H(),fe(m,{key:1,class:"m-r-10 inline",onConfirm:F.batchFileMove,disabled:!F.select.length,title:"\u79FB\u52A8\u6587\u4EF6"},{trigger:$(()=>[K(d,{disabled:!F.select.length},{default:$(()=>[Ja]),_:1},8,["disabled"])]),default:$(()=>[j("div",null,[es,K(e,{modelValue:F.moveId,"onUpdate:modelValue":R[1]||(R[1]=S=>F.moveId=S),placeholder:"\u8BF7\u9009\u62E9"},{default:$(()=>[(H(!0),q(ke,null,Oe(F.cateLists,S=>(H(),q(ke,{key:S.id},[S.id!==""?(H(),fe(l,{key:0,label:S.name,value:S.id},null,8,["label","value"])):Q("",!0)],64))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm","disabled"])):Q("",!0)]),K(i,{placeholder:"\u8BF7\u8F93\u5165\u540D\u5B57",style:{width:"280px"},modelValue:F.fileParams.name,"onUpdate:modelValue":R[2]||(R[2]=S=>F.fileParams.name=S),onKeyup:Be(F.refresh,["enter"])},{append:$(()=>[K(d,{icon:F.Search,onClick:F.refresh},null,8,["icon","onClick"])]),_:1},8,["modelValue","onKeyup"]),j("div",ts,[K(n,{content:"\u5217\u8868\u89C6\u56FE",placement:"top"},{default:$(()=>[j("div",{class:J(["list-icon",{select:F.listShowType=="table"}]),onClick:R[3]||(R[3]=S=>F.listShowType="table")},[K(t,{name:"el-icon-Fold",size:18})],2)]),_:1}),K(n,{content:"\u5E73\u94FA\u89C6\u56FE",placement:"top"},{default:$(()=>[j("div",{class:J(["list-icon",{select:F.listShowType=="normal"}]),onClick:R[4]||(R[4]=S=>F.listShowType="normal")},[K(t,{name:"el-icon-Menu",size:18})],2)]),_:1})])]),F.mode=="page"?(H(),q("div",rs,[K(u,{disabled:!F.pager.lists.length,modelValue:F.isCheckAll,"onUpdate:modelValue":R[5]||(R[5]=S=>F.isCheckAll=S),onChange:F.selectAll,indeterminate:F.isIndeterminate},{default:$(()=>[is]),_:1},8,["disabled","modelValue","onChange","indeterminate"])])):Q("",!0),j("div",ns,[Te(j("ul",as,[(H(!0),q(ke,null,Oe(F.pager.lists,S=>(H(),q("li",{class:"file-item-wrap",key:S.id,style:Ee({width:F.fileSize})},[K(E,{uri:S.uri,"file-size":F.fileSize,type:F.type,onClick:L=>F.selectFile(S)},{default:$(()=>[F.selectStatus(S.id)?(H(),q("div",ss,[K(c,{color:"#fff",size:24},{default:$(()=>[K(a)]),_:1})])):Q("",!0)]),_:2},1032,["uri","file-size","type","onClick"]),j("div",os,ie(S.name),1),j("div",ls,[K(I,{type:"text",value:S.name,onConfirm:L=>F.fileRename(L,S.id)},{default:$(()=>[K(d,{type:"primary",link:""},{default:$(()=>[us]),_:1})]),_:2},1032,["value","onConfirm"]),K(d,{type:"primary",link:"",onClick:L=>F.handlePreview(S.uri)},{default:$(()=>[ds]),_:2},1032,["onClick"]),K(m,{class:"m-r-10 inline",content:"\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",onConfirm:L=>F.batchFileDelete([S.id])},{trigger:$(()=>[K(d,{type:"primary",link:""},{default:$(()=>[cs]),_:1})]),_:2},1032,["onConfirm"])])],4))),128))],512),[[Se,F.listShowType=="normal"]]),Te(K(v,{ref:"tableRef",class:"m-t-16",data:F.pager.lists,width:"100%",height:"100%"},{default:$(()=>[K(g,{width:"55"},{default:$(({row:S})=>[K(u,{modelValue:F.isSelected(S.id),onChange:L=>F.selectFile(S)},null,8,["modelValue","onChange"])]),_:1}),K(g,{label:"\u56FE\u7247",width:"60"},{default:$(({row:S})=>[K(E,{uri:S.uri,"file-size":"40px"},null,8,["uri"])]),_:1}),K(g,{label:"\u540D\u79F0","min-width":"100","show-overflow-tooltip":""},{default:$(({row:S})=>[K(d,{type:"primary",link:"",onClick:L=>F.handlePreview(S.uri)},{default:$(()=>[ee(ie(S.name),1)]),_:2},1032,["onClick"])]),_:1}),K(g,{prop:"create_time",label:"\u4E0A\u4F20\u65F6\u95F4","min-width":"100"}),K(g,{label:"\u64CD\u4F5C",width:"150",fixed:"right"},{default:$(({row:S})=>[K(I,{class:"inline",type:"text",value:S.name,onConfirm:L=>F.fileRename(L,S.id)},{default:$(()=>[K(d,{type:"primary",link:""},{default:$(()=>[hs]),_:1})]),_:2},1032,["value","onConfirm"]),K(d,{type:"primary",link:"",onClick:L=>F.handlePreview(S.uri)},{default:$(()=>[fs]),_:2},1032,["onClick"]),K(m,{class:"m-r-10 inline",content:"\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",onConfirm:L=>F.batchFileDelete([S.id])},{trigger:$(()=>[K(d,{type:"primary",link:""},{default:$(()=>[gs]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),[[Se,F.listShowType=="table"]]),!F.pager.loading&&!F.pager.lists.length?(H(),q("div",ps,"\u6682\u65E0\u6570\u636E~")):Q("",!0)]),j("div",vs,[j("div",ms,[F.mode=="page"?(H(),q(ke,{key:0},[j("span",ys,[K(u,{disabled:!F.pager.lists.length,modelValue:F.isCheckAll,"onUpdate:modelValue":R[6]||(R[6]=S=>F.isCheckAll=S),onChange:F.selectAll,indeterminate:F.isIndeterminate},{default:$(()=>[Es]),_:1},8,["disabled","modelValue","onChange","indeterminate"])]),K(m,{class:"m-r-10 inline",content:"\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",disabled:!F.select.length,onConfirm:R[7]||(R[7]=S=>F.batchFileDelete())},{trigger:$(()=>[K(d,{disabled:!F.select.length},{default:$(()=>[Ts]),_:1},8,["disabled"])]),_:1},8,["disabled"]),K(m,{class:"m-r-10 inline",onConfirm:F.batchFileMove,disabled:!F.select.length,title:"\u79FB\u52A8\u6587\u4EF6"},{trigger:$(()=>[K(d,{disabled:!F.select.length},{default:$(()=>[Ss]),_:1},8,["disabled"])]),default:$(()=>[j("div",null,[bs,K(e,{modelValue:F.moveId,"onUpdate:modelValue":R[8]||(R[8]=S=>F.moveId=S),placeholder:"\u8BF7\u9009\u62E9"},{default:$(()=>[(H(!0),q(ke,null,Oe(F.cateLists,S=>(H(),q(ke,{key:S.id},[S.id!==""?(H(),fe(l,{key:0,label:S.name,value:S.id},null,8,["label","value"])):Q("",!0)],64))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm","disabled"])],64)):Q("",!0)]),K(r,{modelValue:F.pager,"onUpdate:modelValue":R[9]||(R[9]=S=>F.pager=S),onChange:F.getFileList,layout:"total, prev, pager, next, jumper"},null,8,["modelValue","onChange"])])]),F.mode=="select"?(H(),q("div",As,[j("div",Ls,[j("div",ks,[ee(" \u5DF2\u9009\u62E9 "+ie(F.select.length)+" ",1),F.limit?(H(),q("span",_s,"/"+ie(F.limit),1)):Q("",!0)]),K(d,{type:"text",onClick:F.clearSelect},{default:$(()=>[Ds]),_:1},8,["onClick"])]),K(y,{class:"ls-scrollbar",style:{height:"calc(100% - 32px)"}},{default:$(()=>[j("ul",Rs,[(H(!0),q(ke,null,Oe(F.select,S=>(H(),q("li",{class:"m-b-16",key:S.id},[j("div",Cs,[K(s,{onClose:L=>F.cancelSelete(S.id)},{default:$(()=>[K(E,{uri:S.uri,"file-size":"100px",type:F.type},null,8,["uri","type"])]),_:2},1032,["onClose"])])]))),128))])]),_:1})])):Q("",!0),K(f,{modelValue:F.showPreview,"onUpdate:modelValue":R[10]||(R[10]=S=>F.showPreview=S),url:F.previewUrl,type:F.type},null,8,["modelValue","url","type"])])}var Hs=lt(xa,[["render",Is],["__scopeId","data-v-7f24adba"]]);export{Xi as F,Hs as M,Fa as _,Qt as a};

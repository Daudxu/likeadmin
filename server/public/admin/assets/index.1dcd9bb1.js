import{ac as Ze,bC as ar,d as ye,P as Qe,j as K,k as q,Q as pe,w as X,Z as Ut,n as N,aF as Ge,Y as J,V as ee,W as me,$ as at,a3 as Lt,ad as he,e as de,c7 as sr,c8 as Gt,b6 as or,c9 as jt,aI as Vt,af as lr,D as Rt,l as j,a0 as ke,t as se,ag as At,ca as ur,aA as Et,aC as be,aU as dr,r as ge,az as Pe,p as je,m as H,cb as cr,aT as Ce,cc as fr,cd as hr,X as Re,ce as gr,H as pr,z as Kt,s as Ne,cf as vr,cg as mr,K as Ve,L as yr,O as Er,bq as Tr,ah as Sr,a1 as br,ch as kr,bb as Ct,bX as dt,_ as gt,x as Ht,a as Lr,ci as Ar,bR as Tt,b5 as _r,bA as Dr,b2 as Wt,bE as Ke,f as nt,cj as Rr,ck as He,cl as We,q as oe,R as Se,aP as Le,o as _t,aO as $t,ao as St,cm as Cr,cn as Dt,N as ht,M as Ir,co as wr,T as rt,a2 as Or,cp as xr,cq as Pr,cr as Fr,b1 as Mr,i as Nr,h as Br}from"./index.e2e7edc0.js";import{v as Ur}from"./el-loading.50b86702.js";import{_ as Gr}from"./index.c57ed2f5.js";import{E as jr,a as Vr}from"./el-table-column.852b9ccc.js";import{E as Kr}from"./el-checkbox.e0535dea.js";/* empty css               */import{P as Hr}from"./index.c43fd295.js";import{E as Wr,a as $r}from"./el-select.f9bfaab6.js";import{E as qt}from"./index.f20416ed.js";import{E as qr}from"./el-tree.792f8ac5.js";import{u as Yr}from"./paging.9dd8781e.js";import{f as ut}from"./feedback.dc340fdd.js";const Yt=Symbol("uploadContextKey"),zr=Ze({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},icon:{type:ar,default:""}}),Xr={click:P=>P instanceof MouseEvent},Qr=["href"],Zr={name:"ElLink"},Jr=ye({...Zr,props:zr,emits:Xr,setup(P,{emit:C}){const f=P,A=Qe("link");function T(b){f.disabled||C("click",b)}return(b,_)=>(K(),q("a",{class:ee([N(A).b(),N(A).m(b.type),N(A).is("disabled",b.disabled),N(A).is("underline",b.underline&&!b.disabled)]),href:b.disabled||!b.href?void 0:b.href,onClick:T},[b.icon?(K(),pe(N(Ge),{key:0},{default:X(()=>[(K(),pe(Ut(b.icon)))]),_:1})):J("v-if",!0),b.$slots.default?(K(),q("span",{key:1,class:ee(N(A).e("inner"))},[me(b.$slots,"default")],2)):J("v-if",!0),b.$slots.icon?me(b.$slots,"icon",{key:2}):J("v-if",!0)],10,Qr))}});var ei=at(Jr,[["__file","/home/runner/work/element-plus/element-plus/packages/components/link/src/link.vue"]]);const ti=Lt(ei),ri=Ze({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:P=>P>=0&&P<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:he(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:he([String,Array,Function]),default:""},format:{type:he(Function),default:P=>`${P}%`}}),ii=["aria-valuenow"],ni={viewBox:"0 0 100 100"},ai=["d","stroke","stroke-width"],si=["d","stroke","opacity","stroke-linecap","stroke-width"],oi={key:0},li={name:"ElProgress"},ui=ye({...li,props:ri,setup(P){const C=P,f={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},A=Qe("progress"),T=de(()=>({width:`${C.percentage}%`,animationDuration:`${C.duration}s`,backgroundColor:t(C.percentage)})),b=de(()=>(C.strokeWidth/C.width*100).toFixed(1)),_=de(()=>["circle","dashboard"].includes(C.type)?Number.parseInt(`${50-Number.parseFloat(b.value)/2}`,10):0),I=de(()=>{const n=_.value,l=C.type==="dashboard";return`
          M 50 50
          m 0 ${l?"":"-"}${n}
          a ${n} ${n} 0 1 1 0 ${l?"-":""}${n*2}
          a ${n} ${n} 0 1 1 0 ${l?"":"-"}${n*2}
          `}),D=de(()=>2*Math.PI*_.value),o=de(()=>C.type==="dashboard"?.75:1),S=de(()=>`${-1*D.value*(1-o.value)/2}px`),m=de(()=>({strokeDasharray:`${D.value*o.value}px, ${D.value}px`,strokeDashoffset:S.value})),c=de(()=>({strokeDasharray:`${D.value*o.value*(C.percentage/100)}px, ${D.value}px`,strokeDashoffset:S.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),p=de(()=>{let n;return C.color?n=t(C.percentage):n=f[C.status]||f.default,n}),y=de(()=>C.status==="warning"?sr:C.type==="line"?C.status==="success"?Gt:or:C.status==="success"?jt:Vt),u=de(()=>C.type==="line"?12+C.strokeWidth*.4:C.width*.111111+2),e=de(()=>C.format(C.percentage));function i(n){const l=100/n.length;return n.map((d,E)=>Rt(d)?{color:d,percentage:(E+1)*l}:d).sort((d,E)=>d.percentage-E.percentage)}const t=n=>{var l;const{color:a}=C;if(lr(a))return a(n);if(Rt(a))return a;{const d=i(a);for(const E of d)if(E.percentage>n)return E.color;return(l=d[d.length-1])==null?void 0:l.color}};return(n,l)=>(K(),q("div",{class:ee([N(A).b(),N(A).m(n.type),N(A).is(n.status),{[N(A).m("without-text")]:!n.showText,[N(A).m("text-inside")]:n.textInside}]),role:"progressbar","aria-valuenow":n.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[n.type==="line"?(K(),q("div",{key:0,class:ee(N(A).b("bar"))},[j("div",{class:ee(N(A).be("bar","outer")),style:ke({height:`${n.strokeWidth}px`})},[j("div",{class:ee([N(A).be("bar","inner"),{[N(A).bem("bar","inner","indeterminate")]:n.indeterminate}]),style:ke(N(T))},[(n.showText||n.$slots.default)&&n.textInside?(K(),q("div",{key:0,class:ee(N(A).be("bar","innerText"))},[me(n.$slots,"default",{percentage:n.percentage},()=>[j("span",null,se(N(e)),1)])],2)):J("v-if",!0)],6)],6)],2)):(K(),q("div",{key:1,class:ee(N(A).b("circle")),style:ke({height:`${n.width}px`,width:`${n.width}px`})},[(K(),q("svg",ni,[j("path",{class:ee(N(A).be("circle","track")),d:N(I),stroke:`var(${N(A).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":N(b),fill:"none",style:ke(N(m))},null,14,ai),j("path",{class:ee(N(A).be("circle","path")),d:N(I),stroke:N(p),fill:"none",opacity:n.percentage?1:0,"stroke-linecap":n.strokeLinecap,"stroke-width":N(b),style:ke(N(c))},null,14,si)]))],6)),(n.showText||n.$slots.default)&&!n.textInside?(K(),q("div",{key:2,class:ee(N(A).e("text")),style:ke({fontSize:`${N(u)}px`})},[me(n.$slots,"default",{percentage:n.percentage},()=>[n.status?(K(),pe(N(Ge),{key:1},{default:X(()=>[(K(),pe(Ut(N(y))))]),_:1})):(K(),q("span",oi,se(N(e)),1))])],6)):J("v-if",!0)],10,ii))}});var di=at(ui,[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]);const zt=Lt(di),ci="ElUpload";class fi extends Error{constructor(C,f,A,T){super(C),this.name="UploadAjaxError",this.status=f,this.method=A,this.url=T}}function It(P,C,f){let A;return f.response?A=`${f.response.error||f.response}`:f.responseText?A=`${f.responseText}`:A=`fail to ${C.method} ${P} ${f.status}`,new fi(A,f.status,C.method,P)}function hi(P){const C=P.responseText||P.response;if(!C)return C;try{return JSON.parse(C)}catch{return C}}const gi=P=>{typeof XMLHttpRequest>"u"&&At(ci,"XMLHttpRequest is undefined");const C=new XMLHttpRequest,f=P.action;C.upload&&C.upload.addEventListener("progress",b=>{const _=b;_.percent=b.total>0?b.loaded/b.total*100:0,P.onProgress(_)});const A=new FormData;if(P.data)for(const[b,_]of Object.entries(P.data))Array.isArray(_)?A.append(b,..._):A.append(b,_);A.append(P.filename,P.file,P.file.name),C.addEventListener("error",()=>{P.onError(It(f,P,C))}),C.addEventListener("load",()=>{if(C.status<200||C.status>=300)return P.onError(It(f,P,C));P.onSuccess(hi(C))}),C.open(P.method,f,!0),P.withCredentials&&"withCredentials"in C&&(C.withCredentials=!0);const T=P.headers||{};if(T instanceof Headers)T.forEach((b,_)=>C.setRequestHeader(_,b));else for(const[b,_]of Object.entries(T))ur(_)||C.setRequestHeader(b,String(_));return C.send(A),C},Xt=["text","picture","picture-card"];let pi=1;const Qt=()=>Date.now()+pi++,Zt=Ze({action:{type:String,default:"#"},headers:{type:he(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>Et({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:he(Array),default:()=>Et([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:Xt,default:"text"},httpRequest:{type:he(Function),default:gi},disabled:Boolean,limit:Number}),vi=Ze({...Zt,beforeUpload:{type:he(Function),default:be},beforeRemove:{type:he(Function)},onRemove:{type:he(Function),default:be},onChange:{type:he(Function),default:be},onPreview:{type:he(Function),default:be},onSuccess:{type:he(Function),default:be},onProgress:{type:he(Function),default:be},onError:{type:he(Function),default:be},onExceed:{type:he(Function),default:be}}),mi=Ze({files:{type:he(Array),default:()=>Et([])},disabled:{type:Boolean,default:!1},handlePreview:{type:he(Function),default:be},listType:{type:String,values:Xt,default:"text"}}),yi={remove:P=>!!P},Ei=["onKeydown"],Ti=["src"],Si=["onClick"],bi=["onClick"],ki=["onClick"],Li={name:"ElUploadList"},Ai=ye({...Li,props:mi,emits:yi,setup(P,{emit:C}){const f=P,{t:A}=dr(),T=Qe("upload"),b=Qe("icon"),_=Qe("list"),I=ge(!1),D=S=>{f.handlePreview(S)},o=S=>{C("remove",S)};return(S,m)=>(K(),pe(gr,{tag:"ul",class:ee([N(T).b("list"),N(T).bm("list",S.listType),N(T).is("disabled",S.disabled)]),name:N(_).b()},{default:X(()=>[(K(!0),q(Re,null,Pe(S.files,c=>(K(),q("li",{key:c.uid||c.name,class:ee([N(T).be("list","item"),N(T).is(c.status),{focusing:I.value}]),tabindex:"0",onKeydown:je(p=>!S.disabled&&o(c),["delete"]),onFocus:m[0]||(m[0]=p=>I.value=!0),onBlur:m[1]||(m[1]=p=>I.value=!1),onClick:m[2]||(m[2]=p=>I.value=!1)},[me(S.$slots,"default",{file:c},()=>[S.listType==="picture"||c.status!=="uploading"&&S.listType==="picture-card"?(K(),q("img",{key:0,class:ee(N(T).be("list","item-thumbnail")),src:c.url,alt:""},null,10,Ti)):J("v-if",!0),S.listType!=="picture"&&(c.status==="uploading"||S.listType!=="picture-card")?(K(),q("div",{key:1,class:ee(N(T).be("list","item-info"))},[j("a",{class:ee(N(T).be("list","item-name")),onClick:Ce(p=>D(c),["prevent"])},[H(N(Ge),{class:ee(N(b).m("document"))},{default:X(()=>[H(N(cr))]),_:1},8,["class"]),j("span",{class:ee(N(T).be("list","item-file-name"))},se(c.name),3)],10,Si),c.status==="uploading"?(K(),pe(N(zt),{key:0,type:S.listType==="picture-card"?"circle":"line","stroke-width":S.listType==="picture-card"?6:2,percentage:Number(c.percentage),style:ke(S.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):J("v-if",!0)],2)):J("v-if",!0),j("label",{class:ee(N(T).be("list","item-status-label"))},[S.listType==="text"?(K(),pe(N(Ge),{key:0,class:ee([N(b).m("upload-success"),N(b).m("circle-check")])},{default:X(()=>[H(N(Gt))]),_:1},8,["class"])):["picture-card","picture"].includes(S.listType)?(K(),pe(N(Ge),{key:1,class:ee([N(b).m("upload-success"),N(b).m("check")])},{default:X(()=>[H(N(jt))]),_:1},8,["class"])):J("v-if",!0)],2),S.disabled?J("v-if",!0):(K(),pe(N(Ge),{key:2,class:ee(N(b).m("close")),onClick:p=>o(c)},{default:X(()=>[H(N(Vt))]),_:2},1032,["class","onClick"])),J(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),J(" This is a bug which needs to be fixed "),J(" TODO: Fix the incorrect navigation interaction "),S.disabled?J("v-if",!0):(K(),q("i",{key:3,class:ee(N(b).m("close-tip"))},se(N(A)("el.upload.deleteTip")),3)),S.listType==="picture-card"?(K(),q("span",{key:4,class:ee(N(T).be("list","item-actions"))},[j("span",{class:ee(N(T).be("list","item-preview")),onClick:p=>S.handlePreview(c)},[H(N(Ge),{class:ee(N(b).m("zoom-in"))},{default:X(()=>[H(N(fr))]),_:1},8,["class"])],10,bi),S.disabled?J("v-if",!0):(K(),q("span",{key:0,class:ee(N(T).be("list","item-delete")),onClick:p=>o(c)},[H(N(Ge),{class:ee(N(b).m("delete"))},{default:X(()=>[H(N(hr))]),_:1},8,["class"])],10,ki))],2)):J("v-if",!0)])],42,Ei))),128)),me(S.$slots,"append")]),_:3},8,["class","name"]))}});var wt=at(Ai,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const _i=Ze({disabled:{type:Boolean,default:!1}}),Di={file:P=>pr(P)},Ri=["onDrop","onDragover"],Ci={name:"ElUploadDrag"},Ii=ye({...Ci,props:_i,emits:Di,setup(P,{emit:C}){const f=P,A="ElUploadDrag",T=Kt(Yt);T||At(A,"usage: <el-upload><el-upload-dragger /></el-upload>");const b=Qe("upload"),_=ge(!1),I=o=>{if(f.disabled)return;_.value=!1;const S=Array.from(o.dataTransfer.files),m=T.accept.value;if(!m){C("file",S);return}const c=S.filter(p=>{const{type:y,name:u}=p,e=u.includes(".")?`.${u.split(".").pop()}`:"",i=y.replace(/\/.*$/,"");return m.split(",").map(t=>t.trim()).filter(t=>t).some(t=>t.startsWith(".")?e===t:/\/\*$/.test(t)?i===t.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(t)?y===t:!1)});C("file",c)},D=()=>{f.disabled||(_.value=!0)};return(o,S)=>(K(),q("div",{class:ee([N(b).b("dragger"),N(b).is("dragover",_.value)]),onDrop:Ce(I,["prevent"]),onDragover:Ce(D,["prevent"]),onDragleave:S[0]||(S[0]=Ce(m=>_.value=!1,["prevent"]))},[me(o.$slots,"default")],42,Ri))}});var wi=at(Ii,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const Oi=Ze({...Zt,beforeUpload:{type:he(Function),default:be},onRemove:{type:he(Function),default:be},onStart:{type:he(Function),default:be},onSuccess:{type:he(Function),default:be},onProgress:{type:he(Function),default:be},onError:{type:he(Function),default:be},onExceed:{type:he(Function),default:be}}),xi=["onKeydown"],Pi=["name","multiple","accept"],Fi={name:"ElUploadContent",inheritAttrs:!1},Mi=ye({...Fi,props:Oi,setup(P,{expose:C}){const f=P,A=Qe("upload"),T=Ne({}),b=Ne(),_=p=>{if(p.length===0)return;const{autoUpload:y,limit:u,fileList:e,multiple:i,onStart:t,onExceed:n}=f;if(u&&e.length+p.length>u){n(p,e);return}i||(p=p.slice(0,1));for(const l of p){const a=l;a.uid=Qt(),t(a),y&&I(a)}},I=async p=>{if(b.value.value="",!f.beforeUpload)return D(p);let y;try{y=await f.beforeUpload(p)}catch{y=!1}if(y===!1){f.onRemove(p);return}let u=p;y instanceof Blob&&(y instanceof File?u=y:u=new File([y],p.name,{type:p.type})),D(Object.assign(u,{uid:p.uid}))},D=p=>{const{headers:y,data:u,method:e,withCredentials:i,name:t,action:n,onProgress:l,onSuccess:a,onError:d,httpRequest:E}=f,{uid:g}=p,v={headers:y||{},withCredentials:i,file:p,data:u,method:e,filename:t,action:n,onProgress:s=>{l(s,p)},onSuccess:s=>{a(s,p),delete T.value[g]},onError:s=>{d(s,p),delete T.value[g]}},r=E(v);T.value[g]=r,r instanceof Promise&&r.then(v.onSuccess,v.onError)},o=p=>{const y=p.target.files;!y||_(Array.from(y))},S=()=>{f.disabled||(b.value.value="",b.value.click())},m=()=>{S()};return C({abort:p=>{vr(T.value).filter(p?([u])=>String(p.uid)===u:()=>!0).forEach(([u,e])=>{e instanceof XMLHttpRequest&&e.abort(),delete T.value[u]})},upload:I}),(p,y)=>(K(),q("div",{class:ee([N(A).b(),N(A).m(p.listType),N(A).is("drag",p.drag)]),tabindex:"0",onClick:S,onKeydown:je(Ce(m,["self"]),["enter","space"])},[p.drag?(K(),pe(wi,{key:0,disabled:p.disabled,onFile:_},{default:X(()=>[me(p.$slots,"default")]),_:3},8,["disabled"])):me(p.$slots,"default",{key:1}),j("input",{ref_key:"inputRef",ref:b,class:ee(N(A).e("input")),name:p.name,multiple:p.multiple,accept:p.accept,type:"file",onChange:o,onClick:y[0]||(y[0]=Ce(()=>{},["stop"]))},null,42,Pi)],42,xi))}});var Ot=at(Mi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const xt="ElUpload",Ni=P=>{var C;(C=P.url)!=null&&C.startsWith("blob:")&&URL.revokeObjectURL(P.url)},Bi=(P,C)=>{const f=mr(P,"fileList",void 0,{passive:!0}),A=c=>f.value.find(p=>p.uid===c.uid);function T(c){var p;(p=C.value)==null||p.abort(c)}function b(c=["ready","uploading","success","fail"]){f.value=f.value.filter(p=>!c.includes(p.status))}const _=(c,p)=>{const y=A(p);!y||(console.error(c),y.status="fail",f.value.splice(f.value.indexOf(y),1),P.onError(c,y,f.value),P.onChange(y,f.value))},I=(c,p)=>{const y=A(p);!y||(P.onProgress(c,y,f.value),y.status="uploading",y.percentage=Math.round(c.percent))},D=(c,p)=>{const y=A(p);!y||(y.status="success",y.response=c,P.onSuccess(c,y,f.value),P.onChange(y,f.value))},o=c=>{const p={name:c.name,percentage:0,status:"ready",size:c.size,raw:c,uid:c.uid};if(P.listType==="picture-card"||P.listType==="picture")try{p.url=URL.createObjectURL(c)}catch(y){yr(xt,y.message),P.onError(y,p,f.value)}f.value.push(p),P.onChange(p,f.value)},S=async c=>{const p=c instanceof File?A(c):c;p||At(xt,"file to be removed not found");const y=u=>{T(u);const e=f.value;e.splice(e.indexOf(u),1),P.onRemove(u,e),Ni(u)};P.beforeRemove?await P.beforeRemove(p,f.value)!==!1&&y(p):y(p)};function m(){f.value.filter(({status:c})=>c==="ready").forEach(({raw:c})=>{var p;return c&&((p=C.value)==null?void 0:p.upload(c))})}return Ve(()=>P.listType,c=>{c!=="picture-card"&&c!=="picture"||(f.value=f.value.map(p=>{const{raw:y,url:u}=p;if(!u&&y)try{p.url=URL.createObjectURL(y)}catch(e){P.onError(e,p,f.value)}return p}))}),Ve(f,c=>{for(const p of c)p.uid||(p.uid=Qt()),p.status||(p.status="success")},{immediate:!0,deep:!0}),{uploadFiles:f,abort:T,clearFiles:b,handleError:_,handleProgress:I,handleStart:o,handleSuccess:D,handleRemove:S,submit:m}},Ui={name:"ElUpload"},Gi=ye({...Ui,props:vi,setup(P,{expose:C}){const f=P,A=Er(),T=Tr(),b=Ne(),{abort:_,submit:I,clearFiles:D,uploadFiles:o,handleStart:S,handleError:m,handleRemove:c,handleSuccess:p,handleProgress:y}=Bi(f,b),u=de(()=>f.listType==="picture-card"),e=de(()=>({...f,onStart:S,onProgress:y,onSuccess:p,onError:m,onRemove:c}));return Sr(()=>{o.value.forEach(({url:i})=>{i!=null&&i.startsWith("blob:")&&URL.revokeObjectURL(i)})}),br(Yt,{accept:kr(f,"accept")}),C({abort:_,submit:I,clearFiles:D,handleStart:S,handleRemove:c}),(i,t)=>(K(),q("div",null,[N(u)&&i.showFileList?(K(),pe(wt,{key:0,disabled:N(T),"list-type":i.listType,files:N(o),"handle-preview":i.onPreview,onRemove:N(c)},Ct({append:X(()=>[i.listType==="picture-card"?(K(),pe(Ot,dt({key:0,ref_key:"uploadRef",ref:b},N(e)),{default:X(()=>[N(A).trigger?me(i.$slots,"trigger",{key:0}):J("v-if",!0),!N(A).trigger&&N(A).default?me(i.$slots,"default",{key:1}):J("v-if",!0)]),_:3},16)):J("v-if",!0)]),_:2},[i.$slots.file?{name:"default",fn:X(({file:n})=>[me(i.$slots,"file",{file:n})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):J("v-if",!0),i.listType!=="picture-card"?(K(),pe(Ot,dt({key:1,ref_key:"uploadRef",ref:b},N(e)),{default:X(()=>[N(A).trigger?me(i.$slots,"trigger",{key:0}):J("v-if",!0),!N(A).trigger&&N(A).default?me(i.$slots,"default",{key:1}):J("v-if",!0)]),_:3},16)):J("v-if",!0),i.$slots.trigger?me(i.$slots,"default",{key:2}):J("v-if",!0),me(i.$slots,"tip"),!N(u)&&i.showFileList?(K(),pe(wt,{key:3,disabled:N(T),"list-type":i.listType,files:N(o),"handle-preview":i.onPreview,onRemove:N(c)},Ct({_:2},[i.$slots.file?{name:"default",fn:X(({file:n})=>[me(i.$slots,"file",{file:n})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):J("v-if",!0)]))}});var ji=at(Gi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Vi=Lt(ji);const Ki=ye({props:{showClose:{type:Boolean,default:!0}},emits:["close"],setup(P,{emit:C}){return{handleClose:()=>{C("close")}}}}),Hi={class:"del-wrap"};function Wi(P,C,f,A,T,b){const _=Ht;return K(),q("div",Hi,[me(P.$slots,"default",{},void 0,!0),P.showClose?(K(),q("div",{key:0,class:"icon-close",onClick:C[0]||(C[0]=Ce((...I)=>P.handleClose&&P.handleClose(...I),["stop"]))},[H(_,{size:12,name:"el-icon-CloseBold"})])):J("",!0)])}const $i=gt(Ki,[["render",Wi],["__scopeId","data-v-2f279388"]]);const qi=ye({components:{},props:{type:{type:String,default:"image"},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},showProgress:{type:Boolean,default:!1}},emits:["change","error"],setup(P,{emit:C}){const f=Lr(),A=Ne(),T=ge(`/adminapi/upload/${P.type}`),b=de(()=>({token:f.token,version:Ar.version})),_=ge(!1),I=ge([]);return{uploadRefs:A,action:T,headers:b,visible:_,fileList:I,handleProgress:(p,y,u)=>{_.value=!0,I.value=u},handleSuccess:(p,y,u)=>{var i;u.every(t=>t.status=="success")&&((i=A.value)==null||i.clearFiles(),_.value=!1,C("change"))},handleError:(p,y)=>{var u;Tt.error(`${y.name}\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25`),(u=A.value)==null||u.abort(y),_.value=!1,C("change"),C("error")},handleExceed:()=>{Tt.error("\u8D85\u51FA\u4E0A\u4F20\u4E0A\u9650\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20")},handleClose:()=>{var p;(p=A.value)==null||p.clearFiles(),_.value=!1}}}}),Yi={class:"upload"},zi={class:"file-list"},Xi={class:"flex-1"};function Qi(P,C,f,A,T,b){const _=Vi,I=zt,D=qt;return K(),q("div",Yi,[H(_,{ref:"uploadRefs",action:P.action,multiple:P.multiple,limit:P.limit,"show-file-list":!1,headers:P.headers,data:P.data,"on-progress":P.handleProgress,"on-success":P.handleSuccess,"on-exceed":P.handleExceed,"on-error":P.handleError},{default:X(()=>[me(P.$slots,"default")]),_:3},8,["action","multiple","limit","headers","data","on-progress","on-success","on-exceed","on-error"]),P.showProgress&&P.fileList.length?(K(),pe(D,{key:0,modelValue:P.visible,"onUpdate:modelValue":C[0]||(C[0]=o=>P.visible=o),title:"\u4E0A\u4F20\u8FDB\u5EA6","close-on-click-modal":!1,width:"500px",modal:!1,"before-close":P.handleClose},{default:X(()=>[j("div",zi,[(K(!0),q(Re,null,Pe(P.fileList,(o,S)=>(K(),q("div",{key:S,class:"mb-5"},[j("div",null,se(o.name),1),j("div",Xi,[H(I,{percentage:parseInt(o.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue","before-close"])):J("",!0)])}const Zi=gt(qi,[["render",Qi]]),Ji=ye({__name:"index",props:_r,setup(P){const C=P,f=Ne(),A=ge(!1);return Dr(f,"mouseenter",()=>{var T,b;((T=f.value)==null?void 0:T.scrollWidth)>((b=f.value)==null?void 0:b.offsetWidth)?A.value=!1:A.value=!0}),(T,b)=>{const _=Wt;return K(),q("div",null,[H(_,dt(C,{disabled:A.value,placement:"top",teleported:!1}),{default:X(()=>[j("div",{ref_key:"textRef",ref:f,class:"overflow-text truncate"},se(T.content),513)]),_:1},16,["disabled"])])}}}),en="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAACJElEQVRYR+2YMWsUURSFz3m7s+nskjUIQSutbMRi7WzUVjSadMHCbVLkByjmLygaCVYWRqMEUhkFS9Gg0cJfYCPZjYUQFbPs+I7c2R1Q2ZjZfRNYYS4MAzPv3vnmvDvL3kMA2Hl5/CjLI9ckf4ZwY3Zt15C+gfwIao3So0rt3XsJtPUk9M/cAW6y9ap2DIyfAjgCwANwGeoYiEFtk/5e5CvXeer1D2neATcGgiTZM4+t9RNLEKcBtAFEGeBsiRWzl7EoSXo+8rV9gWc/fDc1B1VSEoEnDpj0KTB33tS26DGaEezvZQZpRxmODyoT5+vwBwS3zeTcT4yjTdZNJEiPSykk1bjZX6HeD/WQJ1zUApgq2w+etcsniBuAVlH9vELOx6Yo1VywgkmTB4X1kEGGhyAtg/Ecq3NNqnknDwVTrNBaactEts88OHs5b8Bw/Tof4M+kr4WrwwhoL9n5uRPWhxWwsxPEl+EGNMacP5I8evCPGgVgqKSFgoWCoQqE5hc9WCgYqkBoftGDeSiYz1/+UJLe+foftvh2A2B1fwQIrapkaFoDcK4PVyH0qVnyU4fjGdW4NQ2WlgDE5hLkMoJmQdh9zW9Dk59K5lhtLjyE01TX/jDILP5MGEbvbFPOJroIXvc5PjvTBbx7GM4vAjjd9WdSc2g/IPaqaTv5Aq58haP1TSb2Au20GGErvgTxIqiTAA7tVSnn+2Z9vAXdCsa4bD6Nsf0C/gYA5PMzcW0AAAAASUVORK5CYII=";function tn(P){return Ke.post("/file/addCate",P)}function rn(P){return Ke.post("/file/editCate",P)}function nn(P){return Ke.post("/file/delCate",P)}function an(P){return Ke.get("/file/listCate",P)}function sn(P){return Ke.get("/file/lists",P)}function on(P){return Ke.post("/file/delete",P)}function ln(P){return Ke.post("/file/move",P)}function un(P){return Ke.post("/file/rename",P)}function dn(P){const C=Ne(),f=ge([]),A=ge(""),T=async()=>{const o=await an({type:P,page_type:0}),S=[{name:"\u5168\u90E8",id:""},{name:"\u672A\u5206\u7EC4",id:0}];f.value=o==null?void 0:o.lists,f.value.unshift(...S)};return{treeRef:C,cateId:A,cateLists:f,handleAddCate:async()=>{const{value:o}=await ut.prompt("","\u6DFB\u52A0\u5206\u7EC4");await tn({type:P,name:o,pid:0}),T()},handleEditCate:async(o,S)=>{const{value:m}=await ut.prompt("","\u91CD\u547D\u5206\u7EC4",{inputValue:o});await rn({id:S,name:m}),T()},handleDeleteCate:async o=>{await ut.confirm("\u786E\u8BA4\u8981\u5220\u9664\uFF1F"),await nn({id:o}),T()},getCateLists:T,handleCatSelect:o=>{A.value=o.id}}}function cn(P,C,f,A){const T=Ne(),b=ge("normal"),_=ge(0),I=ge([]),D=ge(!1),o=ge(!1),S=nt({name:"",type:C,cid:P}),{pager:m,getLists:c,resetPage:p}=Yr({fetchFun:sn,params:S,firstLoading:!0,size:A}),y=()=>{c()},u=()=>{p()},e=g=>!!I.value.find(v=>v.id==g),i=async g=>{await ut.confirm("\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01");const v=g||I.value.map(r=>r.id);await on({ids:v}),y(),l()},t=async()=>{const g=I.value.map(v=>v.id);await ln({ids:g,cid:_.value}),_.value=0,y(),l()},n=g=>{const v=I.value.findIndex(r=>r.id==g.id);if(v!=-1){I.value.splice(v,1);return}if(I.value.length==f.value){if(f.value==1){I.value=[],I.value.push(g);return}Tt.warning("\u5DF2\u8FBE\u5230\u9009\u62E9\u4E0A\u9650");return}I.value.push(g)},l=()=>{I.value=[]};return{listShowType:b,tableRef:T,moveId:_,pager:m,fileParams:S,select:I,isCheckAll:D,isIndeterminate:o,getFileList:y,refresh:u,batchFileDelete:i,batchFileMove:t,selectFile:n,isSelect:e,clearSelect:l,cancelSelete:g=>{I.value=I.value.filter(v=>v.id!=g)},selectAll:g=>{var v;if(o.value=!1,(v=T.value)==null||v.toggleAllSelection(),g){I.value=[...m.lists];return}l()},handleFileRename:async(g,v)=>{const{value:r}=await ut.prompt("","\u91CD\u547D\u540D",{inputValue:g});await un({id:v,name:r}),y()}}}const fn=ye({props:{uri:{type:String},fileSize:{type:String,default:"100px"},type:{type:String,default:"image"}},emits:["close"]}),hn=["src"];function gn(P,C,f,A,T,b){const _=Rr;return K(),q("div",null,[j("div",{class:"file-item",style:ke({height:P.fileSize,width:P.fileSize})},[P.type=="image"?(K(),pe(_,{key:0,class:"image",fit:"contain",src:P.uri},null,8,["src"])):P.type=="video"?(K(),q("video",{key:1,class:"video",src:P.uri},null,8,hn)):J("",!0),me(P.$slots,"default",{},void 0,!0)],4)])}const vt=gt(fn,[["render",gn],["__scopeId","data-v-a79dbce2"]]);var pn=Object.defineProperty,vn=Object.defineProperties,mn=Object.getOwnPropertyDescriptors,Pt=Object.getOwnPropertySymbols,yn=Object.prototype.hasOwnProperty,En=Object.prototype.propertyIsEnumerable,Ft=(P,C,f)=>C in P?pn(P,C,{enumerable:!0,configurable:!0,writable:!0,value:f}):P[C]=f,bt=(P,C)=>{for(var f in C||(C={}))yn.call(C,f)&&Ft(P,f,C[f]);if(Pt)for(var f of Pt(C))En.call(C,f)&&Ft(P,f,C[f]);return P},kt=(P,C)=>vn(P,mn(C));function Mt(P,C,f,A){var T,b=!1,_=0;function I(){T&&clearTimeout(T)}function D(){for(var o=arguments.length,S=new Array(o),m=0;m<o;m++)S[m]=arguments[m];var c=this,p=Date.now()-_;function y(){_=Date.now(),f.apply(c,S)}function u(){T=void 0}b||(A&&!T&&y(),I(),A===void 0&&p>P?y():C!==!0&&(T=setTimeout(A?u:y,A===void 0?P-p:P)))}return typeof C!="boolean"&&(A=f,f=C,C=void 0),D.cancel=function(){I(),b=!0},D}function Nt(P,C,f){return f===void 0?Mt(P,C,!1):Mt(P,f,C!==!1)}function Tn(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var Jt={exports:{}};typeof window<"u"&&(Jt.exports=function(P){var C={};function f(A){if(C[A])return C[A].exports;var T=C[A]={i:A,l:!1,exports:{}};return P[A].call(T.exports,T,T.exports,f),T.l=!0,T.exports}return f.m=P,f.c=C,f.d=function(A,T,b){f.o(A,T)||Object.defineProperty(A,T,{enumerable:!0,get:b})},f.r=function(A){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(A,"__esModule",{value:!0})},f.t=function(A,T){if(1&T&&(A=f(A)),8&T||4&T&&typeof A=="object"&&A&&A.__esModule)return A;var b=Object.create(null);if(f.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:A}),2&T&&typeof A!="string")for(var _ in A)f.d(b,_,function(I){return A[I]}.bind(null,_));return b},f.n=function(A){var T=A&&A.__esModule?function(){return A.default}:function(){return A};return f.d(T,"a",T),T},f.o=function(A,T){return Object.prototype.hasOwnProperty.call(A,T)},f.p="/dist/",f(f.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(P,C,f){var A=Object.prototype.hasOwnProperty,T="~";function b(){}function _(S,m,c){this.fn=S,this.context=m,this.once=c||!1}function I(S,m,c,p,y){if(typeof c!="function")throw new TypeError("The listener must be a function");var u=new _(c,p||S,y),e=T?T+m:m;return S._events[e]?S._events[e].fn?S._events[e]=[S._events[e],u]:S._events[e].push(u):(S._events[e]=u,S._eventsCount++),S}function D(S,m){--S._eventsCount==0?S._events=new b:delete S._events[m]}function o(){this._events=new b,this._eventsCount=0}Object.create&&(b.prototype=Object.create(null),new b().__proto__||(T=!1)),o.prototype.eventNames=function(){var S,m,c=[];if(this._eventsCount===0)return c;for(m in S=this._events)A.call(S,m)&&c.push(T?m.slice(1):m);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(S)):c},o.prototype.listeners=function(S){var m=T?T+S:S,c=this._events[m];if(!c)return[];if(c.fn)return[c.fn];for(var p=0,y=c.length,u=new Array(y);p<y;p++)u[p]=c[p].fn;return u},o.prototype.listenerCount=function(S){var m=T?T+S:S,c=this._events[m];return c?c.fn?1:c.length:0},o.prototype.emit=function(S,m,c,p,y,u){var e=T?T+S:S;if(!this._events[e])return!1;var i,t,n=this._events[e],l=arguments.length;if(n.fn){switch(n.once&&this.removeListener(S,n.fn,void 0,!0),l){case 1:return n.fn.call(n.context),!0;case 2:return n.fn.call(n.context,m),!0;case 3:return n.fn.call(n.context,m,c),!0;case 4:return n.fn.call(n.context,m,c,p),!0;case 5:return n.fn.call(n.context,m,c,p,y),!0;case 6:return n.fn.call(n.context,m,c,p,y,u),!0}for(t=1,i=new Array(l-1);t<l;t++)i[t-1]=arguments[t];n.fn.apply(n.context,i)}else{var a,d=n.length;for(t=0;t<d;t++)switch(n[t].once&&this.removeListener(S,n[t].fn,void 0,!0),l){case 1:n[t].fn.call(n[t].context);break;case 2:n[t].fn.call(n[t].context,m);break;case 3:n[t].fn.call(n[t].context,m,c);break;case 4:n[t].fn.call(n[t].context,m,c,p);break;default:if(!i)for(a=1,i=new Array(l-1);a<l;a++)i[a-1]=arguments[a];n[t].fn.apply(n[t].context,i)}}return!0},o.prototype.on=function(S,m,c){return I(this,S,m,c,!1)},o.prototype.once=function(S,m,c){return I(this,S,m,c,!0)},o.prototype.removeListener=function(S,m,c,p){var y=T?T+S:S;if(!this._events[y])return this;if(!m)return D(this,y),this;var u=this._events[y];if(u.fn)u.fn!==m||p&&!u.once||c&&u.context!==c||D(this,y);else{for(var e=0,i=[],t=u.length;e<t;e++)(u[e].fn!==m||p&&!u[e].once||c&&u[e].context!==c)&&i.push(u[e]);i.length?this._events[y]=i.length===1?i[0]:i:D(this,y)}return this},o.prototype.removeAllListeners=function(S){var m;return S?(m=T?T+S:S,this._events[m]&&D(this,m)):(this._events=new b,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=T,o.EventEmitter=o,P.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(P,C,f){var A,T,b,_,I;A=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,T=/^([^\/?#]*)([^]*)$/,b=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(D,o,S){if(S=S||{},D=D.trim(),!(o=o.trim())){if(!S.alwaysNormalize)return D;var m=I.parseURL(D);if(!m)throw new Error("Error trying to parse base URL.");return m.path=I.normalizePath(m.path),I.buildURLFromParts(m)}var c=I.parseURL(o);if(!c)throw new Error("Error trying to parse relative URL.");if(c.scheme)return S.alwaysNormalize?(c.path=I.normalizePath(c.path),I.buildURLFromParts(c)):o;var p=I.parseURL(D);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var y=T.exec(p.path);p.netLoc=y[1],p.path=y[2]}p.netLoc&&!p.path&&(p.path="/");var u={scheme:p.scheme,netLoc:c.netLoc,path:null,params:c.params,query:c.query,fragment:c.fragment};if(!c.netLoc&&(u.netLoc=p.netLoc,c.path[0]!=="/"))if(c.path){var e=p.path,i=e.substring(0,e.lastIndexOf("/")+1)+c.path;u.path=I.normalizePath(i)}else u.path=p.path,c.params||(u.params=p.params,c.query||(u.query=p.query));return u.path===null&&(u.path=S.alwaysNormalize?I.normalizePath(c.path):c.path),I.buildURLFromParts(u)},parseURL:function(D){var o=A.exec(D);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(D){for(D=D.split("").reverse().join("").replace(b,"");D.length!==(D=D.replace(_,"")).length;);return D.split("").reverse().join("")},buildURLFromParts:function(D){return D.scheme+D.netLoc+D.path+D.params+D.query+D.fragment}},P.exports=I},"./node_modules/webworkify-webpack/index.js":function(P,C,f){function A(o){var S={};function m(p){if(S[p])return S[p].exports;var y=S[p]={i:p,l:!1,exports:{}};return o[p].call(y.exports,y,y.exports,m),y.l=!0,y.exports}m.m=o,m.c=S,m.i=function(p){return p},m.d=function(p,y,u){m.o(p,y)||Object.defineProperty(p,y,{configurable:!1,enumerable:!0,get:u})},m.r=function(p){Object.defineProperty(p,"__esModule",{value:!0})},m.n=function(p){var y=p&&p.__esModule?function(){return p.default}:function(){return p};return m.d(y,"a",y),y},m.o=function(p,y){return Object.prototype.hasOwnProperty.call(p,y)},m.p="/",m.oe=function(p){throw console.error(p),p};var c=m(m.s=ENTRY_MODULE);return c.default||c}var T="[\\.|\\-|\\+|\\w|/|@]+",b="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function _(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function I(o,S,m){var c={};c[m]=[];var p=S.toString(),y=p.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!y)return c;for(var u,e=y[1],i=new RegExp("(\\\\n|\\W)"+_(e)+b,"g");u=i.exec(p);)u[3]!=="dll-reference"&&c[m].push(u[3]);for(i=new RegExp("\\("+_(e)+'\\("(dll-reference\\s('+T+'))"\\)\\)'+b,"g");u=i.exec(p);)o[u[2]]||(c[m].push(u[1]),o[u[2]]=f(u[1]).m),c[u[2]]=c[u[2]]||[],c[u[2]].push(u[4]);for(var t,n=Object.keys(c),l=0;l<n.length;l++)for(var a=0;a<c[n[l]].length;a++)t=c[n[l]][a],isNaN(1*t)||(c[n[l]][a]=1*c[n[l]][a]);return c}function D(o){return Object.keys(o).reduce(function(S,m){return S||o[m].length>0},!1)}P.exports=function(o,S){S=S||{};var m={main:f.m},c=S.all?{main:Object.keys(m.main)}:function(i,t){for(var n={main:[t]},l={main:[]},a={main:{}};D(n);)for(var d=Object.keys(n),E=0;E<d.length;E++){var g=d[E],v=n[g].pop();if(a[g]=a[g]||{},!a[g][v]&&i[g][v]){a[g][v]=!0,l[g]=l[g]||[],l[g].push(v);for(var r=I(i,i[g][v],g),s=Object.keys(r),h=0;h<s.length;h++)n[s[h]]=n[s[h]]||[],n[s[h]]=n[s[h]].concat(r[s[h]])}}return l}(m,o),p="";Object.keys(c).filter(function(i){return i!=="main"}).forEach(function(i){for(var t=0;c[i][t];)t++;c[i].push(t),m[i][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",p=p+"var "+i+" = ("+A.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+c[i].map(function(n){return JSON.stringify(n)+": "+m[i][n].toString()}).join(",")+`});
`}),p=p+"new (("+A.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+c.main.map(function(i){return JSON.stringify(i)+": "+m.main[i].toString()}).join(",")+"}))(self);";var y=new window.Blob([p],{type:"text/javascript"});if(S.bare)return y;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(y),e=new window.Worker(u);return e.objectURL=u,e}},"./src/config.ts":function(P,C,f){f.r(C),f.d(C,"hlsDefaultConfig",function(){return d}),f.d(C,"mergeConfig",function(){return E}),f.d(C,"enableStreamingMode",function(){return g});var A=f("./src/controller/abr-controller.ts"),T=f("./src/controller/audio-stream-controller.ts"),b=f("./src/controller/audio-track-controller.ts"),_=f("./src/controller/subtitle-stream-controller.ts"),I=f("./src/controller/subtitle-track-controller.ts"),D=f("./src/controller/buffer-controller.ts"),o=f("./src/controller/timeline-controller.ts"),S=f("./src/controller/cap-level-controller.ts"),m=f("./src/controller/fps-controller.ts"),c=f("./src/controller/eme-controller.ts"),p=f("./src/utils/xhr-loader.ts"),y=f("./src/utils/fetch-loader.ts"),u=f("./src/utils/cues.ts"),e=f("./src/utils/mediakeys-helper.ts"),i=f("./src/utils/logger.ts");function t(){return(t=Object.assign||function(v){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&(v[h]=s[h])}return v}).apply(this,arguments)}function n(v,r){var s=Object.keys(v);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(v);r&&(h=h.filter(function(k){return Object.getOwnPropertyDescriptor(v,k).enumerable})),s.push.apply(s,h)}return s}function l(v){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?n(Object(s),!0).forEach(function(h){a(v,h,s[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(h){Object.defineProperty(v,h,Object.getOwnPropertyDescriptor(s,h))})}return v}function a(v,r,s){return r in v?Object.defineProperty(v,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):v[r]=s,v}var d=l(l({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:A.default,bufferController:D.default,capLevelController:S.default,fpsController:m.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:u.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:_.SubtitleStreamController,subtitleTrackController:I.default,timelineController:o.TimelineController,audioStreamController:T.default,audioTrackController:b.default,emeController:c.default});function E(v,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},v,r)}function g(v){var r=v.loader;r!==y.default&&r!==p.default?(i.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),v.progressive=!1):Object(y.fetchSupported)()&&(v.loader=y.default,v.progressive=!0,v.enableSoftwareAES=!0,i.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(P,C,f){f.r(C);var A=f("./src/polyfills/number.ts"),T=f("./src/utils/ewma-bandwidth-estimator.ts"),b=f("./src/events.ts"),_=f("./src/utils/buffer-helper.ts"),I=f("./src/errors.ts"),D=f("./src/types/loader.ts"),o=f("./src/utils/logger.ts");function S(c,p){for(var y=0;y<p.length;y++){var u=p[y];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(c,u.key,u)}}var m=function(){function c(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var i=e.config;this.bwEstimator=new T.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var p,y,u=c.prototype;return u.registerListeners=function(){var e=this.hls;e.on(b.Events.FRAG_LOADING,this.onFragLoading,this),e.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var e=this.hls;e.off(b.Events.FRAG_LOADING,this.onFragLoading,this),e.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},u.onFragLoading=function(e,i){var t,n=i.frag;n.type===D.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=n,this.partCurrent=(t=i.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)))},u.onLevelLoaded=function(e,i){var t=this.hls.config;i.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},u._abandonRulesCheck=function(){var e=this.fragCurrent,i=this.partCurrent,t=this.hls,n=t.autoLevelEnabled,l=t.config,a=t.media;if(e&&a){var d=i?i.stats:e.stats,E=i?i.duration:e.duration;if(d.aborted)return o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!a.paused&&a.playbackRate&&a.readyState){var g=performance.now()-d.loading.start,v=Math.abs(a.playbackRate);if(!(g<=500*E/v)){var r=t.levels,s=t.minAutoLevel,h=r[e.level],k=d.total||Math.max(d.loaded,Math.round(E*h.maxBitrate/8)),L=Math.max(1,d.bwEstimate?d.bwEstimate/8:1e3*d.loaded/g),R=(k-d.loaded)/L,O=a.currentTime,w=(_.BufferHelper.bufferInfo(a,O,l.maxBufferHole).end-O)/v;if(!(w>=2*E/v||R<=w)){var x,F=Number.POSITIVE_INFINITY;for(x=e.level-1;x>s&&!((F=E*r[x].maxBitrate/(6.4*L))<w);x--);if(!(F>=R)){var M=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+e.sn+(i?" part "+i.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+x+`
      Current BW estimate: `+(Object(A.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+R.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+w.toFixed(3)+" s"),t.nextLoadLevel=x,this.bwEstimator.sample(g,d.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),t.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:i,stats:d})}}}}}},u.onFragLoaded=function(e,i){var t=i.frag,n=i.part;if(t.type===D.PlaylistLevelType.MAIN&&Object(A.isFiniteNumber)(t.sn)){var l=n?n.stats:t.stats,a=n?n.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[t.level],E=(d.loaded?d.loaded.bytes:0)+l.loaded,g=(d.loaded?d.loaded.duration:0)+a;d.loaded={bytes:E,duration:g},d.realBitrate=Math.round(8*E/g)}if(t.bitrateTest){var v={stats:l,frag:t,part:n,id:t.type};this.onFragBuffered(b.Events.FRAG_BUFFERED,v),t.bitrateTest=!1}}},u.onFragBuffered=function(e,i){var t=i.frag,n=i.part,l=n?n.stats:t.stats;if(!l.aborted&&t.type===D.PlaylistLevelType.MAIN&&t.sn!=="initSegment"){var a=l.parsing.end-l.loading.start;this.bwEstimator.sample(a,l.loaded),l.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},u.onError=function(e,i){switch(i.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},u.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},u.getNextABRAutoLevel=function(){var e=this.fragCurrent,i=this.partCurrent,t=this.hls,n=t.maxAutoLevel,l=t.config,a=t.minAutoLevel,d=t.media,E=i?i.duration:e?e.duration:0,g=d?d.currentTime:0,v=d&&d.playbackRate!==0?Math.abs(d.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():l.abrEwmaDefaultEstimate,s=(_.BufferHelper.bufferInfo(d,g,l.maxBufferHole).end-g)/v,h=this.findBestLevel(r,a,n,s,l.abrBandWidthFactor,l.abrBandWidthUpFactor);if(h>=0)return h;o.logger.trace((s?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var k=E?Math.min(E,l.maxStarvationDelay):l.maxStarvationDelay,L=l.abrBandWidthFactor,R=l.abrBandWidthUpFactor;if(!s){var O=this.bitrateTestDelay;O&&(k=(E?Math.min(E,l.maxLoadingDelay):l.maxLoadingDelay)-O,o.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*k)+" ms"),L=R=1)}return h=this.findBestLevel(r,a,n,s+k,L,R),Math.max(h,0)},u.findBestLevel=function(e,i,t,n,l,a){for(var d,E=this.fragCurrent,g=this.partCurrent,v=this.lastLoadedFragLevel,r=this.hls.levels,s=r[v],h=!(s==null||(d=s.details)===null||d===void 0||!d.live),k=s==null?void 0:s.codecSet,L=g?g.duration:E?E.duration:0,R=t;R>=i;R--){var O=r[R];if(O&&(!k||O.codecSet===k)){var w=O.details,x=(g?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||L,F=void 0;F=R<=v?l*e:a*e;var M=r[R].maxBitrate,B=M*x/F;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+R+"/"+Math.round(F)+"/"+M+"/"+x+"/"+n+"/"+B),F>M&&(!B||h&&!this.bitrateTestDelay||B<n))return R}}return-1},p=c,(y=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,i=this.bwEstimator;if(!(e===-1||i&&i.canEstimate()))return e;var t=this.getNextABRAutoLevel();return e!==-1&&(t=Math.min(e,t)),t},set:function(e){this._nextAutoLevel=e}}])&&S(p.prototype,y),c}();C.default=m},"./src/controller/audio-stream-controller.ts":function(P,C,f){f.r(C);var A=f("./src/polyfills/number.ts"),T=f("./src/controller/base-stream-controller.ts"),b=f("./src/events.ts"),_=f("./src/utils/buffer-helper.ts"),I=f("./src/controller/fragment-tracker.ts"),D=f("./src/types/level.ts"),o=f("./src/types/loader.ts"),S=f("./src/loader/fragment.ts"),m=f("./src/demux/chunk-cache.ts"),c=f("./src/demux/transmuxer-interface.ts"),p=f("./src/types/transmuxer.ts"),y=f("./src/controller/fragment-finders.ts"),u=f("./src/utils/discontinuities.ts"),e=f("./src/errors.ts"),i=f("./src/utils/logger.ts");function t(){return(t=Object.assign||function(a){for(var d=1;d<arguments.length;d++){var E=arguments[d];for(var g in E)Object.prototype.hasOwnProperty.call(E,g)&&(a[g]=E[g])}return a}).apply(this,arguments)}function n(a,d){return(n=Object.setPrototypeOf||function(E,g){return E.__proto__=g,E})(a,d)}var l=function(a){var d,E;function g(r,s){var h;return(h=a.call(this,r,s,"[audio-stream-controller]")||this).videoBuffer=null,h.videoTrackCC=-1,h.waitingVideoCC=-1,h.audioSwitch=!1,h.trackId=-1,h.waitingData=null,h.mainDetails=null,h.bufferFlushed=!1,h._registerListeners(),h}E=a,(d=g).prototype=Object.create(E.prototype),d.prototype.constructor=d,n(d,E);var v=g.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var r=this.hls;r.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(b.Events.ERROR,this.onError,this),r.on(b.Events.BUFFER_RESET,this.onBufferReset,this),r.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var r=this.hls;r.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(b.Events.ERROR,this.onError,this),r.off(b.Events.BUFFER_RESET,this.onBufferReset,this),r.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(r,s){var h=s.frag,k=s.id,L=s.initPTS;if(k==="main"){var R=h.cc;this.initPTS[h.cc]=L,this.log("InitPTS for cc: "+R+" found from main: "+L),this.videoTrackCC=R,this.state===T.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=T.State.STOPPED);var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,s>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),this.state=T.State.IDLE):(this.loadedmetadata=!1,this.state=T.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},v.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_TRACK:var r,s=this.levels,h=this.trackId,k=s==null||(r=s[h])===null||r===void 0?void 0:r.details;if(k){if(this.waitForCdnTuneIn(k))break;this.state=T.State.WAITING_INIT_PTS}break;case T.State.FRAG_LOADING_WAITING_RETRY:var L,R=performance.now(),O=this.retryDate;(!O||R>=O||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=T.State.IDLE);break;case T.State.WAITING_INIT_PTS:var w=this.waitingData;if(w){var x=w.frag,F=w.part,M=w.cache,B=w.complete;if(this.initPTS[x.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.FRAG_LOADING;var U={frag:x,part:F,payload:M.flush(),networkDetails:null};this._handleFragmentLoadProgress(U),B&&a.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)i.logger.log("Waiting fragment cc ("+x.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var G=this.getLoadPosition(),V=_.BufferHelper.bufferInfo(this.mediaBuffer,G,this.config.maxBufferHole);Object(y.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,x)<0&&(i.logger.log("Waiting fragment cc ("+x.cc+") @ "+x.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=T.State.IDLE}this.onTickEnd()},v.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.IDLE)},v.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var s=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&s.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},v.doTickIdle=function(){var r,s,h=this.hls,k=this.levels,L=this.media,R=this.trackId,O=h.config;if(k&&k[R]&&(L||!this.startFragRequested&&O.startFragPrefetch)){var w=k[R].details;if(!w||w.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(w))this.state=T.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,S.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var x=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.AUDIO);if(x!==null){var F=x.len,M=this.getMaxBufferLength(),B=this.audioSwitch;if(!(F>=M)||B){if(!B&&this._streamEnded(x,w))return h.trigger(b.Events.BUFFER_EOS,{type:"audio"}),void(this.state=T.State.ENDED);var U=w.fragments[0].start,G=x.end;if(B){var V=this.getLoadPosition();G=V,w.PTSKnown&&V<U&&(x.end>U||x.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),L.currentTime=U+.05)}var W=this.getNextFragment(G,w);W?((r=W.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(s=W.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(W,w,G):this.loadKey(W,w):this.bufferFlushed=!0}}}}},v.getMaxBufferLength=function(){var r=a.prototype.getMaxBufferLength.call(this),s=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN);return s===null?r:Math.max(r,s.len)},v.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(r,s){var h=s.audioTracks;this.resetTransmuxer(),this.levels=h.map(function(k){return new D.Level(k)})},v.onAudioTrackSwitching=function(r,s){var h=!!s.url;this.trackId=s.id;var k=this.fragCurrent;k!=null&&k.loader&&k.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),h?this.setInterval(100):this.resetTransmuxer(),h?(this.audioSwitch=!0,this.state=T.State.IDLE):this.state=T.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(r,s){this.mainDetails=s.details},v.onAudioTrackLoaded=function(r,s){var h,k=this.levels,L=s.details,R=s.id;if(k){this.log("Track "+R+" loaded ["+L.startSN+","+L.endSN+"],duration:"+L.totalduration);var O=k[R],w=0;if(L.live||(h=O.details)!==null&&h!==void 0&&h.live){var x=this.mainDetails;if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed||!x)return;!O.details&&L.hasProgramDateTime&&x.hasProgramDateTime?(Object(u.alignPDT)(L,x),w=L.fragments[0].start):w=this.alignPlaylists(L,O.details)}O.details=L,this.levelLastLoaded=R,this.startFragRequested||!this.mainDetails&&L.live||this.setStartPosition(O.details,w),this.state!==T.State.WAITING_TRACK||this.waitForCdnTuneIn(L)||(this.state=T.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+R)},v._handleFragmentLoadProgress=function(r){var s,h=r.frag,k=r.part,L=r.payload,R=this.config,O=this.trackId,w=this.levels;if(w){var x=w[O];console.assert(x,"Audio track is defined on fragment load progress");var F=x.details;console.assert(F,"Audio track details are defined on fragment load progress");var M=R.defaultAudioCodec||x.audioCodec||"mp4a.40.2",B=this.transmuxer;B||(B=this.transmuxer=new c.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var U=this.initPTS[h.cc],G=(s=h.initSegment)===null||s===void 0?void 0:s.data;if(U!==void 0){var V=k?k.index:-1,W=V!==-1,Y=new p.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,L.byteLength,V,W);B.push(L,G,M,"",h,k,F.totalduration,!1,Y,U)}else i.logger.log("Unknown video PTS for cc "+h.cc+", waiting for video PTS before demuxing audio frag "+h.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+O),(this.waitingData=this.waitingData||{frag:h,part:k,cache:new m.default,complete:!1}).cache.push(new Uint8Array(L)),this.waitingVideoCC=this.videoTrackCC,this.state=T.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered")},v._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:a.prototype._handleFragmentLoadComplete.call(this,r)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(r,s){var h=s.tracks.audio;h&&(this.mediaBuffer=h.buffer),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer)},v.onFragBuffered=function(r,s){var h=s.frag,k=s.part;h.type===o.PlaylistLevelType.AUDIO&&(this.fragContextChanged(h)?this.warn("Fragment "+h.sn+(k?" p: "+k.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(h.sn!=="initSegment"&&(this.fragPrevious=h,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(h,k)))},v.onError=function(r,s){switch(s.details){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,s);break;case e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case e.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==T.State.ERROR&&this.state!==T.State.STOPPED&&(this.state=s.fatal?T.State.ERROR:T.State.IDLE,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case e.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var h=!0,k=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);k&&k.len>.5&&(h=!this.reduceMaxBufferLength(k.len)),h&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},v.onBufferFlushed=function(r,s){s.type===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},v._handleTransmuxComplete=function(r){var s,h="audio",k=this.hls,L=r.remuxResult,R=r.chunkMeta,O=this.getCurrentContext(R);if(!O)return this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(R.level);var w=O.frag,x=O.part,F=L.audio,M=L.text,B=L.id3,U=L.initSegment;if(!this.fragContextChanged(w)){if(this.state=T.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),U!=null&&U.tracks&&(this._bufferInitSegment(U.tracks,w,R),k.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:h,tracks:U.tracks})),F){var G=F.startPTS,V=F.endPTS,W=F.startDTS,Y=F.endDTS;x&&(x.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:G,endPTS:V,startDTS:W,endDTS:Y}),w.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,G,V,W,Y),this.bufferFragmentData(F,w,x,R)}if(B!=null&&(s=B.samples)!==null&&s!==void 0&&s.length){var Z=t({frag:w,id:h},B);k.trigger(b.Events.FRAG_PARSING_METADATA,Z)}if(M){var Q=t({frag:w,id:h},M);k.trigger(b.Events.FRAG_PARSING_USERDATA,Q)}}},v._bufferInitSegment=function(r,s,h){if(this.state===T.State.PARSING){r.video&&delete r.video;var k=r.audio;if(k){k.levelCodec=k.codec,k.id="audio",this.log("Init audio buffer, container:"+k.container+", codecs[parsed]=["+k.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,r);var L=k.initSegment;if(L!=null&&L.byteLength){var R={type:"audio",frag:s,part:null,chunkMeta:h,parent:s.type,data:L};this.hls.trigger(b.Events.BUFFER_APPENDING,R)}this.tick()}}},v.loadFragment=function(r,s,h){var k=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||k===I.FragmentState.NOT_LOADED||k===I.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):s.live&&!Object(A.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=T.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,r,s,h)))},v.completeAudioSwitch=function(){var r=this.hls,s=this.media,h=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:h})},g}(T.default);C.default=l},"./src/controller/audio-track-controller.ts":function(P,C,f){f.r(C);var A=f("./src/events.ts"),T=f("./src/errors.ts"),b=f("./src/controller/base-playlist-controller.ts"),_=f("./src/types/loader.ts");function I(S,m){for(var c=0;c<m.length;c++){var p=m[c];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(S,p.key,p)}}function D(S,m){return(D=Object.setPrototypeOf||function(c,p){return c.__proto__=p,c})(S,m)}var o=function(S){var m,c;function p(i){var t;return(t=S.call(this,i,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}c=S,(m=p).prototype=Object.create(c.prototype),m.prototype.constructor=m,D(m,c);var y,u,e=p.prototype;return e.registerListeners=function(){var i=this.hls;i.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(A.Events.ERROR,this.onError,this)},e.unregisterListeners=function(){var i=this.hls;i.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(A.Events.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,S.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},e.onManifestParsed=function(i,t){this.tracks=t.audioTracks||[]},e.onAudioTrackLoaded=function(i,t){var n=t.id,l=t.details,a=this.tracksInGroup[n];if(a){var d=a.details;a.details=t.details,this.log("audioTrack "+n+" loaded ["+l.startSN+"-"+l.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,t,d))}else this.warn("Invalid audio track id "+n)},e.onLevelLoading=function(i,t){this.switchLevel(t.level)},e.onLevelSwitching=function(i,t){this.switchLevel(t.level)},e.switchLevel=function(i){var t=this.hls.levels[i];if(t!=null&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];if(this.groupId!==n){this.groupId=n;var l=this.tracks.filter(function(d){return!n||d.groupId===n});this.selectDefaultTrack&&!l.some(function(d){return d.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=l;var a={audioTracks:l};this.log("Updating audio tracks, "+l.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(A.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},e.onError=function(i,t){S.prototype.onError.call(this,i,t),!t.fatal&&t.context&&t.context.type===_.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},e.setAudioTrack=function(i){var t=this.tracksInGroup;if(i<0||i>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var n=t[this.trackId];this.log("Now switching to audio-track index "+i);var l=t[i],a=l.id,d=l.groupId,E=d===void 0?"":d,g=l.name,v=l.type,r=l.url;if(this.trackId=i,this.trackName=g,this.selectDefaultTrack=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:E,name:g,type:v,url:r}),!l.details||l.details.live){var s=this.switchParams(l.url,n==null?void 0:n.details);this.loadPlaylist(s)}}},e.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,n=this.findTrackId(t)||this.findTrackId();n!==-1?this.setAudioTrack(n):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},e.findTrackId=function(i){for(var t=this.tracksInGroup,n=0;n<t.length;n++){var l=t[n];if((!this.selectDefaultTrack||l.default)&&(!i||i===l.name))return l.id}return-1},e.loadPlaylist=function(i){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var n=t.id,l=t.groupId,a=t.url;if(i)try{a=i.addDirectives(a)}catch(d){this.warn("Could not construct new URL with HLS Delivery Directives: "+d)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(A.Events.AUDIO_TRACK_LOADING,{url:a,id:n,groupId:l,deliveryDirectives:i||null})}},y=p,(u=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}])&&I(y.prototype,u),p}(b.default);C.default=o},"./src/controller/base-playlist-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return D});var A=f("./src/polyfills/number.ts"),T=f("./src/types/level.ts"),b=f("./src/controller/level-helper.ts"),_=f("./src/utils/logger.ts"),I=f("./src/errors.ts"),D=function(){function o(m,c){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=_.logger.log.bind(_.logger,c+":"),this.warn=_.logger.warn.bind(_.logger,c+":"),this.hls=m}var S=o.prototype;return S.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},S.onError=function(m,c){c.fatal&&c.type===I.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},S.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},S.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},S.stopLoad=function(){this.canLoad=!1,this.clearTimer()},S.switchParams=function(m,c){var p=c==null?void 0:c.renditionReports;if(p)for(var y=0;y<p.length;y++){var u=p[y],e=""+u.URI;if(e===m.substr(-e.length)){var i=parseInt(u["LAST-MSN"]),t=parseInt(u["LAST-PART"]);if(c&&this.hls.config.lowLatencyMode){var n=Math.min(c.age-c.partTarget,c.targetduration);t!==void 0&&n>c.partTarget&&(t+=1)}if(Object(A.isFiniteNumber)(i))return new T.HlsUrlParameters(i,Object(A.isFiniteNumber)(t)?t:void 0,T.HlsSkip.No)}}},S.loadPlaylist=function(m){},S.shouldLoadTrack=function(m){return this.canLoad&&m&&!!m.url&&(!m.details||m.details.live)},S.playlistLoaded=function(m,c,p){var y=this,u=c.details,e=c.stats,i=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(u.advancedDateTime=Date.now()-i,u.live||p!=null&&p.live){if(u.reloaded(p),p&&this.log("live playlist "+m+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),p&&u.fragments.length>0&&Object(b.mergeDetails)(p,u),!this.canLoad||!u.live)return;var t,n=void 0,l=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var a=this.hls.config.lowLatencyMode,d=u.lastPartSn,E=u.endSN,g=u.lastPartIndex,v=d===E;g!==-1?(n=v?E+1:d,l=v?a?0:g:g+1):n=E+1;var r=u.age,s=r+u.ageHeader,h=Math.min(s-u.partTarget,1.5*u.targetduration);if(h>0){if(p&&h>p.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+p.tuneInGoal+" to: "+h+" with playlist age: "+u.age),h=0;else{var k=Math.floor(h/u.targetduration);n+=k,l!==void 0&&(l+=Math.round(h%u.targetduration/u.partTarget)),this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+h+" skip sn "+k+" to part "+l)}u.tuneInGoal=h}if(t=this.getDeliveryDirectives(u,c.deliveryDirectives,n,l),a||!v)return void this.loadPlaylist(t)}else t=this.getDeliveryDirectives(u,c.deliveryDirectives,n,l);var L=Object(b.computeReloadInterval)(u,e);n!==void 0&&u.canBlockReload&&(L-=u.partTarget||1),this.log("reload live playlist "+m+" in "+Math.round(L)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(t)},L)}else this.clearTimer()},S.getDeliveryDirectives=function(m,c,p,y){var u=Object(T.getSkipValue)(m,p);return c!=null&&c.skip&&m.deltaUpdateFailed&&(p=c.msn,y=c.part,u=T.HlsSkip.No),new T.HlsUrlParameters(p,y,u)},S.retryLoadingOrFail=function(m){var c,p=this,y=this.hls.config,u=this.retryCount<y.levelLoadingMaxRetry;if(u)if(this.retryCount++,m.details.indexOf("LoadTimeOut")>-1&&(c=m.context)!==null&&c!==void 0&&c.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+m.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*y.levelLoadingRetryDelay,y.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return p.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+m.details+'"')}else this.warn('cannot recover from error "'+m.details+'"'),this.clearTimer(),m.fatal=!0;return u},o}()},"./src/controller/base-stream-controller.ts":function(P,C,f){f.r(C),f.d(C,"State",function(){return a}),f.d(C,"default",function(){return d});var A=f("./src/polyfills/number.ts"),T=f("./src/task-loop.ts"),b=f("./src/controller/fragment-tracker.ts"),_=f("./src/utils/buffer-helper.ts"),I=f("./src/utils/logger.ts"),D=f("./src/events.ts"),o=f("./src/errors.ts"),S=f("./src/types/transmuxer.ts"),m=f("./src/utils/mp4-tools.ts"),c=f("./src/utils/discontinuities.ts"),p=f("./src/controller/fragment-finders.ts"),y=f("./src/controller/level-helper.ts"),u=f("./src/loader/fragment-loader.ts"),e=f("./src/crypt/decrypter.ts"),i=f("./src/utils/time-ranges.ts"),t=f("./src/types/loader.ts");function n(E,g){for(var v=0;v<g.length;v++){var r=g[v];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(E,r.key,r)}}function l(E,g){return(l=Object.setPrototypeOf||function(v,r){return v.__proto__=r,v})(E,g)}var a={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},d=function(E){var g,v;function r(L,R,O){var w;return(w=E.call(this)||this).hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=a.STOPPED,w.media=void 0,w.mediaBuffer=void 0,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=O,w.log=I.logger.log.bind(I.logger,O+":"),w.warn=I.logger.warn.bind(I.logger,O+":"),w.hls=L,w.fragmentLoader=new u.default(L.config),w.fragmentTracker=R,w.config=L.config,w.decrypter=new e.default(L,L.config),L.on(D.Events.KEY_LOADED,w.onKeyLoaded,function(x){if(x===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x}(w)),w}v=E,(g=r).prototype=Object.create(v.prototype),g.prototype.constructor=g,l(g,v);var s,h,k=r.prototype;return k.doTick=function(){this.onTickEnd()},k.onTickEnd=function(){},k.startLoad=function(L){},k.stopLoad=function(){this.fragmentLoader.abort();var L=this.fragCurrent;L&&this.fragmentTracker.removeFragment(L),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=a.STOPPED},k._streamEnded=function(L,R){var O=this.fragCurrent,w=this.fragmentTracker;if(!R.live&&O&&O.sn===R.endSN&&!L.nextStart){var x=w.getState(O);return x===b.FragmentState.PARTIAL||x===b.FragmentState.OK}return!1},k.onMediaAttached=function(L,R){var O=this.media=this.mediaBuffer=R.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===a.STOPPED&&this.startLoad(w.startPosition)},k.onMediaDetaching=function(){var L=this.media;L!=null&&L.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),L&&(L.removeEventListener("seeking",this.onvseeking),L.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},k.onMediaSeeking=function(){var L=this.config,R=this.fragCurrent,O=this.media,w=this.mediaBuffer,x=this.state,F=O?O.currentTime:0,M=_.BufferHelper.bufferInfo(w||O,F,L.maxBufferHole);if(this.log("media seeking to "+(Object(A.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+x),x===a.ENDED)this.resetLoadingState();else if(R&&!M.len){var B=L.maxFragLookUpTolerance,U=R.start-B,G=F>R.start+R.duration+B;(F<U||G)&&(G&&R.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),R.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=F),this.loadedmetadata||M.len||(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},k.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},k.onKeyLoaded=function(L,R){if(this.state===a.KEY_LOADING&&R.frag===this.fragCurrent&&this.levels){this.state=a.IDLE;var O=this.levels[R.frag.level].details;O&&this.loadFragment(R.frag,O,R.frag.start)}},k.onHandlerDestroying=function(){this.stopLoad(),E.prototype.onHandlerDestroying.call(this)},k.onHandlerDestroyed=function(){this.state=a.STOPPED,this.hls.off(D.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,E.prototype.onHandlerDestroyed.call(this)},k.loadKey=function(L,R){this.log("Loading key for "+L.sn+" of ["+R.startSN+"-"+R.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level),this.state=a.KEY_LOADING,this.fragCurrent=L,this.hls.trigger(D.Events.KEY_LOADING,{frag:L})},k.loadFragment=function(L,R,O){this._loadFragForPlayback(L,R,O)},k._loadFragForPlayback=function(L,R,O){var w=this;this._doFragLoad(L,R,O,function(x){if(w.fragContextChanged(L))return w.warn("Fragment "+L.sn+(x.part?" p: "+x.part.index:"")+" of level "+L.level+" was dropped during download."),void w.fragmentTracker.removeFragment(L);L.stats.chunkCount++,w._handleFragmentLoadProgress(x)}).then(function(x){if(x){w.fragLoadError=0;var F=w.state;if(!w.fragContextChanged(L))return"payload"in x&&(w.log("Loaded fragment "+L.sn+" of level "+L.level),w.hls.trigger(D.Events.FRAG_LOADED,x),w.state===a.BACKTRACKING)?(w.fragmentTracker.backtrack(L,x),void w.resetFragmentLoading(L)):void w._handleFragmentLoadComplete(x);(F===a.FRAG_LOADING||F===a.BACKTRACKING||!w.fragCurrent&&F===a.PARSING)&&(w.fragmentTracker.removeFragment(L),w.state=a.IDLE)}}).catch(function(x){w.warn(x),w.resetFragmentLoading(L)})},k.flushMainBuffer=function(L,R,O){if(O===void 0&&(O=null),L-R){var w={startOffset:L,endOffset:R,type:O};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,w)}},k._loadInitSegment=function(L){var R=this;this._doFragLoad(L).then(function(O){if(!O||R.fragContextChanged(L)||!R.levels)throw new Error("init load aborted");return O}).then(function(O){var w=R.hls,x=O.payload,F=L.decryptdata;if(x&&x.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var M=self.performance.now();return R.decrypter.webCryptoDecrypt(new Uint8Array(x),F.key.buffer,F.iv.buffer).then(function(B){var U=self.performance.now();return w.trigger(D.Events.FRAG_DECRYPTED,{frag:L,payload:B,stats:{tstart:M,tdecrypt:U}}),O.payload=B,O})}return O}).then(function(O){var w=R.fragCurrent,x=R.hls,F=R.levels;if(!F)throw new Error("init load aborted, missing levels");var M=F[L.level].details;console.assert(M,"Level details are defined when init segment is loaded");var B=L.stats;R.state=a.IDLE,R.fragLoadError=0,L.data=new Uint8Array(O.payload),B.parsing.start=B.buffering.start=self.performance.now(),B.parsing.end=B.buffering.end=self.performance.now(),O.frag===w&&x.trigger(D.Events.FRAG_BUFFERED,{stats:B,frag:w,part:null,id:L.type}),R.tick()}).catch(function(O){R.warn(O),R.resetFragmentLoading(L)})},k.fragContextChanged=function(L){var R=this.fragCurrent;return!L||!R||L.level!==R.level||L.sn!==R.sn||L.urlId!==R.urlId},k.fragBufferedComplete=function(L,R){var O=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+L.type+" sn: "+L.sn+(R?" part: "+R.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level+" "+i.default.toString(_.BufferHelper.getBuffered(O))),this.state=a.IDLE,this.tick()},k._handleFragmentLoadComplete=function(L){var R=this.transmuxer;if(R){var O=L.frag,w=L.part,x=L.partsLoaded,F=!x||x.length===0||x.some(function(B){return!B}),M=new S.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,w?w.index:-1,!F);R.flush(M)}},k._handleFragmentLoadProgress=function(L){},k._doFragLoad=function(L,R,O,w){var x=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(L.start,O||0),this.config.lowLatencyMode&&R){var F=R.partList;if(F&&w){O>L.end&&R.fragmentHint&&(L=R.fragmentHint);var M=this.getNextPart(F,L,O);if(M>-1){var B=F[M];return this.log("Loading part sn: "+L.sn+" p: "+B.index+" cc: "+L.cc+" of playlist ["+R.startSN+"-"+R.endSN+"] parts [0-"+M+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=B.start+B.duration,this.state=a.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:L,part:F[M],targetBufferTime:O}),this.doFragPartsLoad(L,F,M,w).catch(function(U){return x.handleFragLoadError(U)})}if(!L.url||this.loadedEndOfParts(F,O))return Promise.resolve(null)}}return this.log("Loading fragment "+L.sn+" cc: "+L.cc+" "+(R?"of ["+R.startSN+"-"+R.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(O.toFixed(3))),Object(A.isFiniteNumber)(L.sn)&&!this.bitrateTest&&(this.nextLoadPosition=L.start+L.duration),this.state=a.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:L,targetBufferTime:O}),this.fragmentLoader.load(L,w).catch(function(U){return x.handleFragLoadError(U)})},k.doFragPartsLoad=function(L,R,O,w){var x=this;return new Promise(function(F,M){var B=[];(function U(G){var V=R[G];x.fragmentLoader.loadPart(L,V,w).then(function(W){B[V.index]=W;var Y=W.part;x.hls.trigger(D.Events.FRAG_LOADED,W);var Z=R[G+1];if(!Z||Z.fragment!==L)return F({frag:L,part:Y,partsLoaded:B});U(G+1)}).catch(M)})(O)})},k.handleFragLoadError=function(L){var R=L.data;return R&&R.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(R.frag,R.part):this.hls.trigger(D.Events.ERROR,R),null},k._handleTransmuxerFlush=function(L){var R=this.getCurrentContext(L);if(R&&this.state===a.PARSING){var O=R.frag,w=R.part,x=R.level,F=self.performance.now();O.stats.parsing.end=F,w&&(w.stats.parsing.end=F),this.updateLevelTiming(O,w,x,L.partial)}else this.fragCurrent||(this.state=a.IDLE)},k.getCurrentContext=function(L){var R=this.levels,O=L.level,w=L.sn,x=L.part;if(!R||!R[O])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+O+". The current chunk will not be buffered."),null;var F=R[O],M=x>-1?Object(y.getPartWith)(F,w,x):null,B=M?M.fragment:Object(y.getFragmentWithSN)(F,w,this.fragCurrent);return B?{frag:B,part:M,level:F}:null},k.bufferFragmentData=function(L,R,O,w){if(L&&this.state===a.PARSING){var x=L.data1,F=L.data2,M=x;if(x&&F&&(M=Object(m.appendUint8Array)(x,F)),M&&M.length){var B={type:L.type,frag:R,part:O,chunkMeta:w,parent:R.type,data:M};this.hls.trigger(D.Events.BUFFER_APPENDING,B),L.dropped&&L.independent&&!O&&this.flushBufferGap(R)}}},k.flushBufferGap=function(L){var R=this.media;if(R)if(_.BufferHelper.isBuffered(R,R.currentTime)){var O=R.currentTime,w=_.BufferHelper.bufferInfo(R,O,0),x=L.duration,F=Math.min(2*this.config.maxFragLookUpTolerance,.25*x),M=Math.max(Math.min(L.start-F,w.end-F),O+F);L.start-M>F&&this.flushMainBuffer(M,L.start)}else this.flushMainBuffer(0,L.start)},k.getFwdBufferInfo=function(L,R){var O=this.config,w=this.getLoadPosition();if(!Object(A.isFiniteNumber)(w))return null;var x=_.BufferHelper.bufferInfo(L,w,O.maxBufferHole);if(x.len===0&&x.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(w,R);if(F&&x.nextStart<F.end)return _.BufferHelper.bufferInfo(L,w,Math.max(x.nextStart,O.maxBufferHole))}return x},k.getMaxBufferLength=function(L){var R,O=this.config;return R=L?Math.max(8*O.maxBufferSize/L,O.maxBufferLength):O.maxBufferLength,Math.min(R,O.maxMaxBufferLength)},k.reduceMaxBufferLength=function(L){var R=this.config,O=L||R.maxBufferLength;return R.maxMaxBufferLength>=O&&(R.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+R.maxMaxBufferLength+"s"),!0)},k.getNextFragment=function(L,R){var O,w,x=R.fragments,F=x.length;if(!F)return null;var M,B=this.config,U=x[0].start;if(R.live){var G=B.initialLiveManifestSize;if(F<G)return this.warn("Not enough fragments to start playback (have: "+F+", need: "+G+")"),null;R.PTSKnown||this.startFragRequested||this.startPosition!==-1||(M=this.getInitialLiveFragment(R,x),this.startPosition=M?this.hls.liveSyncPosition||M.start:L)}else L<=U&&(M=x[0]);if(!M){var V=B.lowLatencyMode?R.partEnd:R.fragmentEnd;M=this.getFragmentAtPosition(L,V,R)}return(O=M)===null||O===void 0||!O.initSegment||(w=M)!==null&&w!==void 0&&w.initSegment.data||this.bitrateTest||(M=M.initSegment),M},k.getNextPart=function(L,R,O){for(var w=-1,x=!1,F=!0,M=0,B=L.length;M<B;M++){var U=L[M];if(F=F&&!U.independent,w>-1&&O<U.start)break;var G=U.loaded;!G&&(x||U.independent||F)&&U.fragment===R&&(w=M),x=G}return w},k.loadedEndOfParts=function(L,R){var O=L[L.length-1];return O&&R>O.start&&O.loaded},k.getInitialLiveFragment=function(L,R){var O=this.fragPrevious,w=null;if(O){if(L.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),w=Object(p.findFragmentByPDT)(R,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var x=O.sn+1;if(x>=L.startSN&&x<=L.endSN){var F=R[x-L.startSN];O.cc===F.cc&&(w=F,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(p.findFragWithCC)(R,O.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn)}}else{var M=this.hls.liveSyncPosition;M!==null&&(w=this.getFragmentAtPosition(M,this.bitrateTest?L.fragmentEnd:L.edge,L))}return w},k.getFragmentAtPosition=function(L,R,O){var w,x=this.config,F=this.fragPrevious,M=O.fragments,B=O.endSN,U=O.fragmentHint,G=x.maxFragLookUpTolerance,V=!!(x.lowLatencyMode&&O.partList&&U);if(V&&U&&!this.bitrateTest&&(M=M.concat(U),B=U.sn),L<R){var W=L>R-G?0:G;w=Object(p.findFragmentByPTS)(F,M,L,W)}else w=M[M.length-1];if(w){var Y=w.sn-O.startSN,Z=F&&w.level===F.level,Q=M[Y+1];if(this.fragmentTracker.getState(w)===b.FragmentState.BACKTRACKED){w=null;for(var z=Y;M[z]&&this.fragmentTracker.getState(M[z])===b.FragmentState.BACKTRACKED;)w=F?M[z--]:M[--z];w||(w=Q)}else F&&w.sn===F.sn&&!V&&Z&&(w.sn<B&&this.fragmentTracker.getState(Q)!==b.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+Q.sn),w=Q):w=null)}return w},k.synchronizeToLiveEdge=function(L){var R=this.config,O=this.media;if(O){var w=this.hls.liveSyncPosition,x=O.currentTime,F=L.fragments[0].start,M=L.edge,B=x>=F-R.maxFragLookUpTolerance&&x<=M;if(w!==null&&O.duration>w&&(x<w||!B)){var U=R.liveMaxLatencyDuration!==void 0?R.liveMaxLatencyDuration:R.liveMaxLatencyDurationCount*L.targetduration;(!B&&O.readyState<4||x<M-U)&&(this.loadedmetadata||(this.nextLoadPosition=w),O.readyState&&(this.warn("Playback: "+x.toFixed(3)+" is located too far from the end of live sliding playlist: "+M+", reset currentTime to : "+w.toFixed(3)),O.currentTime=w))}}},k.alignPlaylists=function(L,R){var O=this.levels,w=this.levelLastLoaded,x=this.fragPrevious,F=w!==null?O[w]:null,M=L.fragments.length;if(!M)return this.warn("No fragments in live playlist"),0;var B=L.fragments[0].start,U=!R,G=L.alignedSliding&&Object(A.isFiniteNumber)(B);if(U||!G&&!B){Object(c.alignStream)(x,F,L);var V=L.fragments[0].start;return this.log("Live playlist sliding: "+V.toFixed(2)+" start-sn: "+(R?R.startSN:"na")+"->"+L.startSN+" prev-sn: "+(x?x.sn:"na")+" fragments: "+M),V}return B},k.waitForCdnTuneIn=function(L){return L.live&&L.canBlockReload&&L.tuneInGoal>Math.max(L.partHoldBack,3*L.partTarget)},k.setStartPosition=function(L,R){var O=this.startPosition;if(O<R&&(O=-1),O===-1||this.lastCurrentTime===-1){var w=L.startTimeOffset;Object(A.isFiniteNumber)(w)?(O=R+w,w<0&&(O+=L.totalduration),O=Math.min(Math.max(R,O),R+L.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+O),this.startPosition=O):L.live?O=this.hls.liveSyncPosition||R:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},k.getLoadPosition=function(){var L=this.media,R=0;return this.loadedmetadata&&L?R=L.currentTime:this.nextLoadPosition&&(R=this.nextLoadPosition),R},k.handleFragLoadAborted=function(L,R){this.transmuxer&&L.sn!=="initSegment"&&L.stats.aborted&&(this.warn("Fragment "+L.sn+(R?" part"+R.index:"")+" of level "+L.level+" was aborted"),this.resetFragmentLoading(L))},k.resetFragmentLoading=function(L){this.fragCurrent&&this.fragContextChanged(L)||(this.state=a.IDLE)},k.onFragmentOrKeyLoadError=function(L,R){if(!R.fatal){var O=R.frag;if(O&&O.type===L){var w=this.fragCurrent;console.assert(w&&O.sn===w.sn&&O.level===w.level&&O.urlId===w.urlId,"Frag load error must match current frag to retry");var x=this.config;if(this.fragLoadError+1<=x.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(O.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*x.fragLoadingRetryDelay,x.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+L+" "+O.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=a.FRAG_LOADING_WAITING_RETRY}else R.levelRetry?(L===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=a.IDLE):(I.logger.error(R.details+" reaches max retry, redispatch as fatal ..."),R.fatal=!0,this.hls.stopLoad(),this.state=a.ERROR)}}},k.afterBufferFlushed=function(L,R,O){if(L){var w=_.BufferHelper.getBuffered(L);this.fragmentTracker.detectEvictedFragments(R,w,O),this.state===a.ENDED&&this.resetLoadingState()}},k.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=a.IDLE},k.resetLiveStartWhenNotLoaded=function(L){if(!this.loadedmetadata){this.startFragRequested=!1;var R=this.levels?this.levels[L].details:null;if(R!=null&&R.live)return this.startPosition=-1,this.setStartPosition(R,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},k.updateLevelTiming=function(L,R,O,w){var x=this,F=O.details;console.assert(!!F,"level.details must be defined"),Object.keys(L.elementaryStreams).reduce(function(M,B){var U=L.elementaryStreams[B];if(U){var G=U.endPTS-U.startPTS;if(G<=0)return x.warn("Could not parse fragment "+L.sn+" "+B+" duration reliably ("+G+") resetting transmuxer to fallback to playlist timing"),x.resetTransmuxer(),M||!1;var V=w?0:Object(y.updateFragPTSDTS)(F,L,U.startPTS,U.endPTS,U.startDTS,U.endDTS);return x.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:F,level:O,drift:V,type:B,frag:L,start:U.startPTS,end:U.endPTS}),!0}return M},!1)?(this.state=a.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:L,part:R})):this.resetLoadingState()},k.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},s=r,(h=[{key:"state",get:function(){return this._state},set:function(L){var R=this._state;R!==L&&(this._state=L,this.log(R+"->"+L))}}])&&n(s.prototype,h),r}(T.default)},"./src/controller/buffer-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return p});var A=f("./src/polyfills/number.ts"),T=f("./src/events.ts"),b=f("./src/utils/logger.ts"),_=f("./src/errors.ts"),I=f("./src/utils/buffer-helper.ts"),D=f("./src/utils/mediasource-helper.ts"),o=f("./src/loader/fragment.ts"),S=f("./src/controller/buffer-operation-queue.ts"),m=Object(D.getMediaSource)(),c=/([ha]vc.)(?:\.[^.,]+)+/,p=function(){function y(e){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.hls,n=i.media,l=i.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),n&&(i.updateMediaElementDuration(),t.trigger(T.Events.MEDIA_ATTACHED,{media:n})),l&&l.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var u=y.prototype;return u.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},u.destroy=function(){this.unregisterListeners(),this.details=null},u.registerListeners=function(){var e=this.hls;e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.Events.BUFFER_RESET,this.onBufferReset,this),e.on(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.Events.BUFFER_EOS,this.onBufferEos,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.Events.FRAG_PARSED,this.onFragParsed,this),e.on(T.Events.FRAG_CHANGED,this.onFragChanged,this)},u.unregisterListeners=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.Events.BUFFER_RESET,this.onBufferReset,this),e.off(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.Events.BUFFER_EOS,this.onBufferEos,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.Events.FRAG_PARSED,this.onFragParsed,this),e.off(T.Events.FRAG_CHANGED,this.onFragChanged,this)},u._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},u.onManifestParsed=function(e,i){var t=2;(i.audio&&!i.video||!i.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},u.onMediaAttaching=function(e,i){var t=this.media=i.media;if(t&&m){var n=this.mediaSource=new m;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(n),this._objectUrl=t.src}},u.onMediaDetaching=function(){var e=this.media,i=this.mediaSource,t=this._objectUrl;if(i){if(b.logger.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(n){b.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.Events.MEDIA_DETACHED,void 0)},u.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(i){var t=e.sourceBuffer[i];try{t&&(e.removeBufferListeners(i),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[i]=void 0)}catch(n){b.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",n)}}),this._initSourceBuffer()},u.onBufferCodecs=function(e,i){var t=this,n=this.getSourceBufferTypes().length;Object.keys(i).forEach(function(l){if(n){var a=t.tracks[l];if(a&&typeof a.buffer.changeType=="function"){var d=i[l],E=d.codec,g=d.levelCodec,v=d.container;if((a.levelCodec||a.codec).replace(c,"$1")!==(g||E).replace(c,"$1")){var r=v+";codecs="+(g||E);t.appendChangeType(l,r)}}}else t.pendingTracks[l]=i[l]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},u.appendChangeType=function(e,i){var t=this,n=this.operationQueue,l={execute:function(){var a=t.sourceBuffer[e];a&&(b.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+i),a.changeType(i)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(a){b.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",a)}};n.append(l,e)},u.onBufferAppending=function(e,i){var t=this,n=this.hls,l=this.operationQueue,a=this.tracks,d=i.data,E=i.type,g=i.frag,v=i.part,r=i.chunkMeta,s=r.buffering[E],h=self.performance.now();s.start=h;var k=g.stats.buffering,L=v?v.stats.buffering:null;k.start===0&&(k.start=h),L&&L.start===0&&(L.start=h);var R=a.audio,O=E==="audio"&&r.id===1&&(R==null?void 0:R.container)==="audio/mpeg",w={execute:function(){if(s.executeStart=self.performance.now(),O){var x=t.sourceBuffer[E];if(x){var F=g.start-x.timestampOffset;Math.abs(F)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+g.start+" (delta: "+F+") sn: "+g.sn+")"),x.timestampOffset=g.start)}}t.appendExecutor(d,E)},onStart:function(){},onComplete:function(){var x=self.performance.now();s.executeEnd=s.end=x,k.first===0&&(k.first=x),L&&L.first===0&&(L.first=x);var F=t.sourceBuffer,M={};for(var B in F)M[B]=I.BufferHelper.getBuffered(F[B]);t.appendError=0,t.hls.trigger(T.Events.BUFFER_APPENDED,{type:E,frag:g,part:v,chunkMeta:r,parent:g.type,timeRanges:M})},onError:function(x){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",x);var F={type:_.ErrorTypes.MEDIA_ERROR,parent:g.type,details:_.ErrorDetails.BUFFER_APPEND_ERROR,err:x,fatal:!1};x.code===DOMException.QUOTA_EXCEEDED_ERR?F.details=_.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,F.details=_.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>n.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),F.fatal=!0)),n.trigger(T.Events.ERROR,F)}};l.append(w,E)},u.onBufferFlushing=function(e,i){var t=this,n=this.operationQueue,l=function(a){return{execute:t.removeExecutor.bind(t,a,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(T.Events.BUFFER_FLUSHED,{type:a})},onError:function(d){b.logger.warn("[buffer-controller]: Failed to remove from "+a+" SourceBuffer",d)}}};i.type?n.append(l(i.type),i.type):this.getSourceBufferTypes().forEach(function(a){n.append(l(a),a)})},u.onFragParsed=function(e,i){var t=this,n=i.frag,l=i.part,a=[],d=l?l.elementaryStreams:n.elementaryStreams;d[o.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(d[o.ElementaryStreamTypes.AUDIO]&&a.push("audio"),d[o.ElementaryStreamTypes.VIDEO]&&a.push("video")),a.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var E=self.performance.now();n.stats.buffering.end=E,l&&(l.stats.buffering.end=E);var g=l?l.stats:n.stats;t.hls.trigger(T.Events.FRAG_BUFFERED,{frag:n,part:l,stats:g,id:n.type})},a)},u.onFragChanged=function(e,i){this.flushBackBuffer()},u.onBufferEos=function(e,i){var t=this;this.getSourceBufferTypes().reduce(function(n,l){var a=t.sourceBuffer[l];return i.type&&i.type!==l||a&&!a.ended&&(a.ended=!0,b.logger.log("[buffer-controller]: "+l+" sourceBuffer now EOS")),n&&!(a&&!a.ended)},!0)&&this.blockBuffers(function(){var n=t.mediaSource;n&&n.readyState==="open"&&n.endOfStream()})},u.onLevelUpdated=function(e,i){var t=i.details;t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},u.flushBackBuffer=function(){var e=this.hls,i=this.details,t=this.media,n=this.sourceBuffer;if(t&&i!==null){var l=this.getSourceBufferTypes();if(l.length){var a=i.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(A.isFiniteNumber)(a)&&!(a<0)){var d=t.currentTime,E=i.levelTargetDuration,g=Math.max(a,E),v=Math.floor(d/E)*E-g;l.forEach(function(r){var s=n[r];if(s){var h=I.BufferHelper.getBuffered(s);h.length>0&&v>h.start(0)&&(e.trigger(T.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),i.live&&e.trigger(T.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v}),e.trigger(T.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:r}))}})}}}},u.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,i=this.hls,t=this.media,n=this.mediaSource,l=e.fragments[0].start+e.totalduration,a=t.duration,d=Object(A.isFiniteNumber)(n.duration)?n.duration:0;e.live&&i.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(l>d&&l>a||!Object(A.isFiniteNumber)(a))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),n.duration=l)}},u.updateSeekableRange=function(e){var i=this.mediaSource,t=e.fragments;if(t.length&&e.live&&i!=null&&i.setLiveSeekableRange){var n=Math.max(0,t[0].start),l=Math.max(n,n+e.totalduration);i.setLiveSeekableRange(n,l)}},u.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,i=this.operationQueue,t=this.pendingTracks,n=Object.keys(t).length;if(n&&!e||n===2){this.createSourceBuffers(t),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length===0)return void this.hls.trigger(T.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});l.forEach(function(a){i.executeNext(a)})}},u.createSourceBuffers=function(e){var i=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var l in e)if(!i[l]){var a=e[l];if(!a)throw Error("source buffer exists for track "+l+", however track does not");var d=a.levelCodec||a.codec,E=a.container+";codecs="+d;b.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var g=i[l]=t.addSourceBuffer(E),v=l;this.addBufferListener(v,"updatestart",this._onSBUpdateStart),this.addBufferListener(v,"updateend",this._onSBUpdateEnd),this.addBufferListener(v,"error",this._onSBUpdateError),this.tracks[l]={buffer:g,codec:d,container:a.container,levelCodec:a.levelCodec,id:a.id},n++}catch(r){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(T.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:E})}}n&&this.hls.trigger(T.Events.BUFFER_CREATED,{tracks:this.tracks})},u._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},u._onSBUpdateEnd=function(e){var i=this.operationQueue;i.current(e).onComplete(),i.shiftAndExecuteNext(e)},u._onSBUpdateError=function(e,i){b.logger.error("[buffer-controller]: "+e+" SourceBuffer error",i),this.hls.trigger(T.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(i)},u.removeExecutor=function(e,i,t){var n=this.media,l=this.mediaSource,a=this.operationQueue,d=this.sourceBuffer[e];if(!n||!l||!d)return b.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(e);var E=Object(A.isFiniteNumber)(n.duration)?n.duration:1/0,g=Object(A.isFiniteNumber)(l.duration)?l.duration:1/0,v=Math.max(0,i),r=Math.min(t,E,g);r>v?(b.logger.log("[buffer-controller]: Removing ["+v+","+r+"] from the "+e+" SourceBuffer"),console.assert(!d.updating,e+" sourceBuffer must not be updating"),d.remove(v,r)):a.shiftAndExecuteNext(e)},u.appendExecutor=function(e,i){var t=this.operationQueue,n=this.sourceBuffer[i];if(!n)return b.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),void t.shiftAndExecuteNext(i);n.ended=!1,console.assert(!n.updating,i+" sourceBuffer must not be updating"),n.appendBuffer(e)},u.blockBuffers=function(e,i){var t=this;if(i===void 0&&(i=this.getSourceBufferTypes()),!i.length)return b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var n=this.operationQueue,l=i.map(function(a){return n.appendBlocker(a)});Promise.all(l).then(function(){e(),i.forEach(function(a){var d=t.sourceBuffer[a];d&&d.updating||n.shiftAndExecuteNext(a)})})},u.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},u.addBufferListener=function(e,i,t){var n=this.sourceBuffer[e];if(n){var l=t.bind(this,e);this.listeners[e].push({event:i,listener:l}),n.addEventListener(i,l)}},u.removeBufferListeners=function(e){var i=this.sourceBuffer[e];i&&this.listeners[e].forEach(function(t){i.removeEventListener(t.event,t.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return T});var A=f("./src/utils/logger.ts"),T=function(){function b(I){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=I}var _=b.prototype;return _.append=function(I,D){var o=this.queues[D];o.push(I),o.length===1&&this.buffers[D]&&this.executeNext(D)},_.insertAbort=function(I,D){this.queues[D].unshift(I),this.executeNext(D)},_.appendBlocker=function(I){var D,o=new Promise(function(m){D=m}),S={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(S,I),o},_.executeNext=function(I){var D=this.buffers,o=this.queues,S=D[I],m=o[I];if(m.length){var c=m[0];try{c.execute()}catch(p){A.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),c.onError(p),S&&S.updating||(m.shift(),this.executeNext(I))}}},_.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},_.current=function(I){return this.queues[I][0]},b}()},"./src/controller/cap-level-controller.ts":function(P,C,f){f.r(C);var A=f("./src/events.ts");function T(_,I){for(var D=0;D<I.length;D++){var o=I[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}var b=function(){function _(m){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=m,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I,D,o,S=_.prototype;return S.setStreamController=function(m){this.streamController=m},S.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},S.registerListeners=function(){var m=this.hls;m.on(A.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},S.unregisterListener=function(){var m=this.hls;m.off(A.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},S.onFpsDropLevelCapping=function(m,c){_.isLevelAllowed(c.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(c.droppedLevel)},S.onMediaAttaching=function(m,c){this.media=c.media instanceof HTMLVideoElement?c.media:null},S.onManifestParsed=function(m,c){var p=this.hls;this.restrictedLevels=[],this.firstLevel=c.firstLevel,p.config.capLevelToPlayerSize&&c.video&&this.startCapping()},S.onBufferCodecs=function(m,c){this.hls.config.capLevelToPlayerSize&&c.video&&this.startCapping()},S.onMediaDetaching=function(){this.stopCapping()},S.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var c=this.hls;c.autoLevelCapping=this.getMaxLevel(m.length-1),c.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=c.autoLevelCapping}}},S.getMaxLevel=function(m){var c=this,p=this.hls.levels;if(!p.length)return-1;var y=p.filter(function(u,e){return _.isLevelAllowed(e,c.restrictedLevels)&&e<=m});return this.clientRect=null,_.getMaxLevelByMediaSize(y,this.mediaWidth,this.mediaHeight)},S.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},S.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},S.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,c={width:0,height:0};if(m){var p=m.getBoundingClientRect();c.width=p.width,c.height=p.height,c.width||c.height||(c.width=p.right-p.left||m.width||0,c.height=p.bottom-p.top||m.height||0)}return this.clientRect=c,c},_.isLevelAllowed=function(m,c){return c===void 0&&(c=[]),c.indexOf(m)===-1},_.getMaxLevelByMediaSize=function(m,c,p){if(!m||!m.length)return-1;for(var y,u,e=m.length-1,i=0;i<m.length;i+=1){var t=m[i];if((t.width>=c||t.height>=p)&&(y=t,!(u=m[i+1])||y.width!==u.width||y.height!==u.height)){e=i;break}}return e},I=_,o=[{key:"contentScaleFactor",get:function(){var m=1;try{m=self.devicePixelRatio}catch{}return m}}],(D=[{key:"mediaWidth",get:function(){return this.getDimensions().width*_.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*_.contentScaleFactor}}])&&T(I.prototype,D),o&&T(I,o),_}();C.default=b},"./src/controller/eme-controller.ts":function(P,C,f){f.r(C);var A=f("./src/events.ts"),T=f("./src/errors.ts"),b=f("./src/utils/logger.ts"),_=f("./src/utils/mediakeys-helper.ts");function I(o,S){for(var m=0;m<S.length;m++){var c=S[m];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(o,c.key,c)}}var D=function(){function o(p){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=p,this._config=p.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var S,m,c=o.prototype;return c.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},c._registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this)},c._unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this)},c.getLicenseServerUrl=function(p){switch(p){case _.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+p+'"')},c._attemptKeySystemAccess=function(p,y,u){var e=this,i=function(n,l,a,d){switch(n){case _.KeySystems.WIDEVINE:return function(E,g,v){var r={audioCapabilities:[],videoCapabilities:[]};return E.forEach(function(s){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+s+'"',robustness:v.audioRobustness||""})}),g.forEach(function(s){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+s+'"',robustness:v.videoRobustness||""})}),[r]}(l,a,d);default:throw new Error("Unknown key-system: "+n)}}(p,y,u,this._drmSystemOptions);b.logger.log("Requesting encrypted media key-system access");var t=this.requestMediaKeySystemAccess(p,i);this.mediaKeysPromise=t.then(function(n){return e._onMediaKeySystemAccessObtained(p,n)}),t.catch(function(n){b.logger.error('Failed to obtain key-system "'+p+'" access:',n)})},c._onMediaKeySystemAccessObtained=function(p,y){var u=this;b.logger.log('Access for key-system "'+p+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:y,mediaKeySystemDomain:p};this._mediaKeysList.push(e);var i=Promise.resolve().then(function(){return y.createMediaKeys()}).then(function(t){return e.mediaKeys=t,b.logger.log('Media-keys created for key-system "'+p+'"'),u._onMediaKeysCreated(),t});return i.catch(function(t){b.logger.error("Failed to create media-keys:",t)}),i},c._onMediaKeysCreated=function(){var p=this;this._mediaKeysList.forEach(function(y){y.mediaKeysSession||(y.mediaKeysSession=y.mediaKeys.createSession(),p._onNewMediaKeySession(y.mediaKeysSession))})},c._onNewMediaKeySession=function(p){var y=this;b.logger.log("New key-system session "+p.sessionId),p.addEventListener("message",function(u){y._onKeySessionMessage(p,u.message)},!1)},c._onKeySessionMessage=function(p,y){b.logger.log("Got EME message event, creating license request"),this._requestLicense(y,function(u){b.logger.log("Received license data (length: "+(u&&u.byteLength)+"), updating key-session"),p.update(u)})},c.onMediaEncrypted=function(p){var y=this;if(b.logger.log('Media is encrypted using "'+p.initDataType+'" init data type'),!this.mediaKeysPromise)return b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var u=function(e){y._media&&(y._attemptSetMediaKeys(e),y._generateRequestWithPreferredKeySession(p.initDataType,p.initData))};this.mediaKeysPromise.then(u).catch(u)},c._attemptSetMediaKeys=function(p){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var y=this._mediaKeysList[0];if(!y||!y.mediaKeys)return b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});b.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(y.mediaKeys),this._hasSetMediaKeys=!0}},c._generateRequestWithPreferredKeySession=function(p,y){var u=this,e=this._mediaKeysList[0];if(!e)return b.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)b.logger.warn("Key-Session already initialized but requested again");else{var i=e.mediaKeysSession;if(!i)return b.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!y)return b.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});b.logger.log('Generating key-session request for "'+p+'" init data type'),e.mediaKeysSessionInitialized=!0,i.generateRequest(p,y).then(function(){b.logger.debug("Key-session generation succeeded")}).catch(function(t){b.logger.error("Error generating key-session request:",t),u.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},c._createLicenseXhr=function(p,y,u){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,p,y,u);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,e,p),i=void 0}catch(t){b.logger.error(t)}try{e.readyState||e.open("POST",p,!0),i&&i.call(this.hls,e,p)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return e},c._onLicenseRequestReadyStageChange=function(p,y,u,e){switch(p.readyState){case 4:if(p.status===200){this._requestLicenseFailureCount=0,b.logger.log("License request succeeded");var i=p.response,t=this._licenseResponseCallback;if(t)try{i=t.call(this.hls,p,y)}catch(l){b.logger.error(l)}e(i)}else{if(b.logger.error("License Request XHR failed ("+y+"). Status: "+p.status+" ("+p.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var n=3-this._requestLicenseFailureCount+1;b.logger.warn("Retrying license request, "+n+" attempts left"),this._requestLicense(u,e)}}},c._generateLicenseRequestChallenge=function(p,y){switch(p.mediaKeySystemDomain){case _.KeySystems.WIDEVINE:return y}throw new Error("unsupported key-system: "+p.mediaKeySystemDomain)},c._requestLicense=function(p,y){b.logger.log("Requesting content license for key-system");var u=this._mediaKeysList[0];if(!u)return b.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var e=this.getLicenseServerUrl(u.mediaKeySystemDomain),i=this._createLicenseXhr(e,p,y);b.logger.log("Sending license request to URL: "+e);var t=this._generateLicenseRequestChallenge(u,p);i.send(t)}catch(n){b.logger.error("Failure requesting DRM license: "+n),this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},c.onMediaAttached=function(p,y){if(this._emeEnabled){var u=y.media;this._media=u,u.addEventListener("encrypted",this._onMediaEncrypted)}},c.onMediaDetached=function(){var p=this._media,y=this._mediaKeysList;p&&(p.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(y.map(function(u){if(u.mediaKeysSession)return u.mediaKeysSession.close().catch(function(){})})).then(function(){return p.setMediaKeys(null)}).catch(function(){}))},c.onManifestParsed=function(p,y){if(this._emeEnabled){var u=y.levels.map(function(i){return i.audioCodec}).filter(function(i){return!!i}),e=y.levels.map(function(i){return i.videoCodec}).filter(function(i){return!!i});this._attemptKeySystemAccess(_.KeySystems.WIDEVINE,u,e)}},S=o,(m=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&I(S.prototype,m),o}();C.default=D},"./src/controller/fps-controller.ts":function(P,C,f){f.r(C);var A=f("./src/events.ts"),T=f("./src/utils/logger.ts"),b=function(){function _(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var I=_.prototype;return I.setStreamController=function(D){this.streamController=D},I.registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},I.unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching)},I.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},I.onMediaAttaching=function(D,o){var S=this.hls.config;if(S.capLevelOnFPSDrop){var m=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=m,m&&typeof m.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},I.checkFPS=function(D,o,S){var m=performance.now();if(o){if(this.lastTime){var c=m-this.lastTime,p=S-this.lastDroppedFrames,y=o-this.lastDecodedFrames,u=1e3*p/c,e=this.hls;if(e.trigger(A.Events.FPS_DROP,{currentDropped:p,currentDecoded:y,totalDroppedFrames:S}),u>0&&p>e.config.fpsDroppedMonitoringThreshold*y){var i=e.currentLevel;T.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=i)&&(i-=1,e.trigger(A.Events.FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:e.currentLevel}),e.autoLevelCapping=i,this.streamController.nextLevelSwitch())}}this.lastTime=m,this.lastDroppedFrames=S,this.lastDecodedFrames=o}},I.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var o=D.getVideoPlaybackQuality();this.checkFPS(D,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},_}();C.default=b},"./src/controller/fragment-finders.ts":function(P,C,f){f.r(C),f.d(C,"findFragmentByPDT",function(){return b}),f.d(C,"findFragmentByPTS",function(){return _}),f.d(C,"fragmentWithinToleranceTest",function(){return I}),f.d(C,"pdtWithinToleranceTest",function(){return D}),f.d(C,"findFragWithCC",function(){return o});var A=f("./src/polyfills/number.ts"),T=f("./src/utils/binary-search.ts");function b(S,m,c){if(m===null||!Array.isArray(S)||!S.length||!Object(A.isFiniteNumber)(m)||m<(S[0].programDateTime||0)||m>=(S[S.length-1].endProgramDateTime||0))return null;c=c||0;for(var p=0;p<S.length;++p){var y=S[p];if(D(m,c,y))return y}return null}function _(S,m,c,p){c===void 0&&(c=0),p===void 0&&(p=0);var y=null;if(S?y=m[S.sn-m[0].sn+1]||null:c===0&&m[0].start===0&&(y=m[0]),y&&I(c,p,y)===0)return y;var u=T.default.search(m,I.bind(null,c,p));return u||y}function I(S,m,c){S===void 0&&(S=0),m===void 0&&(m=0);var p=Math.min(m,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-p<=S?1:c.start-p>S&&c.start?-1:0}function D(S,m,c){var p=1e3*Math.min(m,c.duration+(c.deltaPTS?c.deltaPTS:0));return(c.endProgramDateTime||0)-p>S}function o(S,m){return T.default.search(S,function(c){return c.cc<m?1:c.cc>m?-1:0})}},"./src/controller/fragment-tracker.ts":function(P,C,f){f.r(C),f.d(C,"FragmentState",function(){return A}),f.d(C,"FragmentTracker",function(){return I});var A,T,b=f("./src/events.ts"),_=f("./src/types/loader.ts");(T=A||(A={})).NOT_LOADED="NOT_LOADED",T.BACKTRACKED="BACKTRACKED",T.APPENDING="APPENDING",T.PARTIAL="PARTIAL",T.OK="OK";var I=function(){function S(c){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=c,this._registerListeners()}var m=S.prototype;return m._registerListeners=function(){var c=this.hls;c.on(b.Events.BUFFER_APPENDED,this.onBufferAppended,this),c.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),c.on(b.Events.FRAG_LOADED,this.onFragLoaded,this)},m._unregisterListeners=function(){var c=this.hls;c.off(b.Events.BUFFER_APPENDED,this.onBufferAppended,this),c.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),c.off(b.Events.FRAG_LOADED,this.onFragLoaded,this)},m.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},m.getAppendedFrag=function(c,p){if(p===_.PlaylistLevelType.MAIN){var y=this.activeFragment,u=this.activeParts;if(!y)return null;if(u)for(var e=u.length;e--;){var i=u[e],t=i?i.end:y.appendedPTS;if(i.start<=c&&t!==void 0&&c<=t)return e>9&&(this.activeParts=u.slice(e-9)),i}else if(y.start<=c&&y.appendedPTS!==void 0&&c<=y.appendedPTS)return y}return this.getBufferedFrag(c,p)},m.getBufferedFrag=function(c,p){for(var y=this.fragments,u=Object.keys(y),e=u.length;e--;){var i=y[u[e]];if((i==null?void 0:i.body.type)===p&&i.buffered){var t=i.body;if(t.start<=c&&c<=t.end)return t}}return null},m.detectEvictedFragments=function(c,p,y){var u=this;Object.keys(this.fragments).forEach(function(e){var i=u.fragments[e];if(i)if(i.buffered){var t=i.range[c];t&&t.time.some(function(n){var l=!u.isTimeBuffered(n.startPTS,n.endPTS,p);return l&&u.removeFragment(i.body),l})}else i.body.type===y&&u.removeFragment(i.body)})},m.detectPartialFragments=function(c){var p=this,y=this.timeRanges,u=c.frag,e=c.part;if(y&&u.sn!=="initSegment"){var i=o(u),t=this.fragments[i];t&&(Object.keys(y).forEach(function(n){var l=u.elementaryStreams[n];if(l){var a=y[n],d=e!==null||l.partial===!0;t.range[n]=p.getBufferedTimes(u,e,d,a)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},m.fragBuffered=function(c){var p=o(c),y=this.fragments[p];y&&(y.backtrack=y.loaded=null,y.buffered=!0)},m.getBufferedTimes=function(c,p,y,u){for(var e={time:[],partial:y},i=p?p.start:c.start,t=p?p.end:c.end,n=c.minEndPTS||t,l=c.maxStartPTS||i,a=0;a<u.length;a++){var d=u.start(a)-this.bufferPadding,E=u.end(a)+this.bufferPadding;if(l>=d&&n<=E){e.time.push({startPTS:Math.max(i,u.start(a)),endPTS:Math.min(t,u.end(a))});break}if(i<E&&t>d)e.partial=!0,e.time.push({startPTS:Math.max(i,u.start(a)),endPTS:Math.min(t,u.end(a))});else if(t<=d)break}return e},m.getPartialFragment=function(c){var p,y,u,e=null,i=0,t=this.bufferPadding,n=this.fragments;return Object.keys(n).forEach(function(l){var a=n[l];a&&D(a)&&(y=a.body.start-t,u=a.body.end+t,c>=y&&c<=u&&(p=Math.min(c-y,u-c),i<=p&&(e=a.body,i=p)))}),e},m.getState=function(c){var p=o(c),y=this.fragments[p];return y?y.buffered?D(y)?A.PARTIAL:A.OK:y.backtrack?A.BACKTRACKED:A.APPENDING:A.NOT_LOADED},m.backtrack=function(c,p){var y=o(c),u=this.fragments[y];if(!u||u.backtrack)return null;var e=u.backtrack=p||u.loaded;return u.loaded=null,e},m.getBacktrackData=function(c){var p=o(c),y=this.fragments[p];if(y){var u,e=y.backtrack;if(e!=null&&(u=e.payload)!==null&&u!==void 0&&u.byteLength)return e;this.removeFragment(c)}return null},m.isTimeBuffered=function(c,p,y){for(var u,e,i=0;i<y.length;i++){if(u=y.start(i)-this.bufferPadding,e=y.end(i)+this.bufferPadding,c>=u&&p<=e)return!0;if(p<=u)return!1}return!1},m.onFragLoaded=function(c,p){var y=p.frag,u=p.part;if(y.sn!=="initSegment"&&!y.bitrateTest&&!u){var e=o(y);this.fragments[e]={body:y,loaded:p,backtrack:null,buffered:!1,range:Object.create(null)}}},m.onBufferAppended=function(c,p){var y=this,u=p.frag,e=p.part,i=p.timeRanges;if(u.type===_.PlaylistLevelType.MAIN)if(this.activeFragment=u,e){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(e)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(n){var l=i[n];if(y.detectEvictedFragments(n,l),!e)for(var a=0;a<l.length;a++)u.appendedPTS=Math.max(l.end(a),u.appendedPTS||0)})},m.onFragBuffered=function(c,p){this.detectPartialFragments(p)},m.hasFragment=function(c){var p=o(c);return!!this.fragments[p]},m.removeFragmentsInRange=function(c,p,y){var u=this;Object.keys(this.fragments).forEach(function(e){var i=u.fragments[e];if(i&&i.buffered){var t=i.body;t.type===y&&t.start<p&&t.end>c&&u.removeFragment(t)}})},m.removeFragment=function(c){var p=o(c);c.stats.loaded=0,c.clearElementaryStreamInfo(),delete this.fragments[p]},m.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},S}();function D(S){var m,c;return S.buffered&&(((m=S.range.video)===null||m===void 0?void 0:m.partial)||((c=S.range.audio)===null||c===void 0?void 0:c.partial))}function o(S){return S.type+"_"+S.level+"_"+S.urlId+"_"+S.sn}},"./src/controller/gap-controller.ts":function(P,C,f){f.r(C),f.d(C,"STALL_MINIMUM_DURATION_MS",function(){return I}),f.d(C,"MAX_START_GAP_JUMP",function(){return D}),f.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),f.d(C,"SKIP_BUFFER_RANGE_START",function(){return S}),f.d(C,"default",function(){return m});var A=f("./src/utils/buffer-helper.ts"),T=f("./src/errors.ts"),b=f("./src/events.ts"),_=f("./src/utils/logger.ts"),I=250,D=2,o=.1,S=.05,m=function(){function c(y,u,e,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=u,this.fragmentTracker=e,this.hls=i}var p=c.prototype;return p.destroy=function(){this.hls=this.fragmentTracker=this.media=null},p.poll=function(y){var u=this.config,e=this.media,i=this.stalled,t=e.currentTime,n=e.seeking,l=this.seeking&&!n,a=!this.seeking&&n;if(this.seeking=n,t===y){if((a||l)&&(this.stalled=null),!e.paused&&!e.ended&&e.playbackRate!==0&&A.BufferHelper.getBuffered(e).length){var d=A.BufferHelper.bufferInfo(e,t,0),E=d.len>0,g=d.nextStart||0;if(E||g){if(n){var v=d.len>D,r=!g||g-t>D&&!this.fragmentTracker.getPartialFragment(t);if(v||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var s,h=Math.max(g,d.start||0)-t,k=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,L=!(k==null||(s=k.details)===null||s===void 0)&&s.live?2*k.details.targetduration:D;if(h>0&&h<=L)return void this._trySkipBufferHole(null)}var R=self.performance.now();if(i!==null){var O=R-i;!n&&O>=I&&this._reportStall(d.len);var w=A.BufferHelper.bufferInfo(e,t,u.maxBufferHole);this._tryFixBufferStall(w,O)}else this.stalled=R}}}else if(this.moved=!0,i!==null){if(this.stallReported){var x=self.performance.now()-i;_.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(x)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},p._tryFixBufferStall=function(y,u){var e=this.config,i=this.fragmentTracker,t=this.media.currentTime,n=i.getPartialFragment(t);n&&this._trySkipBufferHole(n)||y.len>e.maxBufferHole&&u>1e3*e.highBufferWatchdogPeriod&&(_.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},p._reportStall=function(y){var u=this.hls,e=this.media;this.stallReported||(this.stallReported=!0,_.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+y+")"),u.trigger(b.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:y}))},p._trySkipBufferHole=function(y){for(var u=this.config,e=this.hls,i=this.media,t=i.currentTime,n=0,l=A.BufferHelper.getBuffered(i),a=0;a<l.length;a++){var d=l.start(a);if(t+u.maxBufferHole>=n&&t<d){var E=Math.max(d+S,i.currentTime+o);return _.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+E),this.moved=!0,this.stalled=null,i.currentTime=E,y&&e.trigger(b.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+E,frag:y}),E}n=l.end(a)}return 0},p._tryNudgeBuffer=function(){var y=this.config,u=this.hls,e=this.media,i=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<y.nudgeMaxRetry){var n=i+t*y.nudgeOffset;_.logger.warn("Nudging 'currentTime' from "+i+" to "+n),e.currentTime=n,u.trigger(b.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+y.nudgeMaxRetry+" nudges"),u.trigger(b.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},c}()},"./src/controller/id3-track-controller.ts":function(P,C,f){f.r(C);var A=f("./src/events.ts"),T=f("./src/utils/texttrack-utils.ts"),b=f("./src/demux/id3.ts"),_=function(){function I(o){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=o,this._registerListeners()}var D=I.prototype;return D.destroy=function(){this._unregisterListeners()},D._registerListeners=function(){var o=this.hls;o.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D._unregisterListeners=function(){var o=this.hls;o.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D.onMediaAttached=function(o,S){this.media=S.media},D.onMediaDetaching=function(){this.id3Track&&(Object(T.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},D.getID3Track=function(o){if(this.media){for(var S=0;S<o.length;S++){var m=o[S];if(m.kind==="metadata"&&m.label==="id3")return Object(T.sendAddTrackEvent)(m,this.media),m}return this.media.addTextTrack("metadata","id3")}},D.onFragParsingMetadata=function(o,S){if(this.media){var m=S.frag,c=S.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var p=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,y=0;y<c.length;y++){var u=b.getID3Frames(c[y].data);if(u){var e=c[y].pts,i=y<c.length-1?c[y+1].pts:m.end;i-e<=0&&(i=e+.25);for(var t=0;t<u.length;t++){var n=u[t];if(!b.isTimeStampFrame(n)){var l=new p(e,i,"");l.value=n,this.id3Track.addCue(l)}}}}}},D.onBufferFlushing=function(o,S){var m=S.startOffset,c=S.endOffset,p=S.type;if(!p||p==="audio"){var y=this.id3Track;y&&Object(T.removeCuesInRange)(y,m,c)}},I}();C.default=_},"./src/controller/latency-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return I});var A=f("./src/errors.ts"),T=f("./src/events.ts"),b=f("./src/utils/logger.ts");function _(D,o){for(var S=0;S<o.length;S++){var m=o[S];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(D,m.key,m)}}var I=function(){function D(c){var p=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return p.timeupdate()},this.hls=c,this.config=c.config,this.registerListeners()}var o,S,m=D.prototype;return m.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},m.registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(T.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(T.Events.ERROR,this.onError)},m.onMediaAttached=function(c,p){this.media=p.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},m.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},m.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},m.onLevelUpdated=function(c,p){var y=p.details;this.levelDetails=y,y.advanced&&this.timeupdate(),!y.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},m.onError=function(c,p){p.details===A.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},m.timeupdate=function(){var c=this.media,p=this.levelDetails;if(c&&p){this.currentTime=c.currentTime;var y=this.computeLatency();if(y!==null){this._latency=y;var u=this.config,e=u.lowLatencyMode,i=u.maxLiveSyncPlaybackRate;if(e&&i!==1){var t=this.targetLatency;if(t!==null){var n=y-t,l=n<Math.min(this.maxLatency,t+p.targetduration);if(p.live&&l&&n>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,i)),d=Math.round(2/(1+Math.exp(-.75*n-this.edgeStalled))*20)/20;c.playbackRate=Math.min(a,Math.max(1,d))}else c.playbackRate!==1&&c.playbackRate!==0&&(c.playbackRate=1)}}}}},m.estimateLiveEdge=function(){var c=this.levelDetails;return c===null?null:c.edge+c.age},m.computeLatency=function(){var c=this.estimateLiveEdge();return c===null?null:c-this.currentTime},o=D,(S=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var c=this.config,p=this.levelDetails;return c.liveMaxLatencyDuration!==void 0?c.liveMaxLatencyDuration:p?c.liveMaxLatencyDurationCount*p.targetduration:0}},{key:"targetLatency",get:function(){var c=this.levelDetails;if(c===null)return null;var p=c.holdBack,y=c.partHoldBack,u=c.targetduration,e=this.config,i=e.liveSyncDuration,t=e.liveSyncDurationCount,n=e.lowLatencyMode,l=this.hls.userConfig,a=n&&y||p;(l.liveSyncDuration||l.liveSyncDurationCount||a===0)&&(a=i!==void 0?i:t*u);var d=u;return a+Math.min(1*this.stallCount,d)}},{key:"liveSyncPosition",get:function(){var c=this.estimateLiveEdge(),p=this.targetLatency,y=this.levelDetails;if(c===null||p===null||y===null)return null;var u=y.edge,e=c-p-this.edgeStalled,i=u-y.totalduration,t=u-(this.config.lowLatencyMode&&y.partTarget||y.targetduration);return Math.min(Math.max(i,e),t)}},{key:"drift",get:function(){var c=this.levelDetails;return c===null?1:c.drift}},{key:"edgeStalled",get:function(){var c=this.levelDetails;if(c===null)return 0;var p=3*(this.config.lowLatencyMode&&c.partTarget||c.targetduration);return Math.max(c.age-p,0)}},{key:"forwardBufferLength",get:function(){var c=this.media,p=this.levelDetails;if(!c||!p)return 0;var y=c.buffered.length;return y?c.buffered.end(y-1):p.edge-this.currentTime}}])&&_(o.prototype,S),D}()},"./src/controller/level-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return y});var A=f("./src/types/level.ts"),T=f("./src/events.ts"),b=f("./src/errors.ts"),_=f("./src/utils/codecs.ts"),I=f("./src/controller/level-helper.ts"),D=f("./src/controller/base-playlist-controller.ts"),o=f("./src/types/loader.ts");function S(){return(S=Object.assign||function(u){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(u[t]=i[t])}return u}).apply(this,arguments)}function m(u,e){for(var i=0;i<e.length;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(u,t.key,t)}}function c(u,e){return(c=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(u,e)}var p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),y=function(u){var e,i;function t(d){var E;return(E=u.call(this,d,"[level-controller]")||this)._levels=[],E._firstLevel=-1,E._startLevel=void 0,E.currentLevelIndex=-1,E.manualLevelIndex=-1,E.onParsedComplete=void 0,E._registerListeners(),E}i=u,(e=t).prototype=Object.create(i.prototype),e.prototype.constructor=e,c(e,i);var n,l,a=t.prototype;return a._registerListeners=function(){var d=this.hls;d.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),d.on(T.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var d=this.hls;d.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(T.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,u.prototype.destroy.call(this)},a.startLoad=function(){this._levels.forEach(function(d){d.loadError=0}),u.prototype.startLoad.call(this)},a.onManifestLoaded=function(d,E){var g,v,r=[],s=[],h=[],k={},L=!1,R=!1,O=!1;if(E.levels.forEach(function(M){var B=M.attrs;L=L||!(!M.width||!M.height),R=R||!!M.videoCodec,O=O||!!M.audioCodec,p&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var U=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;(v=k[U])?v.url.push(M.url):(v=new A.Level(M),k[U]=v,r.push(v)),B&&(B.AUDIO&&Object(I.addGroupId)(v,"audio",B.AUDIO),B.SUBTITLES&&Object(I.addGroupId)(v,"text",B.SUBTITLES))}),(L||R)&&O&&(r=r.filter(function(M){var B=M.videoCodec,U=M.width,G=M.height;return!!B||!(!U||!G)})),r=r.filter(function(M){var B=M.audioCodec,U=M.videoCodec;return(!B||Object(_.isCodecSupportedInMp4)(B,"audio"))&&(!U||Object(_.isCodecSupportedInMp4)(U,"video"))}),E.audioTracks&&(s=E.audioTracks.filter(function(M){return!M.audioCodec||Object(_.isCodecSupportedInMp4)(M.audioCodec,"audio")}),Object(I.assignTrackIdsByGroup)(s)),E.subtitles&&(h=E.subtitles,Object(I.assignTrackIdsByGroup)(h)),r.length>0){g=r[0].bitrate,r.sort(function(M,B){return M.bitrate-B.bitrate}),this._levels=r;for(var w=0;w<r.length;w++)if(r[w].bitrate===g){this._firstLevel=w,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+g);break}var x=O&&!R,F={levels:r,audioTracks:s,subtitleTracks:h,firstLevel:this._firstLevel,stats:E.stats,audio:O,video:R,altAudio:!x&&s.some(function(M){return!!M.url})};this.hls.trigger(T.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(T.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:E.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(d,E){if(u.prototype.onError.call(this,d,E),!E.fatal){var g=E.context,v=this._levels[this.currentLevelIndex];if(g&&(g.type===o.PlaylistContextType.AUDIO_TRACK&&v.audioGroupIds&&g.groupId===v.audioGroupIds[v.urlId]||g.type===o.PlaylistContextType.SUBTITLE_TRACK&&v.textGroupIds&&g.groupId===v.textGroupIds[v.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,s=!1,h=!0;switch(E.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(E.frag){var k=this._levels[E.frag.level];k?(k.fragmentError++,k.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=E.frag.level)):r=E.frag.level}break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:g&&(g.deliveryDirectives&&(h=!1),r=g.level),s=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:r=E.level,s=!0}r!==void 0&&this.recoverLevel(E,r,s,h)}}},a.recoverLevel=function(d,E,g,v){var r=d.details,s=this._levels[E];if(s.loadError++,g){if(!this.retryLoadingOrFail(d))return void(this.currentLevelIndex=-1);d.levelRetry=!0}if(v){var h=s.url.length;if(h>1&&s.loadError<h)d.levelRetry=!0,this.redundantFailover(E);else if(this.manualLevelIndex===-1){var k=E===0?this._levels.length-1:E-1;this.currentLevelIndex!==k&&this._levels[k].loadError===0&&(this.warn(r+": switch to "+k),d.levelRetry=!0,this.hls.nextAutoLevel=k)}}},a.redundantFailover=function(d){var E=this._levels[d],g=E.url.length;if(g>1){var v=(E.urlId+1)%g;this.warn("Switching to redundant URL-id "+v),this._levels.forEach(function(r){r.urlId=v}),this.level=d}},a.onFragLoaded=function(d,E){var g=E.frag;if(g!==void 0&&g.type===o.PlaylistLevelType.MAIN){var v=this._levels[g.level];v!==void 0&&(v.fragmentError=0,v.loadError=0)}},a.onLevelLoaded=function(d,E){var g,v,r=E.level,s=E.details,h=this._levels[r];if(!h)return this.warn("Invalid level index "+r),void((v=E.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(s.deltaUpdateFailed=!0));r===this.currentLevelIndex?(h.fragmentError===0&&(h.loadError=0,this.retryCount=0),this.playlistLoaded(r,E,h.details)):(g=E.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(s.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(d,E){var g=this.hls.levels[this.currentLevelIndex];if(g&&g.audioGroupIds){for(var v=-1,r=this.hls.audioTracks[E.id].groupId,s=0;s<g.audioGroupIds.length;s++)if(g.audioGroupIds[s]===r){v=s;break}v!==g.urlId&&(g.urlId=v,this.startLoad())}},a.loadPlaylist=function(d){var E=this.currentLevelIndex,g=this._levels[E];if(this.canLoad&&g&&g.url.length>0){var v=g.urlId,r=g.url[v];if(d)try{r=d.addDirectives(r)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+E+(d?" at sn "+d.msn+" part "+d.part:"")+" with URL-id "+v+" "+r),this.clearTimer(),this.hls.trigger(T.Events.LEVEL_LOADING,{url:r,level:E,id:v,deliveryDirectives:d||null})}},a.removeLevel=function(d,E){var g=function(r,s){return s!==E},v=this._levels.filter(function(r,s){return s!==d||r.url.length>1&&E!==void 0&&(r.url=r.url.filter(g),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(g)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(g)),r.urlId=0,!0)}).map(function(r,s){var h=r.details;return h!=null&&h.fragments&&h.fragments.forEach(function(k){k.level=s}),r});this._levels=v,this.hls.trigger(T.Events.LEVELS_UPDATED,{levels:v})},n=t,(l=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(d){var E,g=this._levels;if(g.length!==0&&(this.currentLevelIndex!==d||(E=g[d])===null||E===void 0||!E.details)){if(d<0||d>=g.length){var v=d<0;if(this.hls.trigger(T.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:d,fatal:v,reason:"invalid level idx"}),v)return;d=Math.min(d,g.length-1)}this.clearTimer();var r=this.currentLevelIndex,s=g[r],h=g[d];this.log("switching to level "+d+" from "+r),this.currentLevelIndex=d;var k=S({},h,{level:d,maxBitrate:h.maxBitrate,uri:h.uri,urlId:h.urlId});delete k._urlId,this.hls.trigger(T.Events.LEVEL_SWITCHING,k);var L=h.details;if(!L||L.live){var R=this.switchParams(h.uri,s==null?void 0:s.details);this.loadPlaylist(R)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(d){this.manualLevelIndex=d,this._startLevel===void 0&&(this._startLevel=d),d!==-1&&(this.level=d)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(d){this._firstLevel=d}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var d=this.hls.config.startLevel;return d!==void 0?d:this._firstLevel}return this._startLevel},set:function(d){this._startLevel=d}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(d){this.level=d,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=d)}}])&&m(n.prototype,l),t}(D.default)},"./src/controller/level-helper.ts":function(P,C,f){f.r(C),f.d(C,"addGroupId",function(){return b}),f.d(C,"assignTrackIdsByGroup",function(){return _}),f.d(C,"updatePTS",function(){return I}),f.d(C,"updateFragPTSDTS",function(){return o}),f.d(C,"mergeDetails",function(){return S}),f.d(C,"mapPartIntersection",function(){return m}),f.d(C,"mapFragmentIntersection",function(){return c}),f.d(C,"adjustSliding",function(){return p}),f.d(C,"addSliding",function(){return y}),f.d(C,"computeReloadInterval",function(){return u}),f.d(C,"getFragmentWithSN",function(){return e}),f.d(C,"getPartWith",function(){return i});var A=f("./src/polyfills/number.ts"),T=f("./src/utils/logger.ts");function b(t,n,l){switch(n){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(l);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(l)}}function _(t){var n={};t.forEach(function(l){var a=l.groupId||"";l.id=n[a]=n[a]||0,n[a]++})}function I(t,n,l){D(t[n],t[l])}function D(t,n){var l=n.startPTS;if(Object(A.isFiniteNumber)(l)){var a,d=0;n.sn>t.sn?(d=l-t.start,a=t):(d=t.start-l,a=n),a.duration!==d&&(a.duration=d)}else n.sn>t.sn?t.cc===n.cc&&t.minEndPTS?n.start=t.start+(t.minEndPTS-t.start):n.start=t.start+t.duration:n.start=Math.max(t.start-n.duration,0)}function o(t,n,l,a,d,E){a-l<=0&&(T.logger.warn("Fragment should have a positive duration",n),a=l+n.duration,E=d+n.duration);var g=l,v=a,r=n.startPTS,s=n.endPTS;if(Object(A.isFiniteNumber)(r)){var h=Math.abs(r-l);Object(A.isFiniteNumber)(n.deltaPTS)?n.deltaPTS=Math.max(h,n.deltaPTS):n.deltaPTS=h,g=Math.max(l,r),l=Math.min(l,r),d=Math.min(d,n.startDTS),v=Math.min(a,s),a=Math.max(a,s),E=Math.max(E,n.endDTS)}n.duration=a-l;var k=l-n.start;n.appendedPTS=a,n.start=n.startPTS=l,n.maxStartPTS=g,n.startDTS=d,n.endPTS=a,n.minEndPTS=v,n.endDTS=E;var L,R=n.sn;if(!t||R<t.startSN||R>t.endSN)return 0;var O=R-t.startSN,w=t.fragments;for(w[O]=n,L=O;L>0;L--)D(w[L],w[L-1]);for(L=O;L<w.length-1;L++)D(w[L],w[L+1]);return t.fragmentHint&&D(w[w.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,k}function S(t,n){for(var l=null,a=t.fragments,d=a.length-1;d>=0;d--){var E=a[d].initSegment;if(E){l=E;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var g,v=0;if(c(t,n,function(R,O){var w;R.relurl&&(v=R.cc-O.cc),Object(A.isFiniteNumber)(R.startPTS)&&Object(A.isFiniteNumber)(R.endPTS)&&(O.start=O.startPTS=R.startPTS,O.startDTS=R.startDTS,O.appendedPTS=R.appendedPTS,O.maxStartPTS=R.maxStartPTS,O.endPTS=R.endPTS,O.endDTS=R.endDTS,O.minEndPTS=R.minEndPTS,O.duration=R.endPTS-R.startPTS,O.duration&&(g=O),n.PTSKnown=n.alignedSliding=!0),O.elementaryStreams=R.elementaryStreams,O.loader=R.loader,O.stats=R.stats,O.urlId=R.urlId,R.initSegment?(O.initSegment=R.initSegment,l=R.initSegment):O.initSegment&&O.initSegment.relurl!=((w=l)===null||w===void 0?void 0:w.relurl)||(O.initSegment=l)}),n.skippedSegments&&(n.deltaUpdateFailed=n.fragments.some(function(R){return!R}),n.deltaUpdateFailed)){T.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=n.skippedSegments;r--;)n.fragments.shift();n.startSN=n.fragments[0].sn,n.startCC=n.fragments[0].cc}var s=n.fragments;if(v){T.logger.warn("discontinuity sliding from playlist, take drift into account");for(var h=0;h<s.length;h++)s[h].cc+=v}n.skippedSegments&&(n.startCC=n.fragments[0].cc),m(t.partList,n.partList,function(R,O){O.elementaryStreams=R.elementaryStreams,O.stats=R.stats}),g?o(n,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):p(t,n),s.length&&(n.totalduration=n.edge-s[0].start),n.driftStartTime=t.driftStartTime,n.driftStart=t.driftStart;var k=n.advancedDateTime;if(n.advanced&&k){var L=n.edge;n.driftStart||(n.driftStartTime=k,n.driftStart=L),n.driftEndTime=k,n.driftEnd=L}else n.driftEndTime=t.driftEndTime,n.driftEnd=t.driftEnd,n.advancedDateTime=t.advancedDateTime}function m(t,n,l){if(t&&n)for(var a=0,d=0,E=t.length;d<=E;d++){var g=t[d],v=n[d+a];g&&v&&g.index===v.index&&g.fragment.sn===v.fragment.sn?l(g,v):a--}}function c(t,n,l){for(var a=n.skippedSegments,d=Math.max(t.startSN,n.startSN)-n.startSN,E=(t.fragmentHint?1:0)+(a?n.endSN:Math.min(t.endSN,n.endSN))-n.startSN,g=n.startSN-t.startSN,v=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments,r=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,s=d;s<=E;s++){var h=r[g+s],k=v[s];a&&!k&&s<a&&(k=n.fragments[s]=h),h&&k&&l(h,k)}}function p(t,n){var l=n.startSN+n.skippedSegments-t.startSN,a=t.fragments;l<0||l>=a.length||y(n,a[l].start)}function y(t,n){if(n){for(var l=t.fragments,a=t.skippedSegments;a<l.length;a++)l[a].start+=n;t.fragmentHint&&(t.fragmentHint.start+=n)}}function u(t,n){var l,a=1e3*t.levelTargetDuration,d=a/2,E=t.age,g=E>0&&E<3*a,v=n.loading.end-n.loading.start,r=t.availabilityDelay;if(t.updated===!1)if(g){var s=333*t.misses;l=Math.max(Math.min(d,2*v),s),t.availabilityDelay=(t.availabilityDelay||0)+l}else l=d;else g?(r=Math.min(r||a/2,E),t.availabilityDelay=r,l=r+a-E):l=a-v;return Math.round(l)}function e(t,n,l){if(!t||!t.details)return null;var a=t.details,d=a.fragments[n-a.startSN];return d||((d=a.fragmentHint)&&d.sn===n?d:n<a.startSN&&l&&l.sn===n?l:null)}function i(t,n,l){if(!t||!t.details)return null;var a=t.details.partList;if(a)for(var d=a.length;d--;){var E=a[d];if(E.index===l&&E.fragment.sn===n)return E}return null}},"./src/controller/stream-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return t});var A=f("./src/polyfills/number.ts"),T=f("./src/controller/base-stream-controller.ts"),b=f("./src/is-supported.ts"),_=f("./src/events.ts"),I=f("./src/utils/buffer-helper.ts"),D=f("./src/controller/fragment-tracker.ts"),o=f("./src/types/loader.ts"),S=f("./src/loader/fragment.ts"),m=f("./src/demux/transmuxer-interface.ts"),c=f("./src/types/transmuxer.ts"),p=f("./src/controller/gap-controller.ts"),y=f("./src/errors.ts"),u=f("./src/utils/logger.ts");function e(n,l){for(var a=0;a<l.length;a++){var d=l[a];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(n,d.key,d)}}function i(n,l){return(i=Object.setPrototypeOf||function(a,d){return a.__proto__=d,a})(n,l)}var t=function(n){var l,a;function d(r,s){var h;return(h=n.call(this,r,s,"[stream-controller]")||this).audioCodecSwap=!1,h.gapController=null,h.level=-1,h._forceStartLoad=!1,h.altAudio=!1,h.audioOnly=!1,h.fragPlaying=null,h.onvplaying=null,h.onvseeked=null,h.fragLastKbps=0,h.stalled=!1,h.couldBacktrack=!1,h.audioCodecSwitch=!1,h.videoBuffer=null,h._registerListeners(),h}a=n,(l=d).prototype=Object.create(a.prototype),l.prototype.constructor=l,i(l,a);var E,g,v=d.prototype;return v._registerListeners=function(){var r=this.hls;r.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(_.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(_.Events.ERROR,this.onError,this),r.on(_.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(_.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(_.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(_.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(_.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var r=this.hls;r.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(_.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(_.Events.ERROR,this.onError,this),r.off(_.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(_.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(_.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(_.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(_.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(r){if(this.levels){var s=this.lastCurrentTime,h=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var k=h.startLevel;k===-1&&(h.config.testBandwidth?(k=0,this.bitrateTest=!0):k=h.nextAutoLevel),this.level=h.nextLoadLevel=k,this.loadedmetadata=!1}s>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),r=s),this.state=T.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=T.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_LEVEL:var r,s=this.levels,h=this.level,k=s==null||(r=s[h])===null||r===void 0?void 0:r.details;if(k&&(!k.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(k))break;this.state=T.State.IDLE;break}break;case T.State.FRAG_LOADING_WAITING_RETRY:var L,R=self.performance.now(),O=this.retryDate;(!O||R>=O||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=T.State.IDLE)}this.onTickEnd()},v.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var r,s,h=this.hls,k=this.levelLastLoaded,L=this.levels,R=this.media,O=h.config,w=h.nextLoadLevel;if(k!==null&&(R||!this.startFragRequested&&O.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&L&&L[w]){var x=L[w];this.level=h.nextLoadLevel=w;var F=x.details;if(!F||this.state===T.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==w)this.state=T.State.WAITING_LEVEL;else{var M=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:R,o.PlaylistLevelType.MAIN);if(M!==null&&!(M.len>=this.getMaxBufferLength(x.maxBitrate))){if(this._streamEnded(M,F)){var B={};return this.altAudio&&(B.type="video"),this.hls.trigger(_.Events.BUFFER_EOS,B),void(this.state=T.State.ENDED)}var U=M.end,G=this.getNextFragment(U,F);if(this.couldBacktrack&&!this.fragPrevious&&G&&G.sn!=="initSegment"){var V=G.sn-F.startSN;V>1&&(G=F.fragments[V-1],this.fragmentTracker.removeFragment(G))}if(G&&this.fragmentTracker.getState(G)===D.FragmentState.OK&&this.nextLoadPosition>U){var W=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(R,W,o.PlaylistLevelType.MAIN),G=this.getNextFragment(this.nextLoadPosition,F)}G&&(!G.initSegment||G.initSegment.data||this.bitrateTest||(G=G.initSegment),((r=G.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(s=G.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(G,F,U):this.loadKey(G,F))}}}},v.loadFragment=function(r,s,h){var k,L=this.fragmentTracker.getState(r);if(this.fragCurrent=r,L===D.FragmentState.BACKTRACKED){var R=this.fragmentTracker.getBacktrackData(r);if(R)return this._handleFragmentLoadProgress(R),void this._handleFragmentLoadComplete(R);L=D.FragmentState.NOT_LOADED}L===D.FragmentState.NOT_LOADED||L===D.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,r,s,h)):L===D.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((k=this.media)===null||k===void 0?void 0:k.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(r){var s=this.fragmentTracker.getAppendedFrag(r,o.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},v.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,o.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var r=this.levels,s=this.media;if(s!=null&&s.readyState){var h,k=this.getAppendedFrag(s.currentTime);if(k&&k.start>1&&this.flushMainBuffer(0,k.start-1),!s.paused&&r){var L=r[this.hls.nextLoadLevel],R=this.fragLastKbps;h=R&&this.fragCurrent?this.fragCurrent.duration*L.maxBitrate/(1e3*R)+1:0}else h=0;var O=this.getBufferedFrag(s.currentTime+h);if(O){var w=this.followingBufferedFrag(O);if(w){this.abortCurrentFrag();var x=w.maxStartPTS?w.maxStartPTS:w.start,F=w.duration,M=Math.max(O.end,x+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,.5*F),.75*F));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===T.State.KEY_LOADING&&(this.state=T.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(r,s){n.prototype.flushMainBuffer.call(this,r,s,this.altAudio?"video":null)},v.onMediaAttached=function(r,s){n.prototype.onMediaAttached.call(this,r,s);var h=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),h.addEventListener("playing",this.onvplaying),h.addEventListener("seeked",this.onvseeked),this.gapController=new p.default(this.config,h,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var r=this.media,s=r?r.currentTime:null;Object(A.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(_.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},v.onManifestParsed=function(r,s){var h,k=!1,L=!1;s.levels.forEach(function(R){(h=R.audioCodec)&&(h.indexOf("mp4a.40.2")!==-1&&(k=!0),h.indexOf("mp4a.40.5")!==-1&&(L=!0))}),this.audioCodecSwitch=k&&L&&!Object(b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},v.onLevelLoading=function(r,s){var h=this.levels;if(h&&this.state===T.State.IDLE){var k=h[s.level];(!k.details||k.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(k.details))&&(this.state=T.State.WAITING_LEVEL)}},v.onLevelLoaded=function(r,s){var h,k=this.levels,L=s.level,R=s.details,O=R.totalduration;if(k){this.log("Level "+L+" loaded ["+R.startSN+","+R.endSN+"], cc ["+R.startCC+", "+R.endCC+"] duration:"+O);var w=this.fragCurrent;!w||this.state!==T.State.FRAG_LOADING&&this.state!==T.State.FRAG_LOADING_WAITING_RETRY||w.level!==s.level&&w.loader&&(this.state=T.State.IDLE,w.loader.abort());var x=k[L],F=0;if(R.live||(h=x.details)!==null&&h!==void 0&&h.live){if(R.fragments[0]||(R.deltaUpdateFailed=!0),R.deltaUpdateFailed)return;F=this.alignPlaylists(R,x.details)}if(x.details=R,this.levelLastLoaded=L,this.hls.trigger(_.Events.LEVEL_UPDATED,{details:R,level:L}),this.state===T.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(R))return;this.state=T.State.IDLE}this.startFragRequested?R.live&&this.synchronizeToLiveEdge(R):this.setStartPosition(R,F),this.tick()}else this.warn("Levels were reset while loading level "+L)},v._handleFragmentLoadProgress=function(r){var s,h=r.frag,k=r.part,L=r.payload,R=this.levels;if(R){var O=R[h.level],w=O.details;if(w){var x=O.videoCodec,F=w.PTSKnown||!w.live,M=(s=h.initSegment)===null||s===void 0?void 0:s.data,B=this._getAudioCodec(O),U=this.transmuxer=this.transmuxer||new m.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),G=k?k.index:-1,V=G!==-1,W=new c.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,L.byteLength,G,V),Y=this.initPTS[h.cc];U.push(L,M,B,x,h,k,w.totalduration,F,W,Y)}else this.warn("Dropping fragment "+h.sn+" of level "+h.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered")},v.onAudioTrackSwitching=function(r,s){var h=this.altAudio,k=!!s.url,L=s.id;if(!k){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var R=this.fragCurrent;R!=null&&R.loader&&(this.log("Switching to main audio track, cancel main fragment load"),R.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var O=this.hls;h&&O.trigger(_.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),O.trigger(_.Events.AUDIO_TRACK_SWITCHED,{id:L})}},v.onAudioTrackSwitched=function(r,s){var h=s.id,k=!!this.hls.audioTracks[h].url;if(k){var L=this.videoBuffer;L&&this.mediaBuffer!==L&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=L)}this.altAudio=k,this.tick()},v.onBufferCreated=function(r,s){var h,k,L=s.tracks,R=!1;for(var O in L){var w=L[O];if(w.id==="main"){if(k=O,h=w,O==="video"){var x=L[O];x&&(this.videoBuffer=x.buffer)}}else R=!0}R&&h?(this.log("Alternate track found, use "+k+".buffered to schedule main fragment loading"),this.mediaBuffer=h.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(r,s){var h=s.frag,k=s.part;if(!h||h.type===o.PlaylistLevelType.MAIN){if(this.fragContextChanged(h))return this.warn("Fragment "+h.sn+(k?" p: "+k.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===T.State.PARSED&&(this.state=T.State.IDLE));var L=k?k.stats:h.stats;this.fragLastKbps=Math.round(8*L.total/(L.buffering.end-L.loading.first)),h.sn!=="initSegment"&&(this.fragPrevious=h),this.fragBufferedComplete(h,k)}},v.onError=function(r,s){switch(s.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,s);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==T.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=T.State.ERROR):s.levelRetry||this.state!==T.State.WAITING_LEVEL||(this.state=T.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var h=!0,k=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);k&&k.len>.5&&(h=!this.reduceMaxBufferLength(k.len)),h&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},v.checkBuffer=function(){var r=this.media,s=this.gapController;if(r&&s&&r.readyState){var h=I.BufferHelper.getBuffered(r);!this.loadedmetadata&&h.length?(this.loadedmetadata=!0,this.seekToStartPos()):s.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=T.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(r,s){var h=s.type;if(h!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var k=(h===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(k,h,o.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(r,s){this.levels=s.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var r=this.media,s=r.currentTime,h=this.startPosition;if(h>=0&&s<h){if(r.seeking)return void u.logger.log("could not seek to "+h+", already seeking at "+s);var k=I.BufferHelper.getBuffered(r),L=(k.length?k.start(0):0)-h;L>0&&L<this.config.maxBufferHole&&(u.logger.log("adjusting start position by "+L+" to match buffer start"),h+=L,this.startPosition=h),this.log("seek to target start position "+h+" from current time "+s),r.currentTime=h}},v._getAudioCodec=function(r){var s=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s=s.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),s},v._loadBitrateTestFrag=function(r){var s=this;this._doFragLoad(r).then(function(h){var k=s.hls;if(h&&!k.nextLoadLevel&&!s.fragContextChanged(r)){s.fragLoadError=0,s.state=T.State.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var L=r.stats;L.parsing.start=L.parsing.end=L.buffering.start=L.buffering.end=self.performance.now(),k.trigger(_.Events.FRAG_LOADED,h)}})},v._handleTransmuxComplete=function(r){var s,h="main",k=this.hls,L=r.remuxResult,R=r.chunkMeta,O=this.getCurrentContext(R);if(!O)return this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(R.level);var w=O.frag,x=O.part,F=O.level,M=L.video,B=L.text,U=L.id3,G=L.initSegment,V=this.altAudio?void 0:L.audio;if(!this.fragContextChanged(w)){if(this.state=T.State.PARSING,G){G.tracks&&(this._bufferInitSegment(F,G.tracks,w,R),k.trigger(_.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:h,tracks:G.tracks}));var W=G.initPTS,Y=G.timescale;Object(A.isFiniteNumber)(W)&&(this.initPTS[w.cc]=W,k.trigger(_.Events.INIT_PTS_FOUND,{frag:w,id:h,initPTS:W,timescale:Y}))}if(M&&L.independent!==!1){if(F.details){var Z=M.startPTS,Q=M.endPTS,z=M.startDTS,ie=M.endDTS;if(x)x.elementaryStreams[M.type]={startPTS:Z,endPTS:Q,startDTS:z,endDTS:ie};else if(M.firstKeyFrame&&M.independent&&(this.couldBacktrack=!0),M.dropped&&M.independent){if(this.getLoadPosition()+this.config.maxBufferHole<Z)return void this.backtrack(w);w.setElementaryStreamInfo(M.type,w.start,Q,w.start,ie,!0)}w.setElementaryStreamInfo(M.type,Z,Q,z,ie),this.bufferFragmentData(M,w,x,R)}}else if(L.independent===!1)return void this.backtrack(w);if(V){var ae=V.startPTS,le=V.endPTS,te=V.startDTS,ce=V.endDTS;x&&(x.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:ae,endPTS:le,startDTS:te,endDTS:ce}),w.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,ae,le,te,ce),this.bufferFragmentData(V,w,x,R)}if(U!=null&&(s=U.samples)!==null&&s!==void 0&&s.length){var re={frag:w,id:h,samples:U.samples};k.trigger(_.Events.FRAG_PARSING_METADATA,re)}if(B){var ne={frag:w,id:h,samples:B.samples};k.trigger(_.Events.FRAG_PARSING_USERDATA,ne)}}},v._bufferInitSegment=function(r,s,h,k){var L=this;if(this.state===T.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var R=s.audio,O=s.video,w=s.audiovideo;if(R){var x=r.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(x&&(x=x.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),R.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(x="mp4a.40.5")),F.indexOf("android")!==-1&&R.container!=="audio/mpeg"&&(x="mp4a.40.2",this.log("Android: force audio codec to "+x)),r.audioCodec&&r.audioCodec!==x&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+x+'"'),R.levelCodec=x,R.id="main",this.log("Init audio buffer, container:"+R.container+", codecs[selected/level/parsed]=["+(x||"")+"/"+(r.audioCodec||"")+"/"+R.codec+"]")}O&&(O.levelCodec=r.videoCodec,O.id="main",this.log("Init video buffer, container:"+O.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+O.codec+"]")),w&&this.log("Init audiovideo buffer, container:"+w.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+w.codec+"]"),this.hls.trigger(_.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(M){var B=s[M].initSegment;B!=null&&B.byteLength&&L.hls.trigger(_.Events.BUFFER_APPENDING,{type:M,data:B,frag:h,part:null,chunkMeta:k,parent:h.type})}),this.tick()}},v.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var s=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,s?this.resetFragmentLoading(r):this.state=T.State.BACKTRACKING},v.checkFragmentChanged=function(){var r=this.media,s=null;if(r&&r.readyState>1&&r.seeking===!1){var h=r.currentTime;if(I.BufferHelper.isBuffered(r,h)?s=this.getAppendedFrag(h):I.BufferHelper.isBuffered(r,h+.1)&&(s=this.getAppendedFrag(h+.1)),s){var k=this.fragPlaying,L=s.level;k&&s.sn===k.sn&&k.level===L&&s.urlId===k.urlId||(this.hls.trigger(_.Events.FRAG_CHANGED,{frag:s}),k&&k.level===L||this.hls.trigger(_.Events.LEVEL_SWITCHED,{level:L}),this.fragPlaying=s)}}},E=d,(g=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var s=this.getAppendedFrag(r.currentTime);if(s)return s.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var s=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(s)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&e(E.prototype,g),d}(T.default)},"./src/controller/subtitle-stream-controller.ts":function(P,C,f){f.r(C),f.d(C,"SubtitleStreamController",function(){return u});var A=f("./src/events.ts"),T=f("./src/utils/logger.ts"),b=f("./src/utils/buffer-helper.ts"),_=f("./src/controller/fragment-finders.ts"),I=f("./src/utils/discontinuities.ts"),D=f("./src/controller/level-helper.ts"),o=f("./src/controller/fragment-tracker.ts"),S=f("./src/controller/base-stream-controller.ts"),m=f("./src/types/loader.ts"),c=f("./src/types/level.ts");function p(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,i){return(y=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(e,i)}var u=function(e){var i,t;function n(E,g){var v;return(v=e.call(this,E,g,"[subtitle-stream-controller]")||this).levels=[],v.currentTrackId=-1,v.tracksBuffered=[],v.mainDetails=null,v._registerListeners(),v}t=e,(i=n).prototype=Object.create(t.prototype),i.prototype.constructor=i,y(i,t);var l,a,d=n.prototype;return d.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},d._registerListeners=function(){var E=this.hls;E.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(A.Events.ERROR,this.onError,this),E.on(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),E.on(A.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),E.on(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),E.on(A.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),E.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},d._unregisterListeners=function(){var E=this.hls;E.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(A.Events.ERROR,this.onError,this),E.off(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),E.off(A.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),E.off(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),E.off(A.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),E.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},d.startLoad=function(){this.stopLoad(),this.state=S.State.IDLE,this.setInterval(500),this.tick()},d.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},d.onLevelLoaded=function(E,g){this.mainDetails=g.details},d.onSubtitleFragProcessed=function(E,g){var v=g.frag,r=g.success;if(this.fragPrevious=v,this.state=S.State.IDLE,r){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var h,k=v.start,L=0;L<s.length;L++)if(k>=s[L].start&&k<=s[L].end){h=s[L];break}var R=v.start+v.duration;h?h.end=R:(h={start:k,end:R},s.push(h)),this.fragmentTracker.fragBuffered(v)}}},d.onBufferFlushing=function(E,g){var v=g.startOffset,r=g.endOffset;if(v===0&&r!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,h=this.levels;if(!h.length||!h[s]||!h[s].details)return;var k=r-h[s].details.targetduration;if(k<=0)return;g.endOffsetSubtitles=Math.max(0,k),this.tracksBuffered.forEach(function(L){for(var R=0;R<L.length;)if(L[R].end<=k)L.shift();else{if(!(L[R].start<k))break;L[R].start=k,R++}}),this.fragmentTracker.removeFragmentsInRange(v,k,m.PlaylistLevelType.SUBTITLE)}},d.onError=function(E,g){var v,r=g.frag;r&&r.type===m.PlaylistLevelType.SUBTITLE&&((v=this.fragCurrent)!==null&&v!==void 0&&v.loader&&this.fragCurrent.loader.abort(),this.state=S.State.IDLE)},d.onSubtitleTracksUpdated=function(E,g){var v=this,r=g.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(s){return new c.Level(s)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(s){v.tracksBuffered[s.id]=[]}),this.mediaBuffer=null},d.onSubtitleTrackSwitch=function(E,g){if(this.currentTrackId=g.id,this.levels.length&&this.currentTrackId!==-1){var v=this.levels[this.currentTrackId];v!=null&&v.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},d.onSubtitleTrackLoaded=function(E,g){var v,r=g.details,s=g.id,h=this.currentTrackId,k=this.levels;if(k.length){var L=k[h];if(!(s>=k.length||s!==h)&&L){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(v=L.details)!==null&&v!==void 0&&v.live){var R=this.mainDetails;if(r.deltaUpdateFailed||!R)return;var O=R.fragments[0];L.details?this.alignPlaylists(r,L.details)===0&&O&&Object(D.addSliding)(r,O.start):r.hasProgramDateTime&&R.hasProgramDateTime?Object(I.alignPDT)(r,R):O&&Object(D.addSliding)(r,O.start)}L.details=r,this.levelLastLoaded=s,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===S.State.IDLE&&(Object(_.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),L.details=void 0))}}},d._handleFragmentLoadComplete=function(E){var g=E.frag,v=E.payload,r=g.decryptdata,s=this.hls;if(!this.fragContextChanged(g)&&v&&v.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var h=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(v),r.key.buffer,r.iv.buffer).then(function(k){var L=performance.now();s.trigger(A.Events.FRAG_DECRYPTED,{frag:g,payload:k,stats:{tstart:h,tdecrypt:L}})})}},d.doTick=function(){if(this.media){if(this.state===S.State.IDLE){var E,g=this.currentTrackId,v=this.levels;if(!v.length||!v[g]||!v[g].details)return;var r=v[g].details,s=r.targetduration,h=this.config,k=this.media,L=b.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,k.currentTime-s,h.maxBufferHole),R=L.end;if(L.len>this.getMaxBufferLength()+s)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var O,w=r.fragments,x=w.length,F=r.edge,M=this.fragPrevious;if(R<F){var B=h.maxFragLookUpTolerance;M&&r.hasProgramDateTime&&(O=Object(_.findFragmentByPDT)(w,M.endProgramDateTime,B)),O||!(O=Object(_.findFragmentByPTS)(M,w,R,B))&&M&&M.start<w[0].start&&(O=w[0])}else O=w[x-1];(E=O)!==null&&E!==void 0&&E.encrypted?(T.logger.log("Loading key for "+O.sn),this.state=S.State.KEY_LOADING,this.hls.trigger(A.Events.KEY_LOADING,{frag:O})):O&&this.fragmentTracker.getState(O)===o.FragmentState.NOT_LOADED&&this.loadFragment(O,r,R)}}else this.state=S.State.IDLE},d.loadFragment=function(E,g,v){this.fragCurrent=E,e.prototype.loadFragment.call(this,E,g,v)},l=n,(a=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&p(l.prototype,a),n}(S.default)},"./src/controller/subtitle-track-controller.ts":function(P,C,f){f.r(C);var A=f("./src/events.ts"),T=f("./src/utils/texttrack-utils.ts"),b=f("./src/controller/base-playlist-controller.ts"),_=f("./src/types/loader.ts");function I(m,c){for(var p=0;p<c.length;p++){var y=c[p];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}function D(m,c){return(D=Object.setPrototypeOf||function(p,y){return p.__proto__=y,p})(m,c)}var o=function(m){var c,p;function y(t){var n;return(n=m.call(this,t,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n.subtitleDisplay=!0,n.registerListeners(),n}p=m,(c=y).prototype=Object.create(p.prototype),c.prototype.constructor=c,D(c,p);var u,e,i=y.prototype;return i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,m.prototype.destroy.call(this)},i.registerListeners=function(){var t=this.hls;t.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(A.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var t=this.hls;t.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(A.Events.ERROR,this.onError,this)},i.onMediaAttached=function(t,n){this.media=n.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},i.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},i.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),S(this.media.textTracks).forEach(function(t){Object(T.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null)},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},i.onManifestParsed=function(t,n){this.tracks=n.subtitleTracks},i.onSubtitleTrackLoaded=function(t,n){var l=n.id,a=n.details,d=this.trackId,E=this.tracksInGroup[d];if(E){var g=E.details;E.details=n.details,this.log("subtitle track "+l+" loaded ["+a.startSN+"-"+a.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,n,g))}else this.warn("Invalid subtitle track id "+l)},i.onLevelLoading=function(t,n){this.switchLevel(n.level)},i.onLevelSwitching=function(t,n){this.switchLevel(n.level)},i.switchLevel=function(t){var n=this.hls.levels[t];if(n!=null&&n.textGroupIds){var l=n.textGroupIds[n.urlId];if(this.groupId!==l){var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,d=this.tracks.filter(function(v){return!l||v.groupId===l});this.tracksInGroup=d;var E=this.findTrackId(a==null?void 0:a.name)||this.findTrackId();this.groupId=l;var g={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(A.Events.SUBTITLE_TRACKS_UPDATED,g),E!==-1&&this.setSubtitleTrack(E,a)}}},i.findTrackId=function(t){for(var n=this.tracksInGroup,l=0;l<n.length;l++){var a=n[l];if((!this.selectDefaultTrack||a.default)&&(!t||t===a.name))return a.id}return-1},i.onError=function(t,n){m.prototype.onError.call(this,t,n),!n.fatal&&n.context&&n.context.type===_.PlaylistContextType.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},i.loadPlaylist=function(t){var n=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(n)){var l=n.id,a=n.groupId,d=n.url;if(t)try{d=t.addDirectives(d)}catch(E){this.warn("Could not construct new URL with HLS Delivery Directives: "+E)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(A.Events.SUBTITLE_TRACK_LOADING,{url:d,id:l,groupId:a,deliveryDirectives:t||null})}},i.toggleTrackModes=function(t){var n=this,l=this.media,a=this.subtitleDisplay,d=this.trackId;if(l){var E=S(l.textTracks),g=E.filter(function(s){return s.groupId===n.groupId});if(t===-1)[].slice.call(E).forEach(function(s){s.mode="disabled"});else{var v=g[d];v&&(v.mode="disabled")}var r=g[t];r&&(r.mode=a?"showing":"hidden")}},i.setSubtitleTrack=function(t,n){var l,a=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(l=a[t])!==null&&l!==void 0&&l.details)||t<-1||t>=a.length)){this.clearTimer();var d=a[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,d){var E=d.id,g=d.groupId,v=g===void 0?"":g,r=d.name,s=d.type,h=d.url;this.hls.trigger(A.Events.SUBTITLE_TRACK_SWITCH,{id:E,groupId:v,name:r,type:s,url:h});var k=this.switchParams(d.url,n==null?void 0:n.details);this.loadPlaylist(k)}else this.hls.trigger(A.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},i.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,n=S(this.media.textTracks),l=0;l<n.length;l++)if(n[l].mode==="hidden")t=l;else if(n[l].mode==="showing"){t=l;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},u=y,(e=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,n)}}])&&I(u.prototype,e),y}(b.default);function S(m){for(var c=[],p=0;p<m.length;p++){var y=m[p];y.kind==="subtitles"&&y.label&&c.push(m[p])}return c}C.default=o},"./src/controller/timeline-controller.ts":function(P,C,f){f.r(C),f.d(C,"TimelineController",function(){return c});var A=f("./src/polyfills/number.ts"),T=f("./src/events.ts"),b=f("./src/utils/cea-608-parser.ts"),_=f("./src/utils/output-filter.ts"),I=f("./src/utils/webvtt-parser.ts"),D=f("./src/utils/texttrack-utils.ts"),o=f("./src/utils/imsc1-ttml-parser.ts"),S=f("./src/types/loader.ts"),m=f("./src/utils/logger.ts"),c=function(){function y(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var i=new _.default(this,"textTrack1"),t=new _.default(this,"textTrack2"),n=new _.default(this,"textTrack3"),l=new _.default(this,"textTrack4");this.cea608Parser1=new b.default(1,i,t),this.cea608Parser2=new b.default(3,n,l)}e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.Events.FRAG_LOADING,this.onFragLoading,this),e.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=y.prototype;return u.destroy=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.Events.FRAG_LOADING,this.onFragLoading,this),e.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},u.addCues=function(e,i,t,n,l){for(var a,d,E,g,v=!1,r=l.length;r--;){var s=l[r],h=(a=s[0],d=s[1],E=i,g=t,Math.min(d,g)-Math.max(a,E));if(h>=0&&(s[0]=Math.min(s[0],i),s[1]=Math.max(s[1],t),v=!0,h/(t-i)>.5))return}if(v||l.push([i,t]),this.config.renderTextTracksNatively){var k=this.captionsTracks[e];this.Cues.newCue(k,i,t,n)}else{var L=this.Cues.newCue(null,i,t,n);this.hls.trigger(T.Events.CUES_PARSED,{type:"captions",cues:L,track:e})}},u.onInitPtsFound=function(e,i){var t=this,n=i.frag,l=i.id,a=i.initPTS,d=i.timescale,E=this.unparsedVttFrags;l==="main"&&(this.initPTS[n.cc]=a,this.timescale[n.cc]=d),E.length&&(this.unparsedVttFrags=[],E.forEach(function(g){t.onFragLoaded(T.Events.FRAG_LOADED,g)}))},u.getExistingTrack=function(e){var i=this.media;if(i)for(var t=0;t<i.textTracks.length;t++){var n=i.textTracks[t];if(n[e])return n}return null},u.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},u.createNativeTrack=function(e){if(!this.captionsTracks[e]){var i=this.captionsProperties,t=this.captionsTracks,n=this.media,l=i[e],a=l.label,d=l.languageCode,E=this.getExistingTrack(e);if(E)t[e]=E,Object(D.clearCurrentCues)(t[e]),Object(D.sendAddTrackEvent)(t[e],n);else{var g=this.createTextTrack("captions",a,d);g&&(g[e]=!0,t[e]=g)}}},u.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var i=this.captionsProperties[e];if(i){var t={_id:e,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]})}}},u.createTextTrack=function(e,i,t){var n=this.media;if(n)return n.addTextTrack(e,i,t)},u.onMediaAttaching=function(e,i){this.media=i.media,this._cleanTracks()},u.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(i){Object(D.clearCurrentCues)(e[i]),delete e[i]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var e=this.media;if(e){var i=e.textTracks;if(i)for(var t=0;t<i.length;t++)Object(D.clearCurrentCues)(i[t])}},u.onSubtitleTracksUpdated=function(e,i){var t=this;this.textTracks=[];var n=i.subtitleTracks||[],l=n.some(function(g){return g.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||l&&this.config.enableIMSC1){var a=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var d=this.media?this.media.textTracks:[];this.tracks.forEach(function(g,v){var r;if(v<d.length){for(var s=null,h=0;h<d.length;h++)if(p(d[h],g)){s=d[h];break}s&&(r=s)}r?Object(D.clearCurrentCues)(r):(r=t.createTextTrack("subtitles",g.name,g.lang))&&(r.mode="disabled"),r&&(r.groupId=g.groupId,t.textTracks.push(r))})}else if(!a&&this.tracks&&this.tracks.length){var E=this.tracks.map(function(g){return{label:g.name,kind:g.type.toLowerCase(),default:g.default,subtitleTrack:g}});this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:E})}}},u.onManifestLoaded=function(e,i){var t=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(n){var l=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(l){var a="textTrack"+l[1],d=t.captionsProperties[a];d&&(d.label=n.name,n.lang&&(d.languageCode=n.lang),d.media=n)}})},u.onFragLoading=function(e,i){var t=this.cea608Parser1,n=this.cea608Parser2,l=this.lastSn;if(this.enabled&&t&&n&&i.frag.type===S.PlaylistLevelType.MAIN){var a=i.frag.sn;a!==l+1&&(t.reset(),n.reset()),this.lastSn=a}},u.onFragLoaded=function(e,i){var t=i.frag,n=i.payload,l=this.initPTS,a=this.unparsedVttFrags;if(t.type===S.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!Object(A.isFiniteNumber)(l[t.cc]))return a.push(i),void(l.length&&this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")}));var d=t.decryptdata;if(d==null||d.key==null||d.method!=="AES-128"){var E=this.tracks[t.level],g=this.vttCCs;g[t.cc]||(g[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),E&&E.textCodec===o.IMSC1_CODEC?this._parseIMSC1(t,n):this._parseVTTs(t,n,g)}}else this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(e,i){var t=this,n=this.hls;Object(o.parseIMSC1)(i,this.initPTS[e.cc],this.timescale[e.cc],function(l){t._appendCues(l,e.level),n.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(l){m.logger.log("Failed to parse IMSC1: "+l),n.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:l})})},u._parseVTTs=function(e,i,t){var n=this,l=this.hls;Object(I.parseWebVTT)(i,this.initPTS[e.cc],this.timescale[e.cc],t,e.cc,e.start,function(a){n._appendCues(a,e.level),l.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){n._fallbackToIMSC1(e,i),m.logger.log("Failed to parse VTT cue: "+a),l.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},u._fallbackToIMSC1=function(e,i){var t=this,n=this.tracks[e.level];n.textCodec||Object(o.parseIMSC1)(i,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=o.IMSC1_CODEC,t._parseIMSC1(e,i)},function(){n.textCodec="wvtt"})},u._appendCues=function(e,i){var t=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[i];if(n.mode==="disabled")return;e.forEach(function(a){return Object(D.addCueToTrack)(n,a)})}else{var l=this.tracks[i].default?"default":"subtitles"+i;t.trigger(T.Events.CUES_PARSED,{type:"subtitles",cues:e,track:l})}},u.onFragDecrypted=function(e,i){var t=i.frag;if(t.type===S.PlaylistLevelType.SUBTITLE){if(!Object(A.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(i);this.onFragLoaded(T.Events.FRAG_LOADED,i)}},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(e,i){var t=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&t&&n)for(var l=0;l<i.samples.length;l++){var a=i.samples[l].bytes;if(a){var d=this.extractCea608Data(a);t.addData(i.samples[l].pts,d[0]),n.addData(i.samples[l].pts,d[1])}}},u.onBufferFlushing=function(e,i){var t=i.startOffset,n=i.endOffset,l=i.endOffsetSubtitles,a=i.type,d=this.media;if(d&&!(d.currentTime<n)){if(!a||a==="video"){var E=this.captionsTracks;Object.keys(E).forEach(function(v){return Object(D.removeCuesInRange)(E[v],t,n)})}if(this.config.renderTextTracksNatively&&t===0&&l!==void 0){var g=this.textTracks;Object.keys(g).forEach(function(v){return Object(D.removeCuesInRange)(g[v],t,l)})}}},u.extractCea608Data=function(e){for(var i=31&e[0],t=2,n=[[],[]],l=0;l<i;l++){var a=e[t++],d=127&e[t++],E=127&e[t++],g=3&a;d===0&&E===0||(4&a)!=0&&(g!==0&&g!==1||(n[g].push(d),n[g].push(E)))}return n},y}();function p(y,u){return y&&y.label===u.name&&!(y.textTrack1||y.textTrack2)}},"./src/crypt/aes-crypto.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return A});var A=function(){function T(b,_){this.subtle=void 0,this.aesIV=void 0,this.subtle=b,this.aesIV=_}return T.prototype.decrypt=function(b,_){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},_,b)},T}()},"./src/crypt/aes-decryptor.ts":function(P,C,f){f.r(C),f.d(C,"removePadding",function(){return T}),f.d(C,"default",function(){return b});var A=f("./src/utils/typed-array.ts");function T(_){var I=_.byteLength,D=I&&new DataView(_.buffer).getUint8(I-1);return D?Object(A.sliceUint8)(_,0,I-D):_}var b=function(){function _(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var I=_.prototype;return I.uint8ArrayToUint32Array_=function(D){for(var o=new DataView(D),S=new Uint32Array(4),m=0;m<4;m++)S[m]=o.getUint32(4*m);return S},I.initTable=function(){var D=this.sBox,o=this.invSBox,S=this.subMix,m=S[0],c=S[1],p=S[2],y=S[3],u=this.invSubMix,e=u[0],i=u[1],t=u[2],n=u[3],l=new Uint32Array(256),a=0,d=0,E=0;for(E=0;E<256;E++)l[E]=E<128?E<<1:E<<1^283;for(E=0;E<256;E++){var g=d^d<<1^d<<2^d<<3^d<<4;g=g>>>8^255&g^99,D[a]=g,o[g]=a;var v=l[a],r=l[v],s=l[r],h=257*l[g]^16843008*g;m[a]=h<<24|h>>>8,c[a]=h<<16|h>>>16,p[a]=h<<8|h>>>24,y[a]=h,h=16843009*s^65537*r^257*v^16843008*a,e[g]=h<<24|h>>>8,i[g]=h<<16|h>>>16,t[g]=h<<8|h>>>24,n[g]=h,a?(a=v^l[l[l[s^v]]],d^=l[l[d]]):a=d=1}},I.expandKey=function(D){for(var o=this.uint8ArrayToUint32Array_(D),S=!0,m=0;m<o.length&&S;)S=o[m]===this.key[m],m++;if(!S){this.key=o;var c=this.keySize=o.length;if(c!==4&&c!==6&&c!==8)throw new Error("Invalid aes key size="+c);var p,y,u,e,i=this.ksRows=4*(c+6+1),t=this.keySchedule=new Uint32Array(i),n=this.invKeySchedule=new Uint32Array(i),l=this.sBox,a=this.rcon,d=this.invSubMix,E=d[0],g=d[1],v=d[2],r=d[3];for(p=0;p<i;p++)p<c?u=t[p]=o[p]:(e=u,p%c==0?(e=l[(e=e<<8|e>>>24)>>>24]<<24|l[e>>>16&255]<<16|l[e>>>8&255]<<8|l[255&e],e^=a[p/c|0]<<24):c>6&&p%c==4&&(e=l[e>>>24]<<24|l[e>>>16&255]<<16|l[e>>>8&255]<<8|l[255&e]),t[p]=u=(t[p-c]^e)>>>0);for(y=0;y<i;y++)p=i-y,e=3&y?t[p]:t[p-4],n[y]=y<4||p<=4?e:E[l[e>>>24]]^g[l[e>>>16&255]]^v[l[e>>>8&255]]^r[l[255&e]],n[y]=n[y]>>>0}},I.networkToHostOrderSwap=function(D){return D<<24|(65280&D)<<8|(16711680&D)>>8|D>>>24},I.decrypt=function(D,o,S){for(var m,c,p,y,u,e,i,t,n,l,a,d,E,g,v=this.keySize+6,r=this.invKeySchedule,s=this.invSBox,h=this.invSubMix,k=h[0],L=h[1],R=h[2],O=h[3],w=this.uint8ArrayToUint32Array_(S),x=w[0],F=w[1],M=w[2],B=w[3],U=new Int32Array(D),G=new Int32Array(U.length),V=this.networkToHostOrderSwap;o<U.length;){for(n=V(U[o]),l=V(U[o+1]),a=V(U[o+2]),d=V(U[o+3]),u=n^r[0],e=d^r[1],i=a^r[2],t=l^r[3],E=4,g=1;g<v;g++)m=k[u>>>24]^L[e>>16&255]^R[i>>8&255]^O[255&t]^r[E],c=k[e>>>24]^L[i>>16&255]^R[t>>8&255]^O[255&u]^r[E+1],p=k[i>>>24]^L[t>>16&255]^R[u>>8&255]^O[255&e]^r[E+2],y=k[t>>>24]^L[u>>16&255]^R[e>>8&255]^O[255&i]^r[E+3],u=m,e=c,i=p,t=y,E+=4;m=s[u>>>24]<<24^s[e>>16&255]<<16^s[i>>8&255]<<8^s[255&t]^r[E],c=s[e>>>24]<<24^s[i>>16&255]<<16^s[t>>8&255]<<8^s[255&u]^r[E+1],p=s[i>>>24]<<24^s[t>>16&255]<<16^s[u>>8&255]<<8^s[255&e]^r[E+2],y=s[t>>>24]<<24^s[u>>16&255]<<16^s[e>>8&255]<<8^s[255&i]^r[E+3],G[o]=V(m^x),G[o+1]=V(y^F),G[o+2]=V(p^M),G[o+3]=V(c^B),x=n,F=l,M=a,B=d,o+=4}return G.buffer},_}()},"./src/crypt/decrypter.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return o});var A=f("./src/crypt/aes-crypto.ts"),T=f("./src/crypt/fast-aes-key.ts"),b=f("./src/crypt/aes-decryptor.ts"),_=f("./src/utils/logger.ts"),I=f("./src/utils/mp4-tools.ts"),D=f("./src/utils/typed-array.ts"),o=function(){function S(c,p,y){var u=(y===void 0?{}:y).removePKCS7Padding,e=u===void 0||u;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=c,this.config=p,this.removePKCS7Padding=e,e)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var m=S.prototype;return m.destroy=function(){this.observer=null},m.isSync=function(){return this.config.enableSoftwareAES},m.flush=function(){var c=this.currentResult;if(c){var p=new Uint8Array(c);return this.reset(),this.removePKCS7Padding?Object(b.removePadding)(p):p}this.reset()},m.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},m.decrypt=function(c,p,y,u){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(c),p,y);var e=this.flush();e&&u(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(c),p,y).then(u)},m.softwareDecrypt=function(c,p,y){var u=this.currentIV,e=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(c=Object(I.appendUint8Array)(i,c),this.remainderData=null);var t=this.getValidChunk(c);if(!t.length)return null;u&&(y=u);var n=this.softwareDecrypter;n||(n=this.softwareDecrypter=new b.default),n.expandKey(p);var l=e;return this.currentResult=n.decrypt(t.buffer,0,y),this.currentIV=Object(D.sliceUint8)(t,-16).buffer,l||null},m.webCryptoDecrypt=function(c,p,y){var u=this,e=this.subtle;return this.key===p&&this.fastAesKey||(this.key=p,this.fastAesKey=new T.default(e,p)),this.fastAesKey.expandKey().then(function(i){return e?new A.default(e,y).decrypt(c.buffer,i):Promise.reject(new Error("web crypto not initialized"))}).catch(function(i){return u.onWebCryptoError(i,c,p,y)})},m.onWebCryptoError=function(c,p,y,u){return _.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",c),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(p,y,u)},m.getValidChunk=function(c){var p=c,y=c.length-c.length%16;return y!==c.length&&(p=Object(D.sliceUint8)(c,0,y),this.remainderData=Object(D.sliceUint8)(c,y)),p},m.logOnce=function(c){this.logEnabled&&(_.logger.log("[decrypter.ts]: "+c),this.logEnabled=!1)},S}()},"./src/crypt/fast-aes-key.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return A});var A=function(){function T(b,_){this.subtle=void 0,this.key=void 0,this.subtle=b,this.key=_}return T.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},T}()},"./src/demux/aacdemuxer.ts":function(P,C,f){f.r(C);var A=f("./src/demux/base-audio-demuxer.ts"),T=f("./src/demux/adts.ts"),b=f("./src/utils/logger.ts"),_=f("./src/demux/id3.ts");function I(o,S){return(I=Object.setPrototypeOf||function(m,c){return m.__proto__=c,m})(o,S)}var D=function(o){var S,m;function c(y,u){var e;return(e=o.call(this)||this).observer=void 0,e.config=void 0,e.observer=y,e.config=u,e}m=o,(S=c).prototype=Object.create(m.prototype),S.prototype.constructor=S,I(S,m);var p=c.prototype;return p.resetInitSegment=function(y,u,e){o.prototype.resetInitSegment.call(this,y,u,e),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:y,duration:e,inputTimeScale:9e4,dropped:0}},c.probe=function(y){if(!y)return!1;for(var u=(_.getID3Data(y,0)||[]).length,e=y.length;u<e;u++)if(T.probe(y,u))return b.logger.log("ADTS sync word found !"),!0;return!1},p.canParse=function(y,u){return T.canParse(y,u)},p.appendFrame=function(y,u,e){T.initTrackConfig(y,this.observer,u,e,y.manifestCodec);var i=T.appendFrame(y,u,e,this.initPTS,this.frameIndex);if(i&&i.missing===0)return i},c}(A.default);D.minProbeByteLength=9,C.default=D},"./src/demux/adts.ts":function(P,C,f){f.r(C),f.d(C,"getAudioConfig",function(){return _}),f.d(C,"isHeaderPattern",function(){return I}),f.d(C,"getHeaderLength",function(){return D}),f.d(C,"getFullFrameLength",function(){return o}),f.d(C,"canGetFrameLength",function(){return S}),f.d(C,"isHeader",function(){return m}),f.d(C,"canParse",function(){return c}),f.d(C,"probe",function(){return p}),f.d(C,"initTrackConfig",function(){return y}),f.d(C,"getFrameDuration",function(){return u}),f.d(C,"parseFrameHeader",function(){return e}),f.d(C,"appendFrame",function(){return i});var A=f("./src/utils/logger.ts"),T=f("./src/errors.ts"),b=f("./src/events.ts");function _(t,n,l,a){var d,E,g,v,r=navigator.userAgent.toLowerCase(),s=a,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];d=1+((192&n[l+2])>>>6);var k=(60&n[l+2])>>>2;if(!(k>h.length-1))return g=(1&n[l+2])<<2,g|=(192&n[l+3])>>>6,A.logger.log("manifest codec:"+a+", ADTS type:"+d+", samplingIndex:"+k),/firefox/i.test(r)?k>=6?(d=5,v=new Array(4),E=k-3):(d=2,v=new Array(2),E=k):r.indexOf("android")!==-1?(d=2,v=new Array(2),E=k):(d=5,v=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&k>=6?E=k-3:((a&&a.indexOf("mp4a.40.2")!==-1&&(k>=6&&g===1||/vivaldi/i.test(r))||!a&&g===1)&&(d=2,v=new Array(2)),E=k)),v[0]=d<<3,v[0]|=(14&k)>>1,v[1]|=(1&k)<<7,v[1]|=g<<3,d===5&&(v[1]|=(14&E)>>1,v[2]=(1&E)<<7,v[2]|=8,v[3]=0),{config:v,samplerate:h[k],channelCount:g,codec:"mp4a.40."+d,manifestCodec:s};t.trigger(b.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+k})}function I(t,n){return t[n]===255&&(246&t[n+1])==240}function D(t,n){return 1&t[n+1]?7:9}function o(t,n){return(3&t[n+3])<<11|t[n+4]<<3|(224&t[n+5])>>>5}function S(t,n){return n+5<t.length}function m(t,n){return n+1<t.length&&I(t,n)}function c(t,n){return S(t,n)&&I(t,n)&&o(t,n)<=t.length-n}function p(t,n){if(m(t,n)){var l=D(t,n);if(n+l>=t.length)return!1;var a=o(t,n);if(a<=l)return!1;var d=n+a;return d===t.length||m(t,d)}return!1}function y(t,n,l,a,d){if(!t.samplerate){var E=_(n,l,a,d);if(!E)return;t.config=E.config,t.samplerate=E.samplerate,t.channelCount=E.channelCount,t.codec=E.codec,t.manifestCodec=E.manifestCodec,A.logger.log("parsed codec:"+t.codec+", rate:"+E.samplerate+", channels:"+E.channelCount)}}function u(t){return 9216e4/t}function e(t,n,l,a,d){var E=D(t,n),g=o(t,n);if((g-=E)>0)return{headerLength:E,frameLength:g,stamp:l+a*d}}function i(t,n,l,a,d){var E=e(n,l,a,d,u(t.samplerate));if(E){var g,v=E.frameLength,r=E.headerLength,s=E.stamp,h=r+v,k=Math.max(0,l+h-n.length);k?(g=new Uint8Array(h-r)).set(n.subarray(l+r,n.length),0):g=n.subarray(l+r,l+h);var L={unit:g,pts:s};return k||t.samples.push(L),{sample:L,length:h,missing:k}}}},"./src/demux/base-audio-demuxer.ts":function(P,C,f){f.r(C),f.d(C,"initPTSFn",function(){return o});var A=f("./src/polyfills/number.ts"),T=f("./src/demux/id3.ts"),b=f("./src/demux/dummy-demuxed-track.ts"),_=f("./src/utils/mp4-tools.ts"),I=f("./src/utils/typed-array.ts"),D=function(){function S(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var m=S.prototype;return m.resetInitSegment=function(c,p,y){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},m.resetTimeStamp=function(){},m.resetContiguity=function(){},m.canParse=function(c,p){return!1},m.appendFrame=function(c,p,y){},m.demux=function(c,p){this.cachedData&&(c=Object(_.appendUint8Array)(this.cachedData,c),this.cachedData=null);var y,u,e=T.getID3Data(c,0),i=e?e.length:0,t=this._audioTrack,n=this._id3Track,l=e?T.getTimeStamp(e):void 0,a=c.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=o(l,p)),e&&e.length>0&&n.samples.push({pts:this.initPTS,dts:this.initPTS,data:e}),u=this.initPTS;i<a;){if(this.canParse(c,i)){var d=this.appendFrame(t,c,i);d?(this.frameIndex++,u=d.sample.pts,y=i+=d.length):i=a}else T.canParse(c,i)?(e=T.getID3Data(c,i),n.samples.push({pts:u,dts:u,data:e}),y=i+=e.length):i++;if(i===a&&y!==a){var E=Object(I.sliceUint8)(c,y);this.cachedData?this.cachedData=Object(_.appendUint8Array)(this.cachedData,E):this.cachedData=E}}return{audioTrack:t,avcTrack:Object(b.dummyTrack)(),id3Track:n,textTrack:Object(b.dummyTrack)()}},m.demuxSampleAes=function(c,p,y){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},m.flush=function(c){var p=this.cachedData;return p&&(this.cachedData=null,this.demux(p,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(b.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(b.dummyTrack)()}},m.destroy=function(){},S}(),o=function(S,m){return Object(A.isFiniteNumber)(S)?90*S:9e4*m};C.default=D},"./src/demux/chunk-cache.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return A});var A=function(){function T(){this.chunks=[],this.dataLength=0}var b=T.prototype;return b.push=function(_){this.chunks.push(_),this.dataLength+=_.length},b.flush=function(){var _,I=this.chunks,D=this.dataLength;return I.length?(_=I.length===1?I[0]:function(o,S){for(var m=new Uint8Array(S),c=0,p=0;p<o.length;p++){var y=o[p];m.set(y,c),c+=y.length}return m}(I,D),this.reset(),_):new Uint8Array(0)},b.reset=function(){this.chunks.length=0,this.dataLength=0},T}()},"./src/demux/dummy-demuxed-track.ts":function(P,C,f){function A(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}f.r(C),f.d(C,"dummyTrack",function(){return A})},"./src/demux/exp-golomb.ts":function(P,C,f){f.r(C);var A=f("./src/utils/logger.ts"),T=function(){function b(I){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=I,this.bytesAvailable=I.byteLength,this.word=0,this.bitsAvailable=0}var _=b.prototype;return _.loadWord=function(){var I=this.data,D=this.bytesAvailable,o=I.byteLength-D,S=new Uint8Array(4),m=Math.min(4,D);if(m===0)throw new Error("no bytes available");S.set(I.subarray(o,o+m)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=8*m,this.bytesAvailable-=m},_.skipBits=function(I){var D;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,I-=(D=I>>3)>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},_.readBits=function(I){var D=Math.min(this.bitsAvailable,I),o=this.word>>>32-D;return I>32&&A.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),(D=I-D)>0&&this.bitsAvailable?o<<D|this.readBits(D):o},_.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!=0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},_.skipUEG=function(){this.skipBits(1+this.skipLZ())},_.skipEG=function(){this.skipBits(1+this.skipLZ())},_.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},_.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},_.readBoolean=function(){return this.readBits(1)===1},_.readUByte=function(){return this.readBits(8)},_.readUShort=function(){return this.readBits(16)},_.readUInt=function(){return this.readBits(32)},_.skipScalingList=function(I){for(var D=8,o=8,S=0;S<I;S++)o!==0&&(o=(D+this.readEG()+256)%256),D=o===0?D:o},_.readSPS=function(){var I,D,o,S=0,m=0,c=0,p=0,y=this.readUByte.bind(this),u=this.readBits.bind(this),e=this.readUEG.bind(this),i=this.readBoolean.bind(this),t=this.skipBits.bind(this),n=this.skipEG.bind(this),l=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);y();var d=y();if(u(5),t(3),y(),l(),d===100||d===110||d===122||d===244||d===44||d===83||d===86||d===118||d===128){var E=e();if(E===3&&t(1),l(),l(),t(1),i())for(D=E!==3?8:12,o=0;o<D;o++)i()&&a(o<6?16:64)}l();var g=e();if(g===0)e();else if(g===1)for(t(1),n(),n(),I=e(),o=0;o<I;o++)n();l(),t(1);var v=e(),r=e(),s=u(1);s===0&&t(1),t(1),i()&&(S=e(),m=e(),c=e(),p=e());var h=[1,1];if(i()&&i())switch(y()){case 1:h=[1,1];break;case 2:h=[12,11];break;case 3:h=[10,11];break;case 4:h=[16,11];break;case 5:h=[40,33];break;case 6:h=[24,11];break;case 7:h=[20,11];break;case 8:h=[32,11];break;case 9:h=[80,33];break;case 10:h=[18,11];break;case 11:h=[15,11];break;case 12:h=[64,33];break;case 13:h=[160,99];break;case 14:h=[4,3];break;case 15:h=[3,2];break;case 16:h=[2,1];break;case 255:h=[y()<<8|y(),y()<<8|y()]}return{width:Math.ceil(16*(v+1)-2*S-2*m),height:(2-s)*(r+1)*16-(s?2:4)*(c+p),pixelRatio:h}},_.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},b}();C.default=T},"./src/demux/id3.ts":function(P,C,f){f.r(C),f.d(C,"isHeader",function(){return T}),f.d(C,"isFooter",function(){return b}),f.d(C,"getID3Data",function(){return _}),f.d(C,"canParse",function(){return D}),f.d(C,"getTimeStamp",function(){return o}),f.d(C,"isTimeStampFrame",function(){return S}),f.d(C,"getID3Frames",function(){return c}),f.d(C,"decodeFrame",function(){return p}),f.d(C,"utf8ArrayToStr",function(){return t}),f.d(C,"testables",function(){return n});var A,T=function(l,a){return a+10<=l.length&&l[a]===73&&l[a+1]===68&&l[a+2]===51&&l[a+3]<255&&l[a+4]<255&&l[a+6]<128&&l[a+7]<128&&l[a+8]<128&&l[a+9]<128},b=function(l,a){return a+10<=l.length&&l[a]===51&&l[a+1]===68&&l[a+2]===73&&l[a+3]<255&&l[a+4]<255&&l[a+6]<128&&l[a+7]<128&&l[a+8]<128&&l[a+9]<128},_=function(l,a){for(var d=a,E=0;T(l,a);)E+=10,E+=I(l,a+6),b(l,a+10)&&(E+=10),a+=E;if(E>0)return l.subarray(d,d+E)},I=function(l,a){var d=0;return d=(127&l[a])<<21,d|=(127&l[a+1])<<14,d|=(127&l[a+2])<<7,d|=127&l[a+3]},D=function(l,a){return T(l,a)&&I(l,a+6)+10<=l.length-a},o=function(l){for(var a=c(l),d=0;d<a.length;d++){var E=a[d];if(S(E))return i(E)}},S=function(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"},m=function(l){var a=String.fromCharCode(l[0],l[1],l[2],l[3]),d=I(l,4);return{type:a,size:d,data:l.subarray(10,10+d)}},c=function(l){for(var a=0,d=[];T(l,a);){for(var E=I(l,a+6),g=(a+=10)+E;a+8<g;){var v=m(l.subarray(a)),r=p(v);r&&d.push(r),a+=v.size+10}b(l,a)&&(a+=10)}return d},p=function(l){return l.type==="PRIV"?y(l):l.type[0]==="W"?e(l):u(l)},y=function(l){if(!(l.size<2)){var a=t(l.data,!0),d=new Uint8Array(l.data.subarray(a.length+1));return{key:l.type,info:a,data:d.buffer}}},u=function(l){if(!(l.size<2)){if(l.type==="TXXX"){var a=1,d=t(l.data.subarray(a),!0);a+=d.length+1;var E=t(l.data.subarray(a));return{key:l.type,info:d,data:E}}var g=t(l.data.subarray(1));return{key:l.type,data:g}}},e=function(l){if(l.type==="WXXX"){if(l.size<2)return;var a=1,d=t(l.data.subarray(a),!0);a+=d.length+1;var E=t(l.data.subarray(a));return{key:l.type,info:d,data:E}}var g=t(l.data);return{key:l.type,data:g}},i=function(l){if(l.data.byteLength===8){var a=new Uint8Array(l.data),d=1&a[3],E=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return E/=45,d&&(E+=4772185884e-2),Math.round(E)}},t=function(l,a){a===void 0&&(a=!1);var d=(A||self.TextDecoder===void 0||(A=new self.TextDecoder("utf-8")),A);if(d){var E=d.decode(l);if(a){var g=E.indexOf("\0");return g!==-1?E.substring(0,g):E}return E.replace(/\0/g,"")}for(var v,r,s,h=l.length,k="",L=0;L<h;){if((v=l[L++])===0&&a)return k;if(v!==0&&v!==3)switch(v>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:k+=String.fromCharCode(v);break;case 12:case 13:r=l[L++],k+=String.fromCharCode((31&v)<<6|63&r);break;case 14:r=l[L++],s=l[L++],k+=String.fromCharCode((15&v)<<12|(63&r)<<6|(63&s)<<0)}}return k},n={decodeTextFrame:u}},"./src/demux/mp3demuxer.ts":function(P,C,f){f.r(C);var A=f("./src/demux/base-audio-demuxer.ts"),T=f("./src/demux/id3.ts"),b=f("./src/utils/logger.ts"),_=f("./src/demux/mpegaudio.ts");function I(o,S){return(I=Object.setPrototypeOf||function(m,c){return m.__proto__=c,m})(o,S)}var D=function(o){var S,m;function c(){return o.apply(this,arguments)||this}m=o,(S=c).prototype=Object.create(m.prototype),S.prototype.constructor=S,I(S,m);var p=c.prototype;return p.resetInitSegment=function(y,u,e){o.prototype.resetInitSegment.call(this,y,u,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:y,duration:e,inputTimeScale:9e4,dropped:0}},c.probe=function(y){if(!y)return!1;for(var u=(T.getID3Data(y,0)||[]).length,e=y.length;u<e;u++)if(_.probe(y,u))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},p.canParse=function(y,u){return _.canParse(y,u)},p.appendFrame=function(y,u,e){if(this.initPTS!==null)return _.appendFrame(y,u,e,this.initPTS,this.frameIndex)},c}(A.default);D.minProbeByteLength=4,C.default=D},"./src/demux/mp4demuxer.ts":function(P,C,f){f.r(C);var A=f("./src/utils/mp4-tools.ts"),T=f("./src/demux/dummy-demuxed-track.ts"),b=function(){function _(D,o){this.remainderData=null,this.config=void 0,this.config=o}var I=_.prototype;return I.resetTimeStamp=function(){},I.resetInitSegment=function(){},I.resetContiguity=function(){},_.probe=function(D){return Object(A.findBox)({data:D,start:0,end:Math.min(D.length,16384)},["moof"]).length>0},I.demux=function(D){var o=D,S=Object(T.dummyTrack)();if(this.config.progressive){this.remainderData&&(o=Object(A.appendUint8Array)(this.remainderData,D));var m=Object(A.segmentValidRange)(o);this.remainderData=m.remainder,S.samples=m.valid||new Uint8Array}else S.samples=o;return{audioTrack:Object(T.dummyTrack)(),avcTrack:S,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},I.flush=function(){var D=Object(T.dummyTrack)();return D.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(T.dummyTrack)(),avcTrack:D,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},I.demuxSampleAes=function(D,o,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},I.destroy=function(){},_}();b.minProbeByteLength=1024,C.default=b},"./src/demux/mpegaudio.ts":function(P,C,f){f.r(C),f.d(C,"appendFrame",function(){return D}),f.d(C,"parseHeader",function(){return o}),f.d(C,"isHeaderPattern",function(){return S}),f.d(C,"isHeader",function(){return m}),f.d(C,"canParse",function(){return c}),f.d(C,"probe",function(){return p});var A=null,T=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],_=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],I=[0,1,1,4];function D(y,u,e,i,t){if(!(e+24>u.length)){var n=o(u,e);if(n&&e+n.frameLength<=u.length){var l=i+t*(9e4*n.samplesPerFrame/n.sampleRate),a={unit:u.subarray(e,e+n.frameLength),pts:l,dts:l};return y.config=[],y.channelCount=n.channelCount,y.samplerate=n.sampleRate,y.samples.push(a),{sample:a,length:n.frameLength,missing:0}}}}function o(y,u){var e=y[u+1]>>3&3,i=y[u+1]>>1&3,t=y[u+2]>>4&15,n=y[u+2]>>2&3;if(e!==1&&t!==0&&t!==15&&n!==3){var l=y[u+2]>>1&1,a=y[u+3]>>6,d=1e3*T[14*(e===3?3-i:i===3?3:4)+t-1],E=b[3*(e===3?0:e===2?1:2)+n],g=a===3?1:2,v=_[e][i],r=I[i],s=8*v*r,h=Math.floor(v*d/E+l)*r;if(A===null){var k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);A=k?parseInt(k[1]):0}return!!A&&A<=87&&i===2&&d>=224e3&&a===0&&(y[u+3]=128|y[u+3]),{sampleRate:E,channelCount:g,frameLength:h,samplesPerFrame:s}}}function S(y,u){return y[u]===255&&(224&y[u+1])==224&&(6&y[u+1])!=0}function m(y,u){return u+1<y.length&&S(y,u)}function c(y,u){return S(y,u)&&4<=y.length-u}function p(y,u){if(u+1<y.length&&S(y,u)){var e=o(y,u),i=4;e!=null&&e.frameLength&&(i=e.frameLength);var t=u+i;return t===y.length||m(y,t)}return!1}},"./src/demux/sample-aes.ts":function(P,C,f){f.r(C);var A=f("./src/crypt/decrypter.ts"),T=f("./src/demux/tsdemuxer.ts"),b=function(){function _(D,o,S){this.keyData=void 0,this.decrypter=void 0,this.keyData=S,this.decrypter=new A.default(D,o,{removePKCS7Padding:!1})}var I=_.prototype;return I.decryptBuffer=function(D,o){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,o)},I.decryptAacSample=function(D,o,S,m){var c=D[o].unit,p=c.subarray(16,c.length-c.length%16),y=p.buffer.slice(p.byteOffset,p.byteOffset+p.length),u=this;this.decryptBuffer(y,function(e){var i=new Uint8Array(e);c.set(i,16),m||u.decryptAacSamples(D,o+1,S)})},I.decryptAacSamples=function(D,o,S){for(;;o++){if(o>=D.length)return void S();if(!(D[o].unit.length<32)){var m=this.decrypter.isSync();if(this.decryptAacSample(D,o,S,m),!m)return}}},I.getAvcEncryptedData=function(D){for(var o=16*Math.floor((D.length-48)/160)+16,S=new Int8Array(o),m=0,c=32;c<=D.length-16;c+=160,m+=16)S.set(D.subarray(c,c+16),m);return S},I.getAvcDecryptedUnit=function(D,o){for(var S=new Uint8Array(o),m=0,c=32;c<=D.length-16;c+=160,m+=16)D.set(S.subarray(m,m+16),c);return D},I.decryptAvcSample=function(D,o,S,m,c,p){var y=Object(T.discardEPB)(c.data),u=this.getAvcEncryptedData(y),e=this;this.decryptBuffer(u.buffer,function(i){c.data=e.getAvcDecryptedUnit(y,i),p||e.decryptAvcSamples(D,o,S+1,m)})},I.decryptAvcSamples=function(D,o,S,m){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,S=0){if(o>=D.length)return void m();for(var c=D[o].units;!(S>=c.length);S++){var p=c[S];if(!(p.data.length<=48||p.type!==1&&p.type!==5)){var y=this.decrypter.isSync();if(this.decryptAvcSample(D,o,S,m,p,y),!y)return}}}},_}();C.default=b},"./src/demux/transmuxer-interface.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return m});var A=f("./node_modules/webworkify-webpack/index.js"),T=f("./src/events.ts"),b=f("./src/demux/transmuxer.ts"),_=f("./src/utils/logger.ts"),I=f("./src/errors.ts"),D=f("./src/utils/mediasource-helper.ts"),o=f("./node_modules/eventemitter3/index.js"),S=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},m=function(){function c(y,u,e,i){var t=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=y,this.id=u,this.onTransmuxComplete=e,this.onFlush=i;var n=y.config,l=function(g,v){(v=v||{}).frag=t.frag,v.id=t.id,y.trigger(g,v)};this.observer=new o.EventEmitter,this.observer.on(T.Events.FRAG_DECRYPTED,l),this.observer.on(T.Events.ERROR,l);var a={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},d=navigator.vendor;if(n.enableWorker&&typeof Worker<"u"){var E;_.logger.log("demuxing in webworker");try{E=this.worker=A("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),E.addEventListener("message",this.onwmsg),E.onerror=function(g){y.trigger(T.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(g.message+"  ("+g.filename+":"+g.lineno+")")})},E.postMessage({cmd:"init",typeSupported:a,vendor:d,id:u,config:JSON.stringify(n)})}catch(g){_.logger.warn("Error in worker:",g),_.logger.error("Error while initializing DemuxerWorker, fallback to inline"),E&&self.URL.revokeObjectURL(E.objectURL),this.transmuxer=new b.default(this.observer,a,n,d,u),this.worker=null}}else this.transmuxer=new b.default(this.observer,a,n,d,u)}var p=c.prototype;return p.destroy=function(){var y=this.worker;if(y)y.removeEventListener("message",this.onwmsg),y.terminate(),this.worker=null;else{var u=this.transmuxer;u&&(u.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},p.push=function(y,u,e,i,t,n,l,a,d,E){var g=this;d.transmuxing.start=self.performance.now();var v=this.transmuxer,r=this.worker,s=n?n.start:t.start,h=t.decryptdata,k=this.frag,L=!(k&&t.cc===k.cc),R=!(k&&d.level===k.level),O=k?d.sn-k.sn:-1,w=this.part?d.part-this.part.index:1,x=!R&&(O===1||O===0&&w===1),F=self.performance.now();(R||O||t.stats.parsing.start===0)&&(t.stats.parsing.start=F),!n||!w&&x||(n.stats.parsing.start=F);var M=new b.TransmuxState(L,x,a,R,s);if(!x||L){_.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+d.sn+" p: "+d.part+" level: "+d.level+" id: "+d.id+`
        discontinuity: `+L+`
        trackSwitch: `+R+`
        contiguous: `+x+`
        accurateTimeOffset: `+a+`
        timeOffset: `+s);var B=new b.TransmuxConfig(e,i,u,l,E);this.configureTransmuxer(B)}if(this.frag=t,this.part=n,r)r.postMessage({cmd:"demux",data:y,decryptdata:h,chunkMeta:d,state:M},y instanceof ArrayBuffer?[y]:[]);else if(v){var U=v.push(y,h,d,M);Object(b.isPromise)(U)?U.then(function(G){g.handleTransmuxComplete(G)}):this.handleTransmuxComplete(U)}},p.flush=function(y){var u=this;y.transmuxing.start=self.performance.now();var e=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:y});else if(e){var t=e.flush(y);Object(b.isPromise)(t)?t.then(function(n){u.handleFlushResult(n,y)}):this.handleFlushResult(t,y)}},p.handleFlushResult=function(y,u){var e=this;y.forEach(function(i){e.handleTransmuxComplete(i)}),this.onFlush(u)},p.onWorkerMessage=function(y){var u=y.data,e=this.hls;switch(u.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(u.data);break;case"flush":this.onFlush(u.data);break;default:u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,e.trigger(u.event,u.data)}},p.configureTransmuxer=function(y){var u=this.worker,e=this.transmuxer;u?u.postMessage({cmd:"configure",config:y}):e&&e.configure(y)},p.handleTransmuxComplete=function(y){y.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(y)},c}()},"./src/demux/transmuxer-worker.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return I});var A=f("./src/demux/transmuxer.ts"),T=f("./src/events.ts"),b=f("./src/utils/logger.ts"),_=f("./node_modules/eventemitter3/index.js");function I(m){var c=new _.EventEmitter,p=function(y,u){m.postMessage({event:y,data:u})};c.on(T.Events.FRAG_DECRYPTED,p),c.on(T.Events.ERROR,p),m.addEventListener("message",function(y){var u=y.data;switch(u.cmd){case"init":var e=JSON.parse(u.config);m.transmuxer=new A.default(c,u.typeSupported,e,u.vendor,u.id),Object(b.enableLogs)(e.debug),p("init",null);break;case"configure":m.transmuxer.configure(u.config);break;case"demux":var i=m.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);Object(A.isPromise)(i)?i.then(function(l){D(m,l)}):D(m,i);break;case"flush":var t=u.chunkMeta,n=m.transmuxer.flush(t);Object(A.isPromise)(n)?n.then(function(l){S(m,l,t)}):S(m,n,t)}})}function D(m,c){if((p=c.remuxResult).audio||p.video||p.text||p.id3||p.initSegment){var p,y=[],u=c.remuxResult,e=u.audio,i=u.video;e&&o(y,e),i&&o(y,i),m.postMessage({event:"transmuxComplete",data:c},y)}}function o(m,c){c.data1&&m.push(c.data1.buffer),c.data2&&m.push(c.data2.buffer)}function S(m,c,p){c.forEach(function(y){D(m,y)}),m.postMessage({event:"flush",data:p})}},"./src/demux/transmuxer.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return t}),f.d(C,"isPromise",function(){return l}),f.d(C,"TransmuxConfig",function(){return a}),f.d(C,"TransmuxState",function(){return d});var A,T=f("./src/events.ts"),b=f("./src/errors.ts"),_=f("./src/crypt/decrypter.ts"),I=f("./src/demux/aacdemuxer.ts"),D=f("./src/demux/mp4demuxer.ts"),o=f("./src/demux/tsdemuxer.ts"),S=f("./src/demux/mp3demuxer.ts"),m=f("./src/remux/mp4-remuxer.ts"),c=f("./src/remux/passthrough-remuxer.ts"),p=f("./src/demux/chunk-cache.ts"),y=f("./src/utils/mp4-tools.ts"),u=f("./src/utils/logger.ts");try{A=self.performance.now.bind(self.performance)}catch{u.logger.debug("Unable to use Performance API on this environment"),A=self.Date.now}var e=[{demux:o.default,remux:m.default},{demux:D.default,remux:c.default},{demux:I.default,remux:m.default},{demux:S.default,remux:m.default}],i=1024;e.forEach(function(E){var g=E.demux;i=Math.max(i,g.minProbeByteLength)});var t=function(){function E(v,r,s,h,k){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new p.default,this.observer=v,this.typeSupported=r,this.config=s,this.vendor=h,this.id=k}var g=E.prototype;return g.configure=function(v){this.transmuxConfig=v,this.decrypter&&this.decrypter.reset()},g.push=function(v,r,s,h){var k=this,L=s.transmuxing;L.executeStart=A();var R=new Uint8Array(v),O=this.cache,w=this.config,x=this.currentTransmuxState,F=this.transmuxConfig;h&&(this.currentTransmuxState=h);var M=function(fe,ue){var ve=null;return fe.byteLength>0&&ue!=null&&ue.key!=null&&ue.iv!==null&&ue.method!=null&&(ve=ue),ve}(R,r);if(M&&M.method==="AES-128"){var B=this.getDecrypter();if(!w.enableSoftwareAES)return this.decryptionPromise=B.webCryptoDecrypt(R,M.key.buffer,M.iv.buffer).then(function(fe){var ue=k.push(fe,null,s);return k.decryptionPromise=null,ue}),this.decryptionPromise;var U=B.softwareDecrypt(R,M.key.buffer,M.iv.buffer);if(!U)return L.executeEnd=A(),n(s);R=new Uint8Array(U)}var G=h||x,V=G.contiguous,W=G.discontinuity,Y=G.trackSwitch,Z=G.accurateTimeOffset,Q=G.timeOffset,z=F.audioCodec,ie=F.videoCodec,ae=F.defaultInitPts,le=F.duration,te=F.initSegmentData;if((W||Y)&&this.resetInitSegment(te,z,ie,le),W&&this.resetInitialTimestamp(ae),V||this.resetContiguity(),this.needsProbing(R,W,Y)){if(O.dataLength){var ce=O.flush();R=Object(y.appendUint8Array)(ce,R)}this.configureTransmuxer(R,F)}var re=this.transmux(R,M,Q,Z,s),ne=this.currentTransmuxState;return ne.contiguous=!0,ne.discontinuity=!1,ne.trackSwitch=!1,L.executeEnd=A(),re},g.flush=function(v){var r=this,s=v.transmuxing;s.executeStart=A();var h=this.decrypter,k=this.cache,L=this.currentTransmuxState,R=this.decryptionPromise;if(R)return R.then(function(){return r.flush(v)});var O=[],w=L.timeOffset;if(h){var x=h.flush();x&&O.push(this.push(x,null,v))}var F=k.dataLength;k.reset();var M=this.demuxer,B=this.remuxer;if(!M||!B)return F>=i&&this.observer.emit(T.Events.ERROR,T.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),s.executeEnd=A(),[n(v)];var U=M.flush(w);return l(U)?U.then(function(G){return r.flushRemux(O,G,v),O}):(this.flushRemux(O,U,v),O)},g.flushRemux=function(v,r,s){var h=r.audioTrack,k=r.avcTrack,L=r.id3Track,R=r.textTrack,O=this.currentTransmuxState,w=O.accurateTimeOffset,x=O.timeOffset;u.logger.log("[transmuxer.ts]: Flushed fragment "+s.sn+(s.part>-1?" p: "+s.part:"")+" of level "+s.level);var F=this.remuxer.remux(h,k,L,R,x,w,!0,this.id);v.push({remuxResult:F,chunkMeta:s}),s.transmuxing.executeEnd=A()},g.resetInitialTimestamp=function(v){var r=this.demuxer,s=this.remuxer;r&&s&&(r.resetTimeStamp(v),s.resetTimeStamp(v))},g.resetContiguity=function(){var v=this.demuxer,r=this.remuxer;v&&r&&(v.resetContiguity(),r.resetNextTimestamp())},g.resetInitSegment=function(v,r,s,h){var k=this.demuxer,L=this.remuxer;k&&L&&(k.resetInitSegment(r,s,h),L.resetInitSegment(v,r,s))},g.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},g.transmux=function(v,r,s,h,k){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(v,r,s,h,k):this.transmuxUnencrypted(v,s,h,k)},g.transmuxUnencrypted=function(v,r,s,h){var k=this.demuxer.demux(v,r,!1,!this.config.progressive),L=k.audioTrack,R=k.avcTrack,O=k.id3Track,w=k.textTrack;return{remuxResult:this.remuxer.remux(L,R,O,w,r,s,!1,this.id),chunkMeta:h}},g.transmuxSampleAes=function(v,r,s,h,k){var L=this;return this.demuxer.demuxSampleAes(v,r,s).then(function(R){return{remuxResult:L.remuxer.remux(R.audioTrack,R.avcTrack,R.id3Track,R.textTrack,s,h,!1,L.id),chunkMeta:k}})},g.configureTransmuxer=function(v,r){for(var s,h=this.config,k=this.observer,L=this.typeSupported,R=this.vendor,O=r.audioCodec,w=r.defaultInitPts,x=r.duration,F=r.initSegmentData,M=r.videoCodec,B=0,U=e.length;B<U;B++)if(e[B].demux.probe(v)){s=e[B];break}s||(u.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),s={demux:D.default,remux:c.default});var G=this.demuxer,V=this.remuxer,W=s.remux,Y=s.demux;V&&V instanceof W||(this.remuxer=new W(k,h,L,R)),G&&G instanceof Y||(this.demuxer=new Y(k,h,L),this.probe=Y.probe),this.resetInitSegment(F,O,M,x),this.resetInitialTimestamp(w)},g.needsProbing=function(v,r,s){return!this.demuxer||!this.remuxer||r||s},g.getDecrypter=function(){var v=this.decrypter;return v||(v=this.decrypter=new _.default(this.observer,this.config)),v},E}(),n=function(E){return{remuxResult:{},chunkMeta:E}};function l(E){return"then"in E&&E.then instanceof Function}var a=function(E,g,v,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=E,this.videoCodec=g,this.initSegmentData=v,this.duration=r,this.defaultInitPts=s},d=function(E,g,v,r,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=E,this.contiguous=g,this.accurateTimeOffset=v,this.trackSwitch=r,this.timeOffset=s}},"./src/demux/tsdemuxer.ts":function(P,C,f){f.r(C),f.d(C,"discardEPB",function(){return l});var A=f("./src/demux/adts.ts"),T=f("./src/demux/mpegaudio.ts"),b=f("./src/demux/exp-golomb.ts"),_=f("./src/demux/id3.ts"),I=f("./src/demux/sample-aes.ts"),D=f("./src/events.ts"),o=f("./src/utils/mp4-tools.ts"),S=f("./src/utils/logger.ts"),m=f("./src/errors.ts"),c={video:1,audio:2,id3:3,text:4},p=function(){function a(E,g,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=E,this.config=g,this.typeSupported=v}a.probe=function(E){var g=a.syncOffset(E);return!(g<0||(g&&S.logger.warn("MPEG2-TS detected but first sync word found @ offset "+g+", junk ahead ?"),0))},a.syncOffset=function(E){for(var g=Math.min(1e3,E.length-564),v=0;v<g;){if(E[v]===71&&E[v+188]===71&&E[v+376]===71)return v;v++}return-1},a.createTrack=function(E,g){return{container:E==="video"||E==="audio"?"video/mp2t":void 0,type:E,id:c[E],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:E==="audio"?g:void 0}};var d=a.prototype;return d.resetInitSegment=function(E,g,v){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",v),this._audioTrack=a.createTrack("audio",v),this._id3Track=a.createTrack("id3",v),this._txtTrack=a.createTrack("text",v),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=E,this.videoCodec=g,this._duration=v},d.resetTimeStamp=function(){},d.resetContiguity=function(){var E=this._audioTrack,g=this._avcTrack,v=this._id3Track;E&&(E.pesData=null),g&&(g.pesData=null),v&&(v.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},d.demux=function(E,g,v,r){var s;v===void 0&&(v=!1),r===void 0&&(r=!1),v||(this.sampleAes=null);var h=this._avcTrack,k=this._audioTrack,L=this._id3Track,R=h.pid,O=h.pesData,w=k.pid,x=L.pid,F=k.pesData,M=L.pesData,B=!1,U=this.pmtParsed,G=this._pmtId,V=E.length;if(this.remainderData&&(V=(E=Object(o.appendUint8Array)(this.remainderData,E)).length,this.remainderData=null),V<188&&!r)return this.remainderData=E,{audioTrack:k,avcTrack:h,id3Track:L,textTrack:this._txtTrack};var W=Math.max(0,a.syncOffset(E));(V-=(V+W)%188)<E.byteLength&&!r&&(this.remainderData=new Uint8Array(E.buffer,V,E.buffer.byteLength-V));for(var Y=W;Y<V;Y+=188)if(E[Y]===71){var Z=!!(64&E[Y+1]),Q=((31&E[Y+1])<<8)+E[Y+2],z=void 0;if((48&E[Y+3])>>4>1){if((z=Y+5+E[Y+4])===Y+188)continue}else z=Y+4;switch(Q){case R:Z&&(O&&(s=i(O))&&this.parseAVCPES(s,!1),O={data:[],size:0}),O&&(O.data.push(E.subarray(z,Y+188)),O.size+=Y+188-z);break;case w:Z&&(F&&(s=i(F))&&(k.isAAC?this.parseAACPES(s):this.parseMPEGPES(s)),F={data:[],size:0}),F&&(F.data.push(E.subarray(z,Y+188)),F.size+=Y+188-z);break;case x:Z&&(M&&(s=i(M))&&this.parseID3PES(s),M={data:[],size:0}),M&&(M.data.push(E.subarray(z,Y+188)),M.size+=Y+188-z);break;case 0:Z&&(z+=E[z]+1),G=this._pmtId=u(E,z);break;case G:Z&&(z+=E[z]+1);var ie=e(E,z,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,v);(R=ie.avc)>0&&(h.pid=R),(w=ie.audio)>0&&(k.pid=w,k.isAAC=ie.isAAC),(x=ie.id3)>0&&(L.pid=x),B&&!U&&(S.logger.log("reparse from beginning"),B=!1,Y=W-188),U=this.pmtParsed=!0;break;case 17:case 8191:break;default:B=!0}}else this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});h.pesData=O,k.pesData=F,L.pesData=M;var ae={audioTrack:k,avcTrack:h,id3Track:L,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(ae),ae},d.flush=function(){var E,g=this.remainderData;return this.remainderData=null,E=g?this.demux(g,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(E),this.sampleAes?this.decrypt(E,this.sampleAes):E},d.extractRemainingSamples=function(E){var g,v=E.audioTrack,r=E.avcTrack,s=E.id3Track,h=r.pesData,k=v.pesData,L=s.pesData;h&&(g=i(h))?(this.parseAVCPES(g,!0),r.pesData=null):r.pesData=h,k&&(g=i(k))?(v.isAAC?this.parseAACPES(g):this.parseMPEGPES(g),v.pesData=null):(k!=null&&k.size&&S.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=k),L&&(g=i(L))?(this.parseID3PES(g),s.pesData=null):s.pesData=L},d.demuxSampleAes=function(E,g,v){var r=this.demux(E,v,!0,!this.config.progressive),s=this.sampleAes=new I.default(this.observer,this.config,g);return this.decrypt(r,s)},d.decrypt=function(E,g){return new Promise(function(v){var r=E.audioTrack,s=E.avcTrack;r.samples&&r.isAAC?g.decryptAacSamples(r.samples,0,function(){s.samples?g.decryptAvcSamples(s.samples,0,0,function(){v(E)}):v(E)}):s.samples&&g.decryptAvcSamples(s.samples,0,0,function(){v(E)})})},d.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},d.parseAVCPES=function(E,g){var v,r=this,s=this._avcTrack,h=this.parseAVCNALu(E.data),k=this.avcSample,L=!1;E.data=null,k&&h.length&&!s.audFound&&(t(k,s),k=this.avcSample=y(!1,E.pts,E.dts,"")),h.forEach(function(R){switch(R.type){case 1:v=!0,k||(k=r.avcSample=y(!0,E.pts,E.dts,"")),k.frame=!0;var O=R.data;if(L&&O.length>4){var w=new b.default(O).readSliceType();w!==2&&w!==4&&w!==7&&w!==9||(k.key=!0)}break;case 5:v=!0,k||(k=r.avcSample=y(!0,E.pts,E.dts,"")),k.key=!0,k.frame=!0;break;case 6:v=!0;var x=new b.default(l(R.data));x.readUByte();for(var F=0,M=0,B=!1,U=0;!B&&x.bytesAvailable>1;){F=0;do F+=U=x.readUByte();while(U===255);M=0;do M+=U=x.readUByte();while(U===255);if(F===4&&x.bytesAvailable!==0){if(B=!0,x.readUByte()===181&&x.readUShort()===49&&x.readUInt()===1195456820&&x.readUByte()===3){for(var G=x.readUByte(),V=31&G,W=[G,x.readUByte()],Y=0;Y<V;Y++)W.push(x.readUByte()),W.push(x.readUByte()),W.push(x.readUByte());n(r._txtTrack.samples,{type:3,pts:E.pts,bytes:W})}}else if(F===5&&x.bytesAvailable!==0){if(B=!0,M>16){for(var Z=[],Q=0;Q<16;Q++)Z.push(x.readUByte().toString(16)),Q!==3&&Q!==5&&Q!==7&&Q!==9||Z.push("-");for(var z=M-16,ie=new Uint8Array(z),ae=0;ae<z;ae++)ie[ae]=x.readUByte();n(r._txtTrack.samples,{pts:E.pts,payloadType:F,uuid:Z.join(""),userData:Object(_.utf8ArrayToStr)(ie),userDataBytes:ie})}}else if(M<x.bytesAvailable)for(var le=0;le<M;le++)x.readUByte()}break;case 7:if(v=!0,L=!0,!s.sps){var te=new b.default(R.data).readSPS();s.width=te.width,s.height=te.height,s.pixelRatio=te.pixelRatio,s.sps=[R.data],s.duration=r._duration;for(var ce=R.data.subarray(1,4),re="avc1.",ne=0;ne<3;ne++){var fe=ce[ne].toString(16);fe.length<2&&(fe="0"+fe),re+=fe}s.codec=re}break;case 8:v=!0,s.pps||(s.pps=[R.data]);break;case 9:v=!1,s.audFound=!0,k&&t(k,s),k=r.avcSample=y(!1,E.pts,E.dts,"");break;case 12:v=!1;break;default:v=!1,k&&(k.debug+="unknown NAL "+R.type+" ")}k&&v&&k.units.push(R)}),g&&k&&(t(k,s),this.avcSample=null)},d.getLastNalUnit=function(){var E,g,v=this.avcSample;if(!v||v.units.length===0){var r=this._avcTrack.samples;v=r[r.length-1]}if((E=v)!==null&&E!==void 0&&E.units){var s=v.units;g=s[s.length-1]}return g},d.parseAVCNALu=function(E){var g,v,r=E.byteLength,s=this._avcTrack,h=s.naluState||0,k=h,L=[],R=0,O=-1,w=0;for(h===-1&&(O=0,w=31&E[0],h=0,R=1);R<r;)if(g=E[R++],h)if(h!==1)if(g)if(g===1){if(O>=0){var x={data:E.subarray(O,R-h-1),type:w};L.push(x)}else{var F=this.getLastNalUnit();if(F&&(k&&R<=4-k&&F.state&&(F.data=F.data.subarray(0,F.data.byteLength-k)),(v=R-h-1)>0)){var M=new Uint8Array(F.data.byteLength+v);M.set(F.data,0),M.set(E.subarray(0,v),F.data.byteLength),F.data=M}}R<r?(O=R,w=31&E[R],h=0):h=-1}else h=0;else h=3;else h=g?0:2;else h=g?0:1;if(O>=0&&h>=0){var B={data:E.subarray(O,r),type:w,state:h};L.push(B)}if(L.length===0){var U=this.getLastNalUnit();if(U){var G=new Uint8Array(U.data.byteLength+E.byteLength);G.set(U.data,0),G.set(E,U.data.byteLength),U.data=G}}return s.naluState=h,L},d.parseAACPES=function(E){var g,v,r,s,h,k=0,L=this._audioTrack,R=this.aacOverFlow,O=E.data;if(R){this.aacOverFlow=null;var w=R.sample.unit.byteLength,x=Math.min(R.missing,w),F=w-x;R.sample.unit.set(O.subarray(0,x),F),L.samples.push(R.sample),k=R.missing}for(g=k,v=O.length;g<v-1&&!A.isHeader(O,g);g++);if(g===k||(g<v-1?(r="AAC PES did not start with ADTS header,offset:"+g,s=!1):(r="no ADTS header found in AAC PES",s=!0),S.logger.warn("parsing error:"+r),this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:r}),!s)){if(A.initTrackConfig(L,this.observer,O,g,this.audioCodec),E.pts!==void 0)h=E.pts;else{if(!R)return void S.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var M=A.getFrameDuration(L.samplerate);h=R.sample.pts+M}for(var B=0;g<v;){if(A.isHeader(O,g)){if(g+5<v){var U=A.appendFrame(L,O,g,h,B);if(U){if(!U.missing){g+=U.length,B++;continue}this.aacOverFlow=U}}break}g++}}},d.parseMPEGPES=function(E){var g=E.data,v=g.length,r=0,s=0,h=E.pts;if(h!==void 0)for(;s<v;)if(T.isHeader(g,s)){var k=T.appendFrame(this._audioTrack,g,s,h,r);if(!k)break;s+=k.length,r++}else s++;else S.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},d.parseID3PES=function(E){E.pts!==void 0?this._id3Track.samples.push(E):S.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},a}();function y(a,d,E,g){return{key:a,frame:!1,pts:d,dts:E,units:[],debug:g,length:0}}function u(a,d){return(31&a[d+10])<<8|a[d+11]}function e(a,d,E,g){var v={audio:-1,avc:-1,id3:-1,isAAC:!0},r=d+3+((15&a[d+1])<<8|a[d+2])-4;for(d+=12+((15&a[d+10])<<8|a[d+11]);d<r;){var s=(31&a[d+1])<<8|a[d+2];switch(a[d]){case 207:if(!g){S.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:v.audio===-1&&(v.audio=s);break;case 21:v.id3===-1&&(v.id3=s);break;case 219:if(!g){S.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:v.avc===-1&&(v.avc=s);break;case 3:case 4:E?v.audio===-1&&(v.audio=s,v.isAAC=!1):S.logger.log("MPEG audio found, not supported in this browser");break;case 36:S.logger.warn("Unsupported HEVC stream type found")}d+=5+((15&a[d+3])<<8|a[d+4])}return v}function i(a){var d,E,g,v,r,s=0,h=a.data;if(!a||a.size===0)return null;for(;h[0].length<19&&h.length>1;){var k=new Uint8Array(h[0].length+h[1].length);k.set(h[0]),k.set(h[1],h[0].length),h[0]=k,h.splice(1,1)}if(((d=h[0])[0]<<16)+(d[1]<<8)+d[2]===1){if((E=(d[4]<<8)+d[5])&&E>a.size-6)return null;var L=d[7];192&L&&(v=536870912*(14&d[9])+4194304*(255&d[10])+16384*(254&d[11])+128*(255&d[12])+(254&d[13])/2,64&L?v-(r=536870912*(14&d[14])+4194304*(255&d[15])+16384*(254&d[16])+128*(255&d[17])+(254&d[18])/2)>54e5&&(S.logger.warn(Math.round((v-r)/9e4)+"s delta between PTS and DTS, align them"),v=r):r=v);var R=(g=d[8])+9;if(a.size<=R)return null;a.size-=R;for(var O=new Uint8Array(a.size),w=0,x=h.length;w<x;w++){var F=(d=h[w]).byteLength;if(R){if(R>F){R-=F;continue}d=d.subarray(R),F-=R,R=0}O.set(d,s),s+=F}return E&&(E-=g+3),{data:O,pts:v,dts:r,len:E}}return null}function t(a,d){if(a.units.length&&a.frame){if(a.pts===void 0){var E=d.samples,g=E.length;if(!g)return void d.dropped++;var v=E[g-1];a.pts=v.pts,a.dts=v.dts}d.samples.push(a)}a.debug.length&&S.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function n(a,d){var E=a.length;if(E>0){if(d.pts>=a[E-1].pts)a.push(d);else for(var g=E-1;g>=0;g--)if(d.pts<a[g].pts){a.splice(g,0,d);break}}else a.push(d)}function l(a){for(var d=a.byteLength,E=[],g=1;g<d-2;)a[g]===0&&a[g+1]===0&&a[g+2]===3?(E.push(g+2),g+=2):g++;if(E.length===0)return a;var v=d-E.length,r=new Uint8Array(v),s=0;for(g=0;g<v;s++,g++)s===E[0]&&(s++,E.shift()),r[g]=a[s];return r}p.minProbeByteLength=188,C.default=p},"./src/errors.ts":function(P,C,f){var A,T,b,_;f.r(C),f.d(C,"ErrorTypes",function(){return A}),f.d(C,"ErrorDetails",function(){return b}),(T=A||(A={})).NETWORK_ERROR="networkError",T.MEDIA_ERROR="mediaError",T.KEY_SYSTEM_ERROR="keySystemError",T.MUX_ERROR="muxError",T.OTHER_ERROR="otherError",(_=b||(b={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",_.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",_.KEY_SYSTEM_NO_SESSION="keySystemNoSession",_.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",_.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",_.MANIFEST_LOAD_ERROR="manifestLoadError",_.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",_.MANIFEST_PARSING_ERROR="manifestParsingError",_.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",_.LEVEL_EMPTY_ERROR="levelEmptyError",_.LEVEL_LOAD_ERROR="levelLoadError",_.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",_.LEVEL_SWITCH_ERROR="levelSwitchError",_.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",_.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",_.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",_.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",_.FRAG_LOAD_ERROR="fragLoadError",_.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",_.FRAG_DECRYPT_ERROR="fragDecryptError",_.FRAG_PARSING_ERROR="fragParsingError",_.REMUX_ALLOC_ERROR="remuxAllocError",_.KEY_LOAD_ERROR="keyLoadError",_.KEY_LOAD_TIMEOUT="keyLoadTimeOut",_.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",_.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",_.BUFFER_APPEND_ERROR="bufferAppendError",_.BUFFER_APPENDING_ERROR="bufferAppendingError",_.BUFFER_STALLED_ERROR="bufferStalledError",_.BUFFER_FULL_ERROR="bufferFullError",_.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",_.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",_.INTERNAL_EXCEPTION="internalException",_.INTERNAL_ABORTED="aborted",_.UNKNOWN="unknown"},"./src/events.ts":function(P,C,f){var A,T;f.r(C),f.d(C,"Events",function(){return A}),(T=A||(A={})).MEDIA_ATTACHING="hlsMediaAttaching",T.MEDIA_ATTACHED="hlsMediaAttached",T.MEDIA_DETACHING="hlsMediaDetaching",T.MEDIA_DETACHED="hlsMediaDetached",T.BUFFER_RESET="hlsBufferReset",T.BUFFER_CODECS="hlsBufferCodecs",T.BUFFER_CREATED="hlsBufferCreated",T.BUFFER_APPENDING="hlsBufferAppending",T.BUFFER_APPENDED="hlsBufferAppended",T.BUFFER_EOS="hlsBufferEos",T.BUFFER_FLUSHING="hlsBufferFlushing",T.BUFFER_FLUSHED="hlsBufferFlushed",T.MANIFEST_LOADING="hlsManifestLoading",T.MANIFEST_LOADED="hlsManifestLoaded",T.MANIFEST_PARSED="hlsManifestParsed",T.LEVEL_SWITCHING="hlsLevelSwitching",T.LEVEL_SWITCHED="hlsLevelSwitched",T.LEVEL_LOADING="hlsLevelLoading",T.LEVEL_LOADED="hlsLevelLoaded",T.LEVEL_UPDATED="hlsLevelUpdated",T.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",T.LEVELS_UPDATED="hlsLevelsUpdated",T.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",T.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",T.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",T.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",T.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",T.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",T.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",T.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",T.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",T.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",T.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",T.CUES_PARSED="hlsCuesParsed",T.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",T.INIT_PTS_FOUND="hlsInitPtsFound",T.FRAG_LOADING="hlsFragLoading",T.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",T.FRAG_LOADED="hlsFragLoaded",T.FRAG_DECRYPTED="hlsFragDecrypted",T.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",T.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",T.FRAG_PARSING_METADATA="hlsFragParsingMetadata",T.FRAG_PARSED="hlsFragParsed",T.FRAG_BUFFERED="hlsFragBuffered",T.FRAG_CHANGED="hlsFragChanged",T.FPS_DROP="hlsFpsDrop",T.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",T.ERROR="hlsError",T.DESTROYING="hlsDestroying",T.KEY_LOADING="hlsKeyLoading",T.KEY_LOADED="hlsKeyLoaded",T.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",T.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return t});var A=f("./node_modules/url-toolkit/src/url-toolkit.js"),T=f("./src/loader/playlist-loader.ts"),b=f("./src/loader/key-loader.ts"),_=f("./src/controller/id3-track-controller.ts"),I=f("./src/controller/latency-controller.ts"),D=f("./src/controller/level-controller.ts"),o=f("./src/controller/fragment-tracker.ts"),S=f("./src/controller/stream-controller.ts"),m=f("./src/is-supported.ts"),c=f("./src/utils/logger.ts"),p=f("./src/config.ts"),y=f("./node_modules/eventemitter3/index.js"),u=f("./src/events.ts"),e=f("./src/errors.ts");function i(n,l){for(var a=0;a<l.length;a++){var d=l[a];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(n,d.key,d)}}var t=function(){function n(g){g===void 0&&(g={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new y.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var v=this.config=Object(p.mergeConfig)(n.DefaultConfig,g);this.userConfig=g,Object(c.enableLogs)(v.debug),this._autoLevelCapping=-1,v.progressive&&Object(p.enableStreamingMode)(v);var r=v.abrController,s=v.bufferController,h=v.capLevelController,k=v.fpsController,L=this.abrController=new r(this),R=this.bufferController=new s(this),O=this.capLevelController=new h(this),w=new k(this),x=new T.default(this),F=new b.default(this),M=new _.default(this),B=this.levelController=new D.default(this),U=new o.FragmentTracker(this),G=this.streamController=new S.default(this,U);O.setStreamController(G),w.setStreamController(G);var V=[B,G];this.networkControllers=V;var W=[x,F,L,R,O,w,M,U];this.audioTrackController=this.createController(v.audioTrackController,null,V),this.createController(v.audioStreamController,U,V),this.subtitleTrackController=this.createController(v.subtitleTrackController,null,V),this.createController(v.subtitleStreamController,U,V),this.createController(v.timelineController,null,W),this.emeController=this.createController(v.emeController,null,W),this.latencyController=this.createController(I.default,null,W),this.coreComponents=W}n.isSupported=function(){return Object(m.isSupported)()};var l,a,d,E=n.prototype;return E.createController=function(g,v,r){if(g){var s=v?new g(this,v):new g(this);return r&&r.push(s),s}return null},E.on=function(g,v,r){r===void 0&&(r=this),this._emitter.on(g,v,r)},E.once=function(g,v,r){r===void 0&&(r=this),this._emitter.once(g,v,r)},E.removeAllListeners=function(g){this._emitter.removeAllListeners(g)},E.off=function(g,v,r,s){r===void 0&&(r=this),this._emitter.off(g,v,r,s)},E.listeners=function(g){return this._emitter.listeners(g)},E.emit=function(g,v,r){return this._emitter.emit(g,v,r)},E.trigger=function(g,v){if(this.config.debug)return this.emit(g,g,v);try{return this.emit(g,g,v)}catch(r){c.logger.error("An internal error happened while handling event "+g+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(u.Events.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:g,error:r})}return!1},E.listenerCount=function(g){return this._emitter.listenerCount(g)},E.destroy=function(){c.logger.log("destroy"),this.trigger(u.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(g){return g.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(g){return g.destroy()}),this.coreComponents.length=0},E.attachMedia=function(g){c.logger.log("attachMedia"),this._media=g,this.trigger(u.Events.MEDIA_ATTACHING,{media:g})},E.detachMedia=function(){c.logger.log("detachMedia"),this.trigger(u.Events.MEDIA_DETACHING,void 0),this._media=null},E.loadSource=function(g){this.stopLoad();var v=this.media,r=this.url,s=this.url=A.buildAbsoluteURL(self.location.href,g,{alwaysNormalize:!0});c.logger.log("loadSource:"+s),v&&r&&r!==s&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(v)),this.trigger(u.Events.MANIFEST_LOADING,{url:g})},E.startLoad=function(g){g===void 0&&(g=-1),c.logger.log("startLoad("+g+")"),this.networkControllers.forEach(function(v){v.startLoad(g)})},E.stopLoad=function(){c.logger.log("stopLoad"),this.networkControllers.forEach(function(g){g.stopLoad()})},E.swapAudioCodec=function(){c.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},E.recoverMediaError=function(){c.logger.log("recoverMediaError");var g=this._media;this.detachMedia(),g&&this.attachMedia(g)},E.removeLevel=function(g,v){v===void 0&&(v=0),this.levelController.removeLevel(g,v)},l=n,d=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return u.Events}},{key:"ErrorTypes",get:function(){return e.ErrorTypes}},{key:"ErrorDetails",get:function(){return e.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig?n.defaultConfig:p.hlsDefaultConfig},set:function(g){n.defaultConfig=g}}],(a=[{key:"levels",get:function(){var g=this.levelController.levels;return g||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(g){c.logger.log("set currentLevel:"+g),this.loadLevel=g,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(g){c.logger.log("set nextLevel:"+g),this.levelController.manualLevel=g,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(g){c.logger.log("set loadLevel:"+g),this.levelController.manualLevel=g}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(g){this.levelController.nextLoadLevel=g}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(g){c.logger.log("set firstLevel:"+g),this.levelController.firstLevel=g}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(g){c.logger.log("set startLevel:"+g),g!==-1&&(g=Math.max(g,this.minAutoLevel)),this.levelController.startLevel=g}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(g){var v=!!g;v!==this.config.capLevelToPlayerSize&&(v?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=v)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(g){this._autoLevelCapping!==g&&(c.logger.log("set autoLevelCapping:"+g),this._autoLevelCapping=g)}},{key:"bandwidthEstimate",get:function(){var g=this.abrController.bwEstimator;return g?g.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var g=this.levels,v=this.config.minAutoBitrate;if(!g)return 0;for(var r=g.length,s=0;s<r;s++)if(g[s].maxBitrate>v)return s;return 0}},{key:"maxAutoLevel",get:function(){var g=this.levels,v=this.autoLevelCapping;return v===-1&&g&&g.length?g.length-1:v}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(g){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,g)}},{key:"audioTracks",get:function(){var g=this.audioTrackController;return g?g.audioTracks:[]}},{key:"audioTrack",get:function(){var g=this.audioTrackController;return g?g.audioTrack:-1},set:function(g){var v=this.audioTrackController;v&&(v.audioTrack=g)}},{key:"subtitleTracks",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTrack:-1},set:function(g){var v=this.subtitleTrackController;v&&(v.subtitleTrack=g)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var g=this.subtitleTrackController;return!!g&&g.subtitleDisplay},set:function(g){var v=this.subtitleTrackController;v&&(v.subtitleDisplay=g)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(g){this.config.lowLatencyMode=g}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&i(l.prototype,a),d&&i(l,d),n}();t.defaultConfig=void 0},"./src/is-supported.ts":function(P,C,f){f.r(C),f.d(C,"isSupported",function(){return b}),f.d(C,"changeTypeSupported",function(){return _});var A=f("./src/utils/mediasource-helper.ts");function T(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var I=Object(A.getMediaSource)();if(!I)return!1;var D=T(),o=I&&typeof I.isTypeSupported=="function"&&I.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),S=!D||D.prototype&&typeof D.prototype.appendBuffer=="function"&&typeof D.prototype.remove=="function";return!!o&&!!S}function _(){var I,D=T();return typeof(D==null||(I=D.prototype)===null||I===void 0?void 0:I.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return m}),f.d(C,"LoadError",function(){return p});var A=f("./src/polyfills/number.ts"),T=f("./src/errors.ts");function b(y){var u=typeof Map=="function"?new Map:void 0;return(b=function(e){if(e===null||(i=e,Function.toString.call(i).indexOf("[native code]")===-1))return e;var i;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(u!==void 0){if(u.has(e))return u.get(e);u.set(e,t)}function t(){return _(e,arguments,o(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),D(t,e)})(y)}function _(y,u,e){return(_=I()?Reflect.construct:function(i,t,n){var l=[null];l.push.apply(l,t);var a=new(Function.bind.apply(i,l));return n&&D(a,n.prototype),a}).apply(null,arguments)}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(y,u){return(D=Object.setPrototypeOf||function(e,i){return e.__proto__=i,e})(y,u)}function o(y){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)})(y)}var S=Math.pow(2,17),m=function(){function y(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var u=y.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(e,i){var t=this,n=e.url;if(!n)return Promise.reject(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var l=this.config,a=l.fLoader,d=l.loader;return new Promise(function(E,g){t.loader&&t.loader.destroy();var v=t.loader=e.loader=a?new a(l):new d(l),r=c(e),s={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:S};e.stats=v.stats,v.load(r,s,{onSuccess:function(h,k,L,R){t.resetLoader(e,v),E({frag:e,part:null,payload:h.data,networkDetails:R})},onError:function(h,k,L){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:h,networkDetails:L}))},onAbort:function(h,k,L){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:L}))},onTimeout:function(h,k,L){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:L}))},onProgress:function(h,k,L,R){i&&i({frag:e,part:null,payload:L,networkDetails:R})}})})},u.loadPart=function(e,i,t){var n=this;this.abort();var l=this.config,a=l.fLoader,d=l.loader;return new Promise(function(E,g){n.loader&&n.loader.destroy();var v=n.loader=e.loader=a?new a(l):new d(l),r=c(e,i),s={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:S};i.stats=v.stats,v.load(r,s,{onSuccess:function(h,k,L,R){n.resetLoader(e,v),n.updateStatsFromPart(e,i);var O={frag:e,part:i,payload:h.data,networkDetails:R};t(O),E(O)},onError:function(h,k,L){n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:i,response:h,networkDetails:L}))},onAbort:function(h,k,L){e.stats.aborted=i.stats.aborted,n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:i,networkDetails:L}))},onTimeout:function(h,k,L){n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:i,networkDetails:L}))}})})},u.updateStatsFromPart=function(e,i){var t=e.stats,n=i.stats,l=n.total;if(t.loaded+=n.loaded,l){var a=Math.round(e.duration/i.duration),d=Math.min(Math.round(t.loaded/l),a),E=(a-d)*Math.round(t.loaded/d);t.total=t.loaded+E}else t.total=Math.max(t.loaded,t.total);var g=t.loading,v=n.loading;g.start?g.first+=v.first-v.start:(g.start=v.start,g.first=v.first),g.end=v.end},u.resetLoader=function(e,i){e.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()},y}();function c(y,u){u===void 0&&(u=null);var e=u||y,i={frag:y,part:u,responseType:"arraybuffer",url:e.url,rangeStart:0,rangeEnd:0},t=e.byteRangeStartOffset,n=e.byteRangeEndOffset;return Object(A.isFiniteNumber)(t)&&Object(A.isFiniteNumber)(n)&&(i.rangeStart=t,i.rangeEnd=n),i}var p=function(y){var u,e;function i(t){for(var n,l=arguments.length,a=new Array(l>1?l-1:0),d=1;d<l;d++)a[d-1]=arguments[d];return(n=y.call.apply(y,[this].concat(a))||this).data=void 0,n.data=t,n}return e=y,(u=i).prototype=Object.create(e.prototype),u.prototype.constructor=u,D(u,e),i}(b(Error))},"./src/loader/fragment.ts":function(P,C,f){f.r(C),f.d(C,"ElementaryStreamTypes",function(){return A}),f.d(C,"BaseSegment",function(){return y}),f.d(C,"Fragment",function(){return u}),f.d(C,"Part",function(){return e});var A,T,b=f("./src/polyfills/number.ts"),_=f("./node_modules/url-toolkit/src/url-toolkit.js"),I=f("./src/utils/logger.ts"),D=f("./src/loader/level-key.ts"),o=f("./src/loader/load-stats.ts");function S(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,m(i,t)}function m(i,t){return(m=Object.setPrototypeOf||function(n,l){return n.__proto__=l,n})(i,t)}function c(i,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(i,l.key,l)}}function p(i,t,n){return t&&c(i.prototype,t),n&&c(i,n),i}(T=A||(A={})).AUDIO="audio",T.VIDEO="video",T.AUDIOVIDEO="audiovideo";var y=function(){function i(t){var n;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((n={})[A.AUDIO]=null,n[A.VIDEO]=null,n[A.AUDIOVIDEO]=null,n),this.baseurl=t}return i.prototype.setByteRange=function(t,n){var l=t.split("@",2),a=[];l.length===1?a[0]=n?n.byteRangeEndOffset:0:a[0]=parseInt(l[1]),a[1]=parseInt(l[0])+a[0],this._byteRange=a},p(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(_.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),i}(),u=function(i){function t(l,a){var d;return(d=i.call(this,a)||this)._decryptdata=null,d.rawProgramDateTime=null,d.programDateTime=null,d.tagList=[],d.duration=0,d.sn=0,d.levelkey=void 0,d.type=void 0,d.loader=null,d.level=-1,d.cc=0,d.startPTS=void 0,d.endPTS=void 0,d.appendedPTS=void 0,d.startDTS=void 0,d.endDTS=void 0,d.start=0,d.deltaPTS=void 0,d.maxStartPTS=void 0,d.minEndPTS=void 0,d.stats=new o.LoadStats,d.urlId=0,d.data=void 0,d.bitrateTest=!1,d.title=null,d.initSegment=null,d.type=l,d}S(t,i);var n=t.prototype;return n.createInitializationVector=function(l){for(var a=new Uint8Array(16),d=12;d<16;d++)a[d]=l>>8*(15-d)&255;return a},n.setDecryptDataFromLevelKey=function(l,a){var d=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&((d=D.LevelKey.fromURI(l.uri)).method=l.method,d.iv=this.createInitializationVector(a),d.keyFormat="identity"),d},n.setElementaryStreamInfo=function(l,a,d,E,g,v){v===void 0&&(v=!1);var r=this.elementaryStreams,s=r[l];s?(s.startPTS=Math.min(s.startPTS,a),s.endPTS=Math.max(s.endPTS,d),s.startDTS=Math.min(s.startDTS,E),s.endDTS=Math.max(s.endDTS,g)):r[l]={startPTS:a,endPTS:d,startDTS:E,endDTS:g,partial:v}},n.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[A.AUDIO]=null,l[A.VIDEO]=null,l[A.AUDIOVIDEO]=null},p(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&I.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(b.isFiniteNumber)(this.programDateTime))return null;var l=Object(b.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*l}},{key:"encrypted",get:function(){var l;return!((l=this.decryptdata)===null||l===void 0||!l.keyFormat||!this.decryptdata.uri)}}]),t}(y),e=function(i){function t(n,l,a,d,E){var g;(g=i.call(this,a)||this).fragOffset=0,g.duration=0,g.gap=!1,g.independent=!1,g.relurl=void 0,g.fragment=void 0,g.index=void 0,g.stats=new o.LoadStats,g.duration=n.decimalFloatingPoint("DURATION"),g.gap=n.bool("GAP"),g.independent=n.bool("INDEPENDENT"),g.relurl=n.enumeratedString("URI"),g.fragment=l,g.index=d;var v=n.enumeratedString("BYTERANGE");return v&&g.setByteRange(v,E),E&&(g.fragOffset=E.fragOffset+E.duration),g}return S(t,i),p(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var n=this.elementaryStreams;return!!(n.audio||n.video||n.audiovideo)}}]),t}(y)},"./src/loader/key-loader.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return _});var A=f("./src/events.ts"),T=f("./src/errors.ts"),b=f("./src/utils/logger.ts"),_=function(){function I(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this._registerListeners()}var D=I.prototype;return D._registerListeners=function(){this.hls.on(A.Events.KEY_LOADING,this.onKeyLoading,this)},D._unregisterListeners=function(){this.hls.off(A.Events.KEY_LOADING,this.onKeyLoading)},D.destroy=function(){for(var o in this._unregisterListeners(),this.loaders){var S=this.loaders[o];S&&S.destroy()}this.loaders={}},D.onKeyLoading=function(o,S){var m=S.frag,c=m.type,p=this.loaders[c];if(m.decryptdata){var y=m.decryptdata.uri;if(y!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(p&&(b.logger.warn("abort previous key loader for type:"+c),p.abort()),!y)return void b.logger.warn("key uri is falsy");var e=u.loader,i=m.loader=this.loaders[c]=new e(u);this.decrypturl=y,this.decryptkey=null;var t={url:y,frag:m,responseType:"arraybuffer"},n={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.load(t,n,l)}else this.decryptkey&&(m.decryptdata.key=this.decryptkey,this.hls.trigger(A.Events.KEY_LOADED,{frag:m}))}else b.logger.warn("Missing decryption data on fragment in onKeyLoading")},D.loadsuccess=function(o,S,m){var c=m.frag;c.decryptdata?(this.decryptkey=c.decryptdata.key=new Uint8Array(o.data),c.loader=null,delete this.loaders[c.type],this.hls.trigger(A.Events.KEY_LOADED,{frag:c})):b.logger.error("after key load, decryptdata unset")},D.loaderror=function(o,S){var m=S.frag,c=m.loader;c&&c.abort(),delete this.loaders[m.type],this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:m,response:o})},D.loadtimeout=function(o,S){var m=S.frag,c=m.loader;c&&c.abort(),delete this.loaders[m.type],this.hls.trigger(A.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:m})},I}()},"./src/loader/level-details.ts":function(P,C,f){f.r(C),f.d(C,"LevelDetails",function(){return b});var A=f("./src/polyfills/number.ts");function T(_,I){for(var D=0;D<I.length;D++){var o=I[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}var b=function(){function _(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=o}var I,D;return _.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var S=this.lastPartSn-o.lastPartSn,m=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!m||!!S,this.advanced=this.endSN>o.endSN||S>0||S===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(.6*o.misses):this.misses=o.misses+1,this.availabilityDelay=o.availabilityDelay},I=_,(D=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(A.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return(o=this.fragments)!==null&&o!==void 0&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&T(I.prototype,D),_}()},"./src/loader/level-key.ts":function(P,C,f){f.r(C),f.d(C,"LevelKey",function(){return b});var A=f("./node_modules/url-toolkit/src/url-toolkit.js");function T(_,I){for(var D=0;D<I.length;D++){var o=I[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}var b=function(){function _(o,S){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=S?Object(A.buildAbsoluteURL)(o,S,{alwaysNormalize:!0}):o}var I,D;return _.fromURL=function(o,S){return new _(o,S)},_.fromURI=function(o){return new _(o)},I=_,(D=[{key:"uri",get:function(){return this._uri}}])&&T(I.prototype,D),_}()},"./src/loader/load-stats.ts":function(P,C,f){f.r(C),f.d(C,"LoadStats",function(){return A});var A=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return e});var A=f("./src/polyfills/number.ts"),T=f("./node_modules/url-toolkit/src/url-toolkit.js"),b=f("./src/loader/fragment.ts"),_=f("./src/loader/level-details.ts"),I=f("./src/loader/level-key.ts"),D=f("./src/utils/attr-list.ts"),o=f("./src/utils/logger.ts"),S=f("./src/utils/codecs.ts"),m=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,c=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),u=/\.(mp4|m4s|m4v|m4a)$/i,e=function(){function l(){}return l.findGroup=function(a,d){for(var E=0;E<a.length;E++){var g=a[E];if(g.id===d)return g}},l.convertAVC1ToAVCOTI=function(a){var d=a.split(".");if(d.length>2){var E=d.shift()+".";return E+=parseInt(d.shift()).toString(16),E+=("000"+parseInt(d.shift()).toString(16)).substr(-4)}return a},l.resolve=function(a,d){return T.buildAbsoluteURL(d,a,{alwaysNormalize:!0})},l.parseMasterPlaylist=function(a,d){var E,g=[],v={},r=!1;for(m.lastIndex=0;(E=m.exec(a))!=null;)if(E[1]){var s=new D.AttrList(E[1]),h={attrs:s,bitrate:s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),name:s.NAME,url:l.resolve(E[2],d)},k=s.decimalResolution("RESOLUTION");k&&(h.width=k.width,h.height=k.height),i((s.CODECS||"").split(/[ ,]+/).filter(function(R){return R}),h),h.videoCodec&&h.videoCodec.indexOf("avc1")!==-1&&(h.videoCodec=l.convertAVC1ToAVCOTI(h.videoCodec)),g.push(h)}else if(E[3]){var L=new D.AttrList(E[3]);L["DATA-ID"]&&(r=!0,v[L["DATA-ID"]]=L)}return{levels:g,sessionData:r?v:null}},l.parseMasterPlaylistMedia=function(a,d,E,g){var v;g===void 0&&(g=[]);var r=[],s=0;for(c.lastIndex=0;(v=c.exec(a))!==null;){var h=new D.AttrList(v[1]);if(h.TYPE===E){var k={attrs:h,bitrate:0,id:s++,groupId:h["GROUP-ID"],instreamId:h["INSTREAM-ID"],name:h.NAME||h.LANGUAGE||"",type:E,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:h.LANGUAGE,url:h.URI?l.resolve(h.URI,d):""};if(g.length){var L=l.findGroup(g,k.groupId)||g[0];t(k,L,"audioCodec"),t(k,L,"textCodec")}r.push(k)}}return r},l.parseLevelPlaylist=function(a,d,E,g,v){var r,s,h,k=new _.LevelDetails(d),L=k.fragments,R=null,O=0,w=0,x=0,F=0,M=null,B=new b.Fragment(g,d),U=-1,G=!1;for(p.lastIndex=0,k.m3u8=a;(r=p.exec(a))!==null;){G&&(G=!1,(B=new b.Fragment(g,d)).start=x,B.sn=O,B.cc=F,B.level=E,R&&(B.initSegment=R,B.rawProgramDateTime=R.rawProgramDateTime));var V=r[1];if(V){B.duration=parseFloat(V);var W=(" "+r[2]).slice(1);B.title=W||null,B.tagList.push(W?["INF",V,W]:["INF",V])}else if(r[3])Object(A.isFiniteNumber)(B.duration)&&(B.start=x,h&&(B.levelkey=h),B.sn=O,B.level=E,B.cc=F,B.urlId=v,L.push(B),B.relurl=(" "+r[3]).slice(1),n(B,M),M=B,x+=B.duration,O++,w=0,G=!0);else if(r[4]){var Y=(" "+r[4]).slice(1);M?B.setByteRange(Y,M):B.setByteRange(Y)}else if(r[5])B.rawProgramDateTime=(" "+r[5]).slice(1),B.tagList.push(["PROGRAM-DATE-TIME",B.rawProgramDateTime]),U===-1&&(U=L.length);else{if(!(r=r[0].match(y))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<r.length&&r[s]===void 0;s++);var Z=(" "+r[s]).slice(1),Q=(" "+r[s+1]).slice(1),z=r[s+2]?(" "+r[s+2]).slice(1):"";switch(Z){case"PLAYLIST-TYPE":k.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":O=k.startSN=parseInt(Q);break;case"SKIP":var ie=new D.AttrList(Q),ae=ie.decimalInteger("SKIPPED-SEGMENTS");if(Object(A.isFiniteNumber)(ae)){k.skippedSegments=ae;for(var le=ae;le--;)L.unshift(null);O+=ae}var te=ie.enumeratedString("RECENTLY-REMOVED-DATERANGES");te&&(k.recentlyRemovedDateranges=te.split("	"));break;case"TARGETDURATION":k.targetduration=parseFloat(Q);break;case"VERSION":k.version=parseInt(Q);break;case"EXTM3U":break;case"ENDLIST":k.live=!1;break;case"#":(Q||z)&&B.tagList.push(z?[Q,z]:[Q]);break;case"DIS":F++;case"GAP":B.tagList.push([Z]);break;case"BITRATE":B.tagList.push([Z,Q]);break;case"DISCONTINUITY-SEQ":F=parseInt(Q);break;case"KEY":var ce,re=new D.AttrList(Q),ne=re.enumeratedString("METHOD"),fe=re.URI,ue=re.hexadecimalInteger("IV"),ve=re.enumeratedString("KEYFORMATVERSIONS"),Ae=re.enumeratedString("KEYID"),_e=(ce=re.enumeratedString("KEYFORMAT"))!=null?ce:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(_e)>-1){o.logger.warn("Keyformat "+_e+" is not supported from the manifest");continue}if(_e!=="identity")continue;ne&&(h=I.LevelKey.fromURL(d,fe),fe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ne)>=0&&(h.method=ne,h.keyFormat=_e,Ae&&(h.keyID=Ae),ve&&(h.keyFormatVersions=ve),h.iv=ue));break;case"START":var Ie=new D.AttrList(Q).decimalFloatingPoint("TIME-OFFSET");Object(A.isFiniteNumber)(Ie)&&(k.startTimeOffset=Ie);break;case"MAP":var Te=new D.AttrList(Q);B.relurl=Te.URI,Te.BYTERANGE&&B.setByteRange(Te.BYTERANGE),B.level=E,B.sn="initSegment",h&&(B.levelkey=h),B.initSegment=null,R=B,G=!0;break;case"SERVER-CONTROL":var $=new D.AttrList(Q);k.canBlockReload=$.bool("CAN-BLOCK-RELOAD"),k.canSkipUntil=$.optionalFloat("CAN-SKIP-UNTIL",0),k.canSkipDateRanges=k.canSkipUntil>0&&$.bool("CAN-SKIP-DATERANGES"),k.partHoldBack=$.optionalFloat("PART-HOLD-BACK",0),k.holdBack=$.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Ee=new D.AttrList(Q);k.partTarget=Ee.decimalFloatingPoint("PART-TARGET");break;case"PART":var Oe=k.partList;Oe||(Oe=k.partList=[]);var Be=w>0?Oe[Oe.length-1]:void 0,Je=w++,$e=new b.Part(new D.AttrList(Q),B,d,Je,Be);Oe.push($e),B.duration+=$e.duration;break;case"PRELOAD-HINT":var Fe=new D.AttrList(Q);k.preloadHint=Fe;break;case"RENDITION-REPORT":var st=new D.AttrList(Q);k.renditionReports=k.renditionReports||[],k.renditionReports.push(st);break;default:o.logger.warn("line parsed but not handled: "+r)}}}M&&!M.relurl?(L.pop(),x-=M.duration,k.partList&&(k.fragmentHint=M)):k.partList&&(n(B,M),B.cc=F,k.fragmentHint=B);var et=L.length,Me=L[0],ot=L[et-1];if((x+=k.skippedSegments*k.targetduration)>0&&et&&ot){k.averagetargetduration=x/et;var tt=ot.sn;k.endSN=tt!=="initSegment"?tt:0,Me&&(k.startCC=Me.cc,Me.initSegment||k.fragments.every(function(qe){return qe.relurl&&(Ue=qe.relurl,u.test((Ye=(xe=T.parseURL(Ue))===null||xe===void 0?void 0:xe.path)!=null?Ye:""));var Ue,Ye,xe})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(B=new b.Fragment(g,d)).relurl=ot.relurl,B.level=E,B.sn="initSegment",Me.initSegment=B,k.needSidxRanges=!0))}else k.endSN=0,k.startCC=0;return k.fragmentHint&&(x+=k.fragmentHint.duration),k.totalduration=x,k.endCC=F,U>0&&function(qe,Ue){for(var Ye=qe[Ue],xe=Ue;xe--;){var ze=qe[xe];if(!ze)return;ze.programDateTime=Ye.programDateTime-1e3*ze.duration,Ye=ze}}(L,U),k},l}();function i(l,a){["video","audio","text"].forEach(function(d){var E=l.filter(function(v){return Object(S.isCodecType)(v,d)});if(E.length){var g=E.filter(function(v){return v.lastIndexOf("avc1",0)===0||v.lastIndexOf("mp4a",0)===0});a[d+"Codec"]=g.length>0?g[0]:E[0],l=l.filter(function(v){return E.indexOf(v)===-1})}}),a.unknownCodecs=l}function t(l,a,d){var E=a[d];E&&(l[d]=E)}function n(l,a){l.rawProgramDateTime?l.programDateTime=Date.parse(l.rawProgramDateTime):a!=null&&a.programDateTime&&(l.programDateTime=a.endProgramDateTime),Object(A.isFiniteNumber)(l.programDateTime)||(l.programDateTime=null,l.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(P,C,f){f.r(C);var A=f("./src/polyfills/number.ts"),T=f("./src/events.ts"),b=f("./src/errors.ts"),_=f("./src/utils/logger.ts"),I=f("./src/utils/mp4-tools.ts"),D=f("./src/loader/m3u8-parser.ts"),o=f("./src/types/loader.ts"),S=f("./src/utils/attr-list.ts");function m(p,y){var u=p.url;return u!==void 0&&u.indexOf("data:")!==0||(u=y.url),u}var c=function(){function p(u){this.hls=void 0,this.loaders=Object.create(null),this.hls=u,this.registerListeners()}var y=p.prototype;return y.registerListeners=function(){var u=this.hls;u.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.on(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.unregisterListeners=function(){var u=this.hls;u.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.off(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.createInternalLoader=function(u){var e=this.hls.config,i=e.pLoader,t=e.loader,n=new(i||t)(e);return u.loader=n,this.loaders[u.type]=n,n},y.getInternalLoader=function(u){return this.loaders[u.type]},y.resetInternalLoader=function(u){this.loaders[u]&&delete this.loaders[u]},y.destroyInternalLoaders=function(){for(var u in this.loaders){var e=this.loaders[u];e&&e.destroy(),this.resetInternalLoader(u)}},y.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},y.onManifestLoading=function(u,e){var i=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},y.onLevelLoading=function(u,e){var i=e.id,t=e.level,n=e.url,l=e.deliveryDirectives;this.load({id:i,groupId:null,level:t,responseType:"text",type:o.PlaylistContextType.LEVEL,url:n,deliveryDirectives:l})},y.onAudioTrackLoading=function(u,e){var i=e.id,t=e.groupId,n=e.url,l=e.deliveryDirectives;this.load({id:i,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:l})},y.onSubtitleTrackLoading=function(u,e){var i=e.id,t=e.groupId,n=e.url,l=e.deliveryDirectives;this.load({id:i,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:l})},y.load=function(u){var e,i,t,n,l,a,d=this.hls.config,E=this.getInternalLoader(u);if(E){var g=E.context;if(g&&g.url===u.url)return void _.logger.trace("[playlist-loader]: playlist request ongoing");_.logger.log("[playlist-loader]: aborting previous loader for type: "+u.type),E.abort()}switch(u.type){case o.PlaylistContextType.MANIFEST:i=d.manifestLoadingMaxRetry,t=d.manifestLoadingTimeOut,n=d.manifestLoadingRetryDelay,l=d.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:i=0,t=d.levelLoadingTimeOut;break;default:i=d.levelLoadingMaxRetry,t=d.levelLoadingTimeOut,n=d.levelLoadingRetryDelay,l=d.levelLoadingMaxRetryTimeout}if(E=this.createInternalLoader(u),(e=u.deliveryDirectives)!==null&&e!==void 0&&e.part&&(u.type===o.PlaylistContextType.LEVEL&&u.level!==null?a=this.hls.levels[u.level].details:u.type===o.PlaylistContextType.AUDIO_TRACK&&u.id!==null?a=this.hls.audioTracks[u.id].details:u.type===o.PlaylistContextType.SUBTITLE_TRACK&&u.id!==null&&(a=this.hls.subtitleTracks[u.id].details),a)){var v=a.partTarget,r=a.targetduration;v&&r&&(t=Math.min(1e3*Math.max(3*v,.8*r),t))}var s={timeout:t,maxRetry:i,retryDelay:n,maxRetryDelay:l,highWaterMark:0},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};E.load(u,s,h)},y.loadsuccess=function(u,e,i,t){if(t===void 0&&(t=null),i.isSidxRequest)return this.handleSidxRequest(u,i),void this.handlePlaylistLoaded(u,e,i,t);this.resetInternalLoader(i.type);var n=u.data;n.indexOf("#EXTM3U")===0?(e.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(u,e,i,t):this.handleMasterPlaylist(u,e,i,t)):this.handleManifestParsingError(u,i,"no EXTM3U delimiter",t)},y.loaderror=function(u,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!1,u)},y.loadtimeout=function(u,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!0)},y.handleMasterPlaylist=function(u,e,i,t){var n=this.hls,l=u.data,a=m(u,i),d=D.default.parseMasterPlaylist(l,a),E=d.levels,g=d.sessionData;if(E.length){var v=E.map(function(L){return{id:L.attrs.AUDIO,audioCodec:L.audioCodec}}),r=E.map(function(L){return{id:L.attrs.SUBTITLES,textCodec:L.textCodec}}),s=D.default.parseMasterPlaylistMedia(l,a,"AUDIO",v),h=D.default.parseMasterPlaylistMedia(l,a,"SUBTITLES",r),k=D.default.parseMasterPlaylistMedia(l,a,"CLOSED-CAPTIONS");s.length&&(s.some(function(L){return!L.url})||!E[0].audioCodec||E[0].attrs.AUDIO||(_.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),s.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new S.AttrList({}),bitrate:0,url:""}))),n.trigger(T.Events.MANIFEST_LOADED,{levels:E,audioTracks:s,subtitles:h,captions:k,url:a,stats:e,networkDetails:t,sessionData:g})}else this.handleManifestParsingError(u,i,"no level found in manifest",t)},y.handleTrackOrLevelPlaylist=function(u,e,i,t){var n=this.hls,l=i.id,a=i.level,d=i.type,E=m(u,i),g=Object(A.isFiniteNumber)(l)?l:0,v=Object(A.isFiniteNumber)(a)?a:g,r=function(R){switch(R.type){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}(i),s=D.default.parseLevelPlaylist(u.data,E,v,r,g);if(s.fragments.length){if(d===o.PlaylistContextType.MANIFEST){var h={attrs:new S.AttrList({}),bitrate:0,details:s,name:"",url:E};n.trigger(T.Events.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:E,stats:e,networkDetails:t,sessionData:null})}if(e.parsing.end=performance.now(),s.needSidxRanges){var k,L=(k=s.fragments[0].initSegment)===null||k===void 0?void 0:k.url;this.load({url:L,isSidxRequest:!0,type:d,level:a,levelDetails:s,id:l,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=s,this.handlePlaylistLoaded(u,e,i,t)}else n.trigger(T.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:E,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},y.handleSidxRequest=function(u,e){var i=Object(I.parseSegmentIndex)(new Uint8Array(u.data));if(i){var t=i.references,n=e.levelDetails;t.forEach(function(l,a){var d=l.info,E=n.fragments[a];E.byteRange.length===0&&E.setByteRange(String(1+d.end-d.start)+"@"+String(d.start)),E.initSegment&&E.initSegment.setByteRange(String(i.moovEndOffset)+"@0")})}},y.handleManifestParsingError=function(u,e,i,t){this.hls.trigger(T.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===o.PlaylistContextType.MANIFEST,url:u.url,reason:i,response:u,context:e,networkDetails:t})},y.handleNetworkError=function(u,e,i,t){i===void 0&&(i=!1),_.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+u.type+" level: "+u.level+" id: "+u.id+' group-id: "'+u.groupId+'"');var n=b.ErrorDetails.UNKNOWN,l=!1,a=this.getInternalLoader(u);switch(u.type){case o.PlaylistContextType.MANIFEST:n=i?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case o.PlaylistContextType.LEVEL:n=i?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case o.PlaylistContextType.AUDIO_TRACK:n=i?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:n=i?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1}a&&this.resetInternalLoader(u.type);var d={type:b.ErrorTypes.NETWORK_ERROR,details:n,fatal:l,url:u.url,loader:a,context:u,networkDetails:e};t&&(d.response=t),this.hls.trigger(T.Events.ERROR,d)},y.handlePlaylistLoaded=function(u,e,i,t){var n=i.type,l=i.level,a=i.id,d=i.groupId,E=i.loader,g=i.levelDetails,v=i.deliveryDirectives;if(g!=null&&g.targetduration){if(E)switch(g.live&&(E.getCacheAge&&(g.ageHeader=E.getCacheAge()||0),E.getCacheAge&&!isNaN(g.ageHeader)||(g.ageHeader=0)),n){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(T.Events.LEVEL_LOADED,{details:g,level:l||0,id:a||0,stats:e,networkDetails:t,deliveryDirectives:v});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(T.Events.AUDIO_TRACK_LOADED,{details:g,id:a||0,groupId:d||"",stats:e,networkDetails:t,deliveryDirectives:v});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(T.Events.SUBTITLE_TRACK_LOADED,{details:g,id:a||0,groupId:d||"",stats:e,networkDetails:t,deliveryDirectives:v})}}else this.handleManifestParsingError(u,i,"invalid target duration",t)},p}();C.default=c},"./src/polyfills/number.ts":function(P,C,f){f.r(C),f.d(C,"isFiniteNumber",function(){return A}),f.d(C,"MAX_SAFE_INTEGER",function(){return T});var A=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)},T=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(P,C,f){f.r(C);var A=function(){function T(){}return T.getSilentFrame=function(b,_){switch(b){case"mp4a.40.2":if(_===1)return new Uint8Array([0,200,0,128,35,128]);if(_===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(_===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(_===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(_===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(_===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(_===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},T}();C.default=A},"./src/remux/mp4-generator.ts":function(P,C,f){f.r(C);var A=Math.pow(2,32)-1,T=function(){function b(){}return b.init=function(){var _;for(_ in b.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},b.types)b.types.hasOwnProperty(_)&&(b.types[_]=[_.charCodeAt(0),_.charCodeAt(1),_.charCodeAt(2),_.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);b.HDLR_TYPES={video:I,audio:D};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);b.STTS=b.STSC=b.STCO=S,b.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),b.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),b.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),b.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var m=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),p=new Uint8Array([0,0,0,1]);b.FTYP=b.box(b.types.ftyp,m,p,m,c),b.DINF=b.box(b.types.dinf,b.box(b.types.dref,o))},b.box=function(_){for(var I=8,D=arguments.length,o=new Array(D>1?D-1:0),S=1;S<D;S++)o[S-1]=arguments[S];for(var m=o.length,c=m;m--;)I+=o[m].byteLength;var p=new Uint8Array(I);for(p[0]=I>>24&255,p[1]=I>>16&255,p[2]=I>>8&255,p[3]=255&I,p.set(_,4),m=0,I=8;m<c;m++)p.set(o[m],I),I+=o[m].byteLength;return p},b.hdlr=function(_){return b.box(b.types.hdlr,b.HDLR_TYPES[_])},b.mdat=function(_){return b.box(b.types.mdat,_)},b.mdhd=function(_,I){I*=_;var D=Math.floor(I/(A+1)),o=Math.floor(I%(A+1));return b.box(b.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},b.mdia=function(_){return b.box(b.types.mdia,b.mdhd(_.timescale,_.duration),b.hdlr(_.type),b.minf(_))},b.mfhd=function(_){return b.box(b.types.mfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,255&_]))},b.minf=function(_){return _.type==="audio"?b.box(b.types.minf,b.box(b.types.smhd,b.SMHD),b.DINF,b.stbl(_)):b.box(b.types.minf,b.box(b.types.vmhd,b.VMHD),b.DINF,b.stbl(_))},b.moof=function(_,I,D){return b.box(b.types.moof,b.mfhd(_),b.traf(D,I))},b.moov=function(_){for(var I=_.length,D=[];I--;)D[I]=b.trak(_[I]);return b.box.apply(null,[b.types.moov,b.mvhd(_[0].timescale,_[0].duration)].concat(D).concat(b.mvex(_)))},b.mvex=function(_){for(var I=_.length,D=[];I--;)D[I]=b.trex(_[I]);return b.box.apply(null,[b.types.mvex].concat(D))},b.mvhd=function(_,I){I*=_;var D=Math.floor(I/(A+1)),o=Math.floor(I%(A+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return b.box(b.types.mvhd,S)},b.sdtp=function(_){var I,D,o=_.samples||[],S=new Uint8Array(4+o.length);for(I=0;I<o.length;I++)D=o[I].flags,S[I+4]=D.dependsOn<<4|D.isDependedOn<<2|D.hasRedundancy;return b.box(b.types.sdtp,S)},b.stbl=function(_){return b.box(b.types.stbl,b.stsd(_),b.box(b.types.stts,b.STTS),b.box(b.types.stsc,b.STSC),b.box(b.types.stsz,b.STSZ),b.box(b.types.stco,b.STCO))},b.avc1=function(_){var I,D,o,S=[],m=[];for(I=0;I<_.sps.length;I++)o=(D=_.sps[I]).byteLength,S.push(o>>>8&255),S.push(255&o),S=S.concat(Array.prototype.slice.call(D));for(I=0;I<_.pps.length;I++)o=(D=_.pps[I]).byteLength,m.push(o>>>8&255),m.push(255&o),m=m.concat(Array.prototype.slice.call(D));var c=b.box(b.types.avcC,new Uint8Array([1,S[3],S[4],S[5],255,224|_.sps.length].concat(S).concat([_.pps.length]).concat(m))),p=_.width,y=_.height,u=_.pixelRatio[0],e=_.pixelRatio[1];return b.box(b.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>8&255,255&p,y>>8&255,255&y,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,b.box(b.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),b.box(b.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,e>>24,e>>16&255,e>>8&255,255&e])))},b.esds=function(_){var I=_.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(_.config).concat([6,1,2]))},b.mp4a=function(_){var I=_.samplerate;return b.box(b.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]),b.box(b.types.esds,b.esds(_)))},b.mp3=function(_){var I=_.samplerate;return b.box(b.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]))},b.stsd=function(_){return _.type==="audio"?_.isAAC||_.codec!=="mp3"?b.box(b.types.stsd,b.STSD,b.mp4a(_)):b.box(b.types.stsd,b.STSD,b.mp3(_)):b.box(b.types.stsd,b.STSD,b.avc1(_))},b.tkhd=function(_){var I=_.id,D=_.duration*_.timescale,o=_.width,S=_.height,m=Math.floor(D/(A+1)),c=Math.floor(D%(A+1));return b.box(b.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,0,0,0,0,m>>24,m>>16&255,m>>8&255,255&m,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,S>>8&255,255&S,0,0]))},b.traf=function(_,I){var D=b.sdtp(_),o=_.id,S=Math.floor(I/(A+1)),m=Math.floor(I%(A+1));return b.box(b.types.traf,b.box(b.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),b.box(b.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,255&S,m>>24,m>>16&255,m>>8&255,255&m])),b.trun(_,D.length+16+20+8+16+8+8),D)},b.trak=function(_){return _.duration=_.duration||4294967295,b.box(b.types.trak,b.tkhd(_),b.mdia(_))},b.trex=function(_){var I=_.id;return b.box(b.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,255&I,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},b.trun=function(_,I){var D,o,S,m,c,p,y=_.samples||[],u=y.length,e=12+16*u,i=new Uint8Array(e);for(I+=8+e,i.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,I>>>24&255,I>>>16&255,I>>>8&255,255&I],0),D=0;D<u;D++)S=(o=y[D]).duration,m=o.size,c=o.flags,p=o.cts,i.set([S>>>24&255,S>>>16&255,S>>>8&255,255&S,m>>>24&255,m>>>16&255,m>>>8&255,255&m,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,p>>>24&255,p>>>16&255,p>>>8&255,255&p],12+16*D);return b.box(b.types.trun,i)},b.initSegment=function(_){b.types||b.init();var I=b.moov(_),D=new Uint8Array(b.FTYP.byteLength+I.byteLength);return D.set(b.FTYP),D.set(I,b.FTYP.byteLength),D},b}();T.types=void 0,T.HDLR_TYPES=void 0,T.STTS=void 0,T.STSC=void 0,T.STCO=void 0,T.STSZ=void 0,T.VMHD=void 0,T.SMHD=void 0,T.STSD=void 0,T.FTYP=void 0,T.DINF=void 0,C.default=T},"./src/remux/mp4-remuxer.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return u}),f.d(C,"normalizePts",function(){return e});var A=f("./src/polyfills/number.ts"),T=f("./src/remux/aac-helper.ts"),b=f("./src/remux/mp4-generator.ts"),_=f("./src/events.ts"),I=f("./src/errors.ts"),D=f("./src/utils/logger.ts"),o=f("./src/types/loader.ts"),S=f("./src/utils/timescale-conversion.ts");function m(){return(m=Object.assign||function(n){for(var l=1;l<arguments.length;l++){var a=arguments[l];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(n[d]=a[d])}return n}).apply(this,arguments)}var c=null,p=null,y=!1,u=function(){function n(a,d,E,g){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=a,this.config=d,this.typeSupported=E,this.ISGenerated=!1,c===null){var v=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);c=v?parseInt(v[1]):0}if(p===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);p=r?parseInt(r[1]):0}y=!!c&&c<75||!!p&&p<600}var l=n.prototype;return l.destroy=function(){},l.resetTimeStamp=function(a){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},l.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},l.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},l.getVideoStartPts=function(a){var d=!1,E=a.reduce(function(g,v){var r=v.pts-g;return r<-4294967296?(d=!0,e(g,v.pts)):r>0?g:v.pts},a[0].pts);return d&&D.logger.debug("PTS rollover detected"),E},l.remux=function(a,d,E,g,v,r,s,h){var k,L,R,O,w,x,F=v,M=v,B=a.pid>-1,U=d.pid>-1,G=d.samples.length,V=a.samples.length>0,W=G>1;if((!B||V)&&(!U||W)||this.ISGenerated||s){this.ISGenerated||(R=this.generateIS(a,d,v));var Y=this.isVideoContiguous,Z=-1;if(W&&(Z=function(le){for(var te=0;te<le.length;te++)if(le[te].key)return te;return-1}(d.samples),!Y&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,Z>0){D.logger.warn("[mp4-remuxer]: Dropped "+Z+" out of "+G+" video samples due to a missing keyframe");var Q=this.getVideoStartPts(d.samples);d.samples=d.samples.slice(Z),d.dropped+=Z,M+=(d.samples[0].pts-Q)/(d.timescale||9e4)}else Z===-1&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+G+" video samples"),x=!1);if(this.ISGenerated){if(V&&W){var z=this.getVideoStartPts(d.samples),ie=(e(a.samples[0].pts,z)-z)/d.inputTimeScale;F+=Math.max(0,ie),M+=Math.max(0,-ie)}if(V){if(a.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),R=this.generateIS(a,d,v)),L=this.remuxAudio(a,F,this.isAudioContiguous,r,U||W||h===o.PlaylistLevelType.AUDIO?M:void 0),W){var ae=L?L.endPTS-L.startPTS:0;d.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),R=this.generateIS(a,d,v)),k=this.remuxVideo(d,M,Y,ae)}}else W&&(k=this.remuxVideo(d,M,Y,0));k&&(k.firstKeyFrame=Z,k.independent=Z!==-1)}}return this.ISGenerated&&(E.samples.length&&(w=this.remuxID3(E,v)),g.samples.length&&(O=this.remuxText(g,v))),{audio:L,video:k,initSegment:R,independent:x,text:O,id3:w}},l.generateIS=function(a,d,E){var g,v,r,s=a.samples,h=d.samples,k=this.typeSupported,L={},R=!Object(A.isFiniteNumber)(this._initPTS),O="audio/mp4";if(R&&(g=v=1/0),a.config&&s.length&&(a.timescale=a.samplerate,a.isAAC||(k.mpeg?(O="audio/mpeg",a.codec=""):k.mp3&&(a.codec="mp3")),L.audio={id:"audio",container:O,codec:a.codec,initSegment:!a.isAAC&&k.mpeg?new Uint8Array(0):b.default.initSegment([a]),metadata:{channelCount:a.channelCount}},R&&(r=a.inputTimeScale,g=v=s[0].pts-Math.round(r*E))),d.sps&&d.pps&&h.length&&(d.timescale=d.inputTimeScale,L.video={id:"main",container:"video/mp4",codec:d.codec,initSegment:b.default.initSegment([d]),metadata:{width:d.width,height:d.height}},R)){r=d.inputTimeScale;var w=this.getVideoStartPts(h),x=Math.round(r*E);v=Math.min(v,e(h[0].dts,w)-x),g=Math.min(g,w-x)}if(Object.keys(L).length)return this.ISGenerated=!0,R&&(this._initPTS=g,this._initDTS=v),{tracks:L,initPTS:g,timescale:r}},l.remuxVideo=function(a,d,E,g){var v,r,s,h=a.inputTimeScale,k=a.samples,L=[],R=k.length,O=this._initPTS,w=this.nextAvcDts,x=8,F=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,B=0,U=!1;E&&w!==null||(w=d*h-(k[0].pts-e(k[0].dts,k[0].pts)));for(var G=0;G<R;G++){var V=k[G];V.pts=e(V.pts-O,w),V.dts=e(V.dts-O,w),V.dts>V.pts&&(B=Math.max(Math.min(B,V.pts-V.dts),-18e3)),V.dts<k[G>0?G-1:G].dts&&(U=!0)}U&&k.sort(function(xe,ze){var ir=xe.dts-ze.dts,nr=xe.pts-ze.pts;return ir||nr}),r=k[0].dts,s=k[k.length-1].dts;var W=Math.round((s-r)/(R-1));if(B<0){if(B<-2*W){D.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(S.toMsFromMpegTsClock)(-W,!0)+" ms");for(var Y=B,Z=0;Z<R;Z++)k[Z].dts=Y=Math.max(Y,k[Z].pts-W),k[Z].pts=Math.max(Y,k[Z].pts)}else{D.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(S.toMsFromMpegTsClock)(B,!0)+" ms to overcome this issue");for(var Q=0;Q<R;Q++)k[Q].dts=k[Q].dts+B}r=k[0].dts}if(E){var z=r-w,ie=z>W;if(ie||z<-1){ie?D.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(z,!0)+" ms ("+z+"dts) hole between fragments detected, filling it"):D.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(-z,!0)+" ms ("+z+"dts) overlapping between fragments detected"),r=w;var ae=k[0].pts-z;k[0].dts=r,k[0].pts=ae,D.logger.log("Video: First PTS/DTS adjusted: "+Object(S.toMsFromMpegTsClock)(ae,!0)+"/"+Object(S.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(S.toMsFromMpegTsClock)(z,!0)+" ms")}}y&&(r=Math.max(0,r));for(var le=0,te=0,ce=0;ce<R;ce++){for(var re=k[ce],ne=re.units,fe=ne.length,ue=0,ve=0;ve<fe;ve++)ue+=ne[ve].data.length;te+=ue,le+=fe,re.length=ue,re.dts=Math.max(re.dts,r),re.pts=Math.max(re.pts,re.dts,0),F=Math.min(re.pts,F),M=Math.max(re.pts,M)}s=k[R-1].dts;var Ae,_e=te+4*le+8;try{Ae=new Uint8Array(_e)}catch{return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:_e,reason:"fail allocating video mdat "+_e})}var Ie=new DataView(Ae.buffer);Ie.setUint32(0,_e),Ae.set(b.default.types.mdat,4);for(var Te=0;Te<R;Te++){for(var $=k[Te],Ee=$.units,Oe=0,Be=0,Je=Ee.length;Be<Je;Be++){var $e=Ee[Be],Fe=$e.data,st=$e.data.byteLength;Ie.setUint32(x,st),x+=4,Ae.set(Fe,x),x+=st,Oe+=4+st}if(Te<R-1)v=k[Te+1].dts-$.dts;else{var et=this.config,Me=$.dts-k[Te>0?Te-1:Te].dts;if(et.stretchShortVideoTrack&&this.nextAudioPts!==null){var ot=Math.floor(et.maxBufferHole*h),tt=(g?F+g*h:this.nextAudioPts)-$.pts;tt>ot?((v=tt-Me)<0&&(v=Me),D.logger.log("[mp4-remuxer]: It is approximately "+tt/90+" ms to the next segment; using duration "+v/90+" ms for the last video frame.")):v=Me}else v=Me}var qe=Math.round($.pts-$.dts);L.push(new i($.key,v,Oe,qe))}if(L.length&&c&&c<70){var Ue=L[0].flags;Ue.dependsOn=2,Ue.isNonSync=0}console.assert(v!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=w=s+v,this.isVideoContiguous=!0;var Ye={data1:b.default.moof(a.sequenceNumber++,r,m({},a,{samples:L})),data2:Ae,startPTS:F/h,endPTS:(M+v)/h,startDTS:r/h,endDTS:w/h,type:"video",hasAudio:!1,hasVideo:!0,nb:L.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(Ae.length,"MDAT length must not be zero"),Ye},l.remuxAudio=function(a,d,E,g,v){var r=a.inputTimeScale,s=r/(a.samplerate?a.samplerate:r),h=a.isAAC?1024:1152,k=h*s,L=this._initPTS,R=!a.isAAC&&this.typeSupported.mpeg,O=[],w=a.samples,x=R?0:8,F=this.nextAudioPts||-1,M=d*r;if(this.isAudioContiguous=E=E||w.length&&F>0&&(g&&Math.abs(M-F)<9e3||Math.abs(e(w[0].pts-L,M)-F)<20*k),w.forEach(function(Fe){Fe.pts=e(Fe.pts-L,M)}),!E||F<0){if(!(w=w.filter(function(Fe){return Fe.pts>=0})).length)return;F=v===0?0:g?Math.max(0,M):w[0].pts}if(a.isAAC)for(var B=v!==void 0,U=this.config.maxAudioFramesDrift,G=0,V=F;G<w.length;G++){var W=w[G],Y=W.pts,Z=Y-V,Q=Math.abs(1e3*Z/r);if(Z<=-U*k&&B)G===0&&(D.logger.warn("Audio frame @ "+(Y/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Z/r)+" ms."),this.nextAudioPts=F=V=Y);else if(Z>=U*k&&Q<1e4&&B){var z=Math.round(Z/k);(V=Y-z*k)<0&&(z--,V+=k),G===0&&(this.nextAudioPts=F=V),D.logger.warn("[mp4-remuxer]: Injecting "+z+" audio frame @ "+(V/r).toFixed(3)+"s due to "+Math.round(1e3*Z/r)+" ms gap.");for(var ie=0;ie<z;ie++){var ae=Math.max(V,0),le=T.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);le||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),le=W.unit.subarray()),w.splice(G,0,{unit:le,pts:ae}),V+=k,G++}}W.pts=V,V+=k}for(var te,ce=null,re=null,ne=0,fe=w.length;fe--;)ne+=w[fe].unit.byteLength;for(var ue=0,ve=w.length;ue<ve;ue++){var Ae=w[ue],_e=Ae.unit,Ie=Ae.pts;if(re!==null)O[ue-1].duration=Math.round((Ie-re)/s);else{if(E&&a.isAAC&&(Ie=F),ce=Ie,!(ne>0))return;ne+=x;try{te=new Uint8Array(ne)}catch{return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ne,reason:"fail allocating audio mdat "+ne})}R||(new DataView(te.buffer).setUint32(0,ne),te.set(b.default.types.mdat,4))}te.set(_e,x);var Te=_e.byteLength;x+=Te,O.push(new i(!0,h,Te,0)),re=Ie}var $=O.length;if($){var Ee=O[O.length-1];this.nextAudioPts=F=re+s*Ee.duration;var Oe=R?new Uint8Array(0):b.default.moof(a.sequenceNumber++,ce/s,m({},a,{samples:O}));a.samples=[];var Be=ce/r,Je=F/r,$e={data1:Oe,data2:te,startPTS:Be,endPTS:Je,startDTS:Be,endDTS:Je,type:"audio",hasAudio:!0,hasVideo:!1,nb:$};return this.isAudioContiguous=!0,console.assert(te.length,"MDAT length must not be zero"),$e}},l.remuxEmptyAudio=function(a,d,E,g){var v=a.inputTimeScale,r=v/(a.samplerate?a.samplerate:v),s=this.nextAudioPts,h=(s!==null?s:g.startDTS*v)+this._initDTS,k=g.endDTS*v+this._initDTS,L=1024*r,R=Math.ceil((k-h)/L),O=T.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),O){for(var w=[],x=0;x<R;x++){var F=h+x*L;w.push({unit:O,pts:F,dts:F})}return a.samples=w,this.remuxAudio(a,d,E,!1)}D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},l.remuxID3=function(a,d){var E=a.samples.length;if(E){for(var g=a.inputTimeScale,v=this._initPTS,r=this._initDTS,s=0;s<E;s++){var h=a.samples[s];h.pts=e(h.pts-v,d*g)/g,h.dts=e(h.dts-r,d*g)/g}var k=a.samples;return a.samples=[],{samples:k}}},l.remuxText=function(a,d){var E=a.samples.length;if(E){for(var g=a.inputTimeScale,v=this._initPTS,r=0;r<E;r++){var s=a.samples[r];s.pts=e(s.pts-v,d*g)/g}a.samples.sort(function(k,L){return k.pts-L.pts});var h=a.samples;return a.samples=[],{samples:h}}},n}();function e(n,l){var a;if(l===null)return n;for(a=l<n?-8589934592:8589934592;Math.abs(n-l)>4294967296;)n+=a;return n}var i=function(n,l,a,d){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=l,this.size=a,this.cts=d,this.flags=new t(n)},t=function(n){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=n?2:1,this.isNonSync=n?0:1}},"./src/remux/passthrough-remuxer.ts":function(P,C,f){f.r(C);var A=f("./src/polyfills/number.ts"),T=f("./src/utils/mp4-tools.ts"),b=f("./src/loader/fragment.ts"),_=f("./src/utils/logger.ts"),I=function(){function S(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var m=S.prototype;return m.destroy=function(){},m.resetTimeStamp=function(c){this.initPTS=c,this.lastEndDTS=null},m.resetNextTimestamp=function(){this.lastEndDTS=null},m.resetInitSegment=function(c,p,y){this.audioCodec=p,this.videoCodec=y,this.generateInitSegment(c),this.emitInitSegment=!0},m.generateInitSegment=function(c){var p=this.audioCodec,y=this.videoCodec;if(!c||!c.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var u=this.initData=Object(T.parseInitSegment)(c);p||(p=o(u.audio,b.ElementaryStreamTypes.AUDIO)),y||(y=o(u.video,b.ElementaryStreamTypes.VIDEO));var e={};u.audio&&u.video?e.audiovideo={container:"video/mp4",codec:p+","+y,initSegment:c,id:"main"}:u.audio?e.audio={container:"audio/mp4",codec:p,initSegment:c,id:"audio"}:u.video?e.video={container:"video/mp4",codec:y,initSegment:c,id:"main"}:_.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},m.remux=function(c,p,y,u,e){var i=this.initPTS,t=this.lastEndDTS,n={audio:void 0,video:void 0,text:u,id3:y,initSegment:void 0};Object(A.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var l=p.samples;if(!l||!l.length)return n;var a={initPTS:void 0,timescale:1},d=this.initData;if(d&&d.length||(this.generateInitSegment(l),d=this.initData),!d||!d.length)return _.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),n;this.emitInitSegment&&(a.tracks=this.initTracks,this.emitInitSegment=!1),Object(A.isFiniteNumber)(i)||(this.initPTS=a.initPTS=i=D(d,l,t));var E=Object(T.getDuration)(l,d),g=t,v=E+g;Object(T.offsetStartDTS)(d,l,i),E>0?this.lastEndDTS=v:(_.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!d.audio,s=!!d.video,h="";r&&(h+="audio"),s&&(h+="video");var k={data1:l,startPTS:g,startDTS:g,endPTS:v,endDTS:v,type:h,hasAudio:r,hasVideo:s,nb:1,dropped:0};return n.audio=k.type==="audio"?k:void 0,n.video=k.type!=="audio"?k:void 0,n.text=u,n.id3=y,n.initSegment=a,n},S}(),D=function(S,m,c){return Object(T.getStartDTS)(S,m)-c};function o(S,m){var c=S==null?void 0:S.codec;return c&&c.length>4?c:c==="hvc1"?"hvc1.1.c.L120.90":c==="av01"?"av01.0.04M.08":c==="avc1"||m===b.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=I},"./src/task-loop.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return A});var A=function(){function T(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=T.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(_){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,_),!0)},b.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},b.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},T}()},"./src/types/level.ts":function(P,C,f){function A(o,S){for(var m=0;m<S.length;m++){var c=S[m];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(o,c.key,c)}}var T,b;function _(o,S){var m=o.canSkipUntil,c=o.canSkipDateRanges,p=o.endSN;return m&&(S!==void 0?S-p:0)<m?c?T.v2:T.Yes:T.No}f.r(C),f.d(C,"HlsSkip",function(){return T}),f.d(C,"getSkipValue",function(){return _}),f.d(C,"HlsUrlParameters",function(){return I}),f.d(C,"Level",function(){return D}),(b=T||(T={})).No="",b.Yes="YES",b.v2="v2";var I=function(){function o(S,m,c){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=S,this.part=m,this.skip=c}return o.prototype.addDirectives=function(S){var m=new self.URL(S);return this.msn!==void 0&&m.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&m.searchParams.set("_HLS_part",this.part.toString()),this.skip&&m.searchParams.set("_HLS_skip",this.skip),m.toString()},o}(),D=function(){function o(c){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[c.url],this.attrs=c.attrs,this.bitrate=c.bitrate,c.details&&(this.details=c.details),this.id=c.id||0,this.name=c.name,this.width=c.width||0,this.height=c.height||0,this.audioCodec=c.audioCodec,this.videoCodec=c.videoCodec,this.unknownCodecs=c.unknownCodecs,this.codecSet=[c.videoCodec,c.audioCodec].filter(function(p){return p}).join(",").replace(/\.[^.,]+/g,"")}var S,m;return S=o,(m=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(c){var p=c%this.url.length;this._urlId!==p&&(this.details=void 0,this._urlId=p)}}])&&A(S.prototype,m),o}()},"./src/types/loader.ts":function(P,C,f){var A,T,b,_;f.r(C),f.d(C,"PlaylistContextType",function(){return A}),f.d(C,"PlaylistLevelType",function(){return b}),(T=A||(A={})).MANIFEST="manifest",T.LEVEL="level",T.AUDIO_TRACK="audioTrack",T.SUBTITLE_TRACK="subtitleTrack",(_=b||(b={})).MAIN="main",_.AUDIO="audio",_.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(P,C,f){f.r(C),f.d(C,"ChunkMetadata",function(){return A});var A=function(T,b,_,I,D,o){I===void 0&&(I=0),D===void 0&&(D=-1),o===void 0&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=T,this.sn=b,this.id=_,this.size=I,this.part=D,this.partial=o}},"./src/utils/attr-list.ts":function(P,C,f){f.r(C),f.d(C,"AttrList",function(){return b});var A=/^(\d+)x(\d+)$/,T=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function _(D){for(var o in typeof D=="string"&&(D=_.parseAttrList(D)),D)D.hasOwnProperty(o)&&(this[o]=D[o])}var I=_.prototype;return I.decimalInteger=function(D){var o=parseInt(this[D],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},I.hexadecimalInteger=function(D){if(this[D]){var o=(this[D]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var S=new Uint8Array(o.length/2),m=0;m<o.length/2;m++)S[m]=parseInt(o.slice(2*m,2*m+2),16);return S}return null},I.hexadecimalIntegerAsNumber=function(D){var o=parseInt(this[D],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},I.decimalFloatingPoint=function(D){return parseFloat(this[D])},I.optionalFloat=function(D,o){var S=this[D];return S?parseFloat(S):o},I.enumeratedString=function(D){return this[D]},I.bool=function(D){return this[D]==="YES"},I.decimalResolution=function(D){var o=A.exec(this[D]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},_.parseAttrList=function(D){var o,S={};for(T.lastIndex=0;(o=T.exec(D))!==null;){var m=o[2];m.indexOf('"')===0&&m.lastIndexOf('"')===m.length-1&&(m=m.slice(1,-1)),S[o[1]]=m}return S},_}()},"./src/utils/binary-search.ts":function(P,C,f){f.r(C),C.default={search:function(A,T){for(var b=0,_=A.length-1,I=null,D=null;b<=_;){var o=T(D=A[I=(b+_)/2|0]);if(o>0)b=I+1;else{if(!(o<0))return D;_=I-1}}return null}}},"./src/utils/buffer-helper.ts":function(P,C,f){f.r(C),f.d(C,"BufferHelper",function(){return b});var A=f("./src/utils/logger.ts"),T={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function _(){}return _.isBuffered=function(I,D){try{if(I){for(var o=_.getBuffered(I),S=0;S<o.length;S++)if(D>=o.start(S)&&D<=o.end(S))return!0}}catch{}return!1},_.bufferInfo=function(I,D,o){try{if(I){var S,m=_.getBuffered(I),c=[];for(S=0;S<m.length;S++)c.push({start:m.start(S),end:m.end(S)});return this.bufferedInfo(c,D,o)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},_.bufferedInfo=function(I,D,o){D=Math.max(0,D),I.sort(function(a,d){var E=a.start-d.start;return E||d.end-a.end});var S=[];if(o)for(var m=0;m<I.length;m++){var c=S.length;if(c){var p=S[c-1].end;I[m].start-p<o?I[m].end>p&&(S[c-1].end=I[m].end):S.push(I[m])}else S.push(I[m])}else S=I;for(var y,u=0,e=D,i=D,t=0;t<S.length;t++){var n=S[t].start,l=S[t].end;if(D+o>=n&&D<l)e=n,u=(i=l)-D;else if(D+o<n){y=n;break}}return{len:u,start:e||0,end:i||0,nextStart:y}},_.getBuffered=function(I){try{return I.buffered}catch(D){return A.logger.log("failed to get media.buffered",D),T}},_}()},"./src/utils/cea-608-parser.ts":function(P,C,f){f.r(C),f.d(C,"Row",function(){return n}),f.d(C,"CaptionScreen",function(){return l});var A,T,b=f("./src/utils/logger.ts"),_={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},I=function(v){var r=v;return _.hasOwnProperty(v)&&(r=_[v]),String.fromCharCode(r)},D=15,o=100,S={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},m={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(T=A||(A={}))[T.ERROR=0]="ERROR",T[T.TEXT=1]="TEXT",T[T.WARNING=2]="WARNING",T[T.INFO=2]="INFO",T[T.DEBUG=3]="DEBUG",T[T.DATA=3]="DATA";var u=function(){function v(){this.time=null,this.verboseLevel=A.ERROR}return v.prototype.log=function(r,s){this.verboseLevel>=r&&b.logger.log(this.time+" ["+r+"] "+s)},v}(),e=function(v){for(var r=[],s=0;s<v.length;s++)r.push(v[s].toString(16));return r},i=function(){function v(s,h,k,L,R){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=s||"white",this.underline=h||!1,this.italics=k||!1,this.background=L||"black",this.flash=R||!1}var r=v.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(s){for(var h=["foreground","underline","italics","background","flash"],k=0;k<h.length;k++){var L=h[k];s.hasOwnProperty(L)&&(this[L]=s[L])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(s){return this.foreground===s.foreground&&this.underline===s.underline&&this.italics===s.italics&&this.background===s.background&&this.flash===s.flash},r.copy=function(s){this.foreground=s.foreground,this.underline=s.underline,this.italics=s.italics,this.background=s.background,this.flash=s.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),t=function(){function v(s,h,k,L,R,O){this.uchar=void 0,this.penState=void 0,this.uchar=s||" ",this.penState=new i(h,k,L,R,O)}var r=v.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(s,h){this.uchar=s,this.penState.copy(h)},r.setPenState=function(s){this.penState.copy(s)},r.equals=function(s){return this.uchar===s.uchar&&this.penState.equals(s.penState)},r.copy=function(s){this.uchar=s.uchar,this.penState.copy(s.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),n=function(){function v(s){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var h=0;h<o;h++)this.chars.push(new t);this.logger=s,this.pos=0,this.currPenState=new i}var r=v.prototype;return r.equals=function(s){for(var h=!0,k=0;k<o;k++)if(!this.chars[k].equals(s.chars[k])){h=!1;break}return h},r.copy=function(s){for(var h=0;h<o;h++)this.chars[h].copy(s.chars[h])},r.isEmpty=function(){for(var s=!0,h=0;h<o;h++)if(!this.chars[h].isEmpty()){s=!1;break}return s},r.setCursor=function(s){this.pos!==s&&(this.pos=s),this.pos<0?(this.logger.log(A.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(A.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},r.moveCursor=function(s){var h=this.pos+s;if(s>1)for(var k=this.pos+1;k<h+1;k++)this.chars[k].setPenState(this.currPenState);this.setCursor(h)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(s){s>=144&&this.backSpace();var h=I(s);this.pos>=o?this.logger.log(A.ERROR,"Cannot insert "+s.toString(16)+" ("+h+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(h,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(s){var h;for(h=s;h<o;h++)this.chars[h].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var s=[],h=!0,k=0;k<o;k++){var L=this.chars[k].uchar;L!==" "&&(h=!1),s.push(L)}return h?"":s.join("")},r.setPenStyles=function(s){this.currPenState.setStyles(s),this.chars[this.pos].setPenState(this.currPenState)},v}(),l=function(){function v(s){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var h=0;h<D;h++)this.rows.push(new n(s));this.logger=s,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=v.prototype;return r.reset=function(){for(var s=0;s<D;s++)this.rows[s].clear();this.currRow=14},r.equals=function(s){for(var h=!0,k=0;k<D;k++)if(!this.rows[k].equals(s.rows[k])){h=!1;break}return h},r.copy=function(s){for(var h=0;h<D;h++)this.rows[h].copy(s.rows[h])},r.isEmpty=function(){for(var s=!0,h=0;h<D;h++)if(!this.rows[h].isEmpty()){s=!1;break}return s},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(s){this.rows[this.currRow].insertChar(s)},r.setPen=function(s){this.rows[this.currRow].setPenStyles(s)},r.moveCursor=function(s){this.rows[this.currRow].moveCursor(s)},r.setCursor=function(s){this.logger.log(A.INFO,"setCursor: "+s),this.rows[this.currRow].setCursor(s)},r.setPAC=function(s){this.logger.log(A.INFO,"pacData = "+JSON.stringify(s));var h=s.row-1;if(this.nrRollUpRows&&h<this.nrRollUpRows-1&&(h=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==h){for(var k=0;k<D;k++)this.rows[k].clear();var L=this.currRow+1-this.nrRollUpRows,R=this.lastOutputScreen;if(R){var O=R.rows[L].cueStartTime,w=this.logger.time;if(O&&w!==null&&O<w)for(var x=0;x<this.nrRollUpRows;x++)this.rows[h-this.nrRollUpRows+x+1].copy(R.rows[L+x])}}this.currRow=h;var F=this.rows[this.currRow];if(s.indent!==null){var M=s.indent,B=Math.max(M-1,0);F.setCursor(s.indent),s.color=F.chars[B].penState.foreground}var U={foreground:s.color,underline:s.underline,italics:s.italics,background:"black",flash:!1};this.setPen(U)},r.setBkgData=function(s){this.logger.log(A.INFO,"bkgData = "+JSON.stringify(s)),this.backSpace(),this.setPen(s),this.insertChar(32)},r.setRollUpRows=function(s){this.nrRollUpRows=s},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(A.TEXT,this.getDisplayText());var s=this.currRow+1-this.nrRollUpRows,h=this.rows.splice(s,1)[0];h.clear(),this.rows.splice(this.currRow,0,h),this.logger.log(A.INFO,"Rolling up")}else this.logger.log(A.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(s){s=s||!1;for(var h=[],k="",L=-1,R=0;R<D;R++){var O=this.rows[R].getTextString();O&&(L=R+1,s?h.push("Row "+L+": '"+O+"'"):h.push(O.trim()))}return h.length>0&&(k=s?"["+h.join(" | ")+"]":h.join(`
`)),k},r.getTextAndFormat=function(){return this.rows},v}(),a=function(){function v(s,h,k){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=s,this.outputFilter=h,this.mode=null,this.verbose=0,this.displayedMemory=new l(k),this.nonDisplayedMemory=new l(k),this.lastOutputScreen=new l(k),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=k}var r=v.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(s){this.outputFilter=s},r.setPAC=function(s){this.writeScreen.setPAC(s)},r.setBkgData=function(s){this.writeScreen.setBkgData(s)},r.setMode=function(s){s!==this.mode&&(this.mode=s,this.logger.log(A.INFO,"MODE="+s),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=s)},r.insertChars=function(s){for(var h=0;h<s.length;h++)this.writeScreen.insertChar(s[h]);var k=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(A.INFO,k+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(A.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(A.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(A.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(A.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(s){this.logger.log(A.INFO,"RU("+s+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(s)},r.ccFON=function(){this.logger.log(A.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(A.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(A.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(A.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(A.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(A.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(A.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(A.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var s=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=s,this.writeScreen=this.nonDisplayedMemory,this.logger.log(A.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(s){this.logger.log(A.INFO,"TO("+s+") - Tab Offset"),this.writeScreen.moveCursor(s)},r.ccMIDROW=function(s){var h={flash:!1};if(h.underline=s%2==1,h.italics=s>=46,h.italics)h.foreground="white";else{var k=Math.floor(s/2)-16;h.foreground=["white","green","blue","cyan","red","yellow","magenta"][k]}this.logger.log(A.INFO,"MIDROW: "+JSON.stringify(h)),this.writeScreen.setPen(h)},r.outputDataUpdate=function(s){s===void 0&&(s=!1);var h=this.logger.time;h!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,h,this.lastOutputScreen),s&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:h):this.cueStartTime=h,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(s){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,s,this.displayedMemory),this.cueStartTime=s))},v}(),d=function(){function v(s,h,k){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var L=new u;this.channels=[null,new a(s,h,L),new a(s+1,k,L)],this.cmdHistory={a:null,b:null},this.logger=L}var r=v.prototype;return r.getHandler=function(s){return this.channels[s].getHandler()},r.setHandler=function(s,h){this.channels[s].setHandler(h)},r.addData=function(s,h){var k,L,R,O=!1;this.logger.time=s;for(var w=0;w<h.length;w+=2)if(L=127&h[w],R=127&h[w+1],L!==0||R!==0){if(this.logger.log(A.DATA,"["+e([h[w],h[w+1]])+"] -> ("+e([L,R])+")"),(k=this.parseCmd(L,R))||(k=this.parseMidrow(L,R)),k||(k=this.parsePAC(L,R)),k||(k=this.parseBackgroundAttributes(L,R)),!k&&(O=this.parseChars(L,R))){var x=this.currentChannel;x&&x>0?this.channels[x].insertChars(O):this.logger.log(A.WARNING,"No channel found yet. TEXT-MODE?")}k||O||this.logger.log(A.WARNING,"Couldn't parse cleaned data "+e([L,R])+" orig: "+e([h[w],h[w+1]]))}},r.parseCmd=function(s,h){var k=this.cmdHistory;if(!((s===20||s===28||s===21||s===29)&&h>=32&&h<=47||(s===23||s===31)&&h>=33&&h<=35))return!1;if(g(s,h,k))return E(null,null,k),this.logger.log(A.DEBUG,"Repeated command ("+e([s,h])+") is dropped"),!0;var L=s===20||s===21||s===23?1:2,R=this.channels[L];return s===20||s===21||s===28||s===29?h===32?R.ccRCL():h===33?R.ccBS():h===34?R.ccAOF():h===35?R.ccAON():h===36?R.ccDER():h===37?R.ccRU(2):h===38?R.ccRU(3):h===39?R.ccRU(4):h===40?R.ccFON():h===41?R.ccRDC():h===42?R.ccTR():h===43?R.ccRTD():h===44?R.ccEDM():h===45?R.ccCR():h===46?R.ccENM():h===47&&R.ccEOC():R.ccTO(h-32),E(s,h,k),this.currentChannel=L,!0},r.parseMidrow=function(s,h){var k=0;if((s===17||s===25)&&h>=32&&h<=47){if((k=s===17?1:2)!==this.currentChannel)return this.logger.log(A.ERROR,"Mismatch channel in midrow parsing"),!1;var L=this.channels[k];return!!L&&(L.ccMIDROW(h),this.logger.log(A.DEBUG,"MIDROW ("+e([s,h])+")"),!0)}return!1},r.parsePAC=function(s,h){var k,L=this.cmdHistory;if(!((s>=17&&s<=23||s>=25&&s<=31)&&h>=64&&h<=127||(s===16||s===24)&&h>=64&&h<=95))return!1;if(g(s,h,L))return E(null,null,L),!0;var R=s<=23?1:2;k=h>=64&&h<=95?R===1?S[s]:c[s]:R===1?m[s]:p[s];var O=this.channels[R];return!!O&&(O.setPAC(this.interpretPAC(k,h)),E(s,h,L),this.currentChannel=R,!0)},r.interpretPAC=function(s,h){var k,L={color:null,italics:!1,indent:null,underline:!1,row:s};return k=h>95?h-96:h-64,L.underline=(1&k)==1,k<=13?L.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(k/2)]:k<=15?(L.italics=!0,L.color="white"):L.indent=4*Math.floor((k-16)/2),L},r.parseChars=function(s,h){var k,L,R=null,O=null;if(s>=25?(k=2,O=s-8):(k=1,O=s),O>=17&&O<=19?(L=O===17?h+80:O===18?h+112:h+144,this.logger.log(A.INFO,"Special char '"+I(L)+"' in channel "+k),R=[L]):s>=32&&s<=127&&(R=h===0?[s]:[s,h]),R){var w=e(R);this.logger.log(A.DEBUG,"Char codes =  "+w.join(",")),E(s,h,this.cmdHistory)}return R},r.parseBackgroundAttributes=function(s,h){var k;if(!((s===16||s===24)&&h>=32&&h<=47||(s===23||s===31)&&h>=45&&h<=47))return!1;var L={};s===16||s===24?(k=Math.floor((h-32)/2),L.background=y[k],h%2==1&&(L.background=L.background+"_semi")):h===45?L.background="transparent":(L.foreground="black",h===47&&(L.underline=!0));var R=s<=23?1:2;return this.channels[R].setBkgData(L),E(s,h,this.cmdHistory),!0},r.reset=function(){for(var s=0;s<Object.keys(this.channels).length;s++){var h=this.channels[s];h&&h.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(s){for(var h=0;h<this.channels.length;h++){var k=this.channels[h];k&&k.cueSplitAtTime(s)}},v}();function E(v,r,s){s.a=v,s.b=r}function g(v,r,s){return s.a===v&&s.b===r}C.default=d},"./src/utils/codecs.ts":function(P,C,f){f.r(C),f.d(C,"isCodecType",function(){return T}),f.d(C,"isCodecSupportedInMp4",function(){return b});var A={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function T(_,I){var D=A[I];return!!D&&D[_.slice(0,4)]===!0}function b(_,I){return MediaSource.isTypeSupported((I||"video")+'/mp4;codecs="'+_+'"')}},"./src/utils/cues.ts":function(P,C,f){f.r(C);var A=f("./src/utils/vttparser.ts"),T=f("./src/utils/webvtt-parser.ts"),b=f("./src/utils/texttrack-utils.ts"),_=/\s/,I={newCue:function(D,o,S,m){for(var c,p,y,u,e,i=[],t=self.VTTCue||self.TextTrackCue,n=0;n<m.rows.length;n++)if(y=!0,u=0,e="",!(c=m.rows[n]).isEmpty()){for(var l=0;l<c.chars.length;l++)_.test(c.chars[l].uchar)&&y?u++:(e+=c.chars[l].uchar,y=!1);c.cueStartTime=o,o===S&&(S+=1e-4),u>=16?u--:u++;var a=Object(A.fixLineBreaks)(e.trim()),d=Object(T.generateCueId)(o,S,a);D&&D.cues&&D.cues.getCueById(d)||((p=new t(o,S,a)).id=d,p.line=n+1,p.align="left",p.position=10+Math.min(80,10*Math.floor(8*u/32)),i.push(p))}return D&&i.length&&(i.sort(function(E,g){return E.line==="auto"||g.line==="auto"?0:E.line>8&&g.line>8?g.line-E.line:E.line-g.line}),i.forEach(function(E){return Object(b.addCueToTrack)(D,E)})),i}};C.default=I},"./src/utils/discontinuities.ts":function(P,C,f){f.r(C),f.d(C,"findFirstFragWithCC",function(){return _}),f.d(C,"shouldAlignOnDiscontinuities",function(){return I}),f.d(C,"findDiscontinuousReferenceFrag",function(){return D}),f.d(C,"adjustSlidingStart",function(){return S}),f.d(C,"alignStream",function(){return m}),f.d(C,"alignPDT",function(){return c});var A=f("./src/polyfills/number.ts"),T=f("./src/utils/logger.ts"),b=f("./src/controller/level-helper.ts");function _(p,y){for(var u=null,e=0,i=p.length;e<i;e++){var t=p[e];if(t&&t.cc===y){u=t;break}}return u}function I(p,y,u){return!(!y.details||!(u.endCC>u.startCC||p&&p.cc<u.startCC))}function D(p,y){var u=p.fragments,e=y.fragments;if(e.length&&u.length){var i=_(u,e[0].cc);if(i&&(!i||i.startPTS))return i;T.logger.log("No frag in previous level to align on")}else T.logger.log("No fragments to align")}function o(p,y){if(p){var u=p.start+y;p.start=p.startPTS=u,p.endPTS=u+p.duration}}function S(p,y){for(var u=y.fragments,e=0,i=u.length;e<i;e++)o(u[e],p);y.fragmentHint&&o(y.fragmentHint,p),y.alignedSliding=!0}function m(p,y,u){y&&(function(e,i,t){if(I(e,t,i)){var n=D(t.details,i);n&&Object(A.isFiniteNumber)(n.start)&&(T.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),S(n.start,i))}}(p,u,y),!u.alignedSliding&&y.details&&c(u,y.details),u.alignedSliding||!y.details||u.skippedSegments||Object(b.adjustSliding)(y.details,u))}function c(p,y){if(y.fragments.length&&p.hasProgramDateTime&&y.hasProgramDateTime){var u=y.fragments[0].programDateTime,e=p.fragments[0].programDateTime,i=(e-u)/1e3+y.fragments[0].start;i&&Object(A.isFiniteNumber)(i)&&(T.logger.log("Adjusting PTS using programDateTime delta "+(e-u)+"ms, sliding:"+i.toFixed(3)+" "+p.url+" "),S(i,p))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(P,C,f){f.r(C);var A=f("./src/utils/ewma.ts"),T=function(){function b(I,D,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new A.default(I),this.fast_=new A.default(D)}var _=b.prototype;return _.update=function(I,D){var o=this.slow_,S=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new A.default(I,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new A.default(D,S.getEstimate(),S.getTotalWeight()))},_.sample=function(I,D){var o=(I=Math.max(I,this.minDelayMs_))/1e3,S=8*D/o;this.fast_.sample(o,S),this.slow_.sample(o,S)},_.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},_.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},_.destroy=function(){},b}();C.default=T},"./src/utils/ewma.ts":function(P,C,f){f.r(C);var A=function(){function T(_,I,D){I===void 0&&(I=0),D===void 0&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=_,this.alpha_=_?Math.exp(Math.log(.5)/_):0,this.estimate_=I,this.totalWeight_=D}var b=T.prototype;return b.sample=function(_,I){var D=Math.pow(this.alpha_,_);this.estimate_=I*(1-D)+D*this.estimate_,this.totalWeight_+=_},b.getTotalWeight=function(){return this.totalWeight_},b.getEstimate=function(){if(this.alpha_){var _=1-Math.pow(this.alpha_,this.totalWeight_);if(_)return this.estimate_/_}return this.estimate_},T}();C.default=A},"./src/utils/fetch-loader.ts":function(P,C,f){f.r(C),f.d(C,"fetchSupported",function(){return m});var A=f("./src/polyfills/number.ts"),T=f("./src/loader/load-stats.ts"),b=f("./src/demux/chunk-cache.ts");function _(u){var e=typeof Map=="function"?new Map:void 0;return(_=function(i){if(i===null||(t=i,Function.toString.call(t).indexOf("[native code]")===-1))return i;var t;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,n)}function n(){return I(i,arguments,S(this).constructor)}return n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,i)})(u)}function I(u,e,i){return(I=D()?Reflect.construct:function(t,n,l){var a=[null];a.push.apply(a,n);var d=new(Function.bind.apply(t,a));return l&&o(d,l.prototype),d}).apply(null,arguments)}function D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(u,e){return(o=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(u,e)}function S(u){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(u)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var c=function(){function u(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||p,this.controller=new self.AbortController,this.stats=new T.LoadStats}var e=u.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var i=this.response;i&&i.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(i,t,n){var l=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var d=function(r,s){var h={method:"GET",mode:"cors",credentials:"same-origin",signal:s};return r.rangeEnd&&(h.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),h}(i,this.controller.signal),E=n.onProgress,g=i.responseType==="arraybuffer",v=g?"byteLength":"length";this.context=i,this.config=t,this.callbacks=n,this.request=this.fetchSetup(i,d),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){l.abortInternal(),n.onTimeout(a,i,l.response)},t.timeout),self.fetch(this.request).then(function(r){if(l.response=l.loader=r,!r.ok){var s=r.status,h=r.statusText;throw new y(h||"fetch, bad network response",s,r)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(r.headers.get("Content-Length")||"0"),E&&Object(A.isFiniteNumber)(t.highWaterMark)?l.loadProgressively(r,a,i,t.highWaterMark,E):g?r.arrayBuffer():r.text()}).then(function(r){var s=l.response;self.clearTimeout(l.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=r[v];var h={url:s.url,data:r};E&&!Object(A.isFiniteNumber)(t.highWaterMark)&&E(a,i,r,s),n.onSuccess(h,a,i,s)}).catch(function(r){if(self.clearTimeout(l.requestTimeout),!a.aborted){var s=r.code||0;n.onError({code:s,text:r.message},i,r.details)}})},e.getCacheAge=function(){var i=null;if(this.response){var t=this.response.headers.get("age");i=t?parseFloat(t):null}return i},e.loadProgressively=function(i,t,n,l,a){l===void 0&&(l=0);var d=new b.default,E=i.body.getReader();return function g(){return E.read().then(function(v){if(v.done)return d.dataLength&&a(t,n,d.flush(),i),Promise.resolve(new ArrayBuffer(0));var r=v.value,s=r.length;return t.loaded+=s,s<l||d.dataLength?(d.push(r),d.dataLength>=l&&a(t,n,d.flush(),i)):a(t,n,r,i),g()}).catch(function(){return Promise.reject()})}()},u}();function p(u,e){return new self.Request(u.url,e)}var y=function(u){var e,i;function t(n,l,a){var d;return(d=u.call(this,n)||this).code=void 0,d.details=void 0,d.code=l,d.details=a,d}return i=u,(e=t).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i),t}(_(Error));C.default=c},"./src/utils/imsc1-ttml-parser.ts":function(P,C,f){f.r(C),f.d(C,"IMSC1_CODEC",function(){return S}),f.d(C,"parseIMSC1",function(){return y});var A=f("./src/utils/mp4-tools.ts"),T=f("./src/utils/vttparser.ts"),b=f("./src/utils/vttcue.ts"),_=f("./src/demux/id3.ts"),I=f("./src/utils/timescale-conversion.ts"),D=f("./src/utils/webvtt-parser.ts");function o(){return(o=Object.assign||function(a){for(var d=1;d<arguments.length;d++){var E=arguments[d];for(var g in E)Object.prototype.hasOwnProperty.call(E,g)&&(a[g]=E[g])}return a}).apply(this,arguments)}var S="stpp.ttml.im1t",m=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,c=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(a,d,E,g,v){var r=Object(A.findBox)(new Uint8Array(a),["mdat"]);if(r.length!==0){var s=r[0],h=Object(_.utf8ArrayToStr)(new Uint8Array(a,s.start,s.end-s.start)),k=Object(I.toTimescaleFromScale)(d,1,E);try{g(function(L,R){var O=new DOMParser().parseFromString(L,"text/xml").getElementsByTagName("tt")[0];if(!O)throw new Error("Invalid ttml");var w={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},x=Object.keys(w).reduce(function(G,V){return G[V]=O.getAttribute("ttp:"+V)||w[V],G},{}),F=O.getAttribute("xml:space")!=="preserve",M=e(u(O,"styling","style")),B=e(u(O,"layout","region")),U=u(O,"body","[begin]");return[].map.call(U,function(G){var V=i(G,F);if(!V||!G.hasAttribute("begin"))return null;var W=l(G.getAttribute("begin"),x),Y=l(G.getAttribute("dur"),x),Z=l(G.getAttribute("end"),x);if(W===null)throw n(G);if(Z===null){if(Y===null)throw n(G);Z=W+Y}var Q=new b.default(W-R,Z-R,V);Q.id=Object(D.generateCueId)(Q.startTime,Q.endTime,Q.text);var z=B[G.getAttribute("region")],ie=M[G.getAttribute("style")];Q.position=10,Q.size=80;var ae=function(ce,re){var ne="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(fe,ue){var ve=t(re,ne,ue)||t(ce,ne,ue);return ve&&(fe[ue]=ve),fe},{})}(z,ie),le=ae.textAlign;if(le){var te=p[le];te&&(Q.lineAlign=te),Q.align=le}return o(Q,ae),Q}).filter(function(G){return G!==null})}(h,k))}catch(L){v(L)}}else v(new Error("Could not parse IMSC1 mdat"))}function u(a,d,E){var g=a.getElementsByTagName(d)[0];return g?[].slice.call(g.querySelectorAll(E)):[]}function e(a){return a.reduce(function(d,E){var g=E.getAttribute("xml:id");return g&&(d[g]=E),d},{})}function i(a,d){return[].slice.call(a.childNodes).reduce(function(E,g,v){var r;return g.nodeName==="br"&&v?E+`
`:(r=g.childNodes)!==null&&r!==void 0&&r.length?i(g,d):d?E+g.textContent.trim().replace(/\s+/g," "):E+g.textContent},"")}function t(a,d,E){return a.hasAttributeNS(d,E)?a.getAttributeNS(d,E):null}function n(a){return new Error("Could not parse ttml timestamp "+a)}function l(a,d){if(!a)return null;var E=Object(T.parseTimeStamp)(a);return E===null&&(m.test(a)?E=function(g,v){var r=m.exec(g),s=(0|r[4])+(0|r[5])/v.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+s/v.frameRate}(a,d):c.test(a)&&(E=function(g,v){var r=c.exec(g),s=Number(r[1]);switch(r[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/v.frameRate;case"t":return s/v.tickRate}return s}(a,d))),E}},"./src/utils/logger.ts":function(P,C,f){f.r(C),f.d(C,"enableLogs",function(){return I}),f.d(C,"logger",function(){return D});var A=function(){},T={trace:A,debug:A,log:A,warn:A,info:A,error:A},b=T;function _(o){var S=self.console[o];return S?S.bind(self.console,"["+o+"] >"):A}function I(o){if(self.console&&o===!0||typeof o=="object"){(function(S){for(var m=arguments.length,c=new Array(m>1?m-1:0),p=1;p<m;p++)c[p-1]=arguments[p];c.forEach(function(y){b[y]=S[y]?S[y].bind(S):_(y)})})(o,"debug","log","info","warn","error");try{b.log()}catch{b=T}}else b=T}var D=T},"./src/utils/mediakeys-helper.ts":function(P,C,f){var A,T;f.r(C),f.d(C,"KeySystems",function(){return A}),f.d(C,"requestMediaKeySystemAccess",function(){return b}),(T=A||(A={})).WIDEVINE="com.widevine.alpha",T.PLAYREADY="com.microsoft.playready";var b=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(P,C,f){function A(){return self.MediaSource||self.WebKitMediaSource}f.r(C),f.d(C,"getMediaSource",function(){return A})},"./src/utils/mp4-tools.ts":function(P,C,f){f.r(C),f.d(C,"bin2str",function(){return I}),f.d(C,"readUint16",function(){return D}),f.d(C,"readUint32",function(){return o}),f.d(C,"writeUint32",function(){return S}),f.d(C,"findBox",function(){return m}),f.d(C,"parseSegmentIndex",function(){return c}),f.d(C,"parseInitSegment",function(){return p}),f.d(C,"getStartDTS",function(){return y}),f.d(C,"getDuration",function(){return u}),f.d(C,"computeRawDurationFromSamples",function(){return e}),f.d(C,"offsetStartDTS",function(){return i}),f.d(C,"segmentValidRange",function(){return t}),f.d(C,"appendUint8Array",function(){return n});var A=f("./src/utils/typed-array.ts"),T=f("./src/loader/fragment.ts"),b=Math.pow(2,32)-1,_=[].push;function I(l){return String.fromCharCode.apply(null,l)}function D(l,a){"data"in l&&(a+=l.start,l=l.data);var d=l[a]<<8|l[a+1];return d<0?65536+d:d}function o(l,a){"data"in l&&(a+=l.start,l=l.data);var d=l[a]<<24|l[a+1]<<16|l[a+2]<<8|l[a+3];return d<0?4294967296+d:d}function S(l,a,d){"data"in l&&(a+=l.start,l=l.data),l[a]=d>>24,l[a+1]=d>>16&255,l[a+2]=d>>8&255,l[a+3]=255&d}function m(l,a){var d,E,g,v=[];if(!a.length)return v;"data"in l?(d=l.data,E=l.start,g=l.end):(E=0,g=(d=l).byteLength);for(var r=E;r<g;){var s=o(d,r),h=s>1?r+s:g;if(I(d.subarray(r+4,r+8))===a[0])if(a.length===1)v.push({data:d,start:r+8,end:h});else{var k=m({data:d,start:r+8,end:h},a.slice(1));k.length&&_.apply(v,k)}r=h}return v}function c(l){var a=m(l,["moov"])[0],d=a?a.end:null,E=m(l,["sidx"]);if(!E||!E[0])return null;var g=[],v=E[0],r=v.data[0],s=r===0?8:16,h=o(v,s);s+=4,s+=r===0?8:16,s+=2;var k=v.end+0,L=D(v,s);s+=2;for(var R=0;R<L;R++){var O=s,w=o(v,O);O+=4;var x=2147483647&w;if((2147483648&w)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var F=o(v,O);O+=4,g.push({referenceSize:x,subsegmentDuration:F,info:{duration:F/h,start:k,end:k+x-1}}),k+=x,s=O+=4}return{earliestPresentationTime:0,timescale:h,version:r,referencesCount:L,references:g,moovEndOffset:d}}function p(l){for(var a=[],d=m(l,["moov","trak"]),E=0;E<d.length;E++){var g=d[E],v=m(g,["tkhd"])[0];if(v){var r=v.data[v.start],s=r===0?12:20,h=o(v,s),k=m(g,["mdia","mdhd"])[0];if(k){var L=o(k,s=(r=k.data[k.start])===0?12:20),R=m(g,["mdia","hdlr"])[0];if(R){var O=I(R.data.subarray(R.start+8,R.start+12)),w={soun:T.ElementaryStreamTypes.AUDIO,vide:T.ElementaryStreamTypes.VIDEO}[O];if(w){var x=m(g,["mdia","minf","stbl","stsd"])[0],F=void 0;x&&(F=I(x.data.subarray(x.start+12,x.start+16))),a[h]={timescale:L,type:w},a[w]={timescale:L,id:h,codec:F}}}}}}return m(l,["moov","mvex","trex"]).forEach(function(M){var B=o(M,4),U=a[B];U&&(U.default={duration:o(M,12),flags:o(M,20)})}),a}function y(l,a){return m(a,["moof","traf"]).reduce(function(d,E){var g=m(E,["tfdt"])[0],v=g.data[g.start],r=m(E,["tfhd"]).reduce(function(s,h){var k=o(h,4),L=l[k];if(L){var R=o(g,4);v===1&&(R*=Math.pow(2,32),R+=o(g,8));var O=R/(L.timescale||9e4);if(isFinite(O)&&(s===null||O<s))return O}return s},null);return r!==null&&isFinite(r)&&(d===null||r<d)?r:d},null)||0}function u(l,a){for(var d=0,E=0,g=0,v=m(l,["moof","traf"]),r=0;r<v.length;r++){var s=v[r],h=m(s,["tfhd"])[0],k=a[o(h,4)];if(k){var L=k.default,R=o(h,0)|(L==null?void 0:L.flags),O=L==null?void 0:L.duration;8&R&&(O=o(h,2&R?12:8));for(var w=k.timescale||9e4,x=m(s,["trun"]),F=0;F<x.length;F++)d=O?O*o(x[F],4):e(x[F]),k.type===T.ElementaryStreamTypes.VIDEO?E+=d/w:k.type===T.ElementaryStreamTypes.AUDIO&&(g+=d/w)}}if(E===0&&g===0){var M=c(l);if(M!=null&&M.references)return M.references.reduce(function(B,U){return B+U.info.duration||0},0)}return E||g}function e(l){var a=o(l,0),d=8;1&a&&(d+=4),4&a&&(d+=4);for(var E=0,g=o(l,4),v=0;v<g;v++)256&a&&(E+=o(l,d),d+=4),512&a&&(d+=4),1024&a&&(d+=4),2048&a&&(d+=4);return E}function i(l,a,d){m(a,["moof","traf"]).forEach(function(E){m(E,["tfhd"]).forEach(function(g){var v=o(g,4),r=l[v];if(r){var s=r.timescale||9e4;m(E,["tfdt"]).forEach(function(h){var k=h.data[h.start],L=o(h,4);if(k===0)S(h,4,L-d*s);else{L*=Math.pow(2,32),L+=o(h,8),L-=d*s,L=Math.max(L,0);var R=Math.floor(L/(b+1)),O=Math.floor(L%(b+1));S(h,4,R),S(h,8,O)}})}})})}function t(l){var a={valid:null,remainder:null},d=m(l,["moof"]);if(!d)return a;if(d.length<2)return a.remainder=l,a;var E=d[d.length-1];return a.valid=Object(A.sliceUint8)(l,0,E.start-8),a.remainder=Object(A.sliceUint8)(l,E.start-8),a}function n(l,a){var d=new Uint8Array(l.length+a.length);return d.set(l),d.set(a,l.length),d}},"./src/utils/output-filter.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return A});var A=function(){function T(_,I){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=_,this.trackName=I}var b=T.prototype;return b.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(_,I,D){(this.startTime===null||this.startTime>_)&&(this.startTime=_),this.endTime=I,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[]},T}()},"./src/utils/texttrack-utils.ts":function(P,C,f){f.r(C),f.d(C,"sendAddTrackEvent",function(){return T}),f.d(C,"addCueToTrack",function(){return b}),f.d(C,"clearCurrentCues",function(){return _}),f.d(C,"removeCuesInRange",function(){return I}),f.d(C,"getCuesInRange",function(){return D});var A=f("./src/utils/logger.ts");function T(o,S){var m;try{m=new Event("addtrack")}catch{(m=document.createEvent("Event")).initEvent("addtrack",!1,!1)}m.track=o,S.dispatchEvent(m)}function b(o,S){var m=o.mode;if(m==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(S.id))try{if(o.addCue(S),!o.cues.getCueById(S.id))throw new Error("addCue is failed for: "+S)}catch(p){A.logger.debug("[texttrack-utils]: "+p);var c=new self.TextTrackCue(S.startTime,S.endTime,S.text);c.id=S.id,o.addCue(c)}m==="disabled"&&(o.mode=m)}function _(o){var S=o.mode;if(S==="disabled"&&(o.mode="hidden"),o.cues)for(var m=o.cues.length;m--;)o.removeCue(o.cues[m]);S==="disabled"&&(o.mode=S)}function I(o,S,m){var c=o.mode;if(c==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var p=D(o.cues,S,m),y=0;y<p.length;y++)o.removeCue(p[y]);c==="disabled"&&(o.mode=c)}function D(o,S,m){var c=[],p=function(i,t){if(t<i[0].startTime)return 0;var n=i.length-1;if(t>i[n].endTime)return-1;for(var l=0,a=n;l<=a;){var d=Math.floor((a+l)/2);if(t<i[d].startTime)a=d-1;else{if(!(t>i[d].startTime&&l<n))return d;l=d+1}}return i[l].startTime-t<t-i[a].startTime?l:a}(o,S);if(p>-1)for(var y=p,u=o.length;y<u;y++){var e=o[y];if(e.startTime>=S&&e.endTime<=m)c.push(e);else if(e.startTime>m)return c}return c}},"./src/utils/time-ranges.ts":function(P,C,f){f.r(C),C.default={toString:function(A){for(var T="",b=A.length,_=0;_<b;_++)T+="["+A.start(_).toFixed(3)+","+A.end(_).toFixed(3)+"]";return T}}},"./src/utils/timescale-conversion.ts":function(P,C,f){function A(I,D,o,S){o===void 0&&(o=1),S===void 0&&(S=!1);var m=I*D*o;return S?Math.round(m):m}function T(I,D,o,S){return o===void 0&&(o=1),S===void 0&&(S=!1),A(I,D,1/o,S)}function b(I,D){return D===void 0&&(D=!1),A(I,1e3,1/9e4,D)}function _(I,D){return D===void 0&&(D=1),A(I,9e4,1/D)}f.r(C),f.d(C,"toTimescaleFromBase",function(){return A}),f.d(C,"toTimescaleFromScale",function(){return T}),f.d(C,"toMsFromMpegTsClock",function(){return b}),f.d(C,"toMpegTsClockFromTimescale",function(){return _})},"./src/utils/typed-array.ts":function(P,C,f){function A(T,b,_){return Uint8Array.prototype.slice?T.slice(b,_):new Uint8Array(Array.prototype.slice.call(T,b,_))}f.r(C),f.d(C,"sliceUint8",function(){return A})},"./src/utils/vttcue.ts":function(P,C,f){f.r(C),C.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var A=["","lr","rl"],T=["start","middle","end","left","right"];function b(o,S){if(typeof S!="string"||!Array.isArray(o))return!1;var m=S.toLowerCase();return!!~o.indexOf(m)&&m}function _(o){return b(T,o)}function I(o){for(var S=arguments.length,m=new Array(S>1?S-1:0),c=1;c<S;c++)m[c-1]=arguments[c];for(var p=1;p<arguments.length;p++){var y=arguments[p];for(var u in y)o[u]=y[u]}return o}function D(o,S,m){var c=this,p={enumerable:!0};c.hasBeenReset=!1;var y="",u=!1,e=o,i=S,t=m,n=null,l="",a=!0,d="auto",E="start",g=50,v="middle",r=50,s="middle";Object.defineProperty(c,"id",I({},p,{get:function(){return y},set:function(h){y=""+h}})),Object.defineProperty(c,"pauseOnExit",I({},p,{get:function(){return u},set:function(h){u=!!h}})),Object.defineProperty(c,"startTime",I({},p,{get:function(){return e},set:function(h){if(typeof h!="number")throw new TypeError("Start time must be set to a number.");e=h,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",I({},p,{get:function(){return i},set:function(h){if(typeof h!="number")throw new TypeError("End time must be set to a number.");i=h,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",I({},p,{get:function(){return t},set:function(h){t=""+h,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",I({},p,{get:function(){return n},set:function(h){n=h,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",I({},p,{get:function(){return l},set:function(h){var k=function(L){return b(A,L)}(h);if(k===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=k,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",I({},p,{get:function(){return a},set:function(h){a=!!h,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",I({},p,{get:function(){return d},set:function(h){if(typeof h!="number"&&h!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");d=h,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",I({},p,{get:function(){return E},set:function(h){var k=_(h);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");E=k,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",I({},p,{get:function(){return g},set:function(h){if(h<0||h>100)throw new Error("Position must be between 0 and 100.");g=h,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",I({},p,{get:function(){return v},set:function(h){var k=_(h);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");v=k,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",I({},p,{get:function(){return r},set:function(h){if(h<0||h>100)throw new Error("Size must be between 0 and 100.");r=h,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",I({},p,{get:function(){return s},set:function(h){var k=_(h);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");s=k,this.hasBeenReset=!0}})),c.displayState=void 0}return D.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":function(P,C,f){f.r(C),f.d(C,"parseTimeStamp",function(){return b}),f.d(C,"fixLineBreaks",function(){return m}),f.d(C,"VTTParser",function(){return c});var A=f("./src/utils/vttcue.ts"),T=function(){function p(){}return p.prototype.decode=function(y,u){if(!y)return"";if(typeof y!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(y))},p}();function b(p){function y(e,i,t,n){return 3600*(0|e)+60*(0|i)+(0|t)+parseFloat(n||0)}var u=p.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return u?parseFloat(u[2])>59?y(u[2],u[3],0,u[4]):y(u[1],u[2],u[3],u[4]):null}var _=function(){function p(){this.values=Object.create(null)}var y=p.prototype;return y.set=function(u,e){this.get(u)||e===""||(this.values[u]=e)},y.get=function(u,e,i){return i?this.has(u)?this.values[u]:e[i]:this.has(u)?this.values[u]:e},y.has=function(u){return u in this.values},y.alt=function(u,e,i){for(var t=0;t<i.length;++t)if(e===i[t]){this.set(u,e);break}},y.integer=function(u,e){/^-?\d+$/.test(e)&&this.set(u,parseInt(e,10))},y.percent=function(u,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var i=parseFloat(e);if(i>=0&&i<=100)return this.set(u,i),!0}return!1},p}();function I(p,y,u,e){var i=e?p.split(e):[p];for(var t in i)if(typeof i[t]=="string"){var n=i[t].split(u);n.length===2&&y(n[0],n[1])}}var D=new A.default(0,0,""),o=D.align==="middle"?"middle":"center";function S(p,y,u){var e=p;function i(){var n=b(p);if(n===null)throw new Error("Malformed timestamp: "+e);return p=p.replace(/^[^\sa-zA-Z-]+/,""),n}function t(){p=p.replace(/^\s+/,"")}if(t(),y.startTime=i(),t(),p.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);p=p.substr(3),t(),y.endTime=i(),t(),function(n,l){var a=new _;I(n,function(g,v){var r;switch(g){case"region":for(var s=u.length-1;s>=0;s--)if(u[s].id===v){a.set(g,u[s].region);break}break;case"vertical":a.alt(g,v,["rl","lr"]);break;case"line":r=v.split(","),a.integer(g,r[0]),a.percent(g,r[0])&&a.set("snapToLines",!1),a.alt(g,r[0],["auto"]),r.length===2&&a.alt("lineAlign",r[1],["start",o,"end"]);break;case"position":r=v.split(","),a.percent(g,r[0]),r.length===2&&a.alt("positionAlign",r[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":a.percent(g,v);break;case"align":a.alt(g,v,["start",o,"end","left","right"])}},/:/,/\s/),l.region=a.get("region",null),l.vertical=a.get("vertical","");var d=a.get("line","auto");d==="auto"&&D.line===-1&&(d=-1),l.line=d,l.lineAlign=a.get("lineAlign","start"),l.snapToLines=a.get("snapToLines",!0),l.size=a.get("size",100),l.align=a.get("align",o);var E=a.get("position","auto");E==="auto"&&D.position===50&&(E=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=E}(p,y)}function m(p){return p.replace(/<br(?: \/)?>/gi,`
`)}var c=function(){function p(){this.state="INITIAL",this.buffer="",this.decoder=new T,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=p.prototype;return y.parse=function(u){var e=this;function i(){var d=e.buffer,E=0;for(d=m(d);E<d.length&&d[E]!=="\r"&&d[E]!==`
`;)++E;var g=d.substr(0,E);return d[E]==="\r"&&++E,d[E]===`
`&&++E,e.buffer=d.substr(E),g}u&&(e.buffer+=e.decoder.decode(u,{stream:!0}));try{var t="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;var n=(t=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var l=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(l?l=!1:t=i(),e.state){case"HEADER":/:/.test(t)?I(t,function(d,E){},/:/):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new A.default(0,0,""),e.state="CUE",t.indexOf("-->")===-1){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{S(t,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var a=t.indexOf("-->")!==-1;if(!t||a&&(l=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=t;continue;case"BADCUE":t||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var u=this;try{if((u.cue||u.state==="HEADER")&&(u.buffer+=`

`,u.parse()),u.state==="INITIAL"||u.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){u.onparsingerror&&u.onparsingerror(e)}return u.onflush&&u.onflush(),this},p}()},"./src/utils/webvtt-parser.ts":function(P,C,f){f.r(C),f.d(C,"generateCueId",function(){return m}),f.d(C,"parseWebVTT",function(){return c});var A=f("./src/polyfills/number.ts"),T=f("./src/utils/vttparser.ts"),b=f("./src/demux/id3.ts"),_=f("./src/utils/timescale-conversion.ts"),I=f("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,o=function(p,y,u){return u===void 0&&(u=0),p.substr(u,y.length)===y},S=function(p){for(var y=5381,u=p.length;u;)y=33*y^p.charCodeAt(--u);return(y>>>0).toString()};function m(p,y,u){return S(p.toString())+S(y.toString())+S(u)}function c(p,y,u,e,i,t,n,l){var a,d=new T.VTTParser,E=Object(b.utf8ArrayToStr)(new Uint8Array(p)).trim().replace(D,`
`).split(`
`),g=[],v=Object(_.toMpegTsClockFromTimescale)(y,u),r="00:00.000",s=0,h=0,k=!0,L=!1;d.oncue=function(R){var O=e[i],w=e.ccOffset,x=(s-v)/9e4;if(O!=null&&O.new&&(h!==void 0?w=e.ccOffset=O.start:function(U,G,V){var W=U[G],Y=U[W.prevCC];if(!Y||!Y.new&&W.new)return U.ccOffset=U.presentationOffset=W.start,void(W.new=!1);for(;(Z=Y)!==null&&Z!==void 0&&Z.new;){var Z;U.ccOffset+=W.start-Y.start,W.new=!1,Y=U[(W=Y).prevCC]}U.presentationOffset=V}(e,i,x)),x&&(w=x-e.presentationOffset),L){var F=R.endTime-R.startTime,M=Object(I.normalizePts)(9e4*(R.startTime+w-h),9e4*t)/9e4;R.startTime=M,R.endTime=M+F}var B=R.text.trim();R.text=decodeURIComponent(encodeURIComponent(B)),R.id||(R.id=m(R.startTime,R.endTime,B)),R.endTime>0&&g.push(R)},d.onparsingerror=function(R){a=R},d.onflush=function(){a?l(a):n(g)},E.forEach(function(R){if(k){if(o(R,"X-TIMESTAMP-MAP=")){k=!1,L=!0,R.substr(16).split(",").forEach(function(O){o(O,"LOCAL:")?r=O.substr(6):o(O,"MPEGTS:")&&(s=parseInt(O.substr(7)))});try{h=function(O){var w=parseInt(O.substr(-3)),x=parseInt(O.substr(-6,2)),F=parseInt(O.substr(-9,2)),M=O.length>9?parseInt(O.substr(0,O.indexOf(":"))):0;if(!(Object(A.isFiniteNumber)(w)&&Object(A.isFiniteNumber)(x)&&Object(A.isFiniteNumber)(F)&&Object(A.isFiniteNumber)(M)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+O);return w+=1e3*x,(w+=6e4*F)+36e5*M}(r)/1e3}catch(O){L=!1,a=O}return}R===""&&(k=!1)}d.parse(R+`
`)}),d.flush()}},"./src/utils/xhr-loader.ts":function(P,C,f){f.r(C);var A=f("./src/utils/logger.ts"),T=f("./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m,_=function(){function I(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new T.LoadStats,this.retryDelay=0}var D=I.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},D.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(o,S,m){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=S,this.callbacks=m,this.retryDelay=S.retryDelay,this.loadInternal()},D.loadInternal=function(){var o=this.config,S=this.context;if(o){var m=this.loader=new self.XMLHttpRequest,c=this.stats;c.loading.first=0,c.loaded=0;var p=this.xhrSetup;try{if(p)try{p(m,S.url)}catch{m.open("GET",S.url,!0),p(m,S.url)}m.readyState||m.open("GET",S.url,!0)}catch(y){return void this.callbacks.onError({code:m.status,text:y.message},S,m)}S.rangeEnd&&m.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),m.onreadystatechange=this.readystatechange.bind(this),m.onprogress=this.loadprogress.bind(this),m.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),m.send()}},D.readystatechange=function(){var o=this.context,S=this.loader,m=this.stats;if(o&&S){var c=S.readyState,p=this.config;if(!m.aborted&&c>=2)if(self.clearTimeout(this.requestTimeout),m.loading.first===0&&(m.loading.first=Math.max(self.performance.now(),m.loading.start)),c===4){S.onreadystatechange=null,S.onprogress=null;var y=S.status;if(y>=200&&y<300){var u,e;if(m.loading.end=Math.max(self.performance.now(),m.loading.first),e=o.responseType==="arraybuffer"?(u=S.response).byteLength:(u=S.responseText).length,m.loaded=m.total=e,!this.callbacks)return;var i=this.callbacks.onProgress;if(i&&i(m,o,u,S),!this.callbacks)return;var t={url:S.responseURL,data:u};this.callbacks.onSuccess(t,m,o,S)}else m.retry>=p.maxRetry||y>=400&&y<499?(A.logger.error(y+" while loading "+o.url),this.callbacks.onError({code:y,text:S.statusText},o,S)):(A.logger.warn(y+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,p.maxRetryDelay),m.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout)}},D.loadtimeout=function(){A.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(o){var S=this.stats;S.loaded=o.loaded,o.lengthComputable&&(S.total=o.total)},D.getCacheAge=function(){var o=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");o=S?parseFloat(S):null}return o},I}();C.default=_}}).default);var mt=Tn(Jt.exports);const Sn={name:"d-icon"},we=Object.assign(Sn,{props:{icon:String,size:[Number,String]},setup:function(P){const C=P,f=de(()=>({fontSize:/^\d+$/.test(C.size)?C.size+"px":C.size}));return(A,T)=>(K(),q("i",{class:ee(["d-icon iconfont",P.icon]),style:ke(N(f))},null,6))}});we.__scopeId="data-v-0c690e66";He("data-v-4cb76d59");const bn={class:"d-player-top"},kn={class:"top-title"},Ln={class:"top-title"};We();const An={props:{title:{default:""}},setup(P){Date.prototype.format=function(A){let T={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var b in T)new RegExp("("+b+")").test(A)&&(A=A.replace(RegExp.$1,RegExp.$1.length==1?T[b]:("00"+T[b]).substr((""+T[b]).length)));return A};let C=ge("00:00:00");C.value=new Date().format("hh:mm:ss");let f=null;return f=setInterval(()=>{C.value=new Date().format("hh:mm:ss")},1e3),$t(()=>{clearInterval(f)}),(A,T)=>(K(),q("div",bn,[j("p",kn,se(P.title||""),1),j("p",Ln,se(N(C)),1)]))},__scopeId:"data-v-4cb76d59"};He("data-v-ac2469ec");const _n={class:"d-status"},Dn={class:"d-flex-center"},Rn={class:"d-flex-center"},Cn=oe("5X\u901F\u64AD\u653E\u4E2D ");We();var er=ye({props:["state"],setup:P=>(C,f)=>Se((K(),q("div",_n,[Se(j("li",Dn,[H(we,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(P.state.volume==0?"mute":P.state.volume>.5?"up":"down")},null,8,["icon"]),oe(" "+se(~~(100*P.state.volume))+"% ",1)],512),[[Le,P.state.handleType=="volume"]]),Se(j("li",Rn,[H(we,{size:"12",icon:"icon-play"}),H(we,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),Cn],512),[[Le,P.state.handleType=="playbackRate"||P.state.isMultiplesPlay]])],512)),[[Le,P.state.handleType||P.state.isMultiplesPlay]])});er.__scopeId="data-v-ac2469ec",He("data-v-385f7870");const In=["checked","true-value","false-value"],wn=j("span",{class:"d-switch_action"},null,-1);We();var ft=ye({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(P,{emit:C}){const f=P;Dt(_=>({"014e5dc0":P.width,e4e32852:P.activeColor}));const A=ge(null),T=de(()=>f.modelValue===f.trueValue),b=()=>{ht(()=>{const _=A.value.checked;C("update:modelValue",_),C("change",_)})};return(_,I)=>(K(),q("div",{class:ee(["d-switch",{"is-checked":N(T)}])},[j("input",{class:"d-switch__input",ref:A,type:"checkbox",checked:N(T),onChange:b,"true-value":P.trueValue,"false-value":P.falseValue},null,40,In),wn],2))}});ft.__scopeId="data-v-385f7870",He("data-v-b2384226");const On={key:0},xn=j("i",{class:"rotating iconfont icon-loading f50"},null,-1),Pn=[j("i",{class:"rotating iconfont icon-loading f50"},null,-1),j("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],Fn=[j("i",{class:"iconfont icon-replay f24 mr5"},null,-1),oe("\u91CD\u65B0\u64AD\u653E ")],Mn=[j("i",{class:"iconfont icon-replay f24 mr5"},null,-1),oe("\u8BF7\u6C42\u9519\u8BEF ")];We();var tr=ye({props:{loadType:String,text:{type:String,default:""}},setup(P){const C=P,{proxy:f}=Ir(),A=["loadstart","waiting","ended","error","stalled"],T=()=>{f.$parent.play()},b=de(()=>{let _="background: rgba(0, 0, 0, .1);z-index:1";return C.loadType=="loadstart"&&(_="background: rgba(0, 0, 0, 1);;z-index:3"),_});return(_,I)=>Se((K(),q("div",{class:"d-loading",style:ke(N(b))},[j("div",null,[P.loadType=="loadstart"?(K(),q("span",On,[xn,j("p",null,se(P.text),1)])):J("",!0),Se(j("span",null,Pn,512),[[Le,P.loadType=="waiting"]]),Se(j("span",null,[j("p",{onClick:T,class:"d-flex-x d-pointer"},Fn)],512),[[Le,P.loadType=="ended"]]),Se(j("span",null,[j("p",{onClick:T,class:"d-flex-x d-pointer"},Mn)],512),[[Le,P.loadType=="error"||P.loadType=="stalled"]])])],4)),[[Le,A.includes(P.loadType)]])}});tr.__scopeId="data-v-b2384226";const Xe=function(P,C,f,A=!1){P&&C&&f&&P.addEventListener(C,f,A)},De=function(P,C,f,A=!1){P&&C&&f&&P.removeEventListener(C,f,A)};He("data-v-5a794390");const Nn=["onMousedown"];We();var it=ye(kt(bt({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(P,{emit:C}){const f=P;Dt(e=>({"5242b67b":P.size}));const A=ge(null),T=ge(null),b=nt({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),_=de(()=>{let e=f.modelValue<0?0:f.modelValue>1?1:f.modelValue;return f.vertical?`height:${100*e}%`:`width:${100*e}%`}),I=de(()=>{let e=f.preload<0?0:f.preload>1?1:f.preload;return f.vertical?`height:${100*e}%`:`width:${100*e}%`}),D=de(()=>{let e=b.hoverPosition<0?0:b.hoverPosition>1?1:b.hoverPosition;return f.vertical?`bottom:${100*e}%`:`left:${100*e}%`}),o=e=>{e.preventDefault()},S=e=>{f.disabled||(e.preventDefault(),b.dragging=!0,c(e),Xe(window,"mousemove",y),Xe(window,"touchmove",y),Xe(window,"mouseup",u),Xe(window,"touchend",u))},m=e=>{if(!f.hover)return;let i=p(e);if(C("onMousemove",e,i),b.hoverPosition=i,f.vertical)return;let t=A.value,n=T.value.clientWidth/2,l=e.clientX-t.getBoundingClientRect().left;l<n?b.hoverTipsLeft=n-l+"px":t.clientWidth-l<n?b.hoverTipsLeft=t.clientWidth-l-n+"px":b.hoverTipsLeft="50%"},c=e=>{let i=p(e);C("update:modelValue",i),C("change",e,i)},p=e=>{let i=A.value,t=0;if(f.vertical){let n=i.clientHeight;t=(i.getBoundingClientRect().bottom-e.clientY)/n}else t=(e.clientX-i.getBoundingClientRect().left)/i.clientWidth;return t<0?0:t>1?1:t},y=e=>{c(e)},u=e=>{b.dragging&&(De(window,"mousemove",y),De(window,"touchmove",y),De(window,"mouseup",u),De(window,"touchend",u),De(window,"contextmenu",u),setTimeout(()=>{b.dragging=!1},0))};return(e,i)=>(K(),q("div",{ref:A,class:ee(["d-slider",{"is-vertical":f.vertical}]),onMousedown:Ce(S,["stop"]),onContextmenu:o},[j("div",{class:"d-slider__runway",onMousemove:m},[Se(j("div",{class:"d-slider__cursor",style:ke(N(D))},[Se(j("div",{class:"d-slider__tips",ref:T,style:ke({left:N(b).hoverTipsLeft})},se(f.hoverText),5),[[Le,f.hoverText]])],4),[[Le,f.hover]]),j("div",{class:"d-slider__preload",style:ke(N(I))},null,4),j("div",{class:"d-slider__bar",style:ke(N(_))},null,4)],32)],42,Nn))}}));it.__scopeId="data-v-5a794390";He("data-v-570fa0d1");const Bn={key:0,class:"d-player-dialog"},Un={class:"d-player-dialog-body"},Gn={class:"d-player-dialog-title"},jn={class:"d-player-hotkey-panel"},Vn={class:"d-player-filter-panel"},Kn={class:"d-player-filter-panel-item"},Hn=j("span",null,"\u9971\u548C\u5EA6",-1),Wn={class:"d-player-filter-panel-item"},$n=j("span",null,"\u4EAE\u5EA6",-1),qn={class:"d-player-filter-panel-item"},Yn=j("span",null,"\u5BF9\u6BD4\u5EA6",-1),zn={key:0,class:"d-player-contextmenu"},Xn=["dplayerKeyCode"],Qn=j("input",{class:"d-player-copyText"},null,-1);We();var rr=ye({setup(P){const C=nt({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),f=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],A=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],T=nt({saturate:.392,brightness:.392,contrast:.392}),b=de(()=>({left:C.mouseX+"px",top:C.mouseY+"px"}));Ve(T,S=>{let m=document.querySelector("#dPlayerVideo"),c=(2.55*S.saturate).toFixed(2),p=(2.55*S.brightness).toFixed(2),y=(2.55*S.contrast).toFixed(2);m.style.filter=`saturate(${c}) brightness(${p}) contrast(${y})`});const _=()=>{T.saturate=.392,T.brightness=.392,T.contrast=.392},I=S=>{S.key=="Escape"&&o(0)},D=S=>{S.preventDefault(),Xe(window,"keydown",I),Xe(window,"click",o);let m=document.querySelector("#refPlayerWrap"),c=m.clientWidth;m.clientHeight,C.mouseX=S.clientX-m.getBoundingClientRect().left,c-C.mouseX<130&&(C.mouseX=C.mouseX+(c-C.mouseX-130)),C.mouseY=S.clientY-m.getBoundingClientRect().top,C.show=!0},o=S=>{let m=S.path[0].tagName=="LI",c=S.path[0].attributes.dplayerKeyCode&&S.path[0].attributes.dplayerKeyCode.value,p=f.map(y=>y.key);if(m&&p.includes(c))if(C.dialogTitle=S.path[0].innerText,C.dialogType=c,c=="copy"){let y=document.querySelector(".d-player-copyText");y.value=window.location.href,y.select(),document.execCommand("copy"),C.dialogType=""}else c=="version"&&(C.dialogType="");C.show=!1,De(window,"keydown",I),De(window,"click",o)};return _t(()=>{let S=document.querySelector("#refPlayerWrap");De(window,"keydown",I),De(window,"click",o),De(S,"contextmenu",D),Xe(S,"contextmenu",D)}),$t(()=>{let S=document.querySelector("#refPlayerWrap");De(window,"keydown",I),De(window,"click",o),De(S,"contextmenu",D)}),(S,m)=>(K(),q("div",null,[H(St,{name:"d-fade-in"},{default:X(()=>[N(C).dialogType?(K(),q("div",Bn,[j("div",Un,[j("h5",Gn,[oe(se(N(C).dialogTitle)+" ",1),j("i",{onClick:m[0]||(m[0]=c=>N(C).dialogType=!1),class:"icon icon-close"},"X")]),Se(j("ul",jn,[(K(),q(Re,null,Pe(A,c=>j("li",{class:"d-player-hotkey-panel-item",key:c.key},[j("span",null,se(c.key),1),j("span",null,se(c.label),1)])),64))],512),[[Le,N(C).dialogType=="hotkey"]]),Se(j("ul",Vn,[j("li",Kn,[Hn,H(it,{class:"filter-panel-slider",size:"5px",modelValue:N(T).saturate,"onUpdate:modelValue":m[1]||(m[1]=c=>N(T).saturate=c)},null,8,["modelValue"]),j("span",null,se(Math.round(255*N(T).saturate)),1)]),j("li",Wn,[$n,H(it,{class:"filter-panel-slider",size:"5px",modelValue:N(T).brightness,"onUpdate:modelValue":m[2]||(m[2]=c=>N(T).brightness=c)},null,8,["modelValue"]),j("span",null,se(Math.round(255*N(T).brightness)),1)]),j("li",qn,[Yn,H(it,{class:"filter-panel-slider",size:"5px",modelValue:N(T).contrast,"onUpdate:modelValue":m[3]||(m[3]=c=>N(T).contrast=c)},null,8,["modelValue"]),j("span",null,se(Math.round(255*N(T).contrast)),1)]),j("span",{onClick:_,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[Le,N(C).dialogType=="filter"]])])])):J("",!0)]),_:1}),N(C).show?(K(),q("div",zn,[j("ul",{class:"d-player-contextmenu-body",style:ke(N(b))},[(K(),q(Re,null,Pe(f,c=>j("li",{dplayerKeyCode:c.key,key:c.key},se(c.label),9,Xn)),64))],4),Qn])):J("",!0)]))}});rr.__scopeId="data-v-570fa0d1";const yt=P=>{let C=~~(P/3600),f=~~(P%3600/60),A=~~(P%60);return C=C<10?"0"+C:C,f=f<10?"0"+f:f,A=A<10?"0"+A:A,`${C}:${f}:${A}`},lt="ontouchstart"in window,Bt=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],Zn={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};He("data-v-01791e9e");const Jn={class:"d-player-video",id:"dPlayerVideo"},ea=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],ta={class:"d-player-lightoff"},ra={key:1,class:"d-player-state"},ia={class:"d-play-btn"},na=["onKeyup","onKeydown"],aa={class:"d-control-progress"},sa={class:"d-tool-bar"},oa={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},la=j("span",{style:{margin:"0 3px"}},"/",-1),ua={class:"total-time"},da={class:"d-tool-bar"},ca={key:0,class:"d-tool-item quality-btn"},fa={class:"d-tool-item-main"},ha={class:"speed-main",style:{"text-align":"center"}},ga=["onClick"],pa={key:1,class:"d-tool-item speedRate-btn"},va={class:"d-tool-item-main"},ma={class:"speed-main"},ya=["onClick"],Ea={key:2,class:"d-tool-item volume-btn"},Ta={class:"d-tool-item-main volume-box",style:{width:"52px"}},Sa={class:"volume-text-size"},ba={key:3,class:"d-tool-item setting-btn"},ka={class:"d-tool-item-main"},La={class:"speed-main"},Aa=oe(" \u955C\u50CF\u753B\u9762 "),_a=oe(" \u5FAA\u73AF\u64AD\u653E "),Da=oe(" \u5173\u706F\u6A21\u5F0F "),Ra=j("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),Ca=j("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Ia=j("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);We();var ct=ye(kt(bt({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:Zn,emits:[...Bt,"mirrorChange","loopChange","lightOffChange"],setup:function(P,{expose:C,emit:f}){const A=P;Dt(w=>({"51d4439c":N(p),"77e758a6":w.width,b8a1afc0:w.height}));const T=new mt({fragLoadingTimeOut:2e3}),b=ge(null),_=ge(null),I=ge(null),D=ge(null),o=nt(kt(bt({dVideo:null},A),{muted:A.muted,playBtnState:A.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),S=(...w)=>x=>w.reverse().reduce((F,M)=>M(F),x),m=Bt.reduce((w,x)=>{var F;return w[`on${F=x,F.charAt(0).toUpperCase()+F.slice(1)}`]=M=>{o.loadStateType=x,f(x,M)},w},{});m.onCanplay=S(m.onCanplay,()=>{o.playBtnState!="play"&&o.dVideo.play(),o.autoPlay&&(o.dVideo.play(),o.playBtnState="pause")}),m.onEnded=S(m.onEnded,()=>{o.playBtnState="replay"}),m.onDurationchange=w=>{f("durationchange",w),A.currentTime!=0&&(o.dVideo.currentTime=A.currentTime),m.onTimeupdate(w)},m.onProgress=w=>{console.log("\u7F13\u51B2\u4E2D..."),f("progress",w);let x=w.target.duration,F=w.target.buffered,M=w.target.buffered.length&&w.target.buffered.end(F-1);o.preloadBar=M/x},m.onTimeupdate=w=>{f("timeupdate",w);let x=w.duration||w.target.duration||0,F=w.currentTime||w.target.currentTime;o.playProgress=F/x,o.currentTime=yt(F),o.totalTime=yt(x)},m.onError=S(m.onError,()=>{o.playBtnState="replay"});let c=Cr();for(let w in c)m[w]=c[w];const p=(y=o.color,`${parseInt("0x"+y.slice(1,3))},${parseInt("0x"+y.slice(3,5))},${parseInt("0x"+y.slice(5,7))}`);var y;const u=Nt(500,()=>{o.handleType=""}),e=w=>{w.preventDefault(),w.code=="ArrowUp"?o.volume=o.volume+.1>1?1:o.volume+.1:o.volume=o.volume-.1<0?0:o.volume-.1,o.muted=!1,o.handleType="volume",u()},i=w=>{A.speed&&(o.dVideo.currentTime=o.dVideo.currentTime<10?.1:o.dVideo.currentTime-10,m.onTimeupdate(o.dVideo),l())},t=w=>{w.preventDefault();let x=w.type;if(w.key=="ArrowRight"){if(l(),x=="keyup"){if(clearTimeout(o.longPressTimeout),!A.speed&&!o.longPressTimeout)return;o.isMultiplesPlay?(o.dVideo.playbackRate=o.speedActive,o.isMultiplesPlay=!1):(o.dVideo.currentTime=o.dVideo.currentTime+10,m.onTimeupdate(o.dVideo))}else if(x=="keydown"){if(!A.speed)return;o.isMultiplesPlay&&clearTimeout(o.longPressTimeout),o.longPressTimeout=setTimeout(()=>{o.isMultiplesPlay=!0,o.dVideo.playbackRate=5,o.handleType="playbackRate",u()},500)}}},n=()=>{lt||D.value.focus()},l=()=>{o.loadStateType="play",o.dVideo.play().catch(()=>{setTimeout(()=>{o.playBtnState="replay",o.loadStateType="error"},500)}),o.playBtnState="pause"},a=()=>{o.dVideo.pause(),o.playBtnState="play"},d=w=>{w&&w.preventDefault(),o.playBtnState=="play"||o.playBtnState=="replay"?l():o.playBtnState=="pause"&&a()},E=()=>{o.muted=!o.muted,o.volume==0&&(o.volume=.05)},g=(w,x)=>{let F=o.dVideo.duration||o.dVideo.target.duration;o.dVideo.currentTime=F*x,o.playBtnState=="play"&&(o.dVideo.play(),o.playBtnState="pause")},v=(w,x)=>{o.progressCursorTime=yt(o.dVideo.duration*x)},r=Nt(2500,()=>{o.isVideoHovering=!1}),s=w=>{o.isVideoHovering=!0,r()},h=w=>{f("mirrorChange",w,o.dVideo)},k=w=>{f("loopChange",w,o.dVideo)},L=w=>{f("lightOffChange",w,o.dVideo)},R=()=>{var w;w=o.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(x=>{console.log(x,"Video failed to leave Picture-in-Picture mode.")}):w.requestPictureInPicture().catch(x=>{console.log(x,"Video failed to enter Picture-in-Picture mode.")})},O=()=>{o.fullScreen=(w=>{let x=document,F=x.webkitIsFullScreen||x.fullscreen;return F?(document.exitFullscreen||x.webkitExitFullScreen).call(x):(w.requestFullscreen||w.webkitRequestFullScreen).call(w),!F})(b.value)};return Ve(()=>A.src,()=>{ht(()=>{o.dVideo.canPlayType(A.type)||o.dVideo.canPlayType("application/vnd.apple.mpegurl")?o.muted=A.autoPlay:mt.isSupported()&&(T.detachMedia(),T.attachMedia(o.dVideo),T.on(mt.Events.MEDIA_ATTACHED,()=>{T.loadSource(A.src),T.on("hlsManifestParsed",(w,x)=>{console.log(x),o.currentLevel=x.level,o.qualityLevels=x.levels||[]})}),T.on("hlsLevelSwitching",(w,x)=>{console.log(x),console.log("LEVEL_SWITCHING")}),T.on("hlsLevelSwitched",(w,x)=>{o.currentLevel=x.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),_t(()=>{o.dVideo=_,n()}),C({play:l,pause:a,togglePlay:d}),(w,x)=>(K(),q("div",{ref:b,id:"refPlayerWrap",class:ee(["d-player-wrap",{"web-full-screen":N(o).webFullScreen,"is-lightoff":N(o).lightOff,"d-player-wrap-hover":N(o).playBtnState=="play"||N(o).isVideoHovering}]),onMousemove:s},[j("div",Jn,[j("video",dt({ref:_,class:["d-player-video-main",{"video-mirror":N(o).mirror}],id:"dPlayerVideoMain",controls:!(!N(lt)||!N(o).speed),"webkit-playsinline":A.playsinline,playsinline:A.playsinline},N(m),{volume:N(o).volume,muted:N(o).muted,loop:N(o).loop,preload:w.preload,width:"100%",height:"100%",src:A.src,poster:A.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,ea)]),H(St,{name:"d-fade-in"},{default:X(()=>[Se(j("div",ta,null,512),[[Le,N(o).lightOff]])]),_:1}),N(o).fullScreen?(K(),pe(An,{key:0,title:A.title},null,8,["title"])):J("",!0),N(lt)?J("",!0):(K(),q("div",ra,[H(St,{name:"d-scale-out"},{default:X(()=>[Se(j("div",ia,[H(we,{icon:"icon-play",size:40})],512),[[Le,N(o).playBtnState=="play"]])]),_:1}),H(er,{state:N(o)},null,8,["state"])])),N(lt)?J("",!0):(K(),q("input",{key:2,type:"input",readonly:"readonly",ref:D,onDblclick:O,onKeyup:[je(O,["f"]),x[0]||(x[0]=je(F=>N(o).webFullScreen=!1,["esc"])),t],onClick:d,onKeydown:[je(d,["space"]),je(i,["arrow-left"]),je(e,["arrow-up","arrow-down"]),t],class:"d-player-input",maxlength:"0"},null,40,na)),H(tr,{loadType:N(o).loadStateType},null,8,["loadType"]),H(rr),!N(lt)&&N(o).control?(K(),q("div",{key:3,class:"d-player-control",ref:I},[j("div",aa,[H(it,{class:"d-progress-bar",onOnMousemove:v,onChange:g,disabled:!N(o).speed,hoverText:N(o).progressCursorTime,modelValue:N(o).playProgress,"onUpdate:modelValue":x[1]||(x[1]=F=>N(o).playProgress=F),preload:N(o).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),j("div",{class:"d-control-tool",onClick:n},[j("div",sa,[j("div",{class:"d-tool-item",onClick:d},[H(we,{size:"24",icon:`icon-${N(o).playBtnState}`},null,8,["icon"])]),A.controlBtns.includes("audioTrack")?(K(),q("div",oa,[j("span",null,se(N(o).currentTime),1),la,j("span",ua,se(N(o).totalTime),1)])):J("",!0)]),j("div",da,[N(o).qualityLevels.length&&A.controlBtns.includes("quality")?(K(),q("div",ca,[oe(se(N(o).qualityLevels.length&&(N(o).qualityLevels[N(o).currentLevel]||{}).height)+"P ",1),j("div",fa,[j("ul",ha,[(K(!0),q(Re,null,Pe(N(o).qualityLevels,(F,M)=>(K(),q("li",{class:ee({"speed-active":N(o).currentLevel==M}),onClick:B=>((U,G)=>{T.currentLevel=G,o.currentLevel=G})(0,M),key:F},se(F.height)+"P",11,ga))),128))])])])):J("",!0),A.controlBtns.includes("speedRate")?(K(),q("div",pa,[oe(se(N(o).speedActive=="1.0"?"\u500D\u901F":N(o).speedActive+"x")+" ",1),j("div",va,[j("ul",ma,[(K(!0),q(Re,null,Pe(N(o).speedRate,F=>(K(),q("li",{class:ee({"speed-active":N(o).speedActive==F}),onClick:M=>(B=>{o.speedActive=B,o.dVideo.playbackRate=B})(F),key:F},se(F)+"x",11,ya))),128))])])])):J("",!0),A.controlBtns.includes("volume")?(K(),q("div",Ea,[j("div",Ta,[j("div",{class:ee(["volume-main",{"is-muted":N(o).muted}])},[j("span",Sa,se(N(o).muted?0:~~(100*N(o).volume))+"%",1),H(it,{onChange:x[2]||(x[2]=F=>N(o).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:N(o).volume,"onUpdate:modelValue":x[3]||(x[3]=F=>N(o).volume=F)},null,8,["modelValue"])],2)]),j("span",{onClick:E,style:{display:"flex"}},[H(we,{size:"20",icon:"icon-volume-"+(N(o).volume==0||N(o).muted?"mute":N(o).volume>.5?"up":"down")},null,8,["icon"])])])):J("",!0),A.controlBtns.includes("setting")?(K(),q("div",ba,[H(we,{size:"20",class:"rotateHover",icon:"icon-settings"}),j("div",ka,[j("ul",La,[j("li",null,[Aa,H(ft,{onChange:h,modelValue:N(o).mirror,"onUpdate:modelValue":x[4]||(x[4]=F=>N(o).mirror=F)},null,8,["modelValue"])]),j("li",null,[_a,H(ft,{onChange:k,modelValue:N(o).loop,"onUpdate:modelValue":x[5]||(x[5]=F=>N(o).loop=F)},null,8,["modelValue"])]),j("li",null,[Da,H(ft,{onChange:L,modelValue:N(o).lightOff,"onUpdate:modelValue":x[6]||(x[6]=F=>N(o).lightOff=F)},null,8,["modelValue"])])])])])):J("",!0),A.controlBtns.includes("pip")?(K(),q("div",{key:4,class:"d-tool-item pip-btn",onClick:R},[H(we,{size:"20",icon:"icon-pip"}),Ra])):J("",!0),A.controlBtns.includes("pageFullScreen")?(K(),q("div",{key:5,class:"d-tool-item pip-btn",onClick:x[7]||(x[7]=F=>N(o).webFullScreen=!N(o).webFullScreen)},[H(we,{size:"20",icon:"icon-web-screen"}),Ca])):J("",!0),A.controlBtns.includes("fullScreen")?(K(),q("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:O},[Ia,H(we,{size:"20",icon:"icon-screen"})])):J("",!0)])])],512)):J("",!0)],34))}}));function wa(P){P.component(ct.name,ct)}ct.__scopeId="data-v-01791e9e",ct.install=wa;const Oa=ye({__name:"index",props:{src:{type:String,required:!0},width:String,height:String,poster:String},setup(P,{expose:C}){const f=P,A=Ne(),T=nt({color:"var(--el-color-primary)",muted:!1,webFullScreen:!1,speedRate:["0.75","1.0","1.25","1.5","2.0"],autoPlay:!0,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,title:"",poster:"",...f}),b=()=>{A.value.play()},_=()=>{A.value.pause()},I=m=>{console.log(m,"\u64AD\u653E")},D=m=>{console.log(m,"\u6682\u505C")},o=m=>{console.log(m,"\u65F6\u95F4\u66F4\u65B0")},S=m=>{console.log(m,"\u53EF\u4EE5\u64AD\u653E")};return C({play:b,pause:_}),(m,c)=>(K(),q("div",null,[H(N(ct),dt({ref_key:"playerRef",ref:A},T,{src:P.src,onPlay:I,onPause:D,onTimeupdate:o,onCanplay:S}),null,16,["src"])]))}}),xa={key:0},Pa={key:1},Fa=ye({__name:"preview",props:{modelValue:{type:Boolean,default:!1},url:{type:String,default:""},type:{type:String,default:"image"}},emits:["update:modelValue"],setup(P,{emit:C}){const f=P,A=Ne(),T=de({get(){return f.modelValue},set(I){C("update:modelValue",I)}}),b=()=>{C("update:modelValue",!1)},_=ge([]);return Ve(()=>f.modelValue,I=>{I?ht(()=>{var D;_.value=[f.url],(D=A.value)==null||D.play()}):ht(()=>{var D;_.value=[],(D=A.value)==null||D.pause()})}),(I,D)=>{const o=wr,S=Oa,m=qt;return Se((K(),q("div",null,[P.type=="image"?(K(),q("div",xa,[_.value.length?(K(),pe(o,{key:0,"url-list":_.value,"hide-on-click-modal":"",onClose:b},null,8,["url-list"])):J("",!0)])):J("",!0),P.type=="video"?(K(),q("div",Pa,[H(m,{modelValue:N(T),"onUpdate:modelValue":D[0]||(D[0]=c=>rt(T)?T.value=c:null),width:"740px",title:"\u89C6\u9891\u9884\u89C8","before-close":b},{default:X(()=>[H(S,{ref_key:"playerRef",ref:A,src:P.url,width:"700px",height:"450px"},null,8,["src"])]),_:1},8,["modelValue"])])):J("",!0)],512)),[[Le,P.modelValue]])}}});const pt=P=>(He("data-v-1f540c6b"),P=P(),We(),P),Ma={class:"material"},Na={class:"material__left"},Ba={class:"flex-1 min-h-0"},Ua={class:"material-left__content pt-4 pr-4 p-b-4"},Ga={class:"flex flex-1 items-center min-w-0"},ja=pt(()=>j("img",{class:"w-[20px] h-[16px] mr-3",src:en},null,-1)),Va={class:"flex-1 truncate mr-2"},Ka=pt(()=>j("span",{class:"muted m-r-10"},"\xB7\xB7\xB7",-1)),Ha=["onClick"],Wa=oe("\u547D\u540D\u5206\u7EC4"),$a=["onClick"],qa=oe("\u5220\u9664\u5206\u7EC4"),Ya={class:"flex justify-center p-2 border-t border-br"},za=oe("\u6DFB\u52A0\u5206\u7EC4"),Xa={class:"material__center flex flex-col"},Qa={class:"operate-btn flex"},Za={class:"flex-1 flex"},Ja=oe("\u672C\u5730\u4E0A\u4F20"),es=oe(" \u5220\u9664 "),ts=oe("\u79FB\u52A8"),rs=pt(()=>j("span",{class:"mr-5"},"\u79FB\u52A8\u6587\u4EF6\u81F3",-1)),is={class:"flex items-center ml-3"},ns={key:0,class:"mt-3"},as=oe(" \u5F53\u9875\u5168\u9009 "),ss={class:"material-center__content flex flex-col flex-1 mb-1"},os={class:"file-list flex flex-wrap mt-4"},ls={key:0,class:"item-selected"},us={class:"operation-btns flex items-center"},ds=oe(" \u91CD\u547D\u540D "),cs=oe(" \u67E5\u770B "),fs=oe(" \u91CD\u547D\u540D "),hs=oe(" \u67E5\u770B "),gs=oe(" \u5220\u9664 "),ps={key:0,class:"flex flex-1 justify-center items-center"},vs={class:"material-center__footer flex justify-between items-center"},ms={class:"flex"},ys={class:"mr-3"},Es=oe(" \u5F53\u9875\u5168\u9009 "),Ts=oe(" \u5220\u9664 "),Ss=oe("\u79FB\u52A8"),bs=pt(()=>j("span",{class:"mr-5"},"\u79FB\u52A8\u6587\u4EF6\u81F3",-1)),ks={key:0,class:"material__right"},Ls={class:"flex justify-between p-2 flex-wrap"},As={class:"sm flex items-center"},_s={key:0},Ds=oe("\u6E05\u7A7A"),Rs={class:"flex-1 min-h-0"},Cs={class:"select-lists flex flex-col p-t-3"},Is={class:"select-item"},ws=ye({__name:"index",props:{fileSize:{type:String,default:"100px"},limit:{type:Number,default:1},type:{type:String,default:"image"},mode:{type:String,default:"picker"},pageSize:{type:Number,default:15}},emits:["change"],setup(P,{expose:C,emit:f}){const A=P,{limit:T}=Or(A),b=de(()=>{switch(A.type){case"image":return 10;case"video":return 20;case"file":return 30;default:return 0}}),_=Kt("visible"),I=ge(""),D=ge(!1),{treeRef:o,cateId:S,cateLists:m,handleAddCate:c,handleEditCate:p,handleDeleteCate:y,getCateLists:u,handleCatSelect:e}=dn(b.value),{tableRef:i,listShowType:t,moveId:n,pager:l,fileParams:a,select:d,isCheckAll:E,isIndeterminate:g,getFileList:v,refresh:r,batchFileDelete:s,batchFileMove:h,selectFile:k,isSelect:L,clearSelect:R,cancelSelete:O,selectAll:w,handleFileRename:x}=cn(S,b,T,A.pageSize),F=async()=>{var B;await u(),(B=o.value)==null||B.setCurrentKey(S.value),v()},M=B=>{I.value=B,D.value=!0};return Ve(_,async B=>{B&&F()},{immediate:!0}),Ve(S,()=>{a.name="",r()}),Ve(d,B=>{if(f("change",B),B.length==l.lists.length&&B.length!==0){g.value=!1,E.value=!0;return}B.length>0?g.value=!0:(E.value=!1,g.value=!1)},{deep:!0}),_t(()=>{A.mode=="page"&&F()}),C({clearSelect:R}),(B,U)=>{const G=Ji,V=xr,W=Pr,Y=Fr,Z=qr,Q=Mr,z=Nr,ie=Zi,ae=Wr,le=$r,te=Hr,ce=Ht,re=Br,ne=Wt,fe=Kr,ue=$i,ve=jr,Ae=ti,_e=Vr,Ie=Gr,Te=Ur;return Se((K(),q("div",Ma,[j("div",Na,[j("div",Ba,[H(Q,null,{default:X(()=>[j("div",Ua,[H(Z,{ref_key:"treeRef",ref:o,"node-key":"id",data:N(m),"empty-text":"''","highlight-current":!0,"expand-on-click-node":!1,"current-node-key":N(S),onNodeClick:N(e)},{default:X(({data:$})=>[j("div",Ga,[ja,j("span",Va,[H(G,{content:$.name},null,8,["content"])]),$.id>0?(K(),pe(Y,{key:0,"hide-on-click":!1},{dropdown:X(()=>[H(W,null,{default:X(()=>[j("div",{onClick:Ee=>N(p)($.name,$.id)},[H(V,null,{default:X(()=>[Wa]),_:1})],8,Ha),j("div",{onClick:Ee=>N(y)($.id)},[H(V,null,{default:X(()=>[qa]),_:1})],8,$a)]),_:2},1024)]),default:X(()=>[Ka]),_:2},1024)):J("",!0)])]),_:1},8,["data","current-node-key","onNodeClick"])])]),_:1})]),j("div",Ya,[H(z,{onClick:N(c)},{default:X(()=>[za]),_:1},8,["onClick"])])]),j("div",Xa,[j("div",Qa,[j("div",Za,[H(ie,{class:"mr-3",data:{cid:N(S)},type:P.type,"show-progress":!0,onChange:N(r)},{default:X(()=>[H(z,{type:"primary"},{default:X(()=>[Ja]),_:1})]),_:1},8,["data","type","onChange"]),P.mode=="page"?(K(),pe(z,{key:0,disabled:!N(d).length,onClick:U[0]||(U[0]=Ce($=>N(s)(),["stop"]))},{default:X(()=>[es]),_:1},8,["disabled"])):J("",!0),P.mode=="page"?(K(),pe(te,{key:1,class:"ml-3",onConfirm:N(h),disabled:!N(d).length,title:"\u79FB\u52A8\u6587\u4EF6"},{trigger:X(()=>[H(z,{disabled:!N(d).length},{default:X(()=>[ts]),_:1},8,["disabled"])]),default:X(()=>[j("div",null,[rs,H(le,{modelValue:N(n),"onUpdate:modelValue":U[1]||(U[1]=$=>rt(n)?n.value=$:null),placeholder:"\u8BF7\u9009\u62E9"},{default:X(()=>[(K(!0),q(Re,null,Pe(N(m),$=>(K(),q(Re,{key:$.id},[$.id!==""?(K(),pe(ae,{key:0,label:$.name,value:$.id},null,8,["label","value"])):J("",!0)],64))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm","disabled"])):J("",!0)]),H(re,{class:"w-72",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",modelValue:N(a).name,"onUpdate:modelValue":U[2]||(U[2]=$=>N(a).name=$),onKeyup:je(N(r),["enter"])},{append:X(()=>[H(z,{onClick:N(r)},{icon:X(()=>[H(ce,{name:"el-icon-Search"})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeyup"]),j("div",is,[H(ne,{content:"\u5217\u8868\u89C6\u56FE",placement:"top"},{default:X(()=>[j("div",{class:ee(["list-icon",{select:N(t)=="table"}]),onClick:U[3]||(U[3]=$=>t.value="table")},[H(ce,{name:"el-icon-Fold",size:18})],2)]),_:1}),H(ne,{content:"\u5E73\u94FA\u89C6\u56FE",placement:"top"},{default:X(()=>[j("div",{class:ee(["list-icon",{select:N(t)=="normal"}]),onClick:U[4]||(U[4]=$=>t.value="normal")},[H(ce,{name:"el-icon-Menu",size:18})],2)]),_:1})])]),P.mode=="page"?(K(),q("div",ns,[H(fe,{disabled:!N(l).lists.length,modelValue:N(E),"onUpdate:modelValue":U[5]||(U[5]=$=>rt(E)?E.value=$:null),onChange:N(w),indeterminate:N(g)},{default:X(()=>[as]),_:1},8,["disabled","modelValue","onChange","indeterminate"])])):J("",!0),j("div",ss,[Se(j("ul",os,[(K(!0),q(Re,null,Pe(N(l).lists,$=>(K(),q("li",{class:"file-item-wrap",key:$.id,style:ke({width:P.fileSize})},[H(ue,{onClose:Ee=>N(s)([$.id])},{default:X(()=>[H(vt,{uri:$.uri,"file-size":P.fileSize,type:P.type,onClick:Ee=>N(k)($)},{default:X(()=>[N(L)($.id)?(K(),q("div",ls,[H(ce,{size:24,name:"el-icon-Check",color:"#fff"})])):J("",!0)]),_:2},1032,["uri","file-size","type","onClick"])]),_:2},1032,["onClose"]),H(G,{class:"mt-1",content:$.name},null,8,["content"]),j("div",us,[H(z,{type:"primary",link:"",onClick:Ee=>N(x)($.name,$.id)},{default:X(()=>[ds]),_:2},1032,["onClick"]),H(z,{type:"primary",link:"",onClick:Ee=>M($.uri)},{default:X(()=>[cs]),_:2},1032,["onClick"])])],4))),128))],512),[[Le,N(t)=="normal"]]),Se(H(_e,{ref_key:"tableRef",ref:i,class:"mt-4",data:N(l).lists,width:"100%",height:"100%",size:"large",onRowClick:N(k)},{default:X(()=>[H(ve,{width:"55"},{default:X(({row:$})=>[H(fe,{modelValue:N(L)($.id),onChange:Ee=>N(k)($)},null,8,["modelValue","onChange"])]),_:1}),H(ve,{label:"\u56FE\u7247",width:"60"},{default:X(({row:$})=>[H(vt,{uri:$.uri,"file-size":"40px"},null,8,["uri"])]),_:1}),H(ve,{label:"\u540D\u79F0","min-width":"100","show-overflow-tooltip":""},{default:X(({row:$})=>[H(Ae,{onClick:Ce(Ee=>M($.uri),["stop"])},{default:X(()=>[oe(se($.name),1)]),_:2},1032,["onClick"])]),_:1}),H(ve,{prop:"create_time",label:"\u4E0A\u4F20\u65F6\u95F4","min-width":"100"}),H(ve,{label:"\u64CD\u4F5C",width:"200",fixed:"right"},{default:X(({row:$})=>[H(z,{type:"primary",link:"",onClick:Ce(Ee=>N(x)($.name,$.id),["stop"])},{default:X(()=>[fs]),_:2},1032,["onClick"]),H(z,{type:"primary",link:"",onClick:Ce(Ee=>M($.uri),["stop"])},{default:X(()=>[hs]),_:2},1032,["onClick"]),H(z,{type:"primary",link:"",onClick:Ce(Ee=>N(s)([$.id]),["stop"])},{default:X(()=>[gs]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onRowClick"]),[[Le,N(t)=="table"]]),!N(l).loading&&!N(l).lists.length?(K(),q("div",ps," \u6682\u65E0\u6570\u636E~ ")):J("",!0)]),j("div",vs,[j("div",ms,[P.mode=="page"?(K(),q(Re,{key:0},[j("span",ys,[H(fe,{disabled:!N(l).lists.length,modelValue:N(E),"onUpdate:modelValue":U[6]||(U[6]=$=>rt(E)?E.value=$:null),onChange:N(w),indeterminate:N(g)},{default:X(()=>[Es]),_:1},8,["disabled","modelValue","onChange","indeterminate"])]),H(z,{disabled:!N(d).length,onClick:U[7]||(U[7]=$=>N(s)())},{default:X(()=>[Ts]),_:1},8,["disabled"]),H(te,{class:"ml-3 inline",onConfirm:N(h),disabled:!N(d).length,title:"\u79FB\u52A8\u6587\u4EF6"},{trigger:X(()=>[H(z,{disabled:!N(d).length},{default:X(()=>[Ss]),_:1},8,["disabled"])]),default:X(()=>[j("div",null,[bs,H(le,{modelValue:N(n),"onUpdate:modelValue":U[8]||(U[8]=$=>rt(n)?n.value=$:null),placeholder:"\u8BF7\u9009\u62E9"},{default:X(()=>[(K(!0),q(Re,null,Pe(N(m),$=>(K(),q(Re,{key:$.id},[$.id!==""?(K(),pe(ae,{key:0,label:$.name,value:$.id},null,8,["label","value"])):J("",!0)],64))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm","disabled"])],64)):J("",!0)]),H(Ie,{modelValue:N(l),"onUpdate:modelValue":U[9]||(U[9]=$=>rt(l)?l.value=$:null),onChange:N(v),layout:"total, prev, pager, next, jumper"},null,8,["modelValue","onChange"])])]),P.mode=="picker"?(K(),q("div",ks,[j("div",Ls,[j("div",As,[oe(" \u5DF2\u9009\u62E9 "+se(N(d).length)+" ",1),N(T)?(K(),q("span",_s,"/"+se(N(T)),1)):J("",!0)]),H(z,{type:"primary",link:"",onClick:N(R)},{default:X(()=>[Ds]),_:1},8,["onClick"])]),j("div",Rs,[H(Q,{class:"ls-scrollbar"},{default:X(()=>[j("ul",Cs,[(K(!0),q(Re,null,Pe(N(d),$=>(K(),q("li",{class:"mb-4",key:$.id},[j("div",Is,[H(ue,{onClose:Ee=>N(O)($.id)},{default:X(()=>[H(vt,{uri:$.uri,"file-size":"100px",type:P.type},null,8,["uri","type"])]),_:2},1032,["onClose"])])]))),128))])]),_:1})])])):J("",!0),H(Fa,{modelValue:D.value,"onUpdate:modelValue":U[10]||(U[10]=$=>D.value=$),url:I.value,type:P.type},null,8,["modelValue","url","type"])])),[[Te,N(l).loading]])}}}),Hs=gt(ws,[["__scopeId","data-v-1f540c6b"]]);export{vt as F,Hs as _,Fa as a,$i as b};

import{d as A,aq as f,dG as K,u as L,l as N,k as U,E as q,c as I,a as o,w as n,Q as j,f as H,dU as M,K as O,o as _,h as P,e as h,g as S}from"./index.9fc232cc.js";import{v as $}from"./el-loading.923739bb.js";import{F as G}from"./index.f3c8a419.js";import{E as Q,a as z}from"./el-form-item.dd920213.js";import{E as J}from"./el-tree.39ee9f7a.js";import{E as W}from"./el-checkbox.a0689a45.js";import{E as X}from"./el-input-number.c0597b8a.js";import{E as Y}from"./el-input.8962c0a5.js";import{E as Z}from"./el-card.aa4c0f18.js";import{E as ee}from"./el-page-header.9f40f21c.js";import{a as te,i as ae,j as oe,k as le}from"./auth.ad86879c.js";import"./isEqual.57cff38e.js";import"./event.776e7e11.js";import"./index.0c5865cb.js";import"./index.c40746fe.js";const ne={class:"role-add"},re=S("\u4FDD\u5B58"),ve=A({__name:"edit",setup(se){const i=f(),r=f(),{query:d}=K(),E=L(),t=N({loading:!1,isExpand:!1,menuArray:[],menuTree:[],formData:{name:"",desc:"",sort:0,menu_id:[]},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["blur"]}]}}),D=U(()=>d.id?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272"),g=()=>{te({page_type:0}).then(a=>{t.menuTree=a.lists,t.menuArray=M(a.lists)})},k=async()=>{if(!!d.id){t.loading=!0;try{const a=await ae({id:d.id});Object.keys(t.formData).forEach(e=>{t.formData[e]=a[e]}),setTimeout(()=>{b()},100),t.loading=!1}catch{t.loading=!1}}},y=()=>{var l,s;const a=(l=r.value)==null?void 0:l.getCheckedKeys(),e=(s=r.value)==null?void 0:s.getHalfCheckedKeys();return a==null||a.unshift.apply(a,e),a},b=()=>{t.formData.menu_id.forEach(a=>{O(()=>{var e;(e=r.value)==null||e.setChecked(a,!0,!1)})})},v=a=>{const e=t.menuTree;for(let l=0;l<e.length;l++)r.value.store.nodesMap[e[l].id].expanded=a},C=a=>{var e,l;a?(e=r.value)==null||e.setCheckedKeys(t.menuArray.map(s=>s.id)):(l=r.value)==null||l.setCheckedKeys([])},F=async()=>{var e;const a=d.id;await((e=i.value)==null?void 0:e.validate()),t.formData.menu_id=y(),a?await oe({id:a,...t.formData}):await le(t.formData),E.back()};return g(),k(),(a,e)=>{const l=ee,s=Z,c=Y,m=Q,x=X,p=W,w=J,B=z,V=q,R=G,T=$;return _(),I("div",ne,[o(s,{shadow:"never"},{default:n(()=>[o(l,{content:P(D),onBack:e[0]||(e[0]=u=>a.$router.back())},null,8,["content"])]),_:1}),j((_(),H(s,{shadow:"never",class:"m-t-16"},{default:n(()=>[o(B,{class:"ls-form",ref_key:"formRef",ref:i,rules:t.rules,model:t.formData,"label-width":"120px"},{default:n(()=>[o(m,{label:"\u540D\u79F0",prop:"name"},{default:n(()=>[o(c,{class:"ls-input",modelValue:t.formData.name,"onUpdate:modelValue":e[1]||(e[1]=u=>t.formData.name=u),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(m,{label:"\u5907\u6CE8",prop:"desc"},{default:n(()=>[o(c,{style:{width:"280px"},modelValue:t.formData.desc,"onUpdate:modelValue":e[2]||(e[2]=u=>t.formData.desc=u),type:"textarea",rows:4,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1}),o(m,{label:"\u6392\u5E8F",prop:"sort"},{default:n(()=>[o(x,{modelValue:t.formData.sort,"onUpdate:modelValue":e[3]||(e[3]=u=>t.formData.sort=u)},null,8,["modelValue"])]),_:1}),o(m,{label:"\u6743\u9650"},{default:n(()=>[h("div",null,[o(p,{label:"\u5C55\u5F00/\u6298\u53E0",onChange:v}),o(p,{label:"\u5168\u9009/\u4E0D\u5168\u9009",onChange:C}),h("div",null,[o(w,{ref_key:"treeRef",ref:r,data:t.menuTree,props:{label:"name",children:"children"},"node-key":"id","default-expand-all":t.isExpand,"show-checkbox":""},null,8,["data","default-expand-all"])])])]),_:1})]),_:1},8,["rules","model"])]),_:1})),[[T,t.loading]]),o(R,null,{default:n(()=>[o(V,{type:"primary",onClick:F},{default:n(()=>[re]),_:1})]),_:1})])}}});export{ve as default};

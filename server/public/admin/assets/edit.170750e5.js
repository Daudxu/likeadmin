import{F as L}from"./index.319a77f2.js";import{d as N,x as _,v as U,u as j,m as q,l as M,c as O,a as o,w as n,y as S,g as $,bR as z,F as h,e as s,z as H,o as D,i as P,f as g,h as G}from"./index.6235ba03.js";import{a as I,i as J,j as Q,k as W}from"./auth.4c42682d.js";const X={class:"role-add"},Y=G("\u4FDD\u5B58"),oe=N({__name:"edit",setup(Z){const m=_(),r=_(),{query:c}=U(),y=j(),t=q({loading:!1,isExpand:!1,menuArray:[],menuTree:[],formData:{name:"",desc:"",sort:0,menu_id:[]},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["blur"]}]}}),b=M(()=>c.id?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272"),k=()=>{I({page_type:1}).then(a=>{t.menuTree=a.lists,t.menuArray=z(a.lists)})},v=async()=>{if(!!c.id){t.loading=!0;try{const a=await J({id:c.id});Object.keys(t.formData).forEach(e=>{t.formData[e]=a[e]}),h(()=>C()),t.loading=!1}catch{t.loading=!1}}},x=()=>{var l,u;const a=(l=r.value)==null?void 0:l.getCheckedKeys(),e=(u=r.value)==null?void 0:u.getHalfCheckedKeys();return a==null||a.unshift.apply(a,e),a},C=()=>{t.formData.menu_id.forEach(a=>{h(()=>{var e;(e=r.value)==null||e.setChecked(a,!0,!1)})})},F=a=>{const e=t.menuTree;for(let l=0;l<e.length;l++)r.value.store.nodesMap[e[l].id].expanded=a},w=a=>{var e,l;a?(e=r.value)==null||e.setCheckedKeys(t.menuArray.map(u=>u.id)):(l=r.value)==null||l.setCheckedKeys([])},E=async()=>{var e;const a=c.id;await((e=m.value)==null?void 0:e.validate()),t.formData.menu_id=x(),a?await Q({id:a,...t.formData}):await W(t.formData),y.back()};return k(),v(),(a,e)=>{const l=s("el-page-header"),u=s("el-card"),p=s("el-input"),i=s("el-form-item"),V=s("el-input-number"),f=s("el-checkbox"),B=s("el-tree"),R=s("el-form"),A=s("el-button"),T=L,K=H("loading");return D(),O("div",X,[o(u,{shadow:"never"},{default:n(()=>[o(l,{content:P(b),onBack:e[0]||(e[0]=d=>a.$router.back())},null,8,["content"])]),_:1}),S((D(),$(u,{shadow:"never",class:"m-t-16"},{default:n(()=>[o(R,{class:"ls-form",ref_key:"formRef",ref:m,rules:t.rules,model:t.formData,"label-width":"120px"},{default:n(()=>[o(i,{label:"\u540D\u79F0",prop:"name"},{default:n(()=>[o(p,{class:"ls-input",modelValue:t.formData.name,"onUpdate:modelValue":e[1]||(e[1]=d=>t.formData.name=d),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(i,{label:"\u5907\u6CE8",prop:"desc"},{default:n(()=>[o(p,{style:{width:"280px"},modelValue:t.formData.desc,"onUpdate:modelValue":e[2]||(e[2]=d=>t.formData.desc=d),type:"textarea",rows:4,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1}),o(i,{label:"\u6392\u5E8F",prop:"sort"},{default:n(()=>[o(V,{modelValue:t.formData.sort,"onUpdate:modelValue":e[3]||(e[3]=d=>t.formData.sort=d)},null,8,["modelValue"])]),_:1}),o(i,{label:"\u6743\u9650"},{default:n(()=>[g("div",null,[o(f,{label:"\u5C55\u5F00/\u6298\u53E0",onChange:F}),o(f,{label:"\u5168\u9009/\u4E0D\u5168\u9009",onChange:w}),g("div",null,[o(B,{ref_key:"treeRef",ref:r,data:t.menuTree,props:{label:"name",children:"children"},"node-key":"id","default-expand-all":t.isExpand,"show-checkbox":""},null,8,["data","default-expand-all"])])])]),_:1})]),_:1},8,["rules","model"])]),_:1})),[[K,t.loading]]),o(T,null,{default:n(()=>[o(A,{type:"primary",onClick:E},{default:n(()=>[Y]),_:1})]),_:1})])}}});export{oe as default};

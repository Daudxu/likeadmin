import{d as A,aq as f,dG as K,u as S,l as U,k as L,E as N,c as q,a as o,w as r,Q as I,f as j,dU as H,K as M,o as _,h as O,e as h,g as P}from"./index.7fb34f62.js";import{v as $}from"./el-loading.459dc4aa.js";import{F as G}from"./index.a848ecd9.js";import{E as Q,a as z}from"./el-form-item.edb39242.js";import{E as J}from"./el-tree.373a47f6.js";import{E as W}from"./el-checkbox.f8509626.js";import{E as X}from"./el-input-number.ec2bbee0.js";import{E as Y}from"./el-input.ae8e14c0.js";import{E as Z}from"./el-card.9aedb072.js";import{E as ee}from"./el-page-header.4489dfcf.js";import{a as te,i as ae,j as oe,k as le}from"./auth.238e248f.js";import"./isEqual.c50d4493.js";import"./event.776e7e11.js";import"./index.8cdce149.js";import"./index.62992827.js";const re={class:"role-add"},ne=P("\u4FDD\u5B58"),ve=A({__name:"edit",setup(se){const c=f(),s=f(),{query:d}=K(),E=S(),e=U({loading:!1,isExpand:!1,checkStrictly:!0,menuArray:[],menuTree:[],formData:{name:"",desc:"",sort:0,menu_id:[]},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["blur"]}]}}),k=L(()=>d.id?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272"),y=()=>{te({page_type:0}).then(a=>{e.menuTree=a.lists,e.menuArray=H(a.lists)})},D=async()=>{if(!!d.id){e.loading=!0;try{const a=await ae({id:d.id});Object.keys(e.formData).forEach(t=>{e.formData[t]=a[t]}),setTimeout(()=>{b()},100),e.loading=!1}catch{e.loading=!1}}},g=()=>{var l,u;const a=(l=s.value)==null?void 0:l.getCheckedKeys(),t=(u=s.value)==null?void 0:u.getHalfCheckedKeys();return a==null||a.unshift.apply(a,t),a},b=()=>{e.formData.menu_id.forEach(a=>{M(()=>{var t;(t=s.value)==null||t.setChecked(a,!0,!1)})})},v=a=>{const t=e.menuTree;for(let l=0;l<t.length;l++)s.value.store.nodesMap[t[l].id].expanded=a},C=a=>{var t,l;a?(t=s.value)==null||t.setCheckedKeys(e.menuArray.map(u=>u.id)):(l=s.value)==null||l.setCheckedKeys([])},F=async()=>{var t;const a=d.id;await((t=c.value)==null?void 0:t.validate()),e.formData.menu_id=g(),a?await oe({id:a,...e.formData}):await le(e.formData),E.back()};return y(),D(),(a,t)=>{const l=ee,u=Z,p=Y,m=Q,x=X,i=W,V=J,w=z,B=N,R=G,T=$;return _(),q("div",re,[o(u,{shadow:"never"},{default:r(()=>[o(l,{content:O(k),onBack:t[0]||(t[0]=n=>a.$router.back())},null,8,["content"])]),_:1}),I((_(),j(u,{shadow:"never",class:"m-t-16"},{default:r(()=>[o(w,{class:"ls-form",ref_key:"formRef",ref:c,rules:e.rules,model:e.formData,"label-width":"120px"},{default:r(()=>[o(m,{label:"\u540D\u79F0",prop:"name"},{default:r(()=>[o(p,{class:"ls-input",modelValue:e.formData.name,"onUpdate:modelValue":t[1]||(t[1]=n=>e.formData.name=n),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(m,{label:"\u5907\u6CE8",prop:"desc"},{default:r(()=>[o(p,{style:{width:"280px"},modelValue:e.formData.desc,"onUpdate:modelValue":t[2]||(t[2]=n=>e.formData.desc=n),type:"textarea",rows:4,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1}),o(m,{label:"\u6392\u5E8F",prop:"sort"},{default:r(()=>[o(x,{modelValue:e.formData.sort,"onUpdate:modelValue":t[3]||(t[3]=n=>e.formData.sort=n)},null,8,["modelValue"])]),_:1}),o(m,{label:"\u6743\u9650"},{default:r(()=>[h("div",null,[o(i,{label:"\u5C55\u5F00/\u6298\u53E0",onChange:v}),o(i,{label:"\u5168\u9009/\u4E0D\u5168\u9009",onChange:C}),o(i,{modelValue:e.checkStrictly,"onUpdate:modelValue":t[4]||(t[4]=n=>e.checkStrictly=n),label:"\u7236\u5B50\u8054\u52A8"},null,8,["modelValue"]),h("div",null,[o(V,{ref_key:"treeRef",ref:s,data:e.menuTree,props:{label:"name",children:"children"},"check-strictly":!e.checkStrictly,"node-key":"id","default-expand-all":e.isExpand,"show-checkbox":""},null,8,["data","check-strictly","default-expand-all"])])])]),_:1})]),_:1},8,["rules","model"])]),_:1})),[[T,e.loading]]),o(R,null,{default:r(()=>[o(B,{type:"primary",onClick:F},{default:r(()=>[ne]),_:1})]),_:1})])}}});export{ve as default};

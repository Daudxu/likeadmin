import{a1 as he,aB as $,a8 as ce,a9 as ae,am as ue,F as ie,d as de,aZ as se,dn as ye,dp as _e,ct as fe,P as pe,cY as be,r as w,aT as ke,aq as xe,k as h,L as ne,K as ve,m as me,o as y,f as oe,a as u,w as I,e as m,T as d,h as t,az as ze,i as _,p as T,cs as Ie,c as O,d3 as Le,d4 as Ce,V as le,dq as Ee,cv as Te,W as Oe,dr as Se,ds as Ne,bQ as $e,Q as Ye,aw as Ae,q as re,U as K,ak as Re,bf as Be,X as ge,dt as V,dd as B,du as Ve,$ as we,an as Xe,ax as Me,t as De,d9 as Fe,D as Pe,dv as je}from"./index.94cff847.js";import{d as He}from"./el-tag.5a331d0e.js";import{u as Ze}from"./index.09fe042e.js";import{a as We}from"./scroll.c9d77191.js";var qe="Expected a function";function te(l,r,n){var i=!0,S=!0;if(typeof l!="function")throw new TypeError(qe);return he(n)&&(i="leading"in n?!!n.leading:i,S="trailing"in n?!!n.trailing:S),He(l,r,{leading:i,maxWait:r,trailing:S})}const Ke=(l,r)=>{if(!$||!l||!r)return!1;const n=l.getBoundingClientRect();let i;return r instanceof Element?i=r.getBoundingClientRect():i={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},n.top<i.bottom&&n.bottom>i.top&&n.right>i.left&&n.left<i.right},mt=l=>{let r,n;return l.type==="touchend"?(n=l.changedTouches[0].clientY,r=l.changedTouches[0].clientX):l.type.startsWith("touch")?(n=l.touches[0].clientY,r=l.touches[0].clientX):(n=l.clientY,r=l.clientX),{clientX:r,clientY:n}},Qe=()=>$&&/firefox/i.test(window.navigator.userAgent),Ue=ce({urlList:{type:ae(Array),default:()=>ue([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0}}),Ge={close:()=>!0,switch:l=>ie(l)},Je=["src"],et={name:"ElImageViewer"},tt=de({...et,props:Ue,emits:Ge,setup(l,{emit:r}){const n=l,i={CONTAIN:{name:"contain",icon:se(ye)},ORIGINAL:{name:"original",icon:se(_e)}},S=Qe()?"DOMMouseScroll":"mousewheel",{t:L}=fe(),s=pe("image-viewer"),{nextZIndex:Q}=be(),N=w(),b=w([]),k=ke(),x=w(!0),f=w(n.initialIndex),v=xe(i.CONTAIN),c=w({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),X=h(()=>{const{urlList:a}=n;return a.length<=1}),Y=h(()=>f.value===0),j=h(()=>f.value===n.urlList.length-1),U=h(()=>n.urlList[f.value]),M=h(()=>{const{scale:a,deg:e,offsetX:o,offsetY:p,enableTransition:C}=c.value;let g=o/a,E=p/a;switch(e%360){case 90:case-270:[g,E]=[E,-g];break;case 180:case-180:[g,E]=[-g,-E];break;case 270:case-90:[g,E]=[-E,g];break}const R={transform:`scale(${a}) rotate(${e}deg) translate(${g}px, ${E}px)`,transition:C?"transform .3s":""};return v.value.name===i.CONTAIN.name&&(R.maxWidth=R.maxHeight="100%"),R}),G=h(()=>ie(n.zIndex)?n.zIndex:Q());function A(){J(),r("close")}function D(){const a=te(o=>{switch(o.code){case B.esc:n.closeOnPressEscape&&A();break;case B.space:P();break;case B.left:W();break;case B.up:z("zoomIn");break;case B.right:q();break;case B.down:z("zoomOut");break}}),e=te(o=>{(o.wheelDelta?o.wheelDelta:-o.detail)>0?z("zoomIn",{zoomRate:1.2,enableTransition:!1}):z("zoomOut",{zoomRate:1.2,enableTransition:!1})});k.run(()=>{V(document,"keydown",a),V(document,S,e)})}function J(){k.stop()}function ee(){x.value=!1}function H(a){x.value=!1,a.target.alt=L("el.image.error")}function Z(a){if(x.value||a.button!==0||!N.value)return;c.value.enableTransition=!1;const{offsetX:e,offsetY:o}=c.value,p=a.pageX,C=a.pageY,g=te(R=>{c.value={...c.value,offsetX:e+R.pageX-p,offsetY:o+R.pageY-C}}),E=V(document,"mousemove",g);V(document,"mouseup",()=>{E()}),a.preventDefault()}function F(){c.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function P(){if(x.value)return;const a=Ve(i),e=Object.values(i),o=v.value.name,C=(e.findIndex(g=>g.name===o)+1)%a.length;v.value=i[a[C]],F()}function W(){if(Y.value&&!n.infinite)return;const a=n.urlList.length;f.value=(f.value-1+a)%a}function q(){if(j.value&&!n.infinite)return;const a=n.urlList.length;f.value=(f.value+1)%a}function z(a,e={}){if(x.value)return;const{zoomRate:o,rotateDeg:p,enableTransition:C}={zoomRate:1.4,rotateDeg:90,enableTransition:!0,...e};switch(a){case"zoomOut":c.value.scale>.2&&(c.value.scale=Number.parseFloat((c.value.scale/o).toFixed(3)));break;case"zoomIn":c.value.scale<7&&(c.value.scale=Number.parseFloat((c.value.scale*o).toFixed(3)));break;case"clockwise":c.value.deg+=p;break;case"anticlockwise":c.value.deg-=p;break}c.value.enableTransition=C}return ne(U,()=>{ve(()=>{const a=b.value[0];a!=null&&a.complete||(x.value=!0)})}),ne(f,a=>{F(),r("switch",a)}),me(()=>{var a,e;D(),(e=(a=N.value)==null?void 0:a.focus)==null||e.call(a)}),(a,e)=>(y(),oe(Be,{to:"body",disabled:!a.teleported},[u(Re,{name:"viewer-fade",appear:""},{default:I(()=>[m("div",{ref_key:"wrapper",ref:N,tabindex:-1,class:d(t(s).e("wrapper")),style:re({zIndex:t(G)})},[m("div",{class:d(t(s).e("mask")),onClick:e[0]||(e[0]=ze(o=>a.hideOnClickModal&&A(),["self"]))},null,2),_(" CLOSE "),m("span",{class:d([t(s).e("btn"),t(s).e("close")]),onClick:A},[u(t(T),null,{default:I(()=>[u(t(Ie))]),_:1})],2),_(" ARROW "),t(X)?_("v-if",!0):(y(),O(le,{key:0},[m("span",{class:d([t(s).e("btn"),t(s).e("prev"),t(s).is("disabled",!a.infinite&&t(Y))]),onClick:W},[u(t(T),null,{default:I(()=>[u(t(Le))]),_:1})],2),m("span",{class:d([t(s).e("btn"),t(s).e("next"),t(s).is("disabled",!a.infinite&&t(j))]),onClick:q},[u(t(T),null,{default:I(()=>[u(t(Ce))]),_:1})],2)],64)),_(" ACTIONS "),m("div",{class:d([t(s).e("btn"),t(s).e("actions")])},[m("div",{class:d(t(s).e("actions__inner"))},[u(t(T),{onClick:e[1]||(e[1]=o=>z("zoomOut"))},{default:I(()=>[u(t(Ee))]),_:1}),u(t(T),{onClick:e[2]||(e[2]=o=>z("zoomIn"))},{default:I(()=>[u(t(Te))]),_:1}),m("i",{class:d(t(s).e("actions__divider"))},null,2),u(t(T),{onClick:P},{default:I(()=>[(y(),oe(Oe(t(v).icon)))]),_:1}),m("i",{class:d(t(s).e("actions__divider"))},null,2),u(t(T),{onClick:e[3]||(e[3]=o=>z("anticlockwise"))},{default:I(()=>[u(t(Se))]),_:1}),u(t(T),{onClick:e[4]||(e[4]=o=>z("clockwise"))},{default:I(()=>[u(t(Ne))]),_:1})],2)],2),_(" CANVAS "),m("div",{class:d(t(s).e("canvas"))},[(y(!0),O(le,null,$e(a.urlList,(o,p)=>Ye((y(),O("img",{ref_for:!0,ref:C=>b.value[p]=C,key:o,src:o,style:re(t(M)),class:d(t(s).e("img")),onLoad:ee,onError:H,onMousedown:Z},null,46,Je)),[[Ae,p===f.value]])),128))],2),K(a.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var at=ge(tt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const nt=we(at),ot=ce({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:ae([String,Object])},previewSrcList:{type:ae(Array),default:()=>ue([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0}}),lt={load:l=>l instanceof Event,error:l=>l instanceof Event,switch:l=>ie(l),close:()=>!0},rt=["src","loading"],it={key:0},st={name:"ElImage",inheritAttrs:!1},ct=de({...st,props:ot,emits:lt,setup(l,{emit:r}){const n=l;let i="";const{t:S}=fe(),L=pe("image"),s=Xe(),Q=Ze(),N=w(),b=w(!1),k=w(!0),x=w(!1),f=w(),v=w(),c=$&&"loading"in HTMLImageElement.prototype;let X,Y;const j=h(()=>s.style),U=h(()=>{const{fit:e}=n;return $&&e?{objectFit:e}:{}}),M=h(()=>{const{previewSrcList:e}=n;return Array.isArray(e)&&e.length>0}),G=h(()=>{const{previewSrcList:e,initialIndex:o}=n;let p=o;return o>e.length-1&&(p=0),p}),A=h(()=>n.loading==="eager"?!1:!c&&n.loading==="lazy"||n.lazy),D=()=>{!$||(k.value=!0,b.value=!1,N.value=n.src)};function J(e){k.value=!1,b.value=!1,r("load",e)}function ee(e){k.value=!1,b.value=!0,r("error",e)}function H(){Ke(f.value,v.value)&&(D(),P())}const Z=je(H,200);async function F(){var e;if(!$)return;await ve();const{scrollContainer:o}=n;Fe(o)?v.value=o:Pe(o)&&o!==""?v.value=(e=document.querySelector(o))!=null?e:void 0:f.value&&(v.value=We(f.value)),v.value&&(X=V(v,"scroll",Z),setTimeout(()=>H(),100))}function P(){!$||!v.value||!Z||(X==null||X(),v.value=void 0)}function W(e){if(!!e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function q(){!M.value||(Y=V("wheel",W,{passive:!1}),i=document.body.style.overflow,document.body.style.overflow="hidden",x.value=!0)}function z(){Y==null||Y(),document.body.style.overflow=i,x.value=!1,r("close")}function a(e){r("switch",e)}return ne(()=>n.src,()=>{A.value?(k.value=!0,b.value=!1,P(),F()):D()}),me(()=>{A.value?F():D()}),(e,o)=>(y(),O("div",{ref_key:"container",ref:f,class:d([t(L).b(),e.$attrs.class]),style:re(t(j))},[N.value!==void 0&&!b.value?(y(),O("img",Me({key:0},t(Q),{src:N.value,loading:e.loading,style:t(U),class:[t(L).e("inner"),t(M)&&t(L).e("preview"),k.value&&t(L).is("loading")],onClick:q,onLoad:J,onError:ee}),null,16,rt)):_("v-if",!0),k.value||b.value?(y(),O("div",{key:1,class:d(t(L).e("wrapper"))},[k.value?K(e.$slots,"placeholder",{key:0},()=>[m("div",{class:d(t(L).e("placeholder"))},null,2)]):b.value?K(e.$slots,"error",{key:1},()=>[m("div",{class:d(t(L).e("error"))},De(t(S)("el.image.error")),3)]):_("v-if",!0)],2)):_("v-if",!0),t(M)?(y(),O(le,{key:2},[x.value?(y(),oe(t(nt),{key:0,"z-index":e.zIndex,"initial-index":t(G),infinite:e.infinite,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:z,onSwitch:a},{default:I(()=>[e.$slots.viewer?(y(),O("div",it,[K(e.$slots,"viewer")])):_("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):_("v-if",!0)],64)):_("v-if",!0)],6))}});var ut=ge(ct,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const gt=we(ut);export{gt as E,mt as g};

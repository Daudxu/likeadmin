var x=Object.defineProperty,$=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var R=(t,o,l)=>o in t?x(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,C=(t,o)=>{for(var l in o||(o={}))E.call(o,l)&&R(t,l,o[l]);if(F)for(var l of F(o))K.call(o,l)&&R(t,l,o[l]);return t},w=(t,o)=>$(t,A(o));import{_ as T,u as q,q as z,s as S,t as j,w as M,x as N}from"./index.f87774a5.js";import{F as I}from"./index.95edb3d8.js";import{d as P,q as b,a4 as U,r as G,o as H,a as d,b as J,c as L,f as n,w as a,e as O,m as D}from"./vendor.af1b6401.js";const Q=P({components:{FooterBtns:I},setup(){const{route:t,router:o}=q(),l=b(null),f=b(null),i=b(null),{formData:s,menu:c}=U(G({formData:{name:"",desc:"",auth_keys:[]},menu:{permissionsTree:[],allAuthKeys:[]}})),h={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",trigger:["blur"]}]},v=()=>{var e;(e=l.value)==null||e.validate(r=>{!r||(i.value?k():p())})},m=()=>{z().then(e=>{c.value.permissionsTree=e;let r=S(e,[],"sons");c.value.allAuthKeys=r.map(_=>_.auth_key)}).catch(e=>{console.log("err",e)})},p=()=>{j(C({},s.value)).then(e=>{console.log("res",e),setTimeout(()=>{o.back()},500)}).catch(e=>{console.log("err",e)})},k=()=>{M(w(C({},s.value),{id:i.value})).then(e=>{console.log("res",e),setTimeout(()=>{o.back()},500)}).catch(e=>{console.log("err",e)})},y=()=>{N({id:i.value}).then(e=>{var r;console.log("res",e),s.value=e,(r=f.value)==null||r.setCheckedKeys(e.auth_keys)}).catch(e=>{console.log("err",e)})},g=(e,r)=>{if(console.log(e),!e.auth_key)return;let _=s.value.auth_keys.findIndex(V=>V==e.auth_key);if(r){_==-1&&s.value.auth_keys.push(e.auth_key);return}_!=-1&&s.value.auth_keys.splice(_,1)},u=()=>{var e;(e=f.value)==null||e.setCheckedKeys(c.value.allAuthKeys)},B=()=>{var e;(e=f.value)==null||e.setCheckedKeys([])};return H(()=>{const e=t.query;e.id&&(i.value=e.id*1,y()),m()}),{id:i,formData:s,menu:c,formRef:l,treeRef:f,rules:h,getMenu:m,roleAdd:p,roleEdit:k,roleDetail:y,onSubmit:v,handlePermissionsCheckChange:g,close:B,allSelect:u}}}),W={class:"role-edit"},X={class:"flex",style:{"margin-top":"3px"}},Y=D(" \u5168\u9009 "),Z=D(" \u5168\u4E0D\u9009 "),ee=D("\u4FDD\u5B58");function oe(t,o,l,f,i,s){const c=d("el-page-header"),h=d("el-card"),v=d("el-input"),m=d("el-form-item"),p=d("el-button"),k=d("el-tree"),y=d("el-form"),g=d("footer-btns");return J(),L("div",W,[n(h,{shadow:"never"},{default:a(()=>[n(c,{content:t.id?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272",onBack:o[0]||(o[0]=u=>t.$router.back())},null,8,["content"])]),_:1}),n(h,{shadow:"never",class:"m-t-15"},{default:a(()=>[n(y,{rules:t.rules,ref:"formRef",class:"ls-form",model:t.formData,"label-width":"150px",size:"small"},{default:a(()=>[n(m,{label:"\u540D\u79F0",prop:"name"},{default:a(()=>[n(v,{modelValue:t.formData.name,"onUpdate:modelValue":o[1]||(o[1]=u=>t.formData.name=u),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),n(m,{label:"\u5907\u6CE8",prop:"desc"},{default:a(()=>[n(v,{modelValue:t.formData.desc,"onUpdate:modelValue":o[2]||(o[2]=u=>t.formData.desc=u),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea",autosize:{minRows:4,maxRows:6}},null,8,["modelValue"])]),_:1}),n(m,{label:"\u6743\u9650",prop:"auth_keys"},{default:a(()=>[O("div",X,[n(p,{type:"text",size:"mini",onClick:o[3]||(o[3]=u=>t.allSelect())},{default:a(()=>[Y]),_:1}),n(p,{type:"text",size:"mini",onClick:o[4]||(o[4]=u=>t.close())},{default:a(()=>[Z]),_:1})]),n(k,{ref:"treeRef",data:t.menu.permissionsTree,"node-key":"auth_key","default-expand-all":"",icon:"ArrowRight",props:{children:"sons",label:"name"},"empty-text":"","show-checkbox":"",onCheckChange:t.handlePermissionsCheckChange},null,8,["data","onCheckChange"])]),_:1})]),_:1},8,["rules","model"])]),_:1}),n(g,null,{default:a(()=>[n(p,{type:"primary",size:"small",onClick:t.onSubmit},{default:a(()=>[ee]),_:1},8,["onClick"])]),_:1})])}var se=T(Q,[["render",oe],["__scopeId","data-v-187b8caa"]]);export{se as default};

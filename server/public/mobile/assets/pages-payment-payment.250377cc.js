import{d as e,A as a,o as t,c as l,w as i,b as s,h as r,x as n,E as o,l as u,t as d,g as c,s as p,k as h,y as f,r as m,a as y,C as _,z as b,a8 as v,W as S,aJ as x,a4 as g,aQ as D,e as w,f as z,F as C,aR as k,$,aS as A,aT as I,aU as V,aA as j,H as P,aV as N}from"./index.46710e0e.js";import{f as F,s as U}from"./util.62664a6b.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as E}from"./u-icon.a01cd07d.js";import{E as W}from"./emitter.5b880544.js";import{_ as L}from"./u-button.fbb3dafa.js";import{_ as T}from"./u-popup.e3e74487.js";import{u as R}from"./useLockFn.079acabf.js";var H=B(e({__name:"price",props:{content:{default:""},prec:{default:2},autoPrec:{type:Boolean,default:!0},color:{default:"#FA8919"},mainSize:{default:"36rpx"},minorSize:{default:"28rpx"},lineThrough:{type:Boolean,default:!1},fontWeight:{default:"normal"},prefix:{default:"￥"},suffix:{default:""}},setup(e){const m=e,y=a((()=>F({price:m.content,take:"int"}))),_=a((()=>{let e=F({price:m.content,take:"dec",prec:m.prec});return e=e%10==0?e.substr(0,e.length-1):e,m.autoPrec?1*e?"."+e:"":m.prec?"."+e:""}));return(a,m)=>{const b=h,v=f;return t(),l(b,{class:"price-container"},{default:i((()=>[s(b,{class:p(["price-wrap",{"price-wrap--disabled":e.lineThrough}]),style:n({color:e.color})},{default:i((()=>[r(" Prefix "),s(b,{class:"fix-pre",style:n({fontSize:e.minorSize})},{default:i((()=>[o(a.$slots,"prefix",{},(()=>[u(d(e.prefix),1)]),!0)])),_:3},8,["style"]),r(" Content "),s(b,{style:n({"font-weight":e.fontWeight})},{default:i((()=>[r(" Integer "),s(v,{style:n({fontSize:e.mainSize})},{default:i((()=>[u(d(c(y)),1)])),_:1},8,["style"]),r(" Decimals "),s(v,{style:n({fontSize:e.minorSize})},{default:i((()=>[u(d(c(_)),1)])),_:1},8,["style"])])),_:1},8,["style"]),r(" Suffix "),s(b,{class:"fix-suf",style:n({fontSize:e.minorSize})},{default:i((()=>[o(a.$slots,"suffix",{},(()=>[u(d(e.suffix),1)]),!0)])),_:3},8,["style"])])),_:3},8,["class","style"])])),_:3})}}}),[["__scopeId","data-v-171c6bc6"]]);var O=B({name:"u-radio",emits:["change"],props:{name:{type:[String,Number],default:""},size:{type:[String,Number],default:34},shape:{type:String,default:""},disabled:{type:[String,Boolean],default:""},labelDisabled:{type:[String,Boolean],default:""},activeColor:{type:String,default:""},iconSize:{type:[String,Number],default:""},labelSize:{type:[String,Number],default:""}},data:()=>({parentData:{iconSize:null,labelDisabled:null,disabled:null,shape:null,activeColor:null,size:null,width:null,height:null,value:null,wrap:null}}),created(){this.parent=!1,this.updateParentData(),this.parent.children.push(this)},computed:{elDisabled(){return""!==this.disabled?this.disabled:null!==this.parentData.disabled&&this.parentData.disabled},elLabelDisabled(){return""!==this.labelDisabled?this.labelDisabled:null!==this.parentData.labelDisabled&&this.parentData.labelDisabled},elSize(){return this.size?this.size:this.parentData.size?this.parentData.size:34},elIconSize(){return this.iconSize?this.iconSize:this.parentData.iconSize?this.parentData.iconSize:20},elActiveColor(){return this.activeColor?this.activeColor:this.parentData.activeColor?this.parentData.activeColor:"primary"},elShape(){return this.shape?this.shape:this.parentData.shape?this.parentData.shape:"circle"},iconStyle(){let e={};return this.elActiveColor&&this.parentData.value===this.name&&!this.elDisabled&&(e.borderColor=this.elActiveColor,e.backgroundColor=this.elActiveColor),e.width=this.$u.addUnit(this.elSize),e.height=this.$u.addUnit(this.elSize),e},iconColor(){return this.name===this.parentData.value?"#ffffff":"transparent"},iconClass(){let e=[];return e.push("u-radio__icon-wrap--"+this.elShape),this.name===this.parentData.value&&e.push("u-radio__icon-wrap--checked"),this.elDisabled&&e.push("u-radio__icon-wrap--disabled"),this.name===this.parentData.value&&this.elDisabled&&e.push("u-radio__icon-wrap--disabled--checked"),e.join(" ")},radioStyle(){let e={};return this.parentData.width&&(e.width=this.$u.addUnit(this.parentData.width),e.flex=`0 0 ${this.$u.addUnit(this.parentData.width)}`),this.parentData.wrap&&(e.width="100%",e.flex="0 0 100%"),e}},methods:{updateParentData(){this.getParentData("u-radio-group")},onClickLabel(){this.elLabelDisabled||this.elDisabled||this.setRadioCheckedStatus()},toggle(){this.elDisabled||this.setRadioCheckedStatus()},emitEvent(){this.parentData.value!=this.name&&this.$emit("change",this.name)},setRadioCheckedStatus(){this.emitEvent(),this.parent&&(this.parent.setValue(this.name),this.parentData.value=this.name)}}},[["render",function(e,a,r,u,d,c){const f=m(y("u-icon"),E),_=h;return t(),l(_,{class:"u-radio",style:n([c.radioStyle])},{default:i((()=>[s(_,{class:p(["u-radio__icon-wrap",[c.iconClass]]),onClick:c.toggle,style:n([c.iconStyle])},{default:i((()=>[s(f,{class:"u-radio__icon-wrap__icon",name:"checkbox-mark",size:c.elIconSize,color:c.iconColor},null,8,["size","color"])])),_:1},8,["onClick","class","style"]),s(_,{class:"u-radio__label",onClick:c.onClickLabel,style:n({fontSize:e.$u.addUnit(r.labelSize)})},{default:i((()=>[o(e.$slots,"default",{},void 0,!0)])),_:3},8,["onClick","style"])])),_:3},8,["style"])}],["__scopeId","data-v-1458021f"]]);var X=B({name:"u-radio-group",emits:["update:modelValue","input","change"],mixins:[W],props:{value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},disabled:{type:Boolean,default:!1},activeColor:{type:String,default:"#2979ff"},size:{type:[String,Number],default:34},labelDisabled:{type:Boolean,default:!1},shape:{type:String,default:"circle"},iconSize:{type:[String,Number],default:20},width:{type:[String,Number],default:"auto"},wrap:{type:Boolean,default:!1}},data:()=>({uFromData:{inputAlign:"left"}}),created(){this.children=[]},mounted(){let e=this.$u.$parent.call(this,"u-form");e&&Object.keys(this.uFromData).map((a=>{this.uFromData[a]=e[a]}))},watch:{parentData(){this.children.length&&this.children.map((e=>{"function"==typeof e.updateParentData&&e.updateParentData()}))}},computed:{valueCom(){return this.modelValue},parentData(){return[this.valueCom,this.disabled,this.activeColor,this.size,this.labelDisabled,this.shape,this.iconSize,this.width,this.wrap]}},methods:{setValue(e){this.children.map((a=>{a.parentData.value!=e&&(a.parentData.value="")})),this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),setTimeout((()=>{this.dispatch("u-form-item","onFieldChange",e)}),60)}}},[["render",function(e,a,s,r,n,u){const d=h;return t(),l(d,{class:p(["u-radio-group u-clearfix","right"==n.uFromData.inputAlign?"flex-end":""])},{default:i((()=>[o(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])}],["__scopeId","data-v-b8b0ce5a"]]);var J=B(e({__name:"payment",setup(e){const a=b(),r=b(),n=b({order_amount:"",lists:[]}),o=b(!1),p=b(),f=v(),F=U((async()=>{if(0==f.userInfo.is_auth&&[A.OA_WEIXIN,A.MP_WEIXIN].includes(I)&&r.value==V.WECHAT)return(await j({title:"温馨提示",content:"当前账号未绑定微信，无法完成支付",confirmText:"去绑定"})).confirm&&P({url:"/pages/user_set/user_set"}),Promise.reject()}),(async()=>{const e=c(a);return await function(e){return _.post({url:"/pay/prepay",data:e},{isAuth:!0})}({order_id:e.id,from:e.from,pay_way:r.value})}),(async e=>{try{await N.payment(e.pay_way,e.config)}catch(a){return Promise.reject(a)}})),{isLock:B,lockFn:W}=R((async()=>{try{const e=await F();J(e)}catch(e){console.log(e)}})),J=e=>{p.value=e,$(D,{status:e})},M=async()=>{const e=c(a);var t;n.value=await(t={order_id:e.id,from:e.from},_.get({url:"/pay/payWay",data:t},{isAuth:!0}));const l=n.value.lists.find((e=>e.is_default))||n.value.lists[0];r.value=null==l?void 0:l.pay_way},Q=async()=>{const e=c(a);var t;0===(await(t={order_id:e.id,from:e.from},_.get({url:"/pay/payStatus",data:t},{isAuth:!0}))).pay_status?(uni.$u.toast("您的订单还未支付，请重新支付"),J(k.FAIL)):J(k.SUCCESS),o.value=!1};return S((e=>{a.value=e,1==Boolean(e.checkPay)&&(o.value=!0),M()})),x((()=>{g(D)})),(e,a)=>{const p=m(y("price"),H),f=h,_=m(y("u-icon"),E),b=m(y("u-radio"),O),v=m(y("u-radio-group"),X),S=m(y("u-button"),L),x=m(y("u-popup"),T);return t(),l(f,{class:"payment h-full flex flex-col"},{default:i((()=>[s(f,{class:"header bg-primary pt-[60rpx] pb-[44rpx] flex flex-col items-center"},{default:i((()=>[s(p,{content:n.value.order_amount,mainSize:"44rpx",minorSize:"34rpx",fontWeight:"500",color:"#ffffff"},null,8,["content"])])),_:1}),s(f,{class:"main flex-1 mt-[-20rpx] mx-[20rpx]"},{default:i((()=>[s(f,{class:"bg-white rounded-[14rpx]"},{default:i((()=>[s(f,{class:"payway"},{default:i((()=>[s(v,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),class:"w-full"},{default:i((()=>[(t(!0),w(C,null,z(n.value.lists,((e,a)=>(t(),l(f,{class:"p-[20rpx] flex items-center w-full",key:a,onClick:a=>{return t=e.pay_way,void(r.value=t);var t}},{default:i((()=>[s(_,{class:"flex-none",size:48,name:e.icon},null,8,["name"]),s(f,{class:"mx-[16rpx] flex-1"},{default:i((()=>[s(f,{class:"payway-item--name flex-1"},{default:i((()=>[u(d(e.name),1)])),_:2},1024),s(f,{class:"text-muted text-xs"},{default:i((()=>[u(d(e.extra),1)])),_:2},1024)])),_:2},1024),s(b,{class:"mr-[-20rpx]",name:e.pay_way},null,8,["name"])])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(f,{class:"submit-btn bg-white"},{default:i((()=>[s(S,{onClick:c(W),shape:"circle",type:"primary",loading:c(B)},{default:i((()=>[u(" 立即支付 ")])),_:1},8,["onClick","loading"])])),_:1}),s(x,{class:"pay-popup",modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=e=>o.value=e),round:"",mode:"center",borderRadius:"10",maskCloseAble:!1},{default:i((()=>[s(f,{class:"content bg-white w-[560rpx] p-[40rpx]"},{default:i((()=>[s(f,{class:"text-[38rpx] font-medium text-center"},{default:i((()=>[u(" 支付确认 ")])),_:1}),s(f,{class:"pt-[30rpx] pb-[40rpx]"},{default:i((()=>[s(f,null,{default:i((()=>[u(" 请在微信内完成支付，如果您已支付成功，请点击`已完成支付`按钮 ")])),_:1})])),_:1}),s(f,{class:"flex"},{default:i((()=>[s(f,{class:"flex-1 mr-[20rpx]"},{default:i((()=>[s(S,{shape:"circle",type:"primary",plain:"",size:"medium","hover-class":"none",customStyle:{width:"100%"},onClick:Q},{default:i((()=>[u(" 取消 ")])),_:1})])),_:1}),s(f,{class:"flex-1"},{default:i((()=>[s(S,{shape:"circle",type:"primary",size:"medium","hover-class":"none",customStyle:{width:"100%"},onClick:Q},{default:i((()=>[u(" 已完成支付 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-248ce1a0"]]);export{J as default};

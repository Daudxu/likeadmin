import{o as e,c as t,w as a,b as l,p as o,q as s,E as r,h as i,k as n,d as u,A as d,z as c,r as m,a as p,l as f,t as g,g as _,ab as h,n as x,y as b,I as v,ac as y,ad as w,a8 as k,u as C,V as S,m as V,N as j,aa as $,a1 as U,ae as L,af as B,W,J as z,ag as N,e as T,F,x as I,a7 as q,ah as E,H as G,v as H,ai as O,aj as A,i as J}from"./index.4207d159.js";import{_ as R}from"./u-image.b291e84d.js";import{_ as D}from"./u-icon.be43518d.js";import{_ as K,a as M}from"./u-form-item.96d78e6e.js";import{_ as P}from"./u-verification-code.d776b924.js";import{_ as Q}from"./u-form.8acd5f1c.js";import{_ as X}from"./u-checkbox.559b2dbb.js";import{_ as Y}from"./u-button.9651d667.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as ee}from"./avatar-upload.ab045bb8.js";import{_ as te}from"./u-popup.87433227.js";import{i as ae,u as le,l as oe}from"./account.f203fea8.js";import{S as se}from"./appEnums.18338bd1.js";import{u as re,w as ie}from"./wechat.39962e6c.js";import"./util.e67c4cd8.js";import"./_commonjsHelpers.b8add541.js";var ne=Z({name:"u-divider",props:{halfWidth:{type:[Number,String],default:150},borderColor:{type:String,default:"#dcdfe6"},type:{type:String,default:"primary"},color:{type:String,default:"#909399"},fontSize:{type:[Number,String],default:26},bgColor:{type:String,default:"#ffffff"},height:{type:[Number,String],default:"auto"},marginTop:{type:[String,Number],default:0},marginBottom:{type:[String,Number],default:0},useSlot:{type:Boolean,default:!0}},computed:{lineStyle(){let e={};return-1!=String(this.halfWidth).indexOf("%")?e.width=this.halfWidth:e.width=this.halfWidth+"rpx",this.borderColor&&(e.borderColor=this.borderColor),e}},methods:{click(){this.$emit("click")}}},[["render",function(u,d,c,m,p,f){const g=n;return e(),t(g,{class:"u-divider",style:s({height:"auto"==c.height?"auto":c.height+"rpx",backgroundColor:c.bgColor,marginBottom:c.marginBottom+"rpx",marginTop:c.marginTop+"rpx"}),onClick:f.click},{default:a((()=>[l(g,{class:o(["u-divider-line",[c.type?"u-divider-line--bordercolor--"+c.type:""]]),style:s([f.lineStyle])},null,8,["class","style"]),c.useSlot?(e(),t(g,{key:0,class:"u-divider-text",style:s({color:c.color,fontSize:c.fontSize+"rpx"})},{default:a((()=>[r(u.$slots,"default",{},void 0,!0)])),_:3},8,["style"])):i("v-if",!0),l(g,{class:o(["u-divider-line",[c.type?"u-divider-line--bordercolor--"+c.type:""]]),style:s([f.lineStyle])},null,8,["class","style"])])),_:3},8,["style","onClick"])}],["__scopeId","data-v-ba53c472"]]);const ue=u({__name:"mplogin-popup",props:{show:{type:Boolean},logo:{type:String},title:{type:String}},emits:["update:show","update"],setup(o,{emit:s}){const r=o,i=d({get:()=>r.show,set(e){s("update:show",e)}}),u=c(),k=e=>{const{nickname:t}=e.detail.value;return u.value?t?void s("update",{avatar:u.value,nickname:t}):uni.$u.toast({title:"请输入昵称"}):uni.$u.toast({title:"请添加头像"})};return(s,r)=>{const d=x,c=b,C=n,S=m(p("avatar-upload"),ee),V=m(p("u-form-item"),K),j=v,$=y,U=w,L=m(p("u-popup"),te);return e(),t(C,null,{default:a((()=>[l(L,{modelValue:_(i),"onUpdate:modelValue":r[2]||(r[2]=e=>h(i)?i.value=e:null),mode:"bottom","border-radius":"14","mask-close-able":!1},{default:a((()=>[l(C,{class:"h-[1000rpx] p-[40rpx]"},{default:a((()=>[l(C,{class:"flex items-center"},{default:a((()=>[l(d,{class:"w-[100rpx] h-[100rpx] rounded",mode:"heightFix",src:o.logo},null,8,["src"]),l(c,{class:"text-3xl ml-5 font-bold"},{default:a((()=>[f(g(o.title),1)])),_:1})])),_:1}),l(C,{class:"mt-5 text-muted"},{default:a((()=>[f(" 建议使用您的微信头像和昵称，以便获得更好的体验 ")])),_:1}),l(C,{class:"mt-[30rpx]"},{default:a((()=>[l(U,{onSubmit:k},{default:a((()=>[l(V,{required:"",label:"头像",labelWidth:120},{default:a((()=>[l(C,{class:"flex-1"},{default:a((()=>[l(S,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=e=>u.value=e)},null,8,["modelValue"])])),_:1})])),_:1}),l(V,{required:"",label:"昵称",labelWidth:120},{default:a((()=>[l(j,{class:"flex-1 h-[60rpx]",name:"nickname",type:"nickname",placeholder:"请输入昵称"})])),_:1}),l(C,{class:"mt-[80rpx]"},{default:a((()=>[l($,{class:"bg-primary rounded-full text-white text-lg h-[80rpx] leading-[80rpx]","hover-class":"none","form-type":"submit"},{default:a((()=>[f(" 确定 ")])),_:1})])),_:1}),l(C,{class:"flex justify-center mt-[60rpx]"},{default:a((()=>[l(C,{class:"text-muted",onClick:r[1]||(r[1]=e=>i.value=!1)},{default:a((()=>[f("暂不登录")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}});var de=Z(u({__name:"login",setup(s){const r=c(!0);r.value=ae();const u=k(),h=C(),x=S(),v=c(""),y=c(!1),w=c(!1),Z=V({scene:1,account:"",password:"",code:""}),ee=c(),te=e=>{v.value=e},de=d((()=>h.getWebsiteConfig)),ce=async()=>{var e,t;Z.account&&(null==(e=x.value)?void 0:e.canGetCode)&&(await E({scene:se.LOGIN,mobile:Z.account}),uni.$u.toast("发送成功"),null==(t=x.value)||t.start())},me=e=>{Z.scene=e},pe=e=>{var t;return null==(t=h.getLoginConfig.login_way)?void 0:t.includes(String(e))},fe=d((()=>h.getLoginConfig.wechat_auth)),ge=d((()=>1==h.getLoginConfig.login_agreement)),_e=d((()=>1==h.getLoginConfig.third_auth)),he=d((()=>1==h.getLoginConfig.coerce_mobile)),xe=async e=>{const{token:t,mobile:a}=e;if(!a&&he.value)return u.temToken=t,G({url:"/pages/bind_mobile/bind_mobile"}),void L();u.login(e.token),await u.getUser(),uni.$u.toast("登录成功"),L();const l=H();if(l.length>1){const e=l[l.length-1];B({success:()=>{const{onLoad:t,options:a}=e;t&&t(a)}})}else O.get(A)?N({url:O.get(A)}):z({url:"/pages/index/index"});O.remove(A)},{lockFn:be}=re((async()=>{if(!w.value&&ge.value)return uni.$u.toast("请勾选已阅读并同意《服务协议》和《隐私协议》");if(1==Z.scene){if(!Z.account)return uni.$u.toast("请输入账号/手机号码");if(!Z.password)return uni.$u.toast("请输入密码")}if(2==Z.scene){if(!Z.account)return uni.$u.toast("请输入手机号码");if(!Z.code)return uni.$u.toast("请输入验证码")}U({title:"请稍后..."});try{const e=await oe(Z);xe(e)}catch(e){L(),uni.$u.toast(e)}})),ve=async()=>{if(!w.value&&ge.value)return uni.$u.toast("请勾选已阅读并同意《服务协议》和《隐私协议》");r.value&&ie.getUrl()},ye=async e=>{await le(e,{token:u.temToken}),y.value=!1,xe(ee.value)};return j((()=>h.getLoginConfig),(e=>{e.login_way&&(Z.scene=e.login_way[0])}),{immediate:!0}),$((async()=>{try{u.isLogin&&(U({title:"请稍后..."}),await u.getUser(),L(),B())}catch(e){L()}})),W((async e=>{if(u.isLogin)return void z({url:"/pages/index/index"});const{code:t}=e;if(t){U({title:"请稍后..."});try{const e=await ie.authLogin(t);xe(e)}catch(a){throw L(),new Error(a)}N({url:"/pages/login/login"})}})),(s,u)=>{const d=m(p("u-image"),R),c=n,k=m(p("u-icon"),D),C=m(p("u-input"),M),S=m(p("u-form-item"),K),V=J,j=m(p("u-verification-code"),P),$=b,U=m(p("u-form"),Q),L=m(p("u-checkbox"),X),B=m(p("u-button"),Y),W=m(p("u-divider"),ne),z=m(p("mplogin-popup"),ue);return e(),t(c,{class:"bg-white login min-h-full flex flex-col items-center px-[40rpx] pt-[80rpx] box-border"},{default:a((()=>[l(c,null,{default:a((()=>[l(d,{src:_(h).getWebsiteConfig.shop_logo,mode:"widthFix",height:"160",width:"160"},null,8,["src"])])),_:1}),l(c,{class:"mt-4 text-xl font-medium"},{default:a((()=>[f(g(_(h).getWebsiteConfig.shop_name),1)])),_:1}),l(c,{class:"w-full mt-[60rpx] pb-[60rpx]"},{default:a((()=>[l(U,{borderBottom:""},{default:a((()=>[1==Z.scene&&pe(1)?(e(),T(F,{key:0},[l(S,{borderBottom:""},{default:a((()=>[l(k,{class:"mr-2",size:36,name:"/static/images/icon/icon_user.png"}),l(C,{class:"flex-1",modelValue:Z.account,"onUpdate:modelValue":u[0]||(u[0]=e=>Z.account=e),border:!1,placeholder:"请输入账号/手机号码"},null,8,["modelValue"])])),_:1}),l(S,{borderBottom:""},{default:a((()=>[l(k,{class:"mr-2",size:36,name:"/static/images/icon/icon_password.png"}),l(C,{class:"flex-1",modelValue:Z.password,"onUpdate:modelValue":u[1]||(u[1]=e=>Z.password=e),type:"password",placeholder:"请输入密码",border:!1},null,8,["modelValue"]),l(V,{url:"/pages/forget_pwd/forget_pwd","hover-class":"none"},{default:a((()=>[l(c,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3"},{default:a((()=>[f(" 忘记密码？ ")])),_:1})])),_:1})])),_:1})],64)):i("v-if",!0),2==Z.scene&&pe(2)?(e(),T(F,{key:1},[l(S,{borderBottom:""},{default:a((()=>[l(k,{class:"mr-2",size:36,name:"/static/images/icon/icon_mobile.png"}),l(C,{class:"flex-1",modelValue:Z.account,"onUpdate:modelValue":u[2]||(u[2]=e=>Z.account=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),l(S,{borderBottom:""},{default:a((()=>[l(k,{class:"mr-2",size:36,name:"/static/images/icon/icon_code.png"}),l(C,{class:"flex-1",modelValue:Z.code,"onUpdate:modelValue":u[3]||(u[3]=e=>Z.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),l(c,{class:"border-l border-solid border-0 border-light pl-3 leading-4 ml-3 w-[180rpx]",onClick:ce},{default:a((()=>[l(j,{ref_key:"uCodeRef",ref:x,seconds:60,onChange:te,"change-text":"x秒"},null,512),l($,{class:o(Z.account?"text-primary":"text-muted")},{default:a((()=>[f(g(v.value),1)])),_:1},8,["class"])])),_:1})])),_:1})],64)):i("v-if",!0)])),_:1}),_(ge)?(e(),t(c,{key:0,class:"mt-[40rpx]"},{default:a((()=>[l(L,{modelValue:w.value,"onUpdate:modelValue":u[6]||(u[6]=e=>w.value=e),shape:"circle"},{default:a((()=>[l(c,{class:"text-xs flex"},{default:a((()=>[f(" 已阅读并同意 "),l(c,{onClick:u[4]||(u[4]=I((()=>{}),["stop"]))},{default:a((()=>[l(V,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=service"},{default:a((()=>[f(" 《服务协议》 ")])),_:1})])),_:1}),f(" 和 "),l(c,{onClick:u[5]||(u[5]=I((()=>{}),["stop"]))},{default:a((()=>[l(V,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=privacy"},{default:a((()=>[f(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):i("v-if",!0),l(c,{class:"mt-[60rpx]"},{default:a((()=>[l(B,{type:"primary",shape:"circle",onClick:u[7]||(u[7]=e=>_(be)(Z.scene))},{default:a((()=>[f(" 登 录 ")])),_:1})])),_:1}),l(c,{class:"text-content flex justify-between mt-[40rpx]"},{default:a((()=>[l(c,{class:"flex-1"},{default:a((()=>[2==Z.scene&&pe(1)?(e(),t(c,{key:0,onClick:u[8]||(u[8]=e=>me(1))},{default:a((()=>[f(" 账号密码登录 ")])),_:1})):i("v-if",!0),1==Z.scene&&pe(2)?(e(),t(c,{key:1,onClick:u[9]||(u[9]=e=>me(2))},{default:a((()=>[f(" 短信验证码登录 ")])),_:1})):i("v-if",!0)])),_:1}),l(V,{url:"/pages/register/register","hover-class":"none"},{default:a((()=>[f("注册账号")])),_:1})])),_:1}),_(_e)&&r.value?(e(),t(c,{key:1,class:"mt-[80rpx]"},{default:a((()=>[l(W,null,{default:a((()=>[f("第三方登录")])),_:1}),q("div",{class:"flex justify-center mt-[40rpx]"},[_(fe)&&r.value?(e(),T("div",{key:0,class:"flex flex-col items-center",onClick:ve},[q("img",{src:"/mobile/assets/icon_wx.a848c744.png",class:"w-[80rpx] h-[80rpx]"}),q("div",{class:"text-sm mt-[10px]"},"微信登录")])):i("v-if",!0)])])),_:1})):i("v-if",!0)])),_:1}),l(z,{show:y.value,"onUpdate:show":u[10]||(u[10]=e=>y.value=e),logo:_(de).shop_logo,title:_(de).shop_name,onUpdate:ye},null,8,["show","logo","title"])])),_:1})}}}),[["__scopeId","data-v-23e45290"]]);export{de as default};

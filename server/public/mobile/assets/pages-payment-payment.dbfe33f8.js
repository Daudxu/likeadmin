import{d as a,z as e,a8 as s,W as t,o as l,c as r,w as o,b as u,e as n,f as i,F as c,g as p,l as m,aQ as d,ai as f,r as _,a as y,k as x,t as v,aR as w,aS as h,aT as b,aA as g,H as k,aU as j}from"./index.68799f62.js";import{g as C,a as S,_ as I,b as z,c as V,p as A}from"./pay.2195134a.js";import{_ as W}from"./u-icon.6dcdb6e7.js";import{_ as E}from"./u-button.6a010cd2.js";import{_ as F}from"./u-popup.158a05a8.js";import{u as P}from"./useLockFn.145553ea.js";import{s as U}from"./util.78cc033b.js";import{_ as $}from"./plugin-vue_export-helper.21dcd24c.js";import"./emitter.5b880544.js";var L=$(a({__name:"payment",setup(a){const $=e(),L=e(),T=e({order_amount:"",lists:[]}),H=e(!1),N=s(),R=U((async()=>{if(0==N.userInfo.is_auth&&[w.OA_WEIXIN,w.MP_WEIXIN].includes(h)&&L.value==b.WECHAT)return(await g({title:"温馨提示",content:"当前账号未绑定微信，无法完成支付",confirmText:"去绑定"})).confirm&&k({url:"/pages/user_set/user_set"}),Promise.reject()}),(async()=>{const a=p($);return await A({order_id:a.id,from:a.from,pay_way:L.value})}),(async a=>{try{await j.payment(a.pay_way,a.config)}catch(e){return Promise.reject(e)}})),{isLock:X,lockFn:B}=P((async()=>{try{const a=await R();M(a)}catch(a){console.log(a)}})),M=a=>{},O=async(a=!0)=>{const e=p($);0===(await S({order_id:e.id,from:e.from})).pay_status?(1==a&&uni.$u.toast("您的订单还未支付，请重新支付"),M(d.FAIL),f({url:`/pages/payment/payment?id=${e.id}&from=${e.from}`})):(0==a&&uni.$u.toast("您的订单已经支付，请勿重新支付"),M(d.SUCCESS)),H.value=!1};return t((a=>{$.value=a,1==Boolean(a.checkPay)&&(H.value=!0),(async()=>{const a=p($);T.value=await C({order_id:a.id,from:a.from});const e=T.value.lists.find((a=>a.is_default))||T.value.lists[0];L.value=null==e?void 0:e.pay_way})()})),(a,e)=>{const s=_(y("price"),I),t=x,d=_(y("u-icon"),W),f=_(y("u-radio"),z),w=_(y("u-radio-group"),V),h=_(y("u-button"),E),b=_(y("u-popup"),F);return l(),r(t,{class:"payment h-full flex flex-col"},{default:o((()=>[u(t,{class:"header bg-primary pt-[60rpx] pb-[44rpx] flex flex-col items-center"},{default:o((()=>[u(s,{content:T.value.order_amount,mainSize:"44rpx",minorSize:"34rpx",fontWeight:"500",color:"#ffffff"},null,8,["content"])])),_:1}),u(t,{class:"main flex-1 mt-[-20rpx] mx-[20rpx]"},{default:o((()=>[u(t,{class:"bg-white rounded-[14rpx]"},{default:o((()=>[u(t,{class:"payway"},{default:o((()=>[u(w,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=a=>L.value=a),class:"w-full"},{default:o((()=>[(l(!0),n(c,null,i(T.value.lists,((a,e)=>(l(),r(t,{class:"p-[20rpx] flex items-center w-full",key:e,onClick:e=>{return s=a.pay_way,void(L.value=s);var s}},{default:o((()=>[u(d,{class:"flex-none",size:48,name:a.icon},null,8,["name"]),u(t,{class:"mx-[16rpx] flex-1"},{default:o((()=>[u(t,{class:"payway-item--name flex-1"},{default:o((()=>[m(v(a.name),1)])),_:2},1024),u(t,{class:"text-muted text-xs"},{default:o((()=>[m(v(a.extra),1)])),_:2},1024)])),_:2},1024),u(f,{class:"mr-[-20rpx]",name:a.pay_way},null,8,["name"])])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),u(t,{class:"submit-btn bg-white"},{default:o((()=>[u(h,{onClick:p(B),shape:"circle",type:"primary",loading:p(X)},{default:o((()=>[m(" 立即支付 ")])),_:1},8,["onClick","loading"])])),_:1}),u(b,{class:"pay-popup",modelValue:H.value,"onUpdate:modelValue":e[2]||(e[2]=a=>H.value=a),round:"",mode:"center",borderRadius:"10",maskCloseAble:!1},{default:o((()=>[u(t,{class:"content bg-white w-[560rpx] p-[40rpx]"},{default:o((()=>[u(t,{class:"text-[38rpx] font-medium text-center"},{default:o((()=>[m(" 支付确认 ")])),_:1}),u(t,{class:"pt-[30rpx] pb-[40rpx]"},{default:o((()=>[u(t,null,{default:o((()=>[m(" 请在微信内完成支付，如果您已支付成功，请点击`已完成支付`按钮 ")])),_:1})])),_:1}),u(t,{class:"flex"},{default:o((()=>[u(t,{class:"flex-1 mr-[20rpx]"},{default:o((()=>[u(h,{shape:"circle",type:"primary",plain:"",size:"medium","hover-class":"none",customStyle:{width:"100%"},onClick:e[1]||(e[1]=a=>O(!1))},{default:o((()=>[m(" 重新支付 ")])),_:1})])),_:1}),u(t,{class:"flex-1"},{default:o((()=>[u(h,{shape:"circle",type:"primary",size:"medium","hover-class":"none",customStyle:{width:"100%"},onClick:O},{default:o((()=>[m(" 已完成支付 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-190587a6"]]);export{L as default};

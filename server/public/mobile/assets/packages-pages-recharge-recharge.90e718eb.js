import{r as e,a,o as t,c as s,w as o,b as r,E as l,x as u,h as c,k as i,s as d,d as n,b1 as p,g as m,z as f,A as y,a8 as h,af as _,aQ as x,N as g,e as w,F as v,f as b,l as k,t as S,ab as C,aR as I,aS as z,aT as N,aA as j,H as R,a1 as A,aU as E,m as V,W as $,aa as L,J as O,I as P,y as T,i as U}from"./index.68799f62.js";import{_ as F}from"./u-button.6a010cd2.js";import{_ as W}from"./u-icon.6dcdb6e7.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as M,b as q,c as D,g as G,a as H,p as X}from"./pay.2195134a.js";import{_ as J}from"./u-popup.158a05a8.js";import{u as Q}from"./useLockFn.145553ea.js";import{s as Y}from"./util.78cc033b.js";import{r as K,a as Z}from"./recharge.e0b25316.js";import"./emitter.5b880544.js";var ee=B({name:"u-empty",props:{src:{type:String,default:""},text:{type:String,default:""},color:{type:String,default:"#c0c4cc"},iconColor:{type:String,default:"#c0c4cc"},iconSize:{type:[String,Number],default:120},fontSize:{type:[String,Number],default:26},mode:{type:String,default:"data"},imgWidth:{type:[String,Number],default:120},imgHeight:{type:[String,Number],default:"auto"},show:{type:Boolean,default:!0},marginTop:{type:[String,Number],default:0},iconStyle:{type:Object,default:()=>({})}},data:()=>({icons:{car:"购物车为空",page:"页面不存在",search:"没有搜索结果",address:"没有收货地址",wifi:"没有WiFi",order:"订单为空",coupon:"没有优惠券",favor:"暂无收藏",permission:"无权限",history:"无历史记录",news:"无新闻列表",message:"消息列表为空",list:"列表为空",data:"数据为空"}})},[["render",function(d,n,p,m,f,y){const h=e(a("u-icon"),W),_=i;return p.show?(t(),s(_,{key:0,class:"u-empty",style:u({marginTop:p.marginTop+"rpx"})},{default:o((()=>[r(h,{name:p.src?p.src:"empty-"+p.mode,"custom-style":p.iconStyle,label:p.text?p.text:f.icons[p.mode],"label-pos":"bottom","label-color":p.color,"label-size":p.fontSize,size:p.iconSize,color:p.iconColor,"margin-top":"14"},null,8,["name","custom-style","label","label-color","label-size","size","color"]),r(_,{class:"u-slot-wrap"},{default:o((()=>[l(d.$slots,"bottom",{},void 0,!0)])),_:3})])),_:3},8,["style"])):c("v-if",!0)}],["__scopeId","data-v-582d610a"]]);var ae=B({name:"u-loading",props:{mode:{type:String,default:"circle"},color:{type:String,default:"#c7c7c7"},size:{type:[String,Number],default:"34"},show:{type:Boolean,default:!0}},computed:{cricleStyle(){let e={};return e.width=this.size+"rpx",e.height=this.size+"rpx","circle"==this.mode&&(e.borderColor=`#e4e4e4 #e4e4e4 #e4e4e4 ${this.color?this.color:"#c7c7c7"}`),e}}},[["render",function(e,a,o,r,l,n){const p=i;return o.show?(t(),s(p,{key:0,class:d(["u-loading","circle"==o.mode?"u-loading-circle":"u-loading-flower"]),style:u([n.cricleStyle])},null,8,["class","style"])):c("v-if",!0)}],["__scopeId","data-v-53c07659"]]);var te=B(n({__name:"page-status",props:{status:{type:String,default:p.LOADING},fixed:{type:Boolean,default:!0}},setup:u=>(n,f)=>{const y=e(a("u-loading"),ae),h=i;return t(),s(h,{class:d(["page-status",{"page-status--fixed":u.fixed}])},{default:o((()=>[u.status===m(p).NORMAL?l(n.$slots,"default",{key:0},void 0,!0):c("v-if",!0),c(" Loading "),u.status===m(p).LOADING?l(n.$slots,"loading",{key:1},(()=>[r(y,{size:60,mode:"flower"})]),!0):c("v-if",!0),c(" Error "),u.status===m(p).ERROR?l(n.$slots,"error",{key:2},void 0,!0):c("v-if",!0),c(" Empty "),u.status===m(p).EMPTY?l(n.$slots,"empty",{key:3},void 0,!0):c("v-if",!0)])),_:3},8,["class"])}}),[["__scopeId","data-v-4915c4f7"]]);var se=B(n({__name:"payment",props:{show:{type:Boolean,required:!0},showCheck:{type:Boolean},orderId:{type:Number,required:!0},from:{type:String,required:!0},redirect:{type:String}},emits:["update:showCheck","update:show","close","success","fail"],setup(l,{emit:u}){const c=l,d=f(),n=f(p.LOADING),V=f({order_amount:"",lists:[]}),$=y({get:()=>c.showCheck,set(e){u("update:showCheck",e)}}),L=y({get:()=>c.show,set(e){u("update:show",e)}}),O=()=>{L.value=!1,u("close")},P=h(),T=Y((async()=>{if(0==P.userInfo.is_auth&&[I.OA_WEIXIN,I.MP_WEIXIN].includes(z)&&d.value==N.WECHAT)return(await j({title:"温馨提示",content:"当前账号未绑定微信，无法完成支付",confirmText:"去绑定"})).confirm&&R({url:"/pages/user_set/user_set"}),Promise.reject()}),(async()=>(A({title:"正在支付中"}),await X({order_id:c.orderId,from:c.from,pay_way:d.value,redirect:c.redirect}))),(async e=>{try{await E.payment(e.pay_way,e.config)}catch(a){return Promise.reject(a)}})),{isLock:U,lockFn:B}=Q((async()=>{try{const e=await T();K(e),_()}catch(e){_(),console.log(e)}})),K=e=>{switch(e){case x.SUCCESS:u("success");break;case x.FAIL:u("fail")}},Z=async(e=!0)=>{0===(await H({order_id:c.orderId,from:c.from})).pay_status?(1==e&&uni.$u.toast("您的订单还未支付，请重新支付"),L.value=!0,K(x.FAIL)):(0==e&&uni.$u.toast("您的订单已经支付，请勿重新支付"),K(x.SUCCESS)),$.value=!1};return g((()=>c.show),(e=>{if(e){if(!c.orderId)return void(n.value=p.ERROR);(async()=>{try{V.value=await G({order_id:c.orderId,from:c.from}),n.value=p.NORMAL;const e=V.value.lists.find((e=>e.is_default))||V.value.lists[0];d.value=null==e?void 0:e.pay_way}catch(e){n.value=p.ERROR}})()}}),{immediate:!0}),(l,u)=>{const c=e(a("u-empty"),ee),p=e(a("price"),M),f=i,y=e(a("u-icon"),W),h=e(a("u-radio"),q),_=e(a("u-radio-group"),D),x=e(a("u-button"),F),g=e(a("page-status"),te),I=e(a("u-popup"),J);return t(),w(v,null,[r(I,{modelValue:m(L),"onUpdate:modelValue":u[1]||(u[1]=e=>C(L)?L.value=e:null),mode:"bottom","safe-area-inset-bottom":"","mask-close-able":!1,"border-radius":"14",closeable:"",onClose:O},{default:o((()=>[r(f,{class:"h-[900rpx]"},{default:o((()=>[r(g,{status:n.value,fixed:!1},{error:o((()=>[r(c,{text:"订单信息错误，无法查询到订单信息",mode:"order"})])),default:o((()=>[r(f,{class:"payment h-full w-full flex flex-col"},{default:o((()=>[r(f,{class:"header py-[50rpx] flex flex-col items-center"},{default:o((()=>[r(p,{content:V.value.order_amount,mainSize:"44rpx",minorSize:"40rpx",fontWeight:"500",color:"#333"},null,8,["content"])])),_:1}),r(f,{class:"main flex-1 mx-[20rpx]"},{default:o((()=>[r(f,null,{default:o((()=>[r(f,{class:"payway-lists"},{default:o((()=>[r(_,{modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=e=>d.value=e),class:"w-full"},{default:o((()=>[(t(!0),w(v,null,b(V.value.lists,((e,a)=>(t(),s(f,{class:"p-[20rpx] flex items-center w-full payway-item",key:a,onClick:a=>{return t=e.pay_way,void(d.value=t);var t}},{default:o((()=>[r(y,{class:"flex-none",size:48,name:e.icon},null,8,["name"]),r(f,{class:"mx-[16rpx] flex-1"},{default:o((()=>[r(f,{class:"payway-item--name flex-1"},{default:o((()=>[k(S(e.name),1)])),_:2},1024),r(f,{class:"text-muted text-xs"},{default:o((()=>[k(S(e.extra),1)])),_:2},1024)])),_:2},1024),r(h,{class:"mr-[-20rpx]",name:e.pay_way},null,8,["name"])])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(f,{class:"submit-btn p-[20rpx]"},{default:o((()=>[r(x,{onClick:m(B),shape:"circle",type:"primary",loading:m(U)},{default:o((()=>[k(" 立即支付 ")])),_:1},8,["onClick","loading"])])),_:1})])),_:1})])),_:1},8,["status"])])),_:1})])),_:1},8,["modelValue"]),r(I,{class:"pay-popup",modelValue:m($),"onUpdate:modelValue":u[4]||(u[4]=e=>C($)?$.value=e:null),round:"",mode:"center",borderRadius:"10",maskCloseAble:!1},{default:o((()=>[r(f,{class:"content bg-white w-[560rpx] p-[40rpx]"},{default:o((()=>[r(f,{class:"text-[38rpx] font-medium text-center"},{default:o((()=>[k(" 支付确认 ")])),_:1}),r(f,{class:"pt-[30rpx] pb-[40rpx]"},{default:o((()=>[r(f,null,{default:o((()=>[k(" 请在微信内完成支付，如果您已支付成功，请点击`已完成支付`按钮 ")])),_:1})])),_:1}),r(f,{class:"flex"},{default:o((()=>[r(f,{class:"flex-1 mr-[20rpx]"},{default:o((()=>[r(x,{shape:"circle",type:"primary",plain:"",size:"medium","hover-class":"none",customStyle:{width:"100%"},onClick:u[2]||(u[2]=e=>Z(!1))},{default:o((()=>[k(" 重新支付 ")])),_:1})])),_:1}),r(f,{class:"flex-1"},{default:o((()=>[r(x,{shape:"circle",type:"primary",size:"medium","hover-class":"none",customStyle:{width:"100%"},onClick:u[3]||(u[3]=e=>Z())},{default:o((()=>[k(" 已完成支付 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-ef37f14e"]]);const oe=n({__name:"recharge",setup(l){const u=f(""),c=V({orderId:"",from:"",showPay:!1,showCheck:!1,redirect:"/packages/pages/recharge/recharge"}),d=V({user_money:"",min_amount:0}),{isLock:n,lockFn:p}=Q((async()=>{const e=d.min_amount;if(!u.value)return uni.$u.toast("请输入充值金额");if(0==e&&Number(u.value)==e)return uni.$u.toast("充值金额必须大于0");if(Number(u.value)<e)return uni.$u.toast(`最低充值金额${e}`);const a=await Z({money:u.value});c.orderId=a.order_id,c.from=a.from,c.showPay=!0})),y=async()=>{c.showPay=!1,c.showCheck=!1;(await j({title:"充值结果",content:"充值成功",cancelText:"继续充值",confirmText:"回到首页"})).confirm&&O({url:"/pages/index/index"})};return $((e=>{(null==e?void 0:e.checkPay)&&(c.orderId=e.id,c.from=e.from,c.showCheck=!0)})),L((()=>{(async()=>{const e=await K();Object.assign(d,e)})()})),(l,f)=>{const h=i,_=P,x=T,g=e(a("u-button"),F),w=U,v=e(a("payment"),se);return t(),s(h,{class:"recharge p-[20rpx]"},{default:o((()=>[r(h,{class:"bg-white rounded-[14rpx] p-[40rpx]"},{default:o((()=>[r(h,{class:"text-content"},{default:o((()=>[k("充值金额")])),_:1}),r(h,{class:"border-0 border-b border-solid border-light"},{default:o((()=>[r(_,{modelValue:u.value,"onUpdate:modelValue":f[0]||(f[0]=e=>u.value=e),type:"text",class:"text-[60rpx] h-[60rpx] py-[24rpx]",placeholder:"0.00"},null,8,["modelValue"])])),_:1}),r(h,{class:"mt-[20rpx] text-xs text-muted"},{default:o((()=>[k(" 当前可用余额 "),r(x,{class:"text-primary"},{default:o((()=>[k(S(d.user_money),1)])),_:1})])),_:1})])),_:1}),r(h,{class:"mt-[40rpx]"},{default:o((()=>[r(g,{loading:m(n),type:"primary",shape:"circle",onClick:m(p)},{default:o((()=>[k(" 立即充值 ")])),_:1},8,["loading","onClick"])])),_:1}),r(h,{class:"flex justify-center m-[60rpx]"},{default:o((()=>[r(w,{url:"/packages/pages/recharge_record/recharge_record","hover-class":"none"},{default:o((()=>[r(x,{class:"text-content text-sm"},{default:o((()=>[k("充值记录")])),_:1})])),_:1})])),_:1}),r(v,{show:c.showPay,"onUpdate:show":f[1]||(f[1]=e=>c.showPay=e),"show-check":c.showCheck,"onUpdate:show-check":f[2]||(f[2]=e=>c.showCheck=e),"order-id":c.orderId,from:c.from,redirect:c.redirect,onSuccess:y},null,8,["show","show-check","order-id","from","redirect"])])),_:1})}}});export{oe as default};
